var Fs=Object.defineProperty;var js=(e,t,r)=>t in e?Fs(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var ce=(e,t,r)=>(js(e,typeof t!="symbol"?t+"":t,r),r);import{j as jsxRuntimeExports,u as useSelector,a as useDispatch,r as reactExports,d as dist,b as defaultsDeep,c as createSlice,D,C as Color,p as partition,e as createSelector,f as del,g as update,s as setMany,h as entries,i as styled,k as useTranslation,l as useCombobox,R as React,S as Select,m as dist$1,F as FontAwesomeIcon,n as faLightbulb,o as faHeadphones,q as faDisplay,t as faGear,v as lodashExports,w as createListenerMiddleware,x as captureException,y as createReduxEnhancer,z as configureStore,A as faBook,B as faSquare,E as faCircle,G as faUndo,H as faSave,I as faTrash,J as faCompress,K as faExpand,L as faMagicWandSparkles,M as faStopwatch,N as faXmarkCircle,O as ReactTextareaAutocomplete,P as faClapperboard,Q as faCode,T as faFloppyDisk,U as stringify,_ as __vitePreload,V as shallowEqual,W as faCopy,X as faAdd,Y as faMinus,Z as faRotateLeft,$ as faImage,a0 as faVideo,a1 as faStop,a2 as faPlay,a3 as faFileImport,a4 as faDownload,a5 as faShare,a6 as SketchPicker,a7 as faWarning,a8 as Draggable,a9 as keyframes,aa as faMicrochip,ab as faAngleDown,ac as faPlus,ad as faUpload,ae as faXmark,af as faToolbox,ag as useProgress,ah as faCircleQuestion,ai as useLocation,aj as Link$1,ak as faComputer,al as faCancel,am as faKeyboard,an as faStethoscope,ao as faBrush,ap as faBug,aq as faSatelliteDish,ar as faDiscord,as as faGithub,at as faLanguage,au as useResizeObserver,av as useThree,aw as J,ax as useFrame,ay as PerspectiveCamera,az as Shape,aA as E,aB as Html,aC as useGLTF,aD as Segments,aE as Segment,aF as PresentationControls,aG as BufferAttribute,aH as Object3D,aI as SpotLight,aJ as mt,aK as Canvas,aL as OrbitControls,aM as faUnlock,aN as faSpinner,aO as createGlobalStyle,aP as Route,aQ as ErrorBoundary,aR as Router,aS as useLocationProperty,aT as navigate,aU as Provider,aV as instance,aW as Browser$1,aX as initReactI18next,aY as resourcesToBackend,aZ as createRoot}from"./vendor-7fb5baf2.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const l of i)if(l.type==="childList")for(const c of l.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&s(c)}).observe(document,{childList:!0,subtree:!0});function r(i){const l={};return i.integrity&&(l.integrity=i.integrity),i.referrerPolicy&&(l.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?l.credentials="include":i.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function s(i){if(i.ep)return;i.ep=!0;const l=r(i);fetch(i.href,l)}})();const __variableDynamicImportRuntimeHelper=(e,t)=>{const r=e[t];return r?typeof r=="function"?r():Promise.resolve(r):new Promise((s,i)=>{(typeof queueMicrotask=="function"?queueMicrotask:setTimeout)(i.bind(null,new Error("Unknown variable dynamic import: "+t)))})},Fragment=jsxRuntimeExports.Fragment,jsx=jsxRuntimeExports.jsx,jsxs=jsxRuntimeExports.jsxs,style="";var TestKeyState=(e=>(e[e.Initial=0]="Initial",e[e.KeyDown=1]="KeyDown",e[e.KeyUp=2]="KeyUp",e))(TestKeyState||{}),DKSPoint=(e=>(e[e.Hold=0]="Hold",e[e.Down=1]="Down",e[e.Up=2]="Up",e[e.Single=3]="Single",e))(DKSPoint||{});const ATBG="IAMT",ATFG="IAFT";let globalAudioContext,globalAmp,globalAmpGain=1;const ampGain=.25,ampAttack=.05,ampDecay=.05,ampSustain=1,ampRelease=.05;function getAudioContext(){return globalAudioContext===void 0&&(globalAudioContext=new AudioContext),globalAudioContext}function getGlobalAmp(){if(globalAmp===void 0){const e=getAudioContext();globalAmp=e.createGain(),globalAmp.gain.value=globalAmpGain,globalAmp.connect(e.destination)}return globalAmp}function setGlobalAmpGain(e){globalAmpGain=e,globalAmp!==void 0&&(globalAmp.gain.setValueAtTime(globalAmp.gain.value,getAudioContext().currentTime),globalAmp.gain.linearRampToValueAtTime(globalAmpGain,getAudioContext().currentTime+.2))}function midiNoteToFrequency(e){let t=440;return Math.pow(2,(e-69)/12)*t}class Note{constructor(t,r){ce(this,"audioContext");ce(this,"osc");ce(this,"amp");ce(this,"ampSustainTime");ce(this,"midiNote");this.midiNote=t,this.audioContext=getAudioContext(),this.osc=new OscillatorNode(this.audioContext,{type:r,frequency:midiNoteToFrequency(this.midiNote)}),this.ampSustainTime=0,this.amp=this.audioContext.createGain(),this.amp.gain.value=0,this.amp.connect(getGlobalAmp()),this.osc.connect(this.amp)}noteOn(){const t=this.audioContext.currentTime;this.osc.start(t),this.ampSustainTime=t+ampAttack+ampDecay,this.amp.gain.linearRampToValueAtTime(ampGain,t+ampAttack),this.amp.gain.linearRampToValueAtTime(ampGain*ampSustain,this.ampSustainTime)}noteOff(){this.audioContext.currentTime>=this.ampSustainTime&&this.amp.gain.setValueAtTime(ampGain*ampSustain,this.audioContext.currentTime);const t=Math.max(this.audioContext.currentTime,this.ampSustainTime)+ampRelease;this.osc.stop(t),this.amp.gain.linearRampToValueAtTime(0,t)}}const useAppSelector=useSelector,useAppDispatch=useDispatch;var TestKeyboardSoundsMode=(e=>(e[e.Random=0]="Random",e[e.WickiHayden=1]="WickiHayden",e[e.Chromatic=2]="Chromatic",e))(TestKeyboardSoundsMode||{});let lastPressedKeys=[],notes={};const baseSeed=Math.floor(Math.random()*1e3),seededRandom=e=>((baseSeed+e)*9301+49297)%233280/233280,calculateMidiNote=(e,t,r,s,i)=>{const l=Math.min(4,r-s-1)+Math.max(0,5-r);switch(e){case 1:return[-18,-19,-14,-9,-4][l]+72+t+i*2;case 2:return[-15,-12,-7,-1,4][l]+72+t+i;case 0:default:return 72+t+Math.floor(seededRandom(s*1e3+i)*24)-12}},turnOffAllTheNotes=()=>{Object.values(notes).forEach(e=>e==null?void 0:e.noteOff())},TestKeyboardSounds=({pressedKeys:e})=>{const{waveform:t,volume:r,mode:s,transpose:i}=useAppSelector(getTestKeyboardSoundsSettings);return reactExports.useEffect(()=>{setGlobalAmpGain(r/100)},[r]),reactExports.useEffect(()=>{if(e.length===0)turnOffAllTheNotes();else{const l=e.length;lastPressedKeys=e.reduce((c,u,p)=>[...c,u.reduce((f,m,y)=>{var M,w;const K=`${p},${y}`,x=((M=lastPressedKeys==null?void 0:lastPressedKeys.at(p))==null?void 0:M.at(y))??TestKeyState.KeyUp,b=m??TestKeyState.KeyUp;if(b!=x)if(b==TestKeyState.KeyDown){const L=calculateMidiNote(s,i,l,p,y);notes[K]=new Note(L,t),notes[K].noteOn()}else b==TestKeyState.KeyUp&&((w=notes[K])==null||w.noteOff());return[...f,m]},[])],[])}},[e]),reactExports.useEffect(()=>()=>{turnOffAllTheNotes()},[]),null},THEMES={OLIVIA_DARK:{alpha:{c:"#363434",t:"#E8C4B8"},mod:{c:"#363434",t:"#E8C4B8"},accent:{c:"#E8C4B8",t:"#363434"}},OLIVE:{alpha:{t:"#66665A",c:"#D9D7C4"},mod:{c:"#66665A",t:"#9DA183"},accent:{c:"#9DA183",t:"#66665A"}},OLIVE_DARK:{alpha:{c:"#66665A",t:"#9DA183"},mod:{c:"#66665A",t:"#9DA183"},accent:{c:"#9DA183",t:"#66665A"}},OLNY:{alpha:{c:"#c20018",t:"#cfa174"},mod:{c:"#c20018",t:"#cfa174"},accent:{t:"#c20018",c:"#cfa174"}},GREG:{alpha:{c:"#f8c200",t:"#393b3b"},mod:{c:"#f7f2ea",t:"#393b3b"},accent:{c:"#171718",t:"#393b3b"}},CARBON_BLACK_A:{alpha:{c:"#788194",t:"#f3f3f3"},mod:{c:"#3b3b3e",t:"#f3f3f3"},accent:{c:"#e66b67",t:"#f3f3f3"}},CARBON_BLACK_B:{alpha:{c:"#3b3b3e",t:"#f3f3f3"},mod:{c:"#788194",t:"#f3f3f3"},accent:{c:"#e66b67",t:"#f3f3f3"}},SILVER_GREY_A:{alpha:{c:"#b2b3b8",t:"#f3f3f3"},mod:{c:"#838589",t:"#f3f3f3"},accent:{c:"#e8db5d",t:"#3d3125"}},SILVER_GREY_B:{alpha:{c:"#838589",t:"#f3f3f3"},mod:{c:"#b2b3b8",t:"#f3f3f3"},accent:{c:"#e8db5d",t:"#3d3125"}},NAVY_BLUE_A:{alpha:{c:"#547be8",t:"#f3f3f3"},mod:{c:"#49599f",t:"#f3f3f3"},accent:{c:"#4dcfe0",t:"#f3f3f3"}},NAVY_BLUE_B:{alpha:{c:"#49599f",t:"#f3f3f3"},mod:{c:"#547be8",t:"#f3f3f3"},accent:{c:"#4dcfe0",t:"#f3f3f3"}},FENDAI:{alpha:{c:"#f0ebec",t:"#07010f"},mod:{c:"#f0ebec",t:"#56395c"},accent:{c:"#fc5d75",t:"#56395c"}},HONEY_MILK:{alpha:{c:"#fffff8",t:"#07010f"},mod:{c:"#fffff8",t:"#07010f"},accent:{c:"#f8b140",t:"#07010f"}},MATCHA:{alpha:{c:"#e8e8df",t:"#4e475c"},mod:{c:"#828572",t:"#4e475c"},accent:{c:"#828572",t:"#4e475c"}},BLACK_GREY:{alpha:{c:"#7e8293",t:"#a5cbe6"},mod:{c:"#364352",t:"#eff3f2"},accent:{c:"#364352",t:"#eff3f2"}},WHITE_GREEN:{alpha:{c:"#fefefe",t:"#272727"},mod:{c:"#275c65",t:"#d0eae8"},accent:{c:"#275c65",t:"#d0eae8"}},WHITE:{alpha:{c:"#fefefe",t:"#272727"},mod:{c:"#fefefe",t:"#272727"},accent:{c:"#fefefe",t:"#272727"}},BLACK:{alpha:{c:"#272727",t:"#fefefe"},mod:{c:"#272727",t:"#fefefe"},accent:{c:"#272727",t:"#fefefe"}},BLACK_AND_WHITE:{alpha:{c:"#fefefe",t:"#272727"},mod:{c:"#272727",t:"#fefefe"},accent:{c:"#272727",t:"#fefefe"}},CLASSIC_GREY:{alpha:{c:"#fcfcfc",t:"#1a1a1a"},mod:{c:"#a0a0a0",t:"#1a1a1a"},accent:{c:"#a0a0a0",t:"#1a1a1a"}},...dist.THEMES};class Store{constructor(t){ce(this,"store");const r=localStorage.getItem("via-app-store");this.store=r?defaultsDeep(JSON.parse(r),t):t}get(t){return this.store[t]}set(t,r){const s={...this.store,[t]:{...r}};this.store=s,setTimeout(()=>{localStorage.setItem("via-app-store",JSON.stringify(s))},0)}}const entryLog=[],logCommand=(e,t,r)=>{entryLog.push({kbAddr:e,request:t,response:r,ts:Date.now()})},getLog=window.__getLogs=()=>entryLog;window.addEventListener("message",e=>{e.data.command==="fetchLogs"&&window.postMessage({command:"getLogs",payload:getLog()},"*")});const useRetry=(e,t)=>async()=>{let s=0;for(;s<=t.retries;)try{await e();break}catch(i){if(s===t.retries)throw console.debug("Retry limit exceeded",s),i;s++,console.debug(i,"retry",s,"after",t.delay),await new Promise(l=>setTimeout(l,t.delay))}},globalBuffer={},eventWaitBuffer={},filterHIDDevices=e=>e.filter(t=>{var r;return(r=t.collections)==null?void 0:r.some(s=>s.usage===97&&s.usagePage===65376)}),getVIAPathIdentifier=()=>self.crypto&&self.crypto.randomUUID&&self.crypto.randomUUID()||`via-path:${Math.random()}`,tagDevice=e=>{const t=e.__path||getVIAPathIdentifier();e.__path=t;const r={_device:e,usage:97,usagePage:65376,interface:1,vendorId:e.vendorId??-1,productId:e.productId??-1,path:t,productName:e.productName};return ExtendedHID._cache[t]=r},tryForgetDevice=e=>{const t=ExtendedHID._cache[e.path];if(t)return t._device.forget()},ExtendedHID={_cache:{},requestDevice:async()=>{const e=await navigator.hid.requestDevice({filters:[{usagePage:65376,usage:97}]});return e.forEach(tagDevice),e[0]},getFilteredDevices:async()=>{try{return filterHIDDevices(await navigator.hid.getDevices())}catch{return[]}},devices:async(e=!1)=>{let t=await ExtendedHID.getFilteredDevices();if(t.length===0||e){try{await ExtendedHID.requestDevice()}catch{return[]}t=await ExtendedHID.getFilteredDevices()}return t.map(tagDevice)},HID:class{constructor(t){ce(this,"_hidDevice");ce(this,"interface",-1);ce(this,"vendorId",-1);ce(this,"productId",-1);ce(this,"productName","");ce(this,"path","");ce(this,"openPromise",Promise.resolve());ce(this,"readP",promisify(t=>this.read(t)));if(this._hidDevice=ExtendedHID._cache[t],this._hidDevice)this.vendorId=this._hidDevice.vendorId,this.productId=this._hidDevice.productId,this.path=this._hidDevice.path,this.interface=this._hidDevice.interface,this.productName=this._hidDevice.productName,globalBuffer[this.path]=globalBuffer[this.path]||[],eventWaitBuffer[this.path]=eventWaitBuffer[this.path]||[],this._hidDevice._device.opened||this.open();else throw new Error("Missing hid device in cache")}async open(){return this._hidDevice&&!this._hidDevice._device.opened&&(this.openPromise=this._hidDevice._device.open(),this.setupListeners(),await this.openPromise),Promise.resolve()}setupListeners(){this._hidDevice&&this._hidDevice._device.addEventListener("inputreport",t=>{eventWaitBuffer[this.path].length!==0?eventWaitBuffer[this.path].shift()(new Uint8Array(t.data.buffer)):globalBuffer[this.path].push({currTime:Date.now(),message:new Uint8Array(t.data.buffer)})})}read(t){var r;this.fastForwardGlobalBuffer(Date.now()),globalBuffer[this.path].length>0?t(void 0,(r=globalBuffer[this.path].shift())==null?void 0:r.message):eventWaitBuffer[this.path].push(s=>t(void 0,s))}fastForwardGlobalBuffer(t){let r=globalBuffer[this.path].length;for(;r&&(r--,globalBuffer[this.path][0].currTime<t);)globalBuffer[this.path].shift()}async write(t){var s;await this.openPromise;const r=new Uint8Array(t.slice(1));(s=this._hidDevice)==null||s._device.sendReport(0,r)}async send(t){await this.openPromise;const r=new Uint8Array(t.slice(1)),s=Date.now();return await useRetry(async()=>{var c;await((c=this._hidDevice)==null?void 0:c._device.sendReport(0,r))},{retries:3,delay:0})(),new Promise(c=>{var u;this.fastForwardGlobalBuffer(s),globalBuffer[this.path].length>0?c((u=globalBuffer[this.path].shift())==null?void 0:u.message):eventWaitBuffer[this.path].push(p=>c(p))})}}},promisify=e=>()=>new Promise((t,r)=>{e((s,i)=>{s?r(s):t(i)})}),HID=ExtendedHID,Ne=class Ne{static startMonitoring(){this.shouldMonitor=!0,!this.hasMonitored&&navigator.hid&&(navigator.hid.addEventListener("connect",Ne.onConnect),navigator.hid.addEventListener("disconnect",Ne.onDisconnect))}static stopMonitoring(){this.shouldMonitor=!1}static on(t,r){this._listeners[t]=[...this._listeners[t],r]}static off(t,r){this._listeners[t]=this._listeners[t].filter(s=>s!==r)}};ce(Ne,"_listeners",{change:[],remove:[]}),ce(Ne,"shouldMonitor",!1),ce(Ne,"hasMonitored",!1),ce(Ne,"onConnect",({device:t})=>{console.log("Detected Connection"),Ne.shouldMonitor&&Ne._listeners.change.forEach(r=>r(t))}),ce(Ne,"onDisconnect",({device:t})=>{console.log("Detected Disconnection"),Ne.shouldMonitor&&(Ne._listeners.change.forEach(r=>r(t)),Ne._listeners.remove.forEach(r=>r(t)))});let usbDetect=Ne;async function scanDevices(e){return HID.devices(e)}function initAndConnectDevice({path:e}){return new HID.HID(e)}function startMonitoring(){usbDetect.startMonitoring()}const extractDeviceInfo=e=>({productId:e.productId,vendorId:e.vendorId,productName:e.productName,protocol:e.protocol}),initialState$c={appErrors:[]},getErrorTimestamp=()=>{const e=new Date;return`${e.toLocaleTimeString([],{hour12:!1})}.${e.getMilliseconds().toString().padStart(3,"0")}`},extractMessageFromKeyboardAPIError=e=>`Command Name: ${e.commandName}
Command: ${formatBytes(e.commandBytes)}
Response: ${formatBytes(e.responseBytes)}`,getMessageFromError=e=>e.stack||e.message,formatBytes=e=>e.join(" "),errorsSlice=createSlice({name:"errors",initialState:initialState$c,reducers:{logAppError:(e,t)=>{e.appErrors.push({...t.payload,timestamp:getErrorTimestamp()})},logKeyboardAPIError:(e,t)=>{const{deviceInfo:r}=t.payload;e.appErrors.push({timestamp:getErrorTimestamp(),message:extractMessageFromKeyboardAPIError(t.payload),deviceInfo:r})},clearAppErrors:e=>{e.appErrors=[]}}}),{logKeyboardAPIError,logAppError,clearAppErrors}=errorsSlice.actions,errorsReducer=errorsSlice.reducer,getAppErrors=e=>e.errors.appErrors,maxBitSize=5,packBits=e=>e.reduce((t,[r,s])=>t<<minBitSize(s)|r,0)>>>0,numIntoBytes=e=>[e>>24,e>>16,e>>8,e].map(t=>t&255),bytesIntoNum=e=>(e[0]<<24|e[1]<<16|e[2]<<8|e[3])>>>0,unpackBits=(e,t)=>t.reverse().reduce(({res:r,bits:s},i)=>({bits:s>>minBitSize(i),res:[s&(1<<minBitSize(i))-1,...r]}),{bits:e,res:[]}).res,minBitSize=e=>1+Array(maxBitSize).fill(0).findIndex((t,r)=>2<<r>=e),COMMAND_START=0,PER_KEY_RGB_CHANNEL_COMMAND=[0,1];var APICommand=(e=>(e[e.GET_PROTOCOL_VERSION=1]="GET_PROTOCOL_VERSION",e[e.GET_KEYBOARD_VALUE=2]="GET_KEYBOARD_VALUE",e[e.SET_KEYBOARD_VALUE=3]="SET_KEYBOARD_VALUE",e[e.DYNAMIC_KEYMAP_GET_KEYCODE=4]="DYNAMIC_KEYMAP_GET_KEYCODE",e[e.DYNAMIC_KEYMAP_SET_KEYCODE=5]="DYNAMIC_KEYMAP_SET_KEYCODE",e[e.CUSTOM_MENU_SET_VALUE=7]="CUSTOM_MENU_SET_VALUE",e[e.CUSTOM_MENU_GET_VALUE=8]="CUSTOM_MENU_GET_VALUE",e[e.CUSTOM_MENU_SAVE=9]="CUSTOM_MENU_SAVE",e[e.EEPROM_RESET=10]="EEPROM_RESET",e[e.BOOTLOADER_JUMP=11]="BOOTLOADER_JUMP",e[e.DYNAMIC_KEYMAP_MACRO_GET_COUNT=12]="DYNAMIC_KEYMAP_MACRO_GET_COUNT",e[e.DYNAMIC_KEYMAP_MACRO_GET_BUFFER_SIZE=13]="DYNAMIC_KEYMAP_MACRO_GET_BUFFER_SIZE",e[e.DYNAMIC_KEYMAP_MACRO_GET_BUFFER=14]="DYNAMIC_KEYMAP_MACRO_GET_BUFFER",e[e.DYNAMIC_KEYMAP_MACRO_SET_BUFFER=15]="DYNAMIC_KEYMAP_MACRO_SET_BUFFER",e[e.DYNAMIC_KEYMAP_MACRO_RESET=16]="DYNAMIC_KEYMAP_MACRO_RESET",e[e.DYNAMIC_KEYMAP_GET_LAYER_COUNT=17]="DYNAMIC_KEYMAP_GET_LAYER_COUNT",e[e.DYNAMIC_KEYMAP_GET_BUFFER=18]="DYNAMIC_KEYMAP_GET_BUFFER",e[e.DYNAMIC_KEYMAP_SET_BUFFER=19]="DYNAMIC_KEYMAP_SET_BUFFER",e[e.DYNAMIC_KEYMAP_GET_ENCODER=20]="DYNAMIC_KEYMAP_GET_ENCODER",e[e.DYNAMIC_KEYMAP_SET_ENCODER=21]="DYNAMIC_KEYMAP_SET_ENCODER",e[e.BACKLIGHT_CONFIG_SET_VALUE=7]="BACKLIGHT_CONFIG_SET_VALUE",e[e.BACKLIGHT_CONFIG_GET_VALUE=8]="BACKLIGHT_CONFIG_GET_VALUE",e[e.BACKLIGHT_CONFIG_SAVE=9]="BACKLIGHT_CONFIG_SAVE",e[e.TAB_MATRIX_LIGHTING_SET_INFO=192]="TAB_MATRIX_LIGHTING_SET_INFO",e[e.TAB_MATRIX_LIGHTING_SET_BUFFER=193]="TAB_MATRIX_LIGHTING_SET_BUFFER",e[e.TAB_ACTUATION=208]="TAB_ACTUATION",e[e.TAB_FILE_SET_INFO=224]="TAB_FILE_SET_INFO",e[e.TAB_FILE_SET_BUFFER=225]="TAB_FILE_SET_BUFFER",e[e.TAB_FILE_SET_CANCEL=226]="TAB_FILE_SET_CANCEL",e))(APICommand||{});const APICommandValueToName=Object.entries(APICommand).reduce((e,[t,r])=>({...e,[r]:t}),{});var KeyboardValue=(e=>(e[e.UPTIME=1]="UPTIME",e[e.LAYOUT_OPTIONS=2]="LAYOUT_OPTIONS",e[e.SWITCH_MATRIX_STATE=3]="SWITCH_MATRIX_STATE",e[e.FIRMWARE_VERSION=4]="FIRMWARE_VERSION",e[e.DEVICE_INDICATION=5]="DEVICE_INDICATION",e))(KeyboardValue||{});const BACKLIGHT_BRIGHTNESS=9,BACKLIGHT_EFFECT=10,BACKLIGHT_COLOR_1=12,BACKLIGHT_COLOR_2=13,BACKLIGHT_CUSTOM_COLOR=23,PROTOCOL_ALPHA=7,PROTOCOL_BETA=8,PROTOCOL_GAMMA=9,cache$1={},eqArr=(e,t)=>e.length!==t.length?!1:e.every((r,s)=>t[s]===r),shiftTo16Bit=([e,t])=>e<<8|t,shiftFrom16Bit=e=>[e>>8,e&255],shiftBufferTo16Bit=e=>{const t=[];for(let r=0;r<e.length;r+=2)t.push(shiftTo16Bit([e[r],e[r+1]]));return t},shiftBufferFrom16Bit=e=>e.map(shiftFrom16Bit).flatMap(t=>t),globalCommandQueue={},canConnect=e=>{try{return new KeyboardAPI(e.path),!0}catch(t){return console.error("Skipped ",e,t),!1}};class KeyboardAPI{constructor(t){ce(this,"kbAddr");if(this.kbAddr=t,!cache$1[t]){const r=initAndConnectDevice({path:t});cache$1[t]={hid:r}}}refresh(t){this.kbAddr=t,cache$1[t]={...cache$1[t],hid:initAndConnectDevice({path:t})}}async getByteBuffer(){return this.getHID().readP()}async getProtocolVersion(){try{const[,t,r]=await this.hidCommand(1);return shiftTo16Bit([t,r])}catch{return-1}}async getFirmwareVersion(){try{const t=await this.getKeyboardValue(4,[],4);return bytesIntoNum(t)}catch{return 0}}async getKey(t,r,s){const i=await this.hidCommand(4,[t,r,s]);return shiftTo16Bit([i[4],i[5]])}async getLayerCount(){if(await this.getProtocolVersion()>=PROTOCOL_BETA){const[,r]=await this.hidCommand(17);return r}return 4}async readRawMatrix(t,r){const s=await this.getProtocolVersion();if(s>=PROTOCOL_BETA)return this.fastReadRawMatrix(t,r);if(s===PROTOCOL_ALPHA)return this.slowReadRawMatrix(t,r);throw new Error("Unsupported protocol version")}async getKeymapBuffer(t,r){if(r>28)throw new Error("Max data length is 28");return[...await this.hidCommand(18,[...shiftFrom16Bit(t),r])].slice(4,r+4)}async fastReadRawMatrix({rows:t,cols:r},s){const i=t*r,l=14,c=new Array(Math.ceil(i/l)).fill(0),{res:u}=c.reduce(({res:f,remaining:m})=>m<l?{res:[...f,this.getKeymapBuffer(s*i*2+2*(i-m),m*2)],remaining:0}:{res:[...f,this.getKeymapBuffer(s*i*2+2*(i-m),l*2)],remaining:m-l},{res:[],remaining:i});return(await Promise.all(u)).flatMap(shiftBufferTo16Bit)}async slowReadRawMatrix({rows:t,cols:r},s){const i=t*r,l=new Array(i).fill(0).map((c,u)=>this.getKey(s,~~(u/r),u%r));return Promise.all(l)}async writeRawMatrix(t,r){const s=await this.getProtocolVersion();if(s>=PROTOCOL_BETA)return this.fastWriteRawMatrix(r);if(s===PROTOCOL_ALPHA)return this.slowWriteRawMatrix(t,r)}async slowWriteRawMatrix({cols:t},r){r.forEach(async(s,i)=>s.forEach(async(l,c)=>{await this.setKey(i,~~(c/t),c%t,l)}))}async fastWriteRawMatrix(t){const r=t.flatMap(l=>l.map(c=>c)),s=shiftBufferFrom16Bit(r),i=28;for(let l=0;l<s.length;l+=i){const c=s.slice(l,l+i);await this.hidCommand(19,[...shiftFrom16Bit(l),c.length,...c])}}async getKeyboardValue(t,r,s=1){const i=[t,...r];return(await this.hidCommand(2,i)).slice(1+i.length,1+i.length+s)}async setKeyboardValue(t,...r){const s=[t,...r];await this.hidCommand(3,s)}async getEncoderValue(t,r,s){const i=[t,r,+s],l=await this.hidCommand(20,i);return shiftTo16Bit([l[4],l[5]])}async setEncoderValue(t,r,s,i){const l=[t,r,+s,...shiftFrom16Bit(i)];await this.hidCommand(21,l)}async getCustomMenuValue(t){return(await this.hidCommand(8,t)).slice(0+t.length)}async setCustomMenuValue(...t){await this.hidCommand(7,t)}async getPerKeyRGBMatrix(t){return(await Promise.all(t.map(s=>this.hidCommand(8,[...PER_KEY_RGB_CHANNEL_COMMAND,s,1])))).map(s=>[...s.slice(5,7)])}async setPerKeyRGBMatrix(t,r,s){await this.hidCommand(7,[...PER_KEY_RGB_CHANNEL_COMMAND,t,1,r,s])}async getBacklightValue(t,r=1){const s=[t];return(await this.hidCommand(8,s)).slice(2,2+r)}async setBacklightValue(t,...r){const s=[t,...r];await this.hidCommand(7,s)}async getRGBMode(){const t=[BACKLIGHT_EFFECT],[,,r]=await this.hidCommand(8,t);return r}async getBrightness(){const t=[BACKLIGHT_BRIGHTNESS],[,,r]=await this.hidCommand(8,t);return r}async getColor(t){const r=[t===1?BACKLIGHT_COLOR_1:BACKLIGHT_COLOR_2],[,,s,i]=await this.hidCommand(8,r);return{hue:s,sat:i}}async setColor(t,r,s){const i=[t===1?BACKLIGHT_COLOR_1:BACKLIGHT_COLOR_2,r,s];await this.hidCommand(7,i)}async getCustomColor(t){const r=[BACKLIGHT_CUSTOM_COLOR,t],[,,,s,i]=await this.hidCommand(8,r);return{hue:s,sat:i}}async setCustomColor(t,r,s){const i=[BACKLIGHT_CUSTOM_COLOR,t,r,s];await this.hidCommand(7,i)}async setRGBMode(t){const r=[BACKLIGHT_EFFECT,t];await this.hidCommand(7,r)}async commitCustomMenu(t){await this.hidCommand(9,[t])}async saveLighting(){await this.hidCommand(9)}async resetEEPROM(){await this.hidCommand(10)}async jumpToBootloader(){await this.hidCommand(11)}async setKey(t,r,s,i){const l=await this.hidCommand(5,[t,r,s,...shiftFrom16Bit(i)]);return shiftTo16Bit([l[4],l[5]])}async getMacroCount(){const[,t]=await this.hidCommand(12);return t}async getMacroBufferSize(){const[,t,r]=await this.hidCommand(13);return shiftTo16Bit([t,r])}async getMacroBytes(){const t=await this.getMacroBufferSize(),r=28,s=[];for(let l=0;l<t;l+=28)s.push(this.hidCommand(14,[...shiftFrom16Bit(l),r]));return(await Promise.all(s)).flatMap(l=>l.slice(4))}async setMacroBytes(t){const r=await this.getMacroBufferSize(),s=t.length;if(s>r)throw new Error(`Macro size (${s}) exceeds buffer size (${r})`);const i=r-1,l=shiftFrom16Bit(i);await this.resetMacros();try{await this.hidCommand(15,[...shiftFrom16Bit(i),1,255]);const c=28;for(let u=0;u<t.length;u+=c){const p=t.slice(u,u+c);await this.hidCommand(15,[...shiftFrom16Bit(u),p.length,...p])}}finally{await this.hidCommand(15,[...l,1,0])}}async resetMacros(){await this.hidCommand(16)}async setMatrixLighting(t,r,s,i,l){const c=await this.hidCommand(192,[t,r,s,i]);if(c&&c[5]===238){const p=new Error("Error: "+c[5]);p.cause=c[5]}const u=26;for(let p=0;p<l.length;p+=u){const f=l.slice(p,p+u);await this.hidCommand(193,[...numIntoBytes(p),f.length,...f])}}async setTabFile(t,r,s){const i=await this.hidCommand(224,t.slice(0,20));if(i&&i[21]===238){const c=new Error("Error: "+i[21]);throw c.cause=i[21],c}const l=26;for(let c=0;c<t.length;c+=l){const u=t.slice(c,c+l);if(await this.hidCommand(225,[...numIntoBytes(c),u.length,...u]),s&&s()){await this.hidCommand(226);return}r&&r(c+u.length)}}async actuationCommand(t,r=[]){return await this.hidCommand(208,[t,...r])}get commandQueueWrapper(){return globalCommandQueue[this.kbAddr]?globalCommandQueue[this.kbAddr]:(globalCommandQueue[this.kbAddr]={isFlushing:!1,commandQueue:[]},globalCommandQueue[this.kbAddr])}async timeout(t){return new Promise((r,s)=>{this.commandQueueWrapper.commandQueue.push({res:r,rej:s,args:()=>new Promise(i=>setTimeout(()=>{i(),r(void 0)},t))}),this.commandQueueWrapper.isFlushing||this.flushQueue()})}async hidCommand(t,r=[]){return new Promise((s,i)=>{this.commandQueueWrapper.commandQueue.push({res:s,rej:i,args:[t,r]}),this.commandQueueWrapper.isFlushing||this.flushQueue()})}async flushQueue(){if(this.commandQueueWrapper.isFlushing!==!0){for(this.commandQueueWrapper.isFlushing=!0;this.commandQueueWrapper.commandQueue.length!==0;){const{res:t,rej:r,args:s}=this.commandQueueWrapper.commandQueue.shift();if(typeof s=="function")await s(),t();else try{const i=await this._hidCommand(...s);t(i)}catch(i){const l=extractDeviceInfo(this.getHID());store.dispatch(logAppError({message:getMessageFromError(i),deviceInfo:l})),r(i)}}this.commandQueueWrapper.isFlushing=!1}}getHID(){return cache$1[this.kbAddr].hid}async _hidCommand(t,r=[]){const s=[COMMAND_START,t,...r],i=new Array(33).fill(0);s.forEach((p,f)=>{i[f]=p});const l=await this.getHID().send(i),c=Array.from(l),u=c.slice(0,s.length-1);if(logCommand(this.kbAddr,s,c),([8,7,9].includes(t)&&r[0]===66||[208].includes(t))&&eqArr([255],c.slice(0,1))&&eqArr(s.slice(2),u.slice(1)))return console.debug(`Command for ${this.kbAddr}`,s,"Bad Resp:",c),[];if(!eqArr(s.slice(1),u)){console.error(`Command for ${this.kbAddr}:`,s,"Bad Resp:",c);const p=extractDeviceInfo(this.getHID()),f=APICommandValueToName[t];throw store.dispatch(logKeyboardAPIError({commandName:f,commandBytes:s.slice(1),responseBytes:c,deviceInfo:p})),new Error("Receiving incorrect response for command")}return t===208&&console.debug(`Command for ${this.kbAddr}`,s,"Correct Resp:",c),c}}function getVendorProductId(e,t){return e*65536+t}const idExists=({productId:e,vendorId:t},r)=>r[getVendorProductId(t,e)],getRecognisedDevices=async(e,t=!1)=>(await scanDevices(t)).filter(s=>idExists(s,e)&&canConnect(s));let deviceStore;const defaultStoreData={definitionIndex:{generatedAt:-1,hash:"",version:"2.0.0",theme:dist.getTheme(),accentColor:"#ad7070",supportedVendorProductIdMap:{}},definitions:{},settings:{showDesignTab:!1,disableFastRemap:!1,renderMode:"2D",themeMode:"dark",designDefinitionVersion:"v3",themeName:"OLIVIA_DARK",macroEditor:{smartOptimizeEnabled:!0,recordDelaysEnabled:!1,tapEnterAtEOMEnabled:!1},testKeyboardSoundsSettings:{isEnabled:!0,volume:100,waveform:"sine",mode:TestKeyboardSoundsMode.WickiHayden,transpose:0}}};function initDeviceStore(){deviceStore=new Store(defaultStoreData)}initDeviceStore();async function syncStore(){var t;const e=deviceStore.get("definitionIndex");try{const r=((t=document.getElementById("definition_hash"))==null?void 0:t.dataset.hash)||"";if(r===e.hash)return e;const s={...defaultStoreData.definitionIndex,hash:r};return deviceStore.set("definitionIndex",s),deviceStore.set("definitions",{}),s}catch(r){console.warn(r)}return e}const getMissingDefinition=async(e,t)=>{const r=getVendorProductId(e.vendorId,e.productId),s=`/definitions/${t}/${r}.json`,l=await(await fetch(s)).json();let c=deviceStore.get("definitions");const u={...c,[r]:{...c[r],[t]:l}};try{deviceStore.set("definitions",u)}catch{localStorage.clear(),initDeviceStore(),c=deviceStore.get("definitions"),deviceStore.set("definitions",{...c,[r]:{...c[r],[t]:l}})}return[l,t]},getSupportedIdsFromStore=()=>{var e;return(e=deviceStore.get("definitionIndex"))==null?void 0:e.supportedVendorProductIdMap},getDefinitionsFromStore=()=>deviceStore.get("definitions"),getThemeModeFromStore=()=>{var e;return(e=deviceStore.get("settings"))==null?void 0:e.themeMode},getThemeNameFromStore=()=>{var e;return(e=deviceStore.get("settings"))==null?void 0:e.themeName},getSettings=()=>deviceStore.get("settings"),setSettings=e=>{deviceStore.set("settings",D(e))},quantumRangesKeys=["_QK_MODS","_QK_MODS_MAX","_QK_MOD_TAP","_QK_MOD_TAP_MAX","_QK_LAYER_TAP","_QK_LAYER_TAP_MAX","_QK_LAYER_MOD","_QK_LAYER_MOD_MAX","_QK_TO","_QK_TO_MAX","_QK_MOMENTARY","_QK_MOMENTARY_MAX","_QK_DEF_LAYER","_QK_DEF_LAYER_MAX","_QK_TOGGLE_LAYER","_QK_TOGGLE_LAYER_MAX","_QK_ONE_SHOT_LAYER","_QK_ONE_SHOT_LAYER_MAX","_QK_ONE_SHOT_MOD","_QK_ONE_SHOT_MOD_MAX","_QK_LAYER_TAP_TOGGLE","_QK_LAYER_TAP_TOGGLE_MAX","_QK_KB","_QK_KB_MAX","_QK_MACRO","_QK_MACRO_MAX","_QK_TAP_DANCE","_QK_TAP_DANCE_MAX"],quantumRanges=e=>Object.keys(e).reduce((t,r)=>quantumRangesKeys.includes(r)?{...t,[r]:e[r]}:t,{}),modCodes={QK_LCTL:256,QK_LSFT:512,QK_LALT:1024,QK_LGUI:2048,QK_RMODS_MIN:4096,QK_RCTL:4352,QK_RSFT:4608,QK_RALT:5120,QK_RGUI:6144},modMasks={MOD_LCTL:1,MOD_LSFT:2,MOD_LALT:4,MOD_LGUI:8,MOD_RCTL:17,MOD_RSFT:18,MOD_RALT:20,MOD_RGUI:24,MOD_HYPR:15,MOD_MEH:7},topLevelMacroToValue={MT:"_QK_MOD_TAP",LT:"_QK_LAYER_TAP",LM:"_QK_LAYER_MOD",TO:"_QK_TO",MO:"_QK_MOMENTARY",DF:"_QK_DEF_LAYER",TG:"_QK_TOGGLE_LAYER",OSL:"_QK_ONE_SHOT_LAYER",OSM:"_QK_ONE_SHOT_MOD",TT:"_QK_LAYER_TAP_TOGGLE",CUSTOM:"_QK_KB",MACRO:"_QK_MACRO",TD:"_QK_TAP_DANCE"},modifierKeyToValue={LCTL:modCodes.QK_LCTL,C:modCodes.QK_LCTL,LSFT:modCodes.QK_LSFT,S:modCodes.QK_LSFT,LALT:modCodes.QK_LALT,A:modCodes.QK_LALT,LGUI:modCodes.QK_LGUI,LCMD:modCodes.QK_LGUI,LWIN:modCodes.QK_LGUI,G:modCodes.QK_LGUI,RCTL:modCodes.QK_RCTL,RSFT:modCodes.QK_RSFT,ALGR:modCodes.QK_RALT,RALT:modCodes.QK_RALT,RCMD:modCodes.QK_RGUI,RWIN:modCodes.QK_RGUI,RGUI:modCodes.QK_RGUI,SCMD:modCodes.QK_LSFT|modCodes.QK_LGUI,SWIN:modCodes.QK_LSFT|modCodes.QK_LGUI,SGUI:modCodes.QK_LSFT|modCodes.QK_LGUI,LSG:modCodes.QK_LSFT|modCodes.QK_LGUI,LAG:modCodes.QK_LALT|modCodes.QK_LGUI,RSG:modCodes.QK_RSFT|modCodes.QK_RGUI,RAG:modCodes.QK_RALT|modCodes.QK_RGUI,LCA:modCodes.QK_LCTL|modCodes.QK_LALT,LSA:modCodes.QK_LSFT|modCodes.QK_LALT,SAGR:modCodes.QK_RSFT|modCodes.QK_RALT,RSA:modCodes.QK_RSFT|modCodes.QK_RALT,RCS:modCodes.QK_RCTL|modCodes.QK_RSFT,LCAG:modCodes.QK_LCTL|modCodes.QK_LALT|modCodes.QK_LGUI,MEH:modCodes.QK_LCTL|modCodes.QK_LALT|modCodes.QK_LSFT,HYPR:modCodes.QK_LCTL|modCodes.QK_LALT|modCodes.QK_LSFT|modCodes.QK_LGUI},modifierValueToKey=Object.entries(modifierKeyToValue).reduce((e,[t,r])=>({...e,[r]:t}),{}),leftModifierValueToKey=Object.entries(modifierKeyToValue).filter(([e,t])=>Object.values(modCodes).includes(t)&&t<modCodes.QK_RMODS_MIN).reduce((e,[t,r])=>({...e,[r]:t}),{}),rightModifierValueToKey=Object.entries(modifierKeyToValue).filter(([e,t])=>Object.values(modCodes).includes(t)&&t>=modCodes.QK_RMODS_MIN).reduce((e,[t,r])=>({...e,[r]:t}),{}),topLevelValueToMacro=e=>Object.entries(topLevelMacroToValue).reduce((t,[r,s])=>({...t,[e[s]]:r}),{}),advancedStringToKeycode=(e,t)=>{const s=e.toUpperCase().split(/\(|\)/).map(i=>i.trim());return Object.keys(topLevelMacroToValue).includes(s[0])?parseTopLevelMacro(s,t):Object.keys(modifierKeyToValue).includes(s[0])?parseModifierCode(s,t):0},advancedKeycodeToString=(e,t,r)=>{let s=Object.entries(quantumRanges(t)).map(([K,x])=>[x,K]).sort((K,x)=>K[0]-x[0]),i=null,l=-1;for(let K=0;K<s.length;K+=2)e>=s[K][0]&&e<=s[K+1][0]&&(i=s[K][1],l=+s[K][0]);if(["_QK_MODS"].includes(i))return topLevelModToString(e,r);let u=topLevelValueToMacro(t)[l]+"(",p=e&~l,f=0,m="",y=0;switch(i){case"_QK_KB":case"_QK_MACRO":case"_QK_TAP_DANCE":u+=e-l+")";break;case"_QK_MOMENTARY":case"_QK_DEF_LAYER":case"_QK_TOGGLE_LAYER":case"_QK_ONE_SHOT_LAYER":case"_QK_LAYER_TAP_TOGGLE":case"_QK_TO":u+=p+")";break;case"_QK_LAYER_TAP":f=p>>8,m=r[p&255],u+=f+","+m+")";break;case"_QK_ONE_SHOT_MOD":u+=modValueToString(p)+")";break;case"_QK_LAYER_MOD":let K=t._QK_LAYER_MOD_MASK,x=Math.log2(K+1);f=p>>x,y=p&K,u+=f+","+modValueToString(y)+")";break;case"_QK_MOD_TAP":y=p>>8&31,m=r[p&255],u+=modValueToString(y)+","+m+")";break;default:u=null}return u},modValueToString=e=>{const t=["MOD_HYPR","MOD_MEH"];return Object.entries(modMasks).filter(s=>!t.includes(s[0])&&(s[1]&e)===s[1]).map(s=>s[0]).join(" | ")},topLevelModToString=(e,t)=>{const r=t[e&255],s=e&7936,i=modifierValueToKey[s];if(i!=null)return i+"("+r+")";const l=Object.entries(s&modCodes.QK_RMODS_MIN?rightModifierValueToKey:leftModifierValueToKey).filter(c=>{const u=Number.parseInt(c[0]);return(u&s)===u}).map(c=>c[1]);return l.join("(")+"("+r+")".repeat(l.length)},parseTopLevelMacro=(e,t)=>{const r=e[0],s=e[1]??"";let[i,l]=["",""],c=0,u=0;switch(r){case"MO":case"DF":case"TG":case"OSL":case"TT":case"TO":return c=Number.parseInt(s),c<0?0:t[topLevelMacroToValue[r]]|c&255;case"OSM":return u=parseMods(s),u===0?0:t[topLevelMacroToValue[r]]|u&255;case"LM":[i,l]=s.split(",").map(m=>m.trim());let p=t._QK_LAYER_MOD_MASK,f=Math.log2(p+1);return c=Number.parseInt(i),u=parseMods(l),c<0||u===0?0:t[topLevelMacroToValue[r]]|(c&15)<<f|u&p;case"LT":return[i,l]=s.split(",").map(m=>m.trim()),c=Number.parseInt(i),c<0||!t.hasOwnProperty(l)?0:t[topLevelMacroToValue[r]]|(c&15)<<8|t[l];case"MT":return[i,l]=s.split(",").map(m=>m.trim()),u=parseMods(i),u===0||!t.hasOwnProperty(l)?0:t[topLevelMacroToValue[r]]|(u&31)<<8|t[l]&255;case"CUSTOM":{const m=Number.parseInt(s),y=t._QK_KB_MAX-t._QK_KB;return m>=0&&m<=y?t[topLevelMacroToValue[r]]+m:0}case"MACRO":{const m=Number.parseInt(s),y=t._QK_MACRO_MAX-t._QK_MACRO;return m>=0&&m<=y?t[topLevelMacroToValue[r]]+m:0}case"TD":{const m=Number.parseInt(s),y=t._QK_TAP_DANCE_MAX-t._QK_TAP_DANCE;return m>=0&&m<=y?t[topLevelMacroToValue[r]]+m:0}default:return 0}},parseMods=(e="")=>{const t=e.split("|").map(r=>r.trim());return t.reduce((r,s)=>r&&modMasks.hasOwnProperty(s),!0)?t.reduce((r,s)=>r|modMasks[s],0):0},parseModifierCode=(e,t)=>{const r=e.filter(i=>i.length!==0),s=r.map((i,l)=>l===r.length-1?t.hasOwnProperty(i)?t[i]:null:modifierKeyToValue.hasOwnProperty(i)?modifierKeyToValue[i]:null);return s.find(i=>i===null)?0:s.reduce((i,l)=>i|l,0)},anyKeycodeToString=(e,t,r)=>{let s="";const i=advancedKeycodeToString(e,t,r);return r[e]&&!r[e].startsWith("_QK")?s=r[e]:i!==null&&(s=i),s};function isAlpha(e){return/[A-Za-z]/.test(e)&&e.length===1}function isNumpadNumber(e){return/['0-9]/.test(e)&&e.length===1}function isArrowKey(e){return/[🠗🠕🠖🠔←↑→↓]$/.test(e)}function isNumpadSymbol(e){const t="-+.÷×".split("");return e.length===1&&t.includes(e[0])}function isMultiLegend(e){const t='~!@#$%^&*()_+|{}:"<>?'.split("");return e.length!==1&&t.includes(e[0])}function getByteForCode(e,t){const r=t[e];if(r!==void 0)return r;if(isLayerCode(e))return getByteForLayerCode(e,t);if(advancedStringToKeycode(e,t)!==null)return advancedStringToKeycode(e,t);throw`Could not find byte for ${e}`}function isLayerCode(e){return/([A-Za-z]+)\((\d+)\)/.test(e)}function getByteForLayerCode(e,t){const r=e.match(/([A-Za-z]+)\((\d+)\)/);if(r){const[,s,i]=r,l=parseInt(i);switch(s){case"TO":return Math.min(t._QK_TO+l,t._QK_TO_MAX);case"MO":return Math.min(t._QK_MOMENTARY+l,t._QK_MOMENTARY_MAX);case"DF":return Math.min(t._QK_DEF_LAYER+l,t._QK_DEF_LAYER_MAX);case"TG":return Math.min(t._QK_TOGGLE_LAYER+l,t._QK_TOGGLE_LAYER_MAX);case"OSL":return Math.min(t._QK_ONE_SHOT_LAYER+l,t._QK_ONE_SHOT_LAYER_MAX);case"TT":return Math.min(t._QK_LAYER_TAP_TOGGLE+l,t._QK_LAYER_TAP_TOGGLE_MAX);case"CUSTOM":return Math.min(t._QK_KB+l,t._QK_KB_MAX);case"MACRO":return Math.min(t._QK_MACRO+l,t._QK_MACRO_MAX);case"TD":return Math.min(t._QK_TAP_DANCE+l,t._QK_TAP_DANCE_MAX);default:throw new Error("Incorrect code")}}throw new Error("No match found")}function getCodeForLayerByte(e,t){if(t._QK_TO<=e&&t._QK_TO_MAX>=e)return`TO(${e-t._QK_TO})`;if(t._QK_MOMENTARY<=e&&t._QK_MOMENTARY_MAX>=e)return`MO(${e-t._QK_MOMENTARY})`;if(t._QK_DEF_LAYER<=e&&t._QK_DEF_LAYER_MAX>=e)return`DF(${e-t._QK_DEF_LAYER})`;if(t._QK_TOGGLE_LAYER<=e&&t._QK_TOGGLE_LAYER_MAX>=e)return`TG(${e-t._QK_TOGGLE_LAYER})`;if(t._QK_ONE_SHOT_LAYER<=e&&t._QK_ONE_SHOT_LAYER_MAX>=e)return`OSL(${e-t._QK_ONE_SHOT_LAYER})`;if(t._QK_LAYER_TAP_TOGGLE<=e&&t._QK_LAYER_TAP_TOGGLE_MAX>=e)return`TT(${e-t._QK_LAYER_TAP_TOGGLE})`;if(t._QK_KB<=e&&t._QK_KB_MAX>=e)return`CUSTOM(${e-t._QK_KB})`;if(t._QK_MACRO<=e&&t._QK_MACRO_MAX>=e)return`MACRO(${e-t._QK_MACRO})`}const keycodesList=getKeycodes().reduce((e,t)=>e.concat(t.keycodes),[]),getByteToKey=e=>Object.keys(e).reduce((t,r)=>{const s=e[r];if(s in t){const i=keycodesList.find(({code:l})=>l===r);return i?{...t,[s]:i.code}:t}return{...t,[s]:r}},{});function isLayerKey(e,t){return[[t._QK_TO,t._QK_TO_MAX],[t._QK_MOMENTARY,t._QK_MOMENTARY_MAX],[t._QK_DEF_LAYER,t._QK_DEF_LAYER_MAX],[t._QK_TOGGLE_LAYER,t._QK_TOGGLE_LAYER_MAX],[t._QK_ONE_SHOT_LAYER,t._QK_ONE_SHOT_LAYER_MAX],[t._QK_LAYER_TAP_TOGGLE,t._QK_LAYER_TAP_TOGGLE_MAX],[t._QK_KB,t._QK_KB_MAX],[t._QK_MACRO,t._QK_MACRO_MAX]].some(r=>e>=r[0]&&e<=r[1])}function getCodeForByte(e,t,r){const s=r[e];return s&&!s.startsWith("_QK")?s:isLayerKey(e,t)?getCodeForLayerByte(e,t):advancedKeycodeToString(e,t,r)!==null?advancedKeycodeToString(e,t,r):"0x"+Number(e).toString(16)}function keycodeInMaster(e,t){return e in t||isLayerCode(e)||advancedStringToKeycode(e,t)!==null}function shorten(e){return e.split(" ").map(t=>t.slice(0,1)+t.slice(1).replace(/[aeiou ]/gi,"")).join("")}function isCustomKeycodeByte(e,t){return e>=t._QK_KB&&e<=t._QK_KB_MAX}function getCustomKeycodeIndex(e,t){return e-t._QK_KB}function isTapDanceByte(e,t){return e>=t._QK_TAP_DANCE&&e<=t._QK_TAP_DANCE_MAX}function getTapDanceIndex(e,t){return e-t._QK_TAP_DANCE}function isMacroKeycodeByte(e,t){return e>=t._QK_MACRO&&e<=t._QK_MACRO_MAX}function getMacroKeycodeIndex(e,t){return e-t._QK_MACRO}function getLabelForByte(e,t=100,r,s){const i=getCodeForByte(e,r,s),l=keycodesList.find(({code:c})=>c===i);return l?getShortNameForKeycode(l,t):i}function getShortNameForKeycode(e,t=100){const{code:r,name:s,shortName:i}=e;if(t<=150&&i)return i;if(t===100&&s.length>5){const l=shorten(s);if(r){const c=r.replace("KC_","").replace("_"," ");return l.length>4&&c.length<l.length?c:l}return l}return s}function getOtherMenu(e){return{id:"other",label:"Other",keycodes:Object.keys(e).filter(r=>!r.startsWith("_QK")).filter(r=>!keycodesList.map(({code:s})=>s).includes(r)).map(r=>({name:r.replace("KC_","").replace(/_/g," "),code:r}))}}function buildLayerMenu(){const e=[{name:`Fn1
(Fn3)`,code:"FN_MO13",title:"Hold = Layer 1, Hold with Fn2 = Layer 3",shortName:"Fn1(3)"},{name:`Fn2
(Fn3)`,code:"FN_MO23",title:"Hold = Layer 2, Hold with Fn1 = Layer 3",shortName:"Fn2(3)"},{name:"Space Fn1",code:"LT(1,KC_SPC)",title:"Hold = Layer 1, Tap = Space",shortName:"Spc Fn1"},{name:"Space Fn2",code:"LT(2,KC_SPC)",title:"Hold = Layer 2, Tap = Space",shortName:"Spc Fn2"},{name:"Space Fn3",code:"LT(3,KC_SPC)",title:"Hold = Layer 3, Tap = Space",shortName:"Spc Fn3"}],t={id:"layers",label:"Layers",width:"label",keycodes:[{name:"MO",code:"MO(layer)",type:"layer",layer:0,title:"Momentary turn layer on"},{name:"TG",code:"TG(layer)",type:"layer",layer:0,title:"Toggle layer on/off"},{name:"TT",code:"TT(layer)",type:"layer",layer:0,title:"Normally acts like MO unless it's tapped multple times which toggles layer on"},{name:"OSL",code:"OSL(layer)",type:"layer",layer:0,title:"Switch to layer for one keypress"},{name:"TO",code:"TO(layer)",type:"layer",layer:0,title:"Turn on layer when pressed"},{name:"DF",code:"DF(layer)",type:"layer",layer:0,title:"Sets the default layer"}]};return{...t,keycodes:[...e,...t.keycodes.flatMap(r=>{let s=[];for(let i=0;i<10;i++){const l=(r.title||"").replace("layer",`layer ${i}`),c=r.code.replace("layer",`${i}`),u=r.name+`(${i})`;s=[...s,{...r,name:u,title:l,code:c}]}return s})]}}function generateMacros(e=16){let t=[];for(let r=0;r<e;r++){const s=`M${r}`,i=`MACRO(${r})`,l=`Macro ${r}`;t=[...t,{name:s,title:l,code:i}]}return t}function getKeycodes(e=16){return[{id:"basic",label:"Basic",keycodes:[{name:"",code:"KC_NO",title:"Nothing"},{name:"▽",code:"KC_TRNS",title:"Pass-through"},{name:"Esc",code:"KC_ESC",keys:"esc"},{name:"A",code:"KC_A",keys:"a"},{name:"B",code:"KC_B",keys:"b"},{name:"C",code:"KC_C",keys:"c"},{name:"D",code:"KC_D",keys:"d"},{name:"E",code:"KC_E",keys:"e"},{name:"F",code:"KC_F",keys:"f"},{name:"G",code:"KC_G",keys:"g"},{name:"H",code:"KC_H",keys:"h"},{name:"I",code:"KC_I",keys:"i"},{name:"J",code:"KC_J",keys:"j"},{name:"K",code:"KC_K",keys:"k"},{name:"L",code:"KC_L",keys:"l"},{name:"M",code:"KC_M",keys:"m"},{name:"N",code:"KC_N",keys:"n"},{name:"O",code:"KC_O",keys:"o"},{name:"P",code:"KC_P",keys:"p"},{name:"Q",code:"KC_Q",keys:"q"},{name:"R",code:"KC_R",keys:"r"},{name:"S",code:"KC_S",keys:"s"},{name:"T",code:"KC_T",keys:"t"},{name:"U",code:"KC_U",keys:"u"},{name:"V",code:"KC_V",keys:"v"},{name:"W",code:"KC_W",keys:"w"},{name:"X",code:"KC_X",keys:"x"},{name:"Y",code:"KC_Y",keys:"y"},{name:"Z",code:"KC_Z",keys:"z"},{name:`!
1`,code:"KC_1",keys:"1"},{name:`@
2`,code:"KC_2",keys:"2"},{name:`#
3`,code:"KC_3",keys:"3"},{name:`$
4`,code:"KC_4",keys:"4"},{name:`%
5`,code:"KC_5",keys:"5"},{name:`^
6`,code:"KC_6",keys:"6"},{name:`&
7`,code:"KC_7",keys:"7"},{name:`*
8`,code:"KC_8",keys:"8"},{name:`(
9`,code:"KC_9",keys:"9"},{name:`)
0`,code:"KC_0",keys:"0"},{name:`_
-`,code:"KC_MINS",keys:"-"},{name:`+
=`,code:"KC_EQL",keys:"="},{name:"~\n`",code:"KC_GRV",keys:"`"},{name:`{
[`,code:"KC_LBRC",keys:"["},{name:`}
]`,code:"KC_RBRC",keys:"]"},{name:`|
\\`,code:"KC_BSLS",keys:"\\",width:1500},{name:`:
;`,code:"KC_SCLN",keys:";"},{name:`"
'`,code:"KC_QUOT",keys:"'"},{name:`<
,`,code:"KC_COMM",keys:","},{name:`>
.`,code:"KC_DOT",keys:"."},{name:`?
/`,code:"KC_SLSH",keys:"/"},{name:"=",code:"KC_PEQL"},{name:",",code:"KC_PCMM"},{name:"F1",code:"KC_F1"},{name:"F2",code:"KC_F2"},{name:"F3",code:"KC_F3"},{name:"F4",code:"KC_F4"},{name:"F5",code:"KC_F5"},{name:"F6",code:"KC_F6"},{name:"F7",code:"KC_F7"},{name:"F8",code:"KC_F8"},{name:"F9",code:"KC_F9"},{name:"F10",code:"KC_F10"},{name:"F11",code:"KC_F11"},{name:"F12",code:"KC_F12"},{name:"Print Screen",code:"KC_PSCR",shortName:"Print"},{name:"Scroll Lock",code:"KC_SLCK",shortName:"Scroll"},{name:"Pause",code:"KC_PAUS"},{name:"Tab",code:"KC_TAB",keys:"tab",width:1500},{name:"Backspace",code:"KC_BSPC",keys:"backspace",width:2e3,shortName:"Bksp"},{name:"Insert",code:"KC_INS",keys:"insert",shortName:"Ins"},{name:"Del",code:"KC_DEL",keys:"delete"},{name:"Home",code:"KC_HOME",keys:"home"},{name:"End",code:"KC_END",keys:"end"},{name:"Page Up",code:"KC_PGUP",keys:"pageup",shortName:"PgUp"},{name:"Page Down",code:"KC_PGDN",keys:"pagedown",shortName:"PgDn"},{name:`Num
Lock`,code:"KC_NLCK",keys:"num",shortName:"N.Lck"},{name:"Caps Lock",code:"KC_CAPS",keys:"caps_lock",width:1750},{name:"Enter",code:"KC_ENT",keys:"enter",width:2250},{name:"1",code:"KC_P1",keys:"num_1",title:"Numpad 1"},{name:"2",code:"KC_P2",keys:"num_2",title:"Numpad 2"},{name:"3",code:"KC_P3",keys:"num_3",title:"Numpad 3"},{name:"4",code:"KC_P4",keys:"num_4",title:"Numpad 4"},{name:"5",code:"KC_P5",keys:"num_5",title:"Numpad 5"},{name:"6",code:"KC_P6",keys:"num_6",title:"Numpad 6"},{name:"7",code:"KC_P7",keys:"num_7",title:"Numpad 7"},{name:"8",code:"KC_P8",keys:"num_8",title:"Numpad 8"},{name:"9",code:"KC_P9",keys:"num_9",title:"Numpad 9"},{name:"0",code:"KC_P0",width:2e3,keys:"num_0",title:"Numpad 0"},{name:"÷",code:"KC_PSLS",keys:"num_divide",title:"Numpad ÷"},{name:"×",code:"KC_PAST",keys:"num_multiply",title:"Numpad ×"},{name:"-",code:"KC_PMNS",keys:"num_subtract",title:"Numpad -"},{name:"+",code:"KC_PPLS",keys:"num_add",title:"Numpad +"},{name:".",code:"KC_PDOT",keys:"num_decimal",title:"Numpad ."},{name:`Num
Enter`,code:"KC_PENT",shortName:"N.Ent",title:"Numpad Enter"},{name:"Left Shift",code:"KC_LSFT",keys:"shift",width:2250,shortName:"LShft"},{name:"Right Shift",code:"KC_RSFT",width:2750,shortName:"RShft"},{name:"Left Ctrl",code:"KC_LCTL",keys:"ctrl",width:1250},{name:"Right Ctrl",code:"KC_RCTL",width:1250,shortName:"RCtl"},{name:"Left Win",code:"KC_LGUI",keys:"cmd",width:1250,shortName:"LWin"},{name:"Right Win",code:"KC_RGUI",width:1250,shortName:"RWin"},{name:"Left Alt",code:"KC_LALT",keys:"alt",width:1250,shortName:"LAlt"},{name:"Right Alt",code:"KC_RALT",width:1250,shortName:"RAlt"},{name:"Space",code:"KC_SPC",keys:"space",width:6250},{name:"Menu",code:"KC_APP",width:1250,shortName:"RApp"},{name:"Left",code:"KC_LEFT",keys:"left",shortName:"←"},{name:"Down",code:"KC_DOWN",keys:"down",shortName:"↓"},{name:"Up",code:"KC_UP",keys:"up",shortName:"↑"},{name:"Right",code:"KC_RGHT",keys:"right",shortName:"→"}]},{id:"wt_lighting",label:"Lighting",width:"label",keycodes:[{name:"Bright -",code:"BR_DEC",title:"Brightness -",shortName:"BR -"},{name:"Bright +",code:"BR_INC",title:"Brightness +",shortName:"BR +"},{name:"Effect -",code:"EF_DEC",title:"Effect -",shortName:"EF -"},{name:"Effect +",code:"EF_INC",title:"Effect +",shortName:"EF +"},{name:"Effect Speed -",code:"ES_DEC",title:"Effect Speed -",shortName:"ES -"},{name:"Effect Speed +",code:"ES_INC",title:"Effect Speed +",shortName:"ES +"},{name:"Color1 Hue -",code:"H1_DEC",title:"Color1 Hue -",shortName:"H1 -"},{name:"Color1 Hue +",code:"H1_INC",title:"Color1 Hue +",shortName:"H1 +"},{name:"Color2 Hue -",code:"H2_DEC",title:"Color2 Hue -",shortName:"H2 -"},{name:"Color2 Hue +",code:"H2_INC",title:"Color2 Hue +",shortName:"H2 +"},{name:"Color1 Sat -",code:"S1_DEC",title:"Color1 Sat -",shortName:"S1 -"},{name:"Color1 Sat +",code:"S1_INC",title:"Color1 Sat +",shortName:"S1 +"},{name:"Color2 Sat -",code:"S2_DEC",title:"Color2 Sat -",shortName:"S2 -"},{name:"Color2 Sat +",code:"S2_INC",title:"Color2 Sat +",shortName:"S2 +"}]},{id:"media",label:"Media",width:"label",keycodes:[{name:"Vol -",code:"KC_VOLD",title:"Volume Down"},{name:"Vol +",code:"KC_VOLU",title:"Volume Up"},{name:"Mute",code:"KC_MUTE",title:"Mute Audio"},{name:"Play",code:"KC_MPLY",title:"Play/Pause"},{name:"Media Stop",code:"KC_MSTP",title:"Media Stop"},{name:"Previous",code:"KC_MPRV",title:"Media Previous"},{name:"Next",code:"KC_MNXT",title:"Media Next"},{name:"Rewind",code:"KC_MRWD",title:"Rewind"},{name:"Fast Forward",code:"KC_MFFD",title:"Fast Forward"},{name:"Select",code:"KC_MSEL",title:"Media Select"},{name:"Eject",code:"KC_EJCT",title:"Media Eject"}]},{id:"macro",label:"Macro",width:"label",keycodes:generateMacros(e)},buildLayerMenu(),{id:"special",label:"Special",width:"label",keycodes:[{name:"~",code:"S(KC_GRV)",keys:"`",title:"Shift + `"},{name:"!",code:"S(KC_1)",keys:"!",title:"Shift + 1"},{name:"@",code:"S(KC_2)",keys:"@",title:"Shift + 2"},{name:"#",code:"S(KC_3)",keys:"#",title:"Shift + 3"},{name:"$",code:"S(KC_4)",keys:"$",title:"Shift + 4"},{name:"%",code:"S(KC_5)",keys:"%",title:"Shift + 5"},{name:"^",code:"S(KC_6)",keys:"^",title:"Shift + 6"},{name:"&",code:"S(KC_7)",keys:"&",title:"Shift + 7"},{name:"*",code:"S(KC_8)",keys:"*",title:"Shift + 8"},{name:"(",code:"S(KC_9)",keys:"(",title:"Shift + 9"},{name:")",code:"S(KC_0)",keys:")",title:"Shift + 0"},{name:"_",code:"S(KC_MINS)",keys:"_",title:"Shift + -"},{name:"+",code:"S(KC_EQL)",keys:"+",title:"Shift + ="},{name:"{",code:"S(KC_LBRC)",keys:"{",title:"Shift + ["},{name:"}",code:"S(KC_RBRC)",keys:"}",title:"Shift + ]"},{name:"|",code:"S(KC_BSLS)",keys:"|",title:"Shift + \\"},{name:":",code:"S(KC_SCLN)",keys:":",title:"Shift + /"},{name:'"',code:"S(KC_QUOT)",keys:'"',title:"Shift + '"},{name:"<",code:"S(KC_COMM)",keys:"<",title:"Shift + ,"},{name:">",code:"S(KC_DOT)",keys:">",title:"Shift + ."},{name:"?",code:"S(KC_SLSH)",keys:"?",title:"Shift + /"},{name:"NUHS",code:"KC_NUHS",title:"Non-US # and ~"},{name:"NUBS",code:"KC_NUBS",title:"Non-US \\ and |"},{name:"Ro",code:"KC_RO",title:"JIS \\ and |"},{name:"¥",code:"KC_JYEN",title:"JPN Yen"},{name:"無変換",code:"KC_MHEN",title:"JIS Muhenkan"},{name:"漢字",code:"KC_HANJ",title:"Hanja"},{name:"한영",code:"KC_HAEN",title:"HanYeong"},{name:"変換",code:"KC_HENK",title:"JIS Henkan"},{name:"かな",code:"KC_KANA",title:"JIS Katakana/Hiragana"},{name:"Esc `",code:"KC_GESC",title:"Esc normally, but ` when Shift or Win is pressed"},{name:"LS (",code:"KC_LSPO",title:"Left Shift when held, ( when tapped"},{name:"RS )",code:"KC_RSPC",title:"Right Shift when held, ) when tapped"},{name:"LC (",code:"KC_LCPO",title:"Left Control when held, ( when tapped"},{name:"RC )",code:"KC_RCPC",title:"Right Control when held, ) when tapped"},{name:"LA (",code:"KC_LAPO",title:"Left Alt when held, ( when tapped"},{name:"RA )",code:"KC_RAPC",title:"Right Alt when held, ) when tapped"},{name:"SftEnt",code:"KC_SFTENT",title:"Right Shift when held, Enter when tapped"},{name:"Reset",code:"RESET",title:"Reset the keyboard"},{name:"Debug",code:"DEBUG",title:"Toggle debug mode"},{name:"Toggle NKRO",code:"MAGIC_TOGGLE_NKRO",shortName:"NKRO",title:"Toggle NKRO"},{name:"Locking Num Lock",code:"KC_LNUM"},{name:"Locking Caps Lock",code:"KC_LCAP"},{name:"Locking Scroll Lock",code:"KC_LSCR"},{name:"Power",code:"KC_PWR"},{name:"Power OSX",code:"KC_POWER"},{name:"Sleep",code:"KC_SLEP"},{name:"Wake",code:"KC_WAKE"},{name:"Calc",code:"KC_CALC"},{name:"Mail",code:"KC_MAIL"},{name:"Help",code:"KC_HELP"},{name:"Stop",code:"KC_STOP"},{name:"Alt Erase",code:"KC_ERAS"},{name:"Again",code:"KC_AGAIN"},{name:"Menu",code:"KC_MENU"},{name:"Undo",code:"KC_UNDO"},{name:"Select",code:"KC_SELECT"},{name:"Exec",code:"KC_EXECUTE"},{name:"Cut",code:"KC_CUT"},{name:"Copy",code:"KC_COPY"},{name:"Paste",code:"KC_PASTE"},{name:"Find",code:"KC_FIND"},{name:"My Comp",code:"KC_MYCM"},{name:"Home",code:"KC_WWW_HOME"},{name:"Back",code:"KC_WWW_BACK"},{name:"Forward",code:"KC_WWW_FORWARD"},{name:"Stop",code:"KC_WWW_STOP"},{name:"Refresh",code:"KC_WWW_REFRESH"},{name:"Favorites",code:"KC_WWW_FAVORITES"},{name:"Search",code:"KC_WWW_SEARCH"},{name:"Screen +",code:"KC_BRIU",shortName:"Scr +",title:"Screen Brightness Up"},{name:"Screen -",code:"KC_BRID",shortName:"Scr -",title:"Screen Brightness Down"},{name:"F13",code:"KC_F13"},{name:"F14",code:"KC_F14"},{name:"F15",code:"KC_F15"},{name:"F16",code:"KC_F16"},{name:"F17",code:"KC_F17"},{name:"F18",code:"KC_F18"},{name:"F19",code:"KC_F19"},{name:"F20",code:"KC_F20"},{name:"F21",code:"KC_F21"},{name:"F22",code:"KC_F22"},{name:"F23",code:"KC_F23"},{name:"F24",code:"KC_F24"},{name:"Mouse ↑",code:"KC_MS_UP"},{name:"Mouse ↓",code:"KC_MS_DOWN"},{name:"Mouse ←",code:"KC_MS_LEFT"},{name:"Mouse →",code:"KC_MS_RIGHT"},{name:"Mouse Btn1",code:"KC_MS_BTN1"},{name:"Mouse Btn2",code:"KC_MS_BTN2"},{name:"Mouse Btn3",code:"KC_MS_BTN3"},{name:"Mouse Btn4",code:"KC_MS_BTN4"},{name:"Mouse Btn5",code:"KC_MS_BTN5"},{name:"Mouse Btn6",code:"KC_MS_BTN6"},{name:"Mouse Btn7",code:"KC_MS_BTN7"},{name:"Mouse Btn8",code:"KC_MS_BTN8"},{name:"Mouse Wh ↑",code:"KC_MS_WH_UP"},{name:"Mouse Wh ↓",code:"KC_MS_WH_DOWN"},{name:"Mouse Wh ←",code:"KC_MS_WH_LEFT"},{name:"Mouse Wh →",code:"KC_MS_WH_RIGHT"},{name:"Mouse Acc0",code:"KC_MS_ACCEL0"},{name:"Mouse Acc1",code:"KC_MS_ACCEL1"},{name:"Mouse Acc2",code:"KC_MS_ACCEL2"},{name:"Audio On",code:"AU_ON"},{name:"Audio Off",code:"AU_OFF"},{name:"Audio Toggle",code:"AU_TOG"},{name:"Clicky Toggle",code:"CLICKY_TOGGLE"},{name:"Clicky Enable",code:"CLICKY_ENABLE"},{name:"Clicky Disable",code:"CLICKY_DISABLE"},{name:"Clicky Up",code:"CLICKY_UP"},{name:"Clicky Down",code:"CLICKY_DOWN"},{name:"Clicky Reset",code:"CLICKY_RESET"},{name:"Music On",code:"MU_ON"},{name:"Music Off",code:"MU_OFF"},{name:"Music Toggle",code:"MU_TOG"},{name:"Music Mode",code:"MU_MOD"},{name:"Toggle GUI Status",code:"GU_TOGG"},{name:"Toggle Alt/GUI",code:"AG_TOGG"}]},{id:"qmk_lighting",label:"Lighting",width:"label",keycodes:[{name:"BL Toggle",code:"BL_TOGG"},{name:"BL On",code:"BL_ON"},{name:"BL Off",code:"BL_OFF",shortName:"BL Off"},{name:"BL -",code:"BL_DEC"},{name:"BL +",code:"BL_INC"},{name:"BL Cycle",code:"BL_STEP"},{name:"BR Toggle",code:"BL_BRTG"},{name:"RGB Toggle",code:"RGB_TOG"},{name:"RGB Mode -",code:"RGB_RMOD"},{name:"RGB Mode +",code:"RGB_MOD"},{name:"Hue -",code:"RGB_HUD"},{name:"Hue +",code:"RGB_HUI"},{name:"Sat -",code:"RGB_SAD"},{name:"Sat +",code:"RGB_SAI"},{name:"Bright -",code:"RGB_VAD"},{name:"Bright +",code:"RGB_VAI"},{name:"Effect Speed-",code:"RGB_SPD"},{name:"Effect Speed+",code:"RGB_SPI"},{name:"RGB Mode P",code:"RGB_M_P",title:"Plain"},{name:"RGB Mode B",code:"RGB_M_B",title:"Breathe"},{name:"RGB Mode R",code:"RGB_M_R",title:"Rainbow"},{name:"RGB Mode SW",code:"RGB_M_SW",title:"Swirl"},{name:"RGB Mode SN",code:"RGB_M_SN",title:"Snake"},{name:"RGB Mode K",code:"RGB_M_K",title:"Knight"},{name:"RGB Mode X",code:"RGB_M_X",title:"Xmas"},{name:"RGB Mode G",code:"RGB_M_G",title:"Gradient"}]},{id:"custom",label:"Custom",width:"label",keycodes:[{name:"CUSTOM(0)",code:"CUSTOM(0)",title:"Custom Keycode 0"},{name:"CUSTOM(1)",code:"CUSTOM(1)",title:"Custom Keycode 1"},{name:"CUSTOM(2)",code:"CUSTOM(2)",title:"Custom Keycode 2"},{name:"CUSTOM(3)",code:"CUSTOM(3)",title:"Custom Keycode 3"},{name:"CUSTOM(4)",code:"CUSTOM(4)",title:"Custom Keycode 4"},{name:"CUSTOM(5)",code:"CUSTOM(5)",title:"Custom Keycode 5"},{name:"CUSTOM(6)",code:"CUSTOM(6)",title:"Custom Keycode 6"},{name:"CUSTOM(7)",code:"CUSTOM(7)",title:"Custom Keycode 7"},{name:"CUSTOM(8)",code:"CUSTOM(8)",title:"Custom Keycode 8"},{name:"CUSTOM(9)",code:"CUSTOM(9)",title:"Custom Keycode 9"},{name:"CUSTOM(10)",code:"CUSTOM(10)",title:"Custom Keycode 10"},{name:"CUSTOM(11)",code:"CUSTOM(11)",title:"Custom Keycode 11"},{name:"CUSTOM(12)",code:"CUSTOM(12)",title:"Custom Keycode 12"},{name:"CUSTOM(13)",code:"CUSTOM(13)",title:"Custom Keycode 13"},{name:"CUSTOM(14)",code:"CUSTOM(14)",title:"Custom Keycode 14"},{name:"CUSTOM(15)",code:"CUSTOM(15)",title:"Custom Keycode 15"}]}]}const categoriesForKeycodeModule=e=>({default:["basic","media","macro","layers","special"],[dist.BuiltInKeycodeModule.WTLighting]:["wt_lighting"],[dist.BuiltInKeycodeModule.QMKLighting]:["qmk_lighting"]})[e],getKeycodesForKeyboard=e=>{let t=[];if("lighting"in e){const{keycodes:r}=dist.getLightingDefinition(e.lighting);t=categoriesForKeycodeModule("default").concat(r===dist.KeycodeType.None?[]:r===dist.KeycodeType.QMK?categoriesForKeycodeModule(dist.BuiltInKeycodeModule.QMKLighting):categoriesForKeycodeModule(dist.BuiltInKeycodeModule.WTLighting))}else{const{keycodes:r}=e;t=r.flatMap(categoriesForKeycodeModule)}return getKeycodes().flatMap(r=>t.includes(r.id)?r.keycodes:[]).sort((r,s)=>r.code<=s.code?-1:1)},CSSVarObject={keyWidth:52,keyXSpacing:2,keyHeight:54,keyYSpacing:2,keyXPos:52+2,keyYPos:54+2,faceXPadding:[6,6],faceYPadding:[2,10],insideBorder:10},KeycapMetric={keyWidth:18.1,keyXSpacing:1.05,keyHeight:18.1,keyYSpacing:1.05,keyXPos:19.15,keyYPos:19.15},getComboKeyProps=e=>{if(e.w2===void 0||e.h2===void 0)return{clipPath:null,normalizedRects:null};const{x:t,y:r,x2:s=0,y2:i=0,w:l,w2:c,h:u,h2:p}=e,f=Math.max(e.w,e.w2),m=Math.max(e.h,e.h2),y=Math.min(t,t+s),K=Math.min(r,r+i),[x,b,M,w,L,F,I,k]=l===f?[t+s-y,t-y,r+i-K,r-K,c,l,p,u]:[t-y,t+s-y,r-K,r+i-K,l,c,u,p],j=V=>`polygon(${V.map(z=>`${100*z[0]}% ${100*z[1]}%`).join(",")})`,U=[[b/f,w/m],[x/f,w/m],[x/f,M/m],[(x+L)/f,M/m],[(x+L)/f,w/m],[(b+F)/f,w/m],[(b+F)/f,(w+k)/m],[(x+L)/f,(w+k)/m],[(x+L)/f,(M+I)/m],[x/f,(M+I)/m],[x/f,(w+k)/m],[b/f,(w+k)/m]];return{clipPath:j(U),normalizedRects:[[x,M,L,I],[b,w,F,k]]}};function calculatePointPosition({x:e=0,x2:t=0,y:r=0,r:s=0,rx:i=0,ry:l=0,w:c=0,w2:u=0,h:p=0}){const f=s*(2*Math.PI)/360,m=Math.cos(f),y=Math.sin(f),K=CSSVarObject.keyXPos*i,x=CSSVarObject.keyYPos*l,b=CSSVarObject.keyXPos*(e+t)+Math.max(u,c)*CSSVarObject.keyWidth/2+(Math.max(u,c)-1)*CSSVarObject.keyXSpacing/2,M=CSSVarObject.keyYPos*r+p*CSSVarObject.keyHeight/2+(p-1)*CSSVarObject.keyYSpacing/2,w=b*m-M*y-K*m+x*y+K,L=b*y+M*m-K*y-x*m+x;return[w,L]}const sortByX=(e,t)=>{const r=calculatePointPosition(e),s=calculatePointPosition(t);return r[0]-s[0]},sortByYX=(e,t)=>{const r=calculatePointPosition(e),s=calculatePointPosition(t);return r[1]-s[1]===0?r[0]-s[0]:r[1]-s[1]},withinChain=(e,t)=>{const r=calculatePointPosition(e),s=calculatePointPosition(t);return Math.abs(r[1]-s[1])<CSSVarObject.keyYPos*.9},getTraversalOrder=e=>{const[t,...r]=[...e].sort(sortByYX);if(t===void 0)return r;{const[s,i]=partition([...e],l=>withinChain(t,l));return[...s.sort(sortByX),...getTraversalOrder(i)]}},widthProfiles={1:[1,2,3,4],1.25:[4],1.5:[2,4],1.75:[3,4],2:[1,4],2.25:[3,4],2.75:[4],3:[4],6.25:[4],7:[4]},getRowForKey=(e,t)=>e.h!==1?t:widthProfiles[e.w]?widthProfiles[e.w].includes(t)?t:widthProfiles[e.w][0]:4,getRowProfiles=e=>{switch(!e.some(r=>r.some(s=>s.w!==1||s.h!==1))||e.length){case 8:return[1,1,1,1,2,3,4,4];case 7:return[1,1,1,2,3,4,4];case 6:return[1,1,2,3,4,4];case 5:return[1,2,3,4,4];case 4:return[2,3,4,4];case 3:return[2,3,4];default:return Array(e.length).fill(1)}},getKeyId=e=>`${e.w}-${e.h}-${e.col}-${e.row}-${e.w2}-${e.h2}`,getKeyboardRowPartitions=e=>{const{partitionedKeys:t}=getTraversalOrder(e).reduce(({prevX:s,partitionedKeys:i},l)=>{const[c]=calculatePointPosition(l);return s>=c&&i.push([]),i[i.length-1].push(l),{partitionedKeys:i,prevX:c}},{partitionedKeys:[],prevX:1/0}),r=getRowProfiles(t);return{rowMap:t.reduce((s,i,l)=>i.reduce((c,u)=>({...c,[getKeyId(u)]:getRowForKey(u,r[l])}),s),{}),partitionedKeys:t}},getNextKey=(e,t)=>{const r=t.filter(c=>!c.d),s=t[e],i=getTraversalOrder([...r]),l=i.indexOf(s);return l===i.length-1?null:t.indexOf(i[(l+1)%i.length])},makeSRGBTheme=e=>Object.entries(e).reduce((t,[r,s])=>{const i=`#${new Color(s.c).convertSRGBToLinear().getHexString()}`,l=`#${new Color(s.t).convertSRGBToLinear().getHexString()}`;return{...t,[r]:{c:i,t:l}}},{}),calculateKeyboardFrameDimensions=e=>{const t=e.map(dist.getBoundingBox),r=Math.min(...t.map(c=>c.xStart)),s=Math.min(...t.map(c=>c.yStart)),i=Math.max(...t.map(c=>c.xEnd))-r,l=Math.max(...t.map(c=>c.yEnd))-s;return{width:i,height:l}},getMeshName=(e,t,r)=>{if(e.ei!==void 0)return"E-100";if(e.h===2&&e.w===1)return`K-R${t}V-200`;if(e.w===1.25&&e.w2===1.5)return"K-R2-ISO";if(e.w===1.5&&e.w2===2.25)return"K-R2-BAE";if(e.h>1)return r?"K-R4C-100":"K-R4-100";if(!r)switch(e.w){case 1.25:case 1.5:case 1.75:case 1:case 2:case 2.25:case 2.75:return`K-R${t}-${e.w*100}`;case 3:case 6:case 6.25:case 6.5:case 7:return`K-R4C-${e.w*100}`;default:return"K-R4C-100"}switch(e.w){case 1:case 1.25:case 1.5:case 1.75:return`K-R${t}-${e.w*100}`;case 2:case 2.25:case 2.75:case 3:case 6:case 6.25:case 6.5:case 7:return`K-R4C-${e.w*100}`;default:return"K-R4C-100"}},getScale=(e,t)=>{if(e.ei!==void 0)return t;if(e.h===2&&e.w===1)return[1,1,1];if(e.w===1.25&&e.w2===1.5)return[1,1,1];if(e.w===1.5&&e.w2===2.25)return[1,1,1];if(e.h>1)return t;if(e.h==1)switch(e.w){case 1.25:case 1.5:case 1.75:case 2:case 2.25:case 2.75:case 3:case 6:case 6.25:case 6.5:case 7:return[1,1,1];case 1:return[1,1,1];default:return t}return t},getLabelOffsets=(e,t)=>{let r=0,s=0;return e.length==1&&'^*"'.split("").includes(e[0])&&(r=.2),t.length==1&&(",.".split("").includes(t[0])?s=.4:"/\\;'[]".split("").includes(t[0])?s=.3:"-".split("").includes(t[0])&&(s=.1)),[r,s]},getLabel=(e,t,r,s,i,l,c)=>{let u="",p=1,f=[0,0],m="";if(isCustomKeycodeByte(e,i)&&(s!=null&&s.customKeycodes)&&s.customKeycodes[getCustomKeycodeIndex(e,i)]!==void 0){const K=getCustomKeycodeIndex(e,i);u=getShortNameForKeycode(s.customKeycodes[K]),m=getShortNameForKeycode(s.customKeycodes[K],700)}else if(isTapDanceByte(e,i)&&c[getTapDanceIndex(e,i)]!==void 0){const K=getTapDanceIndex(e,i);u=getShortNameForKeycode(c[K]),m=getShortNameForKeycode(c[K],700)}else e&&(u=getLabelForByte(e,t*100,i,l)??"",m=getLabelForByte(e,700,i,l)??"");let y;if(isMacroKeycodeByte(e,i)){const K=getMacroKeycodeIndex(e,i);y=r[K],m=y||""}if(isAlpha(u)||isNumpadNumber(u))return u&&{label:u.toUpperCase(),macroExpression:y,key:(u||"")+(y||""),size:p,offset:f};if(isMultiLegend(u)){const K=u[0],x=u[u.length-1];return x&&{topLabel:K,bottomLabel:x,macroExpression:y,key:(u||"")+(y||""),size:p,offset:getLabelOffsets(K,x)}}else return isNumpadSymbol(u)&&(p=2),isArrowKey(u)&&(p=1.5),{label:u,centerLabel:u,tooltipLabel:m,macroExpression:y,key:(u||"")+(y||""),size:p,offset:f}},updateCSSVariables=e=>{const t=THEMES[e]||THEMES.OLIVIA_DARK;document.documentElement.style.setProperty("--color_accent",t.accent.c),document.documentElement.style.setProperty("--color_inside-accent",t.accent.t)};function getRGBPrime(e,t,r){if(e>=0&&e<60)return[t,r,0];if(e>=60&&e<120)return[r,t,0];if(e>=120&&e<180)return[0,t,r];if(e>=180&&e<240)return[0,r,t];if(e>=240&&e<300)return[r,0,t];if(e>=300&&e<360)return[t,0,r];if(e===360)return[t,r,0];throw new Error("Invalid hue")}const getColorByte=e=>{const t=e.replace("#",""),r=parseInt(t[0],16)*16+parseInt(t[1],16),s=parseInt(t[2],16)*16+parseInt(t[3],16),i=parseInt(t[4],16)*16+parseInt(t[5],16);return[r,s,i]},getDarkenedColor=(e,t=.8)=>{const[r,s,i]=getColorByte(e),l=Math.round(r*t).toString(16),c=Math.round(s*t).toString(16),u=Math.round(i*t).toString(16);return`#${l.padStart(2,"0")}${c.padStart(2,"0")}${u.padStart(2,"0")}`},get256HSV=e=>{const[t,r,s]=getHSV(e);return[Math.round(255*t/360),Math.round(255*r),Math.round(255*s)]},getHSV=e=>{const[t,r,s]=(typeof e=="string"?getColorByte(e):e).map(m=>m/255),[i,l]=[Math.max(t,r,s),Math.min(t,r,s)],c=i-l;let u=60,p=0,f=i;return c===0?u=u*0:i===t?u=u*((r-s)/c%6):i===r?u=u*((s-t)/c+2):i===s&&(u=u*((t-r)/c+4)),i!==0&&(p=c/i),[(u+360)%360,p,f]},getHSVFrom256=e=>[Math.round(360*e[0]/255),Math.round(e[1]/255),1];function getRGB({hue:e,sat:t}){t=t/255,e=Math.round(360*e)/255;const r=t,s=r*(1-Math.abs(e/60%2-1)),i=1-r,[l,c,u]=getRGBPrime(e,r,s).map(p=>Math.round(255*(i+p)));return`rgba(${l},${c},${u},1)`}function toDegrees(e){return e*(180/Math.PI)}function calcRadialHue(e,t){if(e<200&&t<200){const r=200-e,s=200-t;return 2*Math.PI-Math.atan(r/s)}else if(e>200&&t<200){const r=e-200,s=200-t;return Math.atan(r/s)}else if(e<200&&t>200){const r=200-e,s=t-200;return Math.PI+Math.atan(r/s)}else if(e>200&&t>200){const r=e-200,s=t-200;return .5*Math.PI+Math.atan(s/r)}else{if(e===200)return t>200?Math.PI:0;if(t===200)return e>=200?.5*Math.PI:1.5*Math.PI}}function calcRadialMagnitude(e,t){if(e<200&&t<200){const r=200-e,s=200-t;return Math.sqrt(r*r+s*s)/200}else if(e>200&&t<200){const r=e-200,s=200-t;return Math.sqrt(r*r+s*s)/200}else if(e<200&&t>200){const r=200-e,s=t-200;return Math.sqrt(r*r+s*s)/200}else if(e>200&&t>200){const r=e-200,s=t-200;return Math.sqrt(r*r+s*s)/200}else{if(e===200)return t>200?(t-200)/200:(200-t)/200;if(t===200)return e>200?(e-200)/200:(200-e)/200}}function hsToRgb({hue:e,sat:t}){t=t/255,e=Math.round(360*e)/255;const r=t,s=r*(1-Math.abs(e/60%2-1)),i=1-r,[l,c,u]=getRGBPrime(e,r,s).map(p=>Math.round(255*(i+p)));return[l,c,u]}function getHex({hue:e,sat:t}){let[r,s,i]=hsToRgb({hue:e,sat:t}).map(l=>l.toString(16));return r.length==1&&(r="0"+r),s.length==1&&(s="0"+s),i.length==1&&(i="0"+i),"#"+r+s+i}function isWebGLAvailable(){try{const e=document.createElement("canvas");return!!(window.WebGLRenderingContext&&(e.getContext("webgl")||e.getContext("experimental-webgl")))}catch{return!1}}const webGLIsAvailable=isWebGLAvailable(),initialState$b={...getSettings(),isTestMatrixEnabled:!1,restartRequired:!1,allowGlobalHotKeys:!1},toggleBool=(e,t)=>{e[t]=!e[t],setSettings(e)},settingsSlice=createSlice({name:"settings",initialState:initialState$b,reducers:{toggleFastRemap:e=>{toggleBool(e,"disableFastRemap")},toggleCreatorMode:e=>{toggleBool(e,"showDesignTab")},toggleThemeMode:e=>{const t=e.themeMode==="light"?"dark":"light";document.documentElement.dataset.themeMode=t,e.themeMode=t,setSettings(e)},updateRenderMode:(e,t)=>{e.renderMode=t.payload,setSettings(e)},updateDesignDefinitionVersion:(e,t)=>{e.designDefinitionVersion=t.payload,setSettings(e)},updateThemeName:(e,t)=>{e.themeName=t.payload,updateCSSVariables(e.themeName),setSettings(e)},setTestMatrixEnabled:(e,t)=>{e.isTestMatrixEnabled=t.payload},setMacroEditorSettings:(e,t)=>{const r={...e.macroEditor,...t.payload};e.macroEditor=r,setSettings(e)},setTestKeyboardSoundsSettings:(e,t)=>{const r={...e.testKeyboardSoundsSettings,...t.payload};e.testKeyboardSoundsSettings=r,setSettings(e)},disableGlobalHotKeys:e=>{e.allowGlobalHotKeys=!1},enableGlobalHotKeys:e=>{e.allowGlobalHotKeys=!0}}}),{toggleFastRemap,toggleCreatorMode,setTestMatrixEnabled,setTestKeyboardSoundsSettings,setMacroEditorSettings,toggleThemeMode,disableGlobalHotKeys,enableGlobalHotKeys,updateRenderMode,updateThemeName,updateDesignDefinitionVersion}=settingsSlice.actions,settingsReducer=settingsSlice.reducer,getDesignDefinitionVersion=e=>e.settings.designDefinitionVersion,getDisableFastRemap=e=>e.settings.disableFastRemap,getShowDesignTab=e=>e.settings.showDesignTab,getIsTestMatrixEnabled=e=>e.settings.isTestMatrixEnabled,getMacroEditorSettings=e=>e.settings.macroEditor,getTestKeyboardSoundsSettings=e=>e.settings.testKeyboardSoundsSettings,getRenderMode=e=>webGLIsAvailable?e.settings.renderMode:"2D",getThemeMode=e=>e.settings.themeMode,getThemeName=e=>e.settings.themeName,getSelectedTheme=createSelector(getThemeName,e=>THEMES[e]),getSelectedSRGBTheme=createSelector(getSelectedTheme,e=>makeSRGBTheme(e)),basicKeyToByte={_QK_MODS:256,_QK_MODS_MAX:8191,_QK_MOD_TAP:24576,_QK_MOD_TAP_MAX:32767,_QK_LAYER_TAP:16384,_QK_LAYER_TAP_MAX:20479,_QK_LAYER_MOD:22784,_QK_LAYER_MOD_MAX:23039,_QK_TO:20496,_QK_TO_MAX:20511,_QK_MOMENTARY:20736,_QK_MOMENTARY_MAX:20767,_QK_DEF_LAYER:20992,_QK_DEF_LAYER_MAX:21023,_QK_TOGGLE_LAYER:21248,_QK_TOGGLE_LAYER_MAX:21279,_QK_ONE_SHOT_LAYER:21504,_QK_ONE_SHOT_LAYER_MAX:21535,_QK_ONE_SHOT_MOD:21760,_QK_ONE_SHOT_MOD_MAX:22015,_QK_LAYER_TAP_TOGGLE:22528,_QK_LAYER_TAP_TOGGLE_MAX:22559,_QK_LAYER_MOD_MASK:15,_QK_MACRO:24338,_QK_MACRO_MAX:24353,_QK_KB:24448,_QK_KB_MAX:24463,KC_NO:0,KC_TRNS:1,KC_A:4,KC_B:5,KC_C:6,KC_D:7,KC_E:8,KC_F:9,KC_G:10,KC_H:11,KC_I:12,KC_J:13,KC_K:14,KC_L:15,KC_M:16,KC_N:17,KC_O:18,KC_P:19,KC_Q:20,KC_R:21,KC_S:22,KC_T:23,KC_U:24,KC_V:25,KC_W:26,KC_X:27,KC_Y:28,KC_Z:29,KC_1:30,KC_2:31,KC_3:32,KC_4:33,KC_5:34,KC_6:35,KC_7:36,KC_8:37,KC_9:38,KC_0:39,KC_ENT:40,KC_ESC:41,KC_BSPC:42,KC_TAB:43,KC_SPC:44,KC_MINS:45,KC_EQL:46,KC_LBRC:47,KC_RBRC:48,KC_BSLS:49,KC_NUHS:50,KC_SCLN:51,KC_QUOT:52,KC_GRV:53,KC_COMM:54,KC_DOT:55,KC_SLSH:56,KC_CAPS:57,KC_F1:58,KC_F2:59,KC_F3:60,KC_F4:61,KC_F5:62,KC_F6:63,KC_F7:64,KC_F8:65,KC_F9:66,KC_F10:67,KC_F11:68,KC_F12:69,KC_PSCR:70,KC_SLCK:71,KC_PAUS:72,KC_INS:73,KC_HOME:74,KC_PGUP:75,KC_DEL:76,KC_END:77,KC_PGDN:78,KC_RGHT:79,KC_LEFT:80,KC_DOWN:81,KC_UP:82,KC_NLCK:83,KC_PSLS:84,KC_PAST:85,KC_PMNS:86,KC_PPLS:87,KC_PENT:88,KC_P1:89,KC_P2:90,KC_P3:91,KC_P4:92,KC_P5:93,KC_P6:94,KC_P7:95,KC_P8:96,KC_P9:97,KC_P0:98,KC_PDOT:99,KC_NUBS:100,KC_APP:101,KC_POWER:102,KC_PEQL:103,KC_F13:104,KC_F14:105,KC_F15:106,KC_F16:107,KC_F17:108,KC_F18:109,KC_F19:110,KC_F20:111,KC_F21:112,KC_F22:113,KC_F23:114,KC_F24:115,KC_EXECUTE:116,KC_HELP:117,KC_MENU:118,KC_SELECT:119,KC_STOP:120,KC_AGAIN:121,KC_UNDO:122,KC_CUT:123,KC_COPY:124,KC_PASTE:125,KC_FIND:126,KC_LCAP:130,KC_LNUM:131,KC_LSCR:132,KC_PCMM:133,KC_KP_EQUAL_AS400:134,KC_RO:135,KC_KANA:136,KC_JYEN:137,KC_HENK:138,KC_MHEN:139,KC_INT6:140,KC_INT7:141,KC_INT8:142,KC_INT9:143,KC_HAEN:144,KC_HANJ:145,KC_LANG3:146,KC_LANG4:147,KC_LANG5:148,KC_LANG6:149,KC_LANG7:150,KC_LANG8:151,KC_LANG9:152,KC_ERAS:153,KC_SYSREQ:154,KC_CANCEL:155,KC_CLR:156,KC_CLEAR:156,KC_PRIOR:157,KC_OUT:160,KC_OPER:161,KC_CLEAR_AGAIN:162,KC_CRSEL:163,KC_EXSEL:164,KC_PWR:165,KC_SLEP:166,KC_WAKE:167,KC_MUTE:168,KC_VOLU:169,KC_VOLD:170,KC_MNXT:171,KC_MPRV:172,KC_MSTP:173,KC_MPLY:174,KC_MSEL:175,KC_EJCT:176,KC_MAIL:177,KC_CALC:178,KC_MYCM:179,KC_WWW_SEARCH:180,KC_WWW_HOME:181,KC_WWW_BACK:182,KC_WWW_FORWARD:183,KC_WWW_STOP:184,KC_WWW_REFRESH:185,KC_WWW_FAVORITES:186,KC_MFFD:187,KC_MRWD:188,KC_BRIU:189,KC_BRID:190,KC_LCTL:224,KC_LSFT:225,KC_LALT:226,KC_LGUI:227,KC_RCTL:228,KC_RSFT:229,KC_RALT:230,KC_RGUI:231,KC_MS_UP:240,KC_MS_DOWN:241,KC_MS_LEFT:242,KC_MS_RIGHT:243,KC_MS_BTN1:244,KC_MS_BTN2:245,KC_MS_BTN3:246,KC_MS_BTN4:247,KC_MS_BTN5:248,KC_MS_WH_UP:249,KC_MS_WH_DOWN:250,KC_MS_WH_LEFT:251,KC_MS_WH_RIGHT:252,KC_MS_ACCEL0:253,KC_MS_ACCEL1:254,KC_MS_ACCEL2:255,RESET:23552,DEBUG:23553,MAGIC_TOGGLE_NKRO:23572,KC_GESC:23574,AU_ON:23581,AU_OFF:23582,AU_TOG:23583,CLICKY_TOGGLE:23584,CLICKY_ENABLE:23585,CLICKY_DISABLE:23586,CLICKY_UP:23587,CLICKY_DOWN:23588,CLICKY_RESET:23589,MU_ON:23590,MU_OFF:23591,MU_TOG:23592,MU_MOD:23593,BL_ON:23739,BL_OFF:23740,BL_DEC:23741,BL_INC:23742,BL_TOGG:23743,BL_STEP:23744,BL_BRTG:23745,RGB_TOG:23746,RGB_MOD:23747,RGB_RMOD:23748,RGB_HUI:23749,RGB_HUD:23750,RGB_SAI:23751,RGB_SAD:23752,RGB_VAI:23753,RGB_VAD:23754,RGB_SPI:23755,RGB_SPD:23756,RGB_M_P:23757,RGB_M_B:23758,RGB_M_R:23759,RGB_M_SW:23760,RGB_M_SN:23761,RGB_M_K:23762,RGB_M_X:23763,RGB_M_G:23764,KC_LSPO:23767,KC_RSPC:23768,KC_SFTENT:23769,KC_LCPO:23795,KC_RCPC:23796,KC_LAPO:23797,KC_RAPC:23798,BR_INC:24320,BR_DEC:24321,EF_INC:24322,EF_DEC:24323,ES_INC:24324,ES_DEC:24325,H1_INC:24326,H1_DEC:24327,S1_INC:24328,S1_DEC:24329,H2_INC:24330,H2_DEC:24331,S2_INC:24332,S2_DEC:24333,FN_MO13:24336,FN_MO23:24337},v10BasicKeyToByte={_QK_MODS:256,_QK_MODS_MAX:8191,_QK_MOD_TAP:24576,_QK_MOD_TAP_MAX:32767,_QK_LAYER_TAP:16384,_QK_LAYER_TAP_MAX:20479,_QK_LAYER_MOD:22784,_QK_LAYER_MOD_MAX:23039,_QK_TO:20480,_QK_TO_MAX:20511,_QK_MOMENTARY:20736,_QK_MOMENTARY_MAX:20767,_QK_DEF_LAYER:20992,_QK_DEF_LAYER_MAX:21023,_QK_TOGGLE_LAYER:21248,_QK_TOGGLE_LAYER_MAX:21279,_QK_ONE_SHOT_LAYER:21504,_QK_ONE_SHOT_LAYER_MAX:21535,_QK_ONE_SHOT_MOD:21760,_QK_ONE_SHOT_MOD_MAX:22015,_QK_LAYER_TAP_TOGGLE:22528,_QK_LAYER_TAP_TOGGLE_MAX:22559,_QK_LAYER_MOD_MASK:15,_QK_MACRO:24338,_QK_MACRO_MAX:24353,_QK_KB:24448,_QK_KB_MAX:24463,KC_NO:0,KC_TRNS:1,KC_A:4,KC_B:5,KC_C:6,KC_D:7,KC_E:8,KC_F:9,KC_G:10,KC_H:11,KC_I:12,KC_J:13,KC_K:14,KC_L:15,KC_M:16,KC_N:17,KC_O:18,KC_P:19,KC_Q:20,KC_R:21,KC_S:22,KC_T:23,KC_U:24,KC_V:25,KC_W:26,KC_X:27,KC_Y:28,KC_Z:29,KC_1:30,KC_2:31,KC_3:32,KC_4:33,KC_5:34,KC_6:35,KC_7:36,KC_8:37,KC_9:38,KC_0:39,KC_ENT:40,KC_ESC:41,KC_BSPC:42,KC_TAB:43,KC_SPC:44,KC_MINS:45,KC_EQL:46,KC_LBRC:47,KC_RBRC:48,KC_BSLS:49,KC_NUHS:50,KC_SCLN:51,KC_QUOT:52,KC_GRV:53,KC_COMM:54,KC_DOT:55,KC_SLSH:56,KC_CAPS:57,KC_F1:58,KC_F2:59,KC_F3:60,KC_F4:61,KC_F5:62,KC_F6:63,KC_F7:64,KC_F8:65,KC_F9:66,KC_F10:67,KC_F11:68,KC_F12:69,KC_PSCR:70,KC_SLCK:71,KC_PAUS:72,KC_INS:73,KC_HOME:74,KC_PGUP:75,KC_DEL:76,KC_END:77,KC_PGDN:78,KC_RGHT:79,KC_LEFT:80,KC_DOWN:81,KC_UP:82,KC_NLCK:83,KC_PSLS:84,KC_PAST:85,KC_PMNS:86,KC_PPLS:87,KC_PENT:88,KC_P1:89,KC_P2:90,KC_P3:91,KC_P4:92,KC_P5:93,KC_P6:94,KC_P7:95,KC_P8:96,KC_P9:97,KC_P0:98,KC_PDOT:99,KC_NUBS:100,KC_APP:101,KC_POWER:102,KC_PEQL:103,KC_F13:104,KC_F14:105,KC_F15:106,KC_F16:107,KC_F17:108,KC_F18:109,KC_F19:110,KC_F20:111,KC_F21:112,KC_F22:113,KC_F23:114,KC_F24:115,KC_EXECUTE:116,KC_HELP:117,KC_MENU:118,KC_SELECT:119,KC_STOP:120,KC_AGAIN:121,KC_UNDO:122,KC_CUT:123,KC_COPY:124,KC_PASTE:125,KC_FIND:126,KC_LCAP:130,KC_LNUM:131,KC_LSCR:132,KC_PCMM:133,KC_KP_EQUAL_AS400:134,KC_RO:135,KC_KANA:136,KC_JYEN:137,KC_HENK:138,KC_MHEN:139,KC_INT6:140,KC_INT7:141,KC_INT8:142,KC_INT9:143,KC_HAEN:144,KC_HANJ:145,KC_LANG3:146,KC_LANG4:147,KC_LANG5:148,KC_LANG6:149,KC_LANG7:150,KC_LANG8:151,KC_LANG9:152,KC_ERAS:153,KC_SYSREQ:154,KC_CANCEL:155,KC_CLR:156,KC_CLEAR:156,KC_PRIOR:157,KC_OUT:160,KC_OPER:161,KC_CLEAR_AGAIN:162,KC_CRSEL:163,KC_EXSEL:164,KC_PWR:165,KC_SLEP:166,KC_WAKE:167,KC_MUTE:168,KC_VOLU:169,KC_VOLD:170,KC_MNXT:171,KC_MPRV:172,KC_MSTP:173,KC_MPLY:174,KC_MSEL:175,KC_EJCT:176,KC_MAIL:177,KC_CALC:178,KC_MYCM:179,KC_WWW_SEARCH:180,KC_WWW_HOME:181,KC_WWW_BACK:182,KC_WWW_FORWARD:183,KC_WWW_STOP:184,KC_WWW_REFRESH:185,KC_WWW_FAVORITES:186,KC_MFFD:187,KC_MRWD:188,KC_BRIU:189,KC_BRID:190,KC_LCTL:224,KC_LSFT:225,KC_LALT:226,KC_LGUI:227,KC_RCTL:228,KC_RSFT:229,KC_RALT:230,KC_RGUI:231,KC_MS_UP:240,KC_MS_DOWN:241,KC_MS_LEFT:242,KC_MS_RIGHT:243,KC_MS_BTN1:244,KC_MS_BTN2:245,KC_MS_BTN3:246,KC_MS_BTN4:247,KC_MS_BTN5:248,KC_MS_WH_UP:249,KC_MS_WH_DOWN:250,KC_MS_WH_LEFT:251,KC_MS_WH_RIGHT:252,KC_MS_ACCEL0:253,KC_MS_ACCEL1:254,KC_MS_ACCEL2:255,RESET:23552,DEBUG:23553,MAGIC_TOGGLE_NKRO:23572,KC_GESC:23574,AU_ON:23581,AU_OFF:23582,AU_TOG:23583,CLICKY_TOGGLE:23584,CLICKY_ENABLE:23585,CLICKY_DISABLE:23586,CLICKY_UP:23587,CLICKY_DOWN:23588,CLICKY_RESET:23589,MU_ON:23590,MU_OFF:23591,MU_TOG:23592,MU_MOD:23593,BL_ON:23739,BL_OFF:23740,BL_DEC:23741,BL_INC:23742,BL_TOGG:23743,BL_STEP:23744,BL_BRTG:23745,RGB_TOG:23746,RGB_MOD:23747,RGB_RMOD:23748,RGB_HUI:23749,RGB_HUD:23750,RGB_SAI:23751,RGB_SAD:23752,RGB_VAI:23753,RGB_VAD:23754,RGB_SPI:23755,RGB_SPD:23756,RGB_M_P:23757,RGB_M_B:23758,RGB_M_R:23759,RGB_M_SW:23760,RGB_M_SN:23761,RGB_M_K:23762,RGB_M_X:23763,RGB_M_G:23764,KC_LSPO:23767,KC_RSPC:23768,KC_SFTENT:23769,KC_LCPO:23795,KC_RCPC:23796,KC_LAPO:23797,KC_RAPC:23798,BR_INC:24320,BR_DEC:24321,EF_INC:24322,EF_DEC:24323,ES_INC:24324,ES_DEC:24325,H1_INC:24326,H1_DEC:24327,S1_INC:24328,S1_DEC:24329,H2_INC:24330,H2_DEC:24331,S2_INC:24332,S2_DEC:24333,FN_MO13:24336,FN_MO23:24337},v11BasicKeyToByte={_QK_MODS:256,_QK_MODS_MAX:8191,_QK_MOD_TAP:8192,_QK_MOD_TAP_MAX:16383,_QK_LAYER_TAP:16384,_QK_LAYER_TAP_MAX:20479,_QK_LAYER_MOD:20480,_QK_LAYER_MOD_MAX:20991,_QK_TO:20992,_QK_TO_MAX:21023,_QK_MOMENTARY:21024,_QK_MOMENTARY_MAX:21055,_QK_DEF_LAYER:21056,_QK_DEF_LAYER_MAX:21087,_QK_TOGGLE_LAYER:21088,_QK_TOGGLE_LAYER_MAX:21119,_QK_ONE_SHOT_LAYER:21120,_QK_ONE_SHOT_LAYER_MAX:21151,_QK_ONE_SHOT_MOD:21152,_QK_ONE_SHOT_MOD_MAX:21183,_QK_LAYER_TAP_TOGGLE:21184,_QK_LAYER_TAP_TOGGLE_MAX:21215,_QK_LAYER_MOD_MASK:31,_QK_MACRO:30466,_QK_MACRO_MAX:30481,_QK_KB:32512,_QK_KB_MAX:32767,KC_NO:0,KC_TRNS:1,KC_A:4,KC_B:5,KC_C:6,KC_D:7,KC_E:8,KC_F:9,KC_G:10,KC_H:11,KC_I:12,KC_J:13,KC_K:14,KC_L:15,KC_M:16,KC_N:17,KC_O:18,KC_P:19,KC_Q:20,KC_R:21,KC_S:22,KC_T:23,KC_U:24,KC_V:25,KC_W:26,KC_X:27,KC_Y:28,KC_Z:29,KC_1:30,KC_2:31,KC_3:32,KC_4:33,KC_5:34,KC_6:35,KC_7:36,KC_8:37,KC_9:38,KC_0:39,KC_ENT:40,KC_ESC:41,KC_BSPC:42,KC_TAB:43,KC_SPC:44,KC_MINS:45,KC_EQL:46,KC_LBRC:47,KC_RBRC:48,KC_BSLS:49,KC_NUHS:50,KC_SCLN:51,KC_QUOT:52,KC_GRV:53,KC_COMM:54,KC_DOT:55,KC_SLSH:56,KC_CAPS:57,KC_F1:58,KC_F2:59,KC_F3:60,KC_F4:61,KC_F5:62,KC_F6:63,KC_F7:64,KC_F8:65,KC_F9:66,KC_F10:67,KC_F11:68,KC_F12:69,KC_PSCR:70,KC_SLCK:71,KC_PAUS:72,KC_INS:73,KC_HOME:74,KC_PGUP:75,KC_DEL:76,KC_END:77,KC_PGDN:78,KC_RGHT:79,KC_LEFT:80,KC_DOWN:81,KC_UP:82,KC_NLCK:83,KC_PSLS:84,KC_PAST:85,KC_PMNS:86,KC_PPLS:87,KC_PENT:88,KC_P1:89,KC_P2:90,KC_P3:91,KC_P4:92,KC_P5:93,KC_P6:94,KC_P7:95,KC_P8:96,KC_P9:97,KC_P0:98,KC_PDOT:99,KC_NUBS:100,KC_APP:101,KC_POWER:102,KC_PEQL:103,KC_F13:104,KC_F14:105,KC_F15:106,KC_F16:107,KC_F17:108,KC_F18:109,KC_F19:110,KC_F20:111,KC_F21:112,KC_F22:113,KC_F23:114,KC_F24:115,KC_EXECUTE:116,KC_HELP:117,KC_MENU:118,KC_SELECT:119,KC_STOP:120,KC_AGAIN:121,KC_UNDO:122,KC_CUT:123,KC_COPY:124,KC_PASTE:125,KC_FIND:126,KC_LCAP:130,KC_LNUM:131,KC_LSCR:132,KC_PCMM:133,KC_KP_EQUAL_AS400:134,KC_RO:135,KC_KANA:136,KC_JYEN:137,KC_HENK:138,KC_MHEN:139,KC_INT6:140,KC_INT7:141,KC_INT8:142,KC_INT9:143,KC_HAEN:144,KC_HANJ:145,KC_LANG3:146,KC_LANG4:147,KC_LANG5:148,KC_LANG6:149,KC_LANG7:150,KC_LANG8:151,KC_LANG9:152,KC_ERAS:153,KC_SYSREQ:154,KC_CANCEL:155,KC_CLR:156,KC_CLEAR:156,KC_PRIOR:157,KC_OUT:160,KC_OPER:161,KC_CLEAR_AGAIN:162,KC_CRSEL:163,KC_EXSEL:164,KC_PWR:165,KC_SLEP:166,KC_WAKE:167,KC_MUTE:168,KC_VOLU:169,KC_VOLD:170,KC_MNXT:171,KC_MPRV:172,KC_MSTP:173,KC_MPLY:174,KC_MSEL:175,KC_EJCT:176,KC_MAIL:177,KC_CALC:178,KC_MYCM:179,KC_WWW_SEARCH:180,KC_WWW_HOME:181,KC_WWW_BACK:182,KC_WWW_FORWARD:183,KC_WWW_STOP:184,KC_WWW_REFRESH:185,KC_WWW_FAVORITES:186,KC_MFFD:187,KC_MRWD:188,KC_BRIU:189,KC_BRID:190,KC_MS_UP:205,KC_MS_DOWN:206,KC_MS_LEFT:207,KC_MS_RIGHT:208,KC_MS_BTN1:209,KC_MS_BTN2:210,KC_MS_BTN3:211,KC_MS_BTN4:212,KC_MS_BTN5:213,KC_MS_BTN6:214,KC_MS_BTN7:215,KC_MS_BTN8:216,KC_MS_WH_UP:217,KC_MS_WH_DOWN:218,KC_MS_WH_LEFT:219,KC_MS_WH_RIGHT:220,KC_MS_ACCEL0:221,KC_MS_ACCEL1:222,KC_MS_ACCEL2:223,KC_LCTL:224,KC_LSFT:225,KC_LALT:226,KC_LGUI:227,KC_RCTL:228,KC_RSFT:229,KC_RALT:230,KC_RGUI:231,RESET:31744,DEBUG:31746,MAGIC_TOGGLE_NKRO:28691,KC_GESC:31766,KC_ASUP:31761,KC_ASDN:31760,KC_ASRP:31762,KC_ASTG:31765,KC_ASON:31763,KC_ASOFF:31764,AU_ON:29824,AU_OFF:29825,AU_TOG:29826,CLICKY_TOGGLE:29834,CLICKY_ENABLE:29835,CLICKY_DISABLE:29836,CLICKY_UP:29837,CLICKY_DOWN:29838,CLICKY_RESET:29839,MU_ON:29840,MU_OFF:29841,MU_TOG:29842,MU_MOD:29843,MI_ON:28928,MI_OFF:28929,MI_TOG:28930,MI_C:28944,MI_Cs:28945,MI_D:28946,MI_Ds:28947,MI_E:28948,MI_F:28949,MI_Fs:28950,MI_G:28951,MI_Gs:28952,MI_A:28953,MI_As:28954,MI_B:28955,MI_C_1:28960,MI_Cs_1:28961,MI_D_1:28962,MI_Ds_1:28963,MI_E_1:28964,MI_F_1:28965,MI_Fs_1:28966,MI_G_1:28967,MI_Gs_1:28968,MI_A_1:28969,MI_As_1:28970,MI_B_1:28971,MI_C_2:28976,MI_Cs_2:28977,MI_D_2:28978,MI_Ds_2:28979,MI_E_2:28980,MI_F_2:28981,MI_Fs_2:28982,MI_G_2:28983,MI_Gs_2:28984,MI_A_2:28985,MI_As_2:28986,MI_B_2:28987,MI_C_3:28992,MI_Cs_3:28993,MI_D_3:28994,MI_Ds_3:28995,MI_E_3:28996,MI_F_3:28997,MI_Fs_3:28998,MI_G_3:28999,MI_Gs_3:29e3,MI_A_3:29001,MI_As_3:29002,MI_B_3:29003,MI_C_4:29008,MI_Cs_4:29009,MI_D_4:29010,MI_Ds_4:29011,MI_E_4:29012,MI_F_4:29013,MI_Fs_4:29014,MI_G_4:29015,MI_Gs_4:29016,MI_A_4:29017,MI_As_4:29018,MI_B_4:29019,MI_C_5:29024,MI_Cs_5:29025,MI_D_5:29026,MI_Ds_5:29027,MI_E_5:29028,MI_F_5:29029,MI_Fs_5:29030,MI_G_5:29031,MI_Gs_5:29032,MI_A_5:29033,MI_As_5:29034,MI_B_5:29035,MI_OCT_N2:29040,MI_OCT_N1:29041,MI_OCT_0:29042,MI_OCT_1:29043,MI_OCT_2:29044,MI_OCT_3:29045,MI_OCT_4:29046,MI_OCT_5:29047,MI_OCT_6:29048,MI_OCT_7:29049,MI_OCTD:29050,MI_OCTU:29051,MI_TRNS_N6:29056,MI_TRNS_N5:29057,MI_TRNS_N4:29058,MI_TRNS_N3:29059,MI_TRNS_N2:29060,MI_TRNS_N1:29061,MI_TRNS_0:29062,MI_TRNS_1:29063,MI_TRNS_2:29064,MI_TRNS_3:29065,MI_TRNS_4:29066,MI_TRNS_5:29067,MI_TRNS_6:29068,MI_TRNSD:29069,MI_TRNSU:29070,MI_VEL_0:29072,MI_VEL_1:29073,MI_VEL_2:29074,MI_VEL_3:29075,MI_VEL_4:29076,MI_VEL_5:29077,MI_VEL_6:29078,MI_VEL_7:29079,MI_VEL_8:29080,MI_VEL_9:29081,MI_VEL_10:29082,MI_VELD:29083,MI_VELU:29084,MI_CH1:29088,MI_CH2:29089,MI_CH3:29090,MI_CH4:29091,MI_CH5:29092,MI_CH6:29093,MI_CH7:29094,MI_CH8:29095,MI_CH9:29096,MI_CH10:29097,MI_CH11:29098,MI_CH12:29099,MI_CH13:29100,MI_CH14:29101,MI_CH15:29102,MI_CH16:29103,MI_CHD:29104,MI_CHU:29105,MI_ALLOFF:29120,MI_SUST:29121,MI_PORT:29122,MI_SOST:29123,MI_SOFT:29124,MI_LEG:29125,MI_MOD:29126,MI_MODSD:29127,MI_MODSU:29128,MI_BENDD:29129,MI_BENDU:29130,BL_ON:30720,BL_OFF:30721,BL_DEC:30723,BL_INC:30724,BL_TOGG:30722,BL_STEP:30725,BL_BRTG:30726,RGB_TOG:30752,RGB_MOD:30753,RGB_RMOD:30754,RGB_HUI:30755,RGB_HUD:30756,RGB_SAI:30757,RGB_SAD:30758,RGB_VAI:30759,RGB_VAD:30760,RGB_SPI:30761,RGB_SPD:30762,RGB_M_P:30763,RGB_M_B:30764,RGB_M_R:30765,RGB_M_SW:30766,RGB_M_SN:30767,RGB_M_K:30768,RGB_M_X:30769,RGB_M_G:30770,RGB_MODE_RGBTEST:30771,VLK_TOG:31767,KC_LSPO:31770,KC_RSPC:31771,KC_SFTENT:31774,OUT_AUTO:31776,OUT_USB:31777,QK_CLEAR_EEPROM:31747,HPT_ON:31808,HPT_OFF:31809,HPT_TOG:31810,HPT_RST:31811,HPT_FBK:31812,HPT_BUZ:31813,HPT_MODI:31814,HPT_MODD:31815,HPT_CONT:31816,HPT_CONI:31817,HPT_COND:31818,HPT_DWLI:31819,HPT_DWLD:31820,KC_LCPO:31768,KC_RCPC:31769,KC_LAPO:31772,KC_RAPC:31773,CMB_ON:31824,CMB_OFF:31825,CMB_TOG:31826,MAGIC_SWAP_LCTL_LGUI:28695,MAGIC_SWAP_RCTL_RGUI:28697,MAGIC_UNSWAP_LCTL_LGUI:28696,MAGIC_UNSWAP_RCTL_RGUI:28698,MAGIC_SWAP_CTL_GUI:28699,MAGIC_UNSWAP_CTL_GUI:28700,MAGIC_TOGGLE_CTL_GUI:28701,MAGIC_EE_HANDS_LEFT:28702,MAGIC_EE_HANDS_RIGHT:28703,DYN_REC_START1:31827,DYN_REC_START2:31828,DYN_REC_STOP:31829,DYN_MACRO_PLAY1:31830,DYN_MACRO_PLAY2:31831,FN_MO13:30464,FN_MO23:30465},v12BasicKeyToByte={_QK_MODS:256,_QK_MODS_MAX:8191,_QK_MOD_TAP:8192,_QK_MOD_TAP_MAX:16383,_QK_LAYER_TAP:16384,_QK_LAYER_TAP_MAX:20479,_QK_LAYER_MOD:20480,_QK_LAYER_MOD_MAX:20991,_QK_TO:20992,_QK_TO_MAX:21023,_QK_MOMENTARY:21024,_QK_MOMENTARY_MAX:21055,_QK_DEF_LAYER:21056,_QK_DEF_LAYER_MAX:21087,_QK_TOGGLE_LAYER:21088,_QK_TOGGLE_LAYER_MAX:21119,_QK_ONE_SHOT_LAYER:21120,_QK_ONE_SHOT_LAYER_MAX:21151,_QK_ONE_SHOT_MOD:21152,_QK_ONE_SHOT_MOD_MAX:21183,_QK_LAYER_TAP_TOGGLE:21184,_QK_LAYER_TAP_TOGGLE_MAX:21215,_QK_LAYER_MOD_MASK:31,_QK_TAP_DANCE:22272,_QK_TAP_DANCE_MAX:22527,_QK_MACRO:30464,_QK_MACRO_MAX:30591,_QK_KB:32256,_QK_KB_MAX:32511,KC_NO:0,KC_TRNS:1,KC_A:4,KC_B:5,KC_C:6,KC_D:7,KC_E:8,KC_F:9,KC_G:10,KC_H:11,KC_I:12,KC_J:13,KC_K:14,KC_L:15,KC_M:16,KC_N:17,KC_O:18,KC_P:19,KC_Q:20,KC_R:21,KC_S:22,KC_T:23,KC_U:24,KC_V:25,KC_W:26,KC_X:27,KC_Y:28,KC_Z:29,KC_1:30,KC_2:31,KC_3:32,KC_4:33,KC_5:34,KC_6:35,KC_7:36,KC_8:37,KC_9:38,KC_0:39,KC_ENT:40,KC_ESC:41,KC_BSPC:42,KC_TAB:43,KC_SPC:44,KC_MINS:45,KC_EQL:46,KC_LBRC:47,KC_RBRC:48,KC_BSLS:49,KC_NUHS:50,KC_SCLN:51,KC_QUOT:52,KC_GRV:53,KC_COMM:54,KC_DOT:55,KC_SLSH:56,KC_CAPS:57,KC_F1:58,KC_F2:59,KC_F3:60,KC_F4:61,KC_F5:62,KC_F6:63,KC_F7:64,KC_F8:65,KC_F9:66,KC_F10:67,KC_F11:68,KC_F12:69,KC_PSCR:70,KC_SLCK:71,KC_PAUS:72,KC_INS:73,KC_HOME:74,KC_PGUP:75,KC_DEL:76,KC_END:77,KC_PGDN:78,KC_RGHT:79,KC_LEFT:80,KC_DOWN:81,KC_UP:82,KC_NLCK:83,KC_PSLS:84,KC_PAST:85,KC_PMNS:86,KC_PPLS:87,KC_PENT:88,KC_P1:89,KC_P2:90,KC_P3:91,KC_P4:92,KC_P5:93,KC_P6:94,KC_P7:95,KC_P8:96,KC_P9:97,KC_P0:98,KC_PDOT:99,KC_NUBS:100,KC_APP:101,KC_POWER:102,KC_PEQL:103,KC_F13:104,KC_F14:105,KC_F15:106,KC_F16:107,KC_F17:108,KC_F18:109,KC_F19:110,KC_F20:111,KC_F21:112,KC_F22:113,KC_F23:114,KC_F24:115,KC_EXECUTE:116,KC_HELP:117,KC_MENU:118,KC_SELECT:119,KC_STOP:120,KC_AGAIN:121,KC_UNDO:122,KC_CUT:123,KC_COPY:124,KC_PASTE:125,KC_FIND:126,KC_LCAP:130,KC_LNUM:131,KC_LSCR:132,KC_PCMM:133,KC_KP_EQUAL_AS400:134,KC_RO:135,KC_KANA:136,KC_JYEN:137,KC_HENK:138,KC_MHEN:139,KC_INT6:140,KC_INT7:141,KC_INT8:142,KC_INT9:143,KC_HAEN:144,KC_HANJ:145,KC_LANG3:146,KC_LANG4:147,KC_LANG5:148,KC_LANG6:149,KC_LANG7:150,KC_LANG8:151,KC_LANG9:152,KC_ERAS:153,KC_SYSREQ:154,KC_CANCEL:155,KC_CLR:156,KC_CLEAR:156,KC_PRIOR:157,KC_OUT:160,KC_OPER:161,KC_CLEAR_AGAIN:162,KC_CRSEL:163,KC_EXSEL:164,KC_PWR:165,KC_SLEP:166,KC_WAKE:167,KC_MUTE:168,KC_VOLU:169,KC_VOLD:170,KC_MNXT:171,KC_MPRV:172,KC_MSTP:173,KC_MPLY:174,KC_MSEL:175,KC_EJCT:176,KC_MAIL:177,KC_CALC:178,KC_MYCM:179,KC_WWW_SEARCH:180,KC_WWW_HOME:181,KC_WWW_BACK:182,KC_WWW_FORWARD:183,KC_WWW_STOP:184,KC_WWW_REFRESH:185,KC_WWW_FAVORITES:186,KC_MFFD:187,KC_MRWD:188,KC_BRIU:189,KC_BRID:190,KC_MS_UP:205,KC_MS_DOWN:206,KC_MS_LEFT:207,KC_MS_RIGHT:208,KC_MS_BTN1:209,KC_MS_BTN2:210,KC_MS_BTN3:211,KC_MS_BTN4:212,KC_MS_BTN5:213,KC_MS_BTN6:214,KC_MS_BTN7:215,KC_MS_BTN8:216,KC_MS_WH_UP:217,KC_MS_WH_DOWN:218,KC_MS_WH_LEFT:219,KC_MS_WH_RIGHT:220,KC_MS_ACCEL0:221,KC_MS_ACCEL1:222,KC_MS_ACCEL2:223,KC_LCTL:224,KC_LSFT:225,KC_LALT:226,KC_LGUI:227,KC_RCTL:228,KC_RSFT:229,KC_RALT:230,KC_RGUI:231,CL_SWAP:28672,CL_NORM:28673,CL_TOGG:28674,CL_CAPS:28675,CL_CTRL:28676,AG_LSWP:28677,AG_LNRM:28678,AG_RSWP:28679,AG_RNRM:28680,GU_ON:28681,GU_OFF:28682,GU_TOGG:28683,GE_SWAP:28684,GE_NORM:28685,BS_SWAP:28686,BS_NORM:28687,BS_TOGG:28688,NK_ON:28689,NK_OFF:28690,NK_TOGG:28691,AG_SWAP:28692,AG_NORM:28693,AG_TOGG:28694,CG_LSWP:28695,CG_LNRM:28696,CG_RSWP:28697,CG_RNRM:28698,CG_SWAP:28699,CG_NORM:28700,CG_TOGG:28701,EH_LEFT:28702,EH_RGHT:28703,EC_SWAP:28704,EC_NORM:28705,EC_TOGG:28706,RESET:31744,DEBUG:31746,MAGIC_TOGGLE_NKRO:28691,KC_GESC:31766,KC_ASUP:31761,KC_ASDN:31760,KC_ASRP:31762,KC_ASTG:31765,KC_ASON:31763,KC_ASOFF:31764,AU_ON:29824,AU_OFF:29825,AU_TOG:29826,CLICKY_TOGGLE:29834,CLICKY_ENABLE:29835,CLICKY_DISABLE:29836,CLICKY_UP:29837,CLICKY_DOWN:29838,CLICKY_RESET:29839,MU_ON:29840,MU_OFF:29841,MU_TOG:29842,MU_MOD:29843,MI_ON:28928,MI_OFF:28929,MI_TOG:28930,MI_C:28944,MI_Cs:28945,MI_D:28946,MI_Ds:28947,MI_E:28948,MI_F:28949,MI_Fs:28950,MI_G:28951,MI_Gs:28952,MI_A:28953,MI_As:28954,MI_B:28955,MI_C_1:28960,MI_Cs_1:28961,MI_D_1:28962,MI_Ds_1:28963,MI_E_1:28964,MI_F_1:28965,MI_Fs_1:28966,MI_G_1:28967,MI_Gs_1:28968,MI_A_1:28969,MI_As_1:28970,MI_B_1:28971,MI_C_2:28976,MI_Cs_2:28977,MI_D_2:28978,MI_Ds_2:28979,MI_E_2:28980,MI_F_2:28981,MI_Fs_2:28982,MI_G_2:28983,MI_Gs_2:28984,MI_A_2:28985,MI_As_2:28986,MI_B_2:28987,MI_C_3:28992,MI_Cs_3:28993,MI_D_3:28994,MI_Ds_3:28995,MI_E_3:28996,MI_F_3:28997,MI_Fs_3:28998,MI_G_3:28999,MI_Gs_3:29e3,MI_A_3:29001,MI_As_3:29002,MI_B_3:29003,MI_C_4:29008,MI_Cs_4:29009,MI_D_4:29010,MI_Ds_4:29011,MI_E_4:29012,MI_F_4:29013,MI_Fs_4:29014,MI_G_4:29015,MI_Gs_4:29016,MI_A_4:29017,MI_As_4:29018,MI_B_4:29019,MI_C_5:29024,MI_Cs_5:29025,MI_D_5:29026,MI_Ds_5:29027,MI_E_5:29028,MI_F_5:29029,MI_Fs_5:29030,MI_G_5:29031,MI_Gs_5:29032,MI_A_5:29033,MI_As_5:29034,MI_B_5:29035,MI_OCT_N2:29040,MI_OCT_N1:29041,MI_OCT_0:29042,MI_OCT_1:29043,MI_OCT_2:29044,MI_OCT_3:29045,MI_OCT_4:29046,MI_OCT_5:29047,MI_OCT_6:29048,MI_OCT_7:29049,MI_OCTD:29050,MI_OCTU:29051,MI_TRNS_N6:29056,MI_TRNS_N5:29057,MI_TRNS_N4:29058,MI_TRNS_N3:29059,MI_TRNS_N2:29060,MI_TRNS_N1:29061,MI_TRNS_0:29062,MI_TRNS_1:29063,MI_TRNS_2:29064,MI_TRNS_3:29065,MI_TRNS_4:29066,MI_TRNS_5:29067,MI_TRNS_6:29068,MI_TRNSD:29069,MI_TRNSU:29070,MI_VEL_0:29072,MI_VEL_1:29073,MI_VEL_2:29074,MI_VEL_3:29075,MI_VEL_4:29076,MI_VEL_5:29077,MI_VEL_6:29078,MI_VEL_7:29079,MI_VEL_8:29080,MI_VEL_9:29081,MI_VEL_10:29082,MI_VELD:29083,MI_VELU:29084,MI_CH1:29088,MI_CH2:29089,MI_CH3:29090,MI_CH4:29091,MI_CH5:29092,MI_CH6:29093,MI_CH7:29094,MI_CH8:29095,MI_CH9:29096,MI_CH10:29097,MI_CH11:29098,MI_CH12:29099,MI_CH13:29100,MI_CH14:29101,MI_CH15:29102,MI_CH16:29103,MI_CHD:29104,MI_CHU:29105,MI_ALLOFF:29120,MI_SUST:29121,MI_PORT:29122,MI_SOST:29123,MI_SOFT:29124,MI_LEG:29125,MI_MOD:29126,MI_MODSD:29127,MI_MODSU:29128,MI_BENDD:29129,MI_BENDU:29130,BL_ON:30720,BL_OFF:30721,BL_DEC:30723,BL_INC:30724,BL_TOGG:30722,BL_STEP:30725,BL_BRTG:30726,RGB_TOG:30752,RGB_MOD:30753,RGB_RMOD:30754,RGB_HUI:30755,RGB_HUD:30756,RGB_SAI:30757,RGB_SAD:30758,RGB_VAI:30759,RGB_VAD:30760,RGB_SPI:30761,RGB_SPD:30762,RGB_M_P:30763,RGB_M_B:30764,RGB_M_R:30765,RGB_M_SW:30766,RGB_M_SN:30767,RGB_M_K:30768,RGB_M_X:30769,RGB_M_G:30770,RGB_MODE_RGBTEST:30771,VLK_TOG:31767,KC_LSPO:31770,KC_RSPC:31771,KC_SFTENT:31774,OUT_AUTO:31776,OUT_USB:31777,QK_CLEAR_EEPROM:31747,HPT_ON:31808,HPT_OFF:31809,HPT_TOG:31810,HPT_RST:31811,HPT_FBK:31812,HPT_BUZ:31813,HPT_MODI:31814,HPT_MODD:31815,HPT_CONT:31816,HPT_CONI:31817,HPT_COND:31818,HPT_DWLI:31819,HPT_DWLD:31820,KC_LCPO:31768,KC_RCPC:31769,KC_LAPO:31772,KC_RAPC:31773,CMB_ON:31824,CMB_OFF:31825,CMB_TOG:31826,MAGIC_SWAP_LCTL_LGUI:28695,MAGIC_SWAP_RCTL_RGUI:28697,MAGIC_UNSWAP_LCTL_LGUI:28696,MAGIC_UNSWAP_RCTL_RGUI:28698,MAGIC_SWAP_CTL_GUI:28699,MAGIC_UNSWAP_CTL_GUI:28700,MAGIC_TOGGLE_CTL_GUI:28701,MAGIC_EE_HANDS_LEFT:28702,MAGIC_EE_HANDS_RIGHT:28703,DYN_REC_START1:31827,DYN_REC_START2:31828,DYN_REC_STOP:31829,DYN_MACRO_PLAY1:31830,DYN_MACRO_PLAY2:31831,FN_MO13:31863,FN_MO23:31864};function getBasicKeyDict(e){switch(e){case 13:case 12:return v12BasicKeyToByte;case 11:return v11BasicKeyToByte;case 10:return v10BasicKeyToByte;default:return basicKeyToByte}}const autocompleteKeycodes={KC_NO:!0,KC_A:!0,KC_B:!0,KC_C:!0,KC_D:!0,KC_E:!0,KC_F:!0,KC_G:!0,KC_H:!0,KC_I:!0,KC_J:!0,KC_K:!0,KC_L:!0,KC_M:!0,KC_N:!0,KC_O:!0,KC_P:!0,KC_Q:!0,KC_R:!0,KC_S:!0,KC_T:!0,KC_U:!0,KC_V:!0,KC_W:!0,KC_X:!0,KC_Y:!0,KC_Z:!0,KC_1:!0,KC_2:!0,KC_3:!0,KC_4:!0,KC_5:!0,KC_6:!0,KC_7:!0,KC_8:!0,KC_9:!0,KC_0:!0,KC_ENT:!0,KC_ESC:!0,KC_BSPC:!0,KC_TAB:!0,KC_SPC:!0,KC_MINS:!0,KC_EQL:!0,KC_LBRC:!0,KC_RBRC:!0,KC_BSLS:!0,KC_NUHS:!0,KC_SCLN:!0,KC_QUOT:!0,KC_GRV:!0,KC_COMM:!0,KC_DOT:!0,KC_SLSH:!0,KC_CAPS:!0,KC_F1:!0,KC_F2:!0,KC_F3:!0,KC_F4:!0,KC_F5:!0,KC_F6:!0,KC_F7:!0,KC_F8:!0,KC_F9:!0,KC_F10:!0,KC_F11:!0,KC_F12:!0,KC_PSCR:!0,KC_SLCK:!0,KC_PAUS:!0,KC_INS:!0,KC_HOME:!0,KC_PGUP:!0,KC_DEL:!0,KC_END:!0,KC_PGDN:!0,KC_RGHT:!0,KC_LEFT:!0,KC_DOWN:!0,KC_UP:!0,KC_NLCK:!0,KC_PSLS:!0,KC_KP_ASTERISK:!0,KC_PAST:!0,KC_PPLS:!0,KC_PMNS:!0,KC_PENT:!0,KC_P1:!0,KC_P2:!0,KC_P3:!0,KC_P4:!0,KC_P5:!0,KC_P6:!0,KC_P7:!0,KC_P8:!0,KC_P9:!0,KC_P0:!0,KC_PDOT:!0,KC_NUBS:!0,KC_APP:!0,KC_POWER:!0,KC_PEQL:!0,KC_F13:!0,KC_F14:!0,KC_F15:!0,KC_F16:!0,KC_F17:!0,KC_F18:!0,KC_F19:!0,KC_F20:!0,KC_F21:!0,KC_F22:!0,KC_F23:!0,KC_F24:!0,KC_EXECUTE:!0,KC_HELP:!0,KC_MENU:!0,KC_SELECT:!0,KC_STOP:!0,KC_AGAIN:!0,KC_UNDO:!0,KC_CUT:!0,KC_COPY:!0,KC_PASTE:!0,KC_FIND:!0,KC_LCAP:!0,KC_LNUM:!0,KC_LSCR:!0,KC_PCMM:!0,KC_KP_EQUAL_AS400:!0,KC_RO:!0,KC_KANA:!0,KC_JYEN:!0,KC_HENK:!0,KC_MHEN:!0,KC_INT6:!0,KC_INT7:!0,KC_INT8:!0,KC_INT9:!0,KC_HAEN:!0,KC_HANJ:!0,KC_LANG3:!0,KC_LANG4:!0,KC_LANG5:!0,KC_LANG6:!0,KC_LANG7:!0,KC_LANG8:!0,KC_LANG9:!0,KC_SYSREQ:!0,KC_CANCEL:!0,KC_CLEAR:!0,KC_PRIOR:!0,KC_OUT:!0,KC_OPER:!0,KC_CLEAR_AGAIN:!0,KC_CRSEL:!0,KC_EXSEL:!0,KC_LCTL:!0,KC_LSFT:!0,KC_LALT:!0,KC_LGUI:!0,KC_RCTL:!0,KC_RSFT:!0,KC_RALT:!0,KC_RGUI:!0,KC_PWR:!0,KC_SLEP:!0,KC_WAKE:!0,KC_MUTE:!0,KC_VOLU:!0,KC_VOLD:!0,KC_MNXT:!0,KC_MPRV:!0,KC_MSTP:!0,KC_MPLY:!0,KC_MSEL:!0,KC_EJCT:!0,KC_MAIL:!0,KC_CALC:!0,KC_MYCM:!0,KC_WWW_SEARCH:!0,KC_WWW_HOME:!0,KC_WWW_BACK:!0,KC_WWW_FORWARD:!0,KC_WWW_STOP:!0,KC_WWW_REFRESH:!0,KC_WWW_FAVORITES:!0,KC_MFFD:!0,KC_MRWD:!0,KC_MS_UP:!0,KC_MS_DOWN:!0,KC_MS_LEFT:!0,KC_MS_RIGHT:!0,KC_MS_BTN1:!0,KC_MS_BTN2:!0,KC_MS_BTN3:!0,KC_MS_BTN4:!0,KC_MS_BTN5:!0,KC_MS_BTN6:!0,KC_MS_BTN7:!0,KC_MS_BTN8:!0,KC_MS_WH_UP:!0,KC_MS_WH_DOWN:!0,KC_MS_WH_LEFT:!0,KC_MS_WH_RIGHT:!0,KC_MS_ACCEL0:!0,KC_MS_ACCEL1:!0,KC_MS_ACCEL2:!0},getAutocompleteKeycodes=()=>keycodesList.filter(e=>!!autocompleteKeycodes[e.code]);function isAutocompleteKeycode(e){const t=e.toUpperCase();return!!autocompleteKeycodes[t]}var RawKeycodeSequenceAction=(e=>(e[e.Tap=1]="Tap",e[e.Down=2]="Down",e[e.Up=3]="Up",e[e.Delay=4]="Delay",e[e.CharacterStream=5]="CharacterStream",e))(RawKeycodeSequenceAction||{}),GroupedKeycodeSequenceAction=(e=>(e[e.Chord=6]="Chord",e))(GroupedKeycodeSequenceAction||{}),KeyAction=(e=>(e[e.Tap=1]="Tap",e[e.Down=2]="Down",e[e.Up=3]="Up",e[e.Delay=4]="Delay",e))(KeyAction||{});const KeyActionPrefix=1,DelayTerminator=124,MacroTerminator=0;function splitExpression(expression){let regex;try{return regex=eval("/(?<!\\\\)({.*?})/g"),expression.split(regex).filter(e=>e.length)}catch(e){return console.error("Lookbehind is not supported in this browser."),[]}}function optimizedSequenceToRawSequence(e){return e.flatMap(t=>{if(t[0]==GroupedKeycodeSequenceAction.Chord){const r=s=>i=>[s,i];return[...t[1]].map(r(RawKeycodeSequenceAction.Down)).concat([...t[1]].reverse().map(r(RawKeycodeSequenceAction.Up)))}else return[t]})}function rawSequenceToOptimizedSequence(e){let t=[];return t=convertToTapsAndChords(e),t}function convertToTapsAndChords(e){let t=[],r=[],s=0;const i=e.reduce((u,p)=>p[0]===RawKeycodeSequenceAction.Tap?[...u,[RawKeycodeSequenceAction.Down,p[1]],[RawKeycodeSequenceAction.Up,p[1]]]:[...u,p],[]);let l=[];i.forEach((u,p)=>{let f=!1;if(t.push(u),u[0]===RawKeycodeSequenceAction.Down)s==r.length&&(r.push(u[1]),s++,f=!0);else if(u[0]===RawKeycodeSequenceAction.Up){const m=u[1];r.length>0&&m===r[s-1]&&(s--,s==0?(r.length===1?l.push([RawKeycodeSequenceAction.Tap,r[0]]):l.push([GroupedKeycodeSequenceAction.Chord,r]),t=[]):f=!0)}p===i.length-1&&(f=!1),f||(l.push(...t),t=[],r=[],s=0)});let c=[];for(let u=0;u<l.length;u++)u+1<l.length&&l[u][0]==RawKeycodeSequenceAction.Down&&l[u+1][0]==RawKeycodeSequenceAction.Up&&l[u][1]===l[u+1][1]?(c.push([RawKeycodeSequenceAction.Tap,l[u][1]]),u++):c.push(l[u]);return c}const mapKeycodeToCharacterStream={KC_A:["a","A"],KC_B:["b","B"],KC_C:["c","C"],KC_D:["d","D"],KC_E:["e","E"],KC_F:["f","F"],KC_G:["g","G"],KC_H:["h","H"],KC_I:["i","I"],KC_J:["j","J"],KC_K:["k","K"],KC_L:["l","L"],KC_M:["m","M"],KC_N:["n","N"],KC_O:["o","O"],KC_P:["p","P"],KC_Q:["q","Q"],KC_R:["r","R"],KC_S:["s","S"],KC_T:["t","T"],KC_U:["u","U"],KC_V:["v","V"],KC_W:["w","W"],KC_X:["x","X"],KC_Y:["y","Y"],KC_Z:["z","Z"],KC_1:["1","!"],KC_2:["2","@"],KC_3:["3","#"],KC_4:["4","$"],KC_5:["5","%"],KC_6:["6","^"],KC_7:["7","&"],KC_8:["8","*"],KC_9:["9","("],KC_0:["0",")"],KC_SPC:[" "," "],KC_MINS:["-","_"],KC_EQL:["=","+"],KC_LBRC:["[","{"],KC_RBRC:["]","}"],KC_BSLS:["\\","|"],KC_SCLN:[";",":"],KC_QUOT:["'",'"'],KC_GRV:["`","~"],KC_COMM:[",","<"],KC_DOT:[".",">"],KC_SLSH:["/","?"]},mapCharToShiftedChar=Object.values(mapKeycodeToCharacterStream).reduce((e,[t,r])=>({...e,[t]:r}),{});function convertCharacterTaps(e){return e.reduce((r,s)=>s[0]==RawKeycodeSequenceAction.Down&&s[1]in mapKeycodeToCharacterStream?[...r,[RawKeycodeSequenceAction.Tap,s[1]]]:s[0]==RawKeycodeSequenceAction.Up&&s[1]in mapKeycodeToCharacterStream?r:[...r,s],[])}function trimLastWait(e){return e[e.length-1]&&e[e.length-1][0]===RawKeycodeSequenceAction.Delay?e.slice(0,-1):e}function mergeConsecutiveWaits(e){return e.reduce((t,r)=>(t[t.length-1]&&t[t.length-1][0]===RawKeycodeSequenceAction.Delay&&r[0]===RawKeycodeSequenceAction.Delay?t.splice(-1,1,[RawKeycodeSequenceAction.Delay,Number(t[t.length-1][1])+Number(r[1])]):t.push(r),t),[])}function foldKeydownKeyupKeys(e){return e.reduce((t,r)=>(t[t.length-1]&&t[t.length-1][0]===RawKeycodeSequenceAction.Down&&r[0]===RawKeycodeSequenceAction.Up&&t[t.length-1][1]===r[1]?t.splice(-1,1,[RawKeycodeSequenceAction.Tap,r[1]]):t.push(r),t),[])}function convertToCharacterStreams(e){let t=e.reduce((i,l)=>{if(l[0]==RawKeycodeSequenceAction.Tap&&l[1]in mapKeycodeToCharacterStream){const c=mapKeycodeToCharacterStream[l[1]][0];return i[i.length-1]!==void 0&&i[i.length-1][0]===RawKeycodeSequenceAction.CharacterStream?[...i.slice(0,-1),[RawKeycodeSequenceAction.CharacterStream,i[i.length-1][1]+c]]:[...i,[RawKeycodeSequenceAction.CharacterStream,c]]}else return[...i,l]},[]),r=[];for(let i=0;i<t.length;i++)if(i+2<t.length&&t[i][0]===RawKeycodeSequenceAction.Down&&t[i+1][0]===RawKeycodeSequenceAction.CharacterStream&&t[i+2][0]===RawKeycodeSequenceAction.Up&&t[i][1]===t[i+2][1]&&(t[i][1]==="KC_LSFT"||t[i][1]==="KC_RSFT")){const l=t[i+1][1].split("").map(c=>mapCharToShiftedChar[c]).join("");r.push([RawKeycodeSequenceAction.CharacterStream,l]),i+=2}else r.push(t[i]);return r.reduce((i,l)=>l[0]===RawKeycodeSequenceAction.CharacterStream&&i[i.length-1]!==void 0&&i[i.length-1][0]===RawKeycodeSequenceAction.CharacterStream?(i[i.length-1][1]=i[i.length-1][1].concat(l[1]),i):[...i,l],[])}function sequenceToExpression(e){let t=[];return e.forEach(r=>{switch(r[0]){case RawKeycodeSequenceAction.Tap:t.push("{"+r[1]+"}");break;case RawKeycodeSequenceAction.Down:t.push("{+"+r[1]+"}");break;case RawKeycodeSequenceAction.Up:t.push("{-"+r[1]+"}");break;case RawKeycodeSequenceAction.Delay:t.push("{"+r[1]+"}");break;case GroupedKeycodeSequenceAction.Chord:t.push("{"+r[1].join(",")+"}");break;case RawKeycodeSequenceAction.CharacterStream:t.push(r[1].replace(/{/g,"\\{"))}}),t.join("")}function expressionToSequence(e){let t=splitExpression(e),r=[];return t.forEach(s=>{if(/^{.*}$/.test(s))if(s=s.slice(1,-1),/^\d+$/.test(s))r.push([RawKeycodeSequenceAction.Delay,parseInt(s)]);else{const i=/^[+-]/.test(s)?s.slice(0,1):null,l=s.replace(/^[+-]/,"").split(",").map(c=>c.trim().toUpperCase()).filter(c=>c.length);if(l.length>0)if(i==null)l.length==1?r.push([RawKeycodeSequenceAction.Tap,l[0]]):r.push([GroupedKeycodeSequenceAction.Chord,l]);else{const c=i=="+"?RawKeycodeSequenceAction.Down:RawKeycodeSequenceAction.Up;r.push([c,l[0]])}}else s=s.replace(/\\{/g,"{"),r.push([RawKeycodeSequenceAction.CharacterStream,s])}),r}function validateMacroExpression(expression){let unclosedBlockRegex,keycodeBlockRegex;try{unclosedBlockRegex=eval("/(?<!\\\\){(?![^{]*})/"),keycodeBlockRegex=eval("/(?<!\\\\){(.*?)}/g")}catch(e){return console.error("Lookbehind is not supported in this browser."),{isValid:!1,errorMessage:"Lookbehind is not supported in this browser."}}if(expression.match(unclosedBlockRegex))return{isValid:!1,errorMessage:"Looks like a keycode block - {} - is unclosed! Are you missing an '}'?"};let groups=null;for(;groups=keycodeBlockRegex.exec(expression);){const e=groups[1].replace(/\s+/g,"");if(!e.length)return{isValid:!1,errorMessage:"Sorry, I can't handle empty {}. Fill them up with keycodes or use \\{} to tell the macro to literally type {}"};const t=e.split(",").filter(r=>r.trim().length&&!isAutocompleteKeycode(r));if(t.length)return{isValid:!1,errorMessage:`Whoops! Invalid keycodes detected inside {}: ${t.join(", ")}`}}return{isValid:!0,errorMessage:void 0}}class MacroAPI{constructor(t,r,s){this.keyboardApi=t,this.basicKeyToByte=r,this.byteToKey=s}async readRawKeycodeSequences(){const t=await this.keyboardApi.getMacroBytes(),r=await this.keyboardApi.getMacroCount();let s=0,i=0;const l=[];let c=[];if(r===0)throw Error("Macros are disabled");for(;i<t.length&&s<r;){let u=t[i];switch(u){case MacroTerminator:l[s]=c,s++,c=[];break;case KeyAction.Tap:u=t[++i],c.push([RawKeycodeSequenceAction.Tap,this.byteToKey[u]]);break;case KeyAction.Down:u=t[++i],c.push([RawKeycodeSequenceAction.Down,this.byteToKey[u]]);break;case KeyAction.Up:u=t[++i],c.push([RawKeycodeSequenceAction.Up,this.byteToKey[u]]);break;default:{const p=String.fromCharCode(u);c.length&&c[c.length-1][0]===RawKeycodeSequenceAction.CharacterStream?c[c.length-1]=[RawKeycodeSequenceAction.CharacterStream,c[c.length-1][1]+p]:c.push([RawKeycodeSequenceAction.CharacterStream,p]);break}}i++}return l}rawKeycodeSequencesToMacroBytes(t){return t.flatMap(r=>{const s=[];return r.forEach(i=>{switch(i[0]){case RawKeycodeSequenceAction.Tap:s.push(KeyAction.Tap,this.basicKeyToByte[i[1]]);break;case RawKeycodeSequenceAction.Up:s.push(KeyAction.Up,this.basicKeyToByte[i[1]]);break;case RawKeycodeSequenceAction.Down:s.push(KeyAction.Down,this.basicKeyToByte[i[1]]);break;case RawKeycodeSequenceAction.Delay:break;case RawKeycodeSequenceAction.CharacterStream:s.push(...i[1].split("").map(l=>l.charCodeAt(0)));break}}),s.push(MacroTerminator),s})}async writeRawKeycodeSequences(t){const r=this.rawKeycodeSequencesToMacroBytes(t);await this.keyboardApi.setMacroBytes(r)}}function validateMacroExpressionV11(expression){let unclosedBlockRegex,keycodeBlockRegex;try{unclosedBlockRegex=eval("/(?<!\\\\){(?![^{]*})/"),keycodeBlockRegex=eval("/(?<!\\\\){(.*?)}/g")}catch(e){return console.error("Lookbehind is not supported in this browser."),{isValid:!1,errorMessage:"Lookbehind is not supported in this browser."}}if(expression.match(unclosedBlockRegex))return{isValid:!1,errorMessage:"Looks like a keycode block - {} - is unclosed! Are you missing an '}'?"};let groups=null;for(;groups=keycodeBlockRegex.exec(expression);){const e=groups[1].replace(/\s+/g,"");if(!e.length)return{isValid:!1,errorMessage:"Sorry, I can't handle empty {}. Fill them up with keycodes or use \\{} to tell the macro to literally type {}"};if(/^\d+$/.test(e)){if(/\d{5,}/.test(e))return{isValid:!1,errorMessage:`Invalid delay: ${e}. Please use a delay value of 9999 or less.`}}else{const t=e.replace(/^[-+]/,"").split(",").filter(r=>r.trim().length&&!isAutocompleteKeycode(r));if(t.length)return{isValid:!1,errorMessage:`Whoops! Invalid keycodes detected inside {}: ${t.join(", ")}`}}}return{isValid:!0,errorMessage:void 0}}class MacroAPIV11{constructor(t,r,s){this.keyboardApi=t,this.basicKeyToByte=r,this.byteToKey=s}async readRawKeycodeSequences(){const t=await this.keyboardApi.getMacroBytes(),r=await this.keyboardApi.getMacroCount();let s=0,i=0;const l=[];let c=[];if(r===0)throw Error("Macros are disabled");for(;i<t.length&&s<r;){let u=t[i];switch(u){case MacroTerminator:l[s]=c,s++,c=[];break;case KeyActionPrefix:switch(u=t[++i],u){case KeyAction.Tap:u=t[++i],c.push([RawKeycodeSequenceAction.Tap,this.byteToKey[u]]);break;case KeyAction.Down:u=t[++i],c.push([RawKeycodeSequenceAction.Down,this.byteToKey[u]]);break;case KeyAction.Up:u=t[++i],c.push([RawKeycodeSequenceAction.Up,this.byteToKey[u]]);break;case KeyAction.Delay:let p=[];for(u=t[++i];u!==DelayTerminator&&i<t.length;)p.push(u),u=t[++i];const f=p.reduce((m,y)=>(m+=String.fromCharCode(y),m),"");c.push([RawKeycodeSequenceAction.Delay,parseInt(f)]);break;default:throw`Expected a KeyAction to follow the KeyActionPrefix. Received ${u} instead.`}break;default:{const p=String.fromCharCode(u);c.length&&c[c.length-1][0]===RawKeycodeSequenceAction.CharacterStream?c[c.length-1]=[RawKeycodeSequenceAction.CharacterStream,c[c.length-1][1]+p]:c.push([RawKeycodeSequenceAction.CharacterStream,p]);break}}i++}return l}rawKeycodeSequencesToMacroBytes(t){return t.flatMap(r=>{const s=[];return r.forEach(i=>{switch(i[0]){case RawKeycodeSequenceAction.Tap:s.push(KeyActionPrefix,KeyAction.Tap,this.basicKeyToByte[i[1]]);break;case RawKeycodeSequenceAction.Down:s.push(KeyActionPrefix,KeyAction.Down,this.basicKeyToByte[i[1]]);break;case RawKeycodeSequenceAction.Up:s.push(KeyActionPrefix,KeyAction.Up,this.basicKeyToByte[i[1]]);break;case RawKeycodeSequenceAction.Delay:let l=`${i[1]}`;s.push(KeyActionPrefix,KeyAction.Delay,...l.split("").map(c=>c.charCodeAt(0)),DelayTerminator);break;case RawKeycodeSequenceAction.CharacterStream:s.push(...i[1].split("").map(c=>c.charCodeAt(0)));break}}),s.push(MacroTerminator),s})}async writeRawKeycodeSequences(t){const r=this.rawKeycodeSequencesToMacroBytes(t);await this.keyboardApi.setMacroBytes(r)}}const getMacroAPI=(e,t)=>{const r=getBasicKeyDict(e),s=getByteToKey(getBasicKeyDict(e));return e>=11?new MacroAPIV11(t,r,s):new MacroAPI(t,r,s)},getMacroValidator=e=>e>=11?validateMacroExpressionV11:validateMacroExpression,isDelaySupported=e=>e>=11,initialState$a={selectedDevicePath:null,connectedDevicePaths:{},supportedIds:{},forceAuthorize:!1},deviceSlice=createSlice({name:"devices",initialState:initialState$a,reducers:{selectDevice:(e,t)=>{t.payload?e.selectedDevicePath=t.payload.path:e.selectedDevicePath=null},setForceAuthorize:(e,t)=>{e.forceAuthorize=t.payload},updateConnectedDevices:(e,t)=>{e.connectedDevicePaths=t.payload},clearAllDevices:e=>{e.selectedDevicePath=null,e.connectedDevicePaths={}},updateSupportedIds:(e,t)=>{e.supportedIds=t.payload},ensureSupportedIds:(e,t)=>{const{productIds:r,version:s}=t.payload;r.forEach(i=>{e.supportedIds[i]=e.supportedIds[i]??{},e.supportedIds[i][s]=!0})}}}),{clearAllDevices,selectDevice,updateConnectedDevices,updateSupportedIds,ensureSupportedIds,setForceAuthorize}=deviceSlice.actions,devicesReducer=deviceSlice.reducer,getForceAuthorize=e=>e.devices.forceAuthorize,getConnectedDevices=e=>e.devices.connectedDevicePaths,getSelectedDevicePath=e=>e.devices.selectedDevicePath,getSupportedIds=e=>e.devices.supportedIds,getSelectedConnectedDevice=createSelector(getConnectedDevices,getSelectedDevicePath,(e,t)=>t&&e[t]),getSelectedKeyboardAPI=createSelector(getSelectedDevicePath,e=>e&&new KeyboardAPI(e)),macrosInitialState={ast:[],macroBufferSize:0,macroCount:0,isFeatureSupported:!0},macrosSlice=createSlice({name:"macros",initialState:macrosInitialState,reducers:{loadMacrosSuccess:(e,t)=>{e.ast=t.payload.ast,e.macroBufferSize=t.payload.macroBufferSize,e.macroCount=t.payload.macroCount},saveMacrosSuccess:(e,t)=>{e.ast=t.payload.ast},setMacrosNotSupported:e=>{e.isFeatureSupported=!1}}}),{loadMacrosSuccess,saveMacrosSuccess,setMacrosNotSupported}=macrosSlice.actions,macrosReducer=macrosSlice.reducer,loadMacros=e=>async(t,r)=>{const{protocol:s}=e;if(s<8)t(setMacrosNotSupported());else try{const i=r(),l=getSelectedKeyboardAPI(i),c=getMacroAPI(s,l);if(c){const u=await c.readRawKeycodeSequences(),p=await l.getMacroBufferSize(),f=await l.getMacroCount();t(loadMacrosSuccess({ast:u,macroBufferSize:p,macroCount:f}))}}catch{t(setMacrosNotSupported())}},saveMacros=(e,t)=>async(r,s)=>{const i=s(),l=getSelectedKeyboardAPI(i),{protocol:c}=e,u=getMacroAPI(c,l);if(u){const p=t.map(f=>{const m=expressionToSequence(f);return optimizedSequenceToRawSequence(m)});await u.writeRawKeycodeSequences(p),r(saveMacrosSuccess({ast:p}))}},getIsMacroFeatureSupported=e=>e.macros.isFeatureSupported,getAST=e=>e.macros.ast,getMacroBufferSize=e=>e.macros.macroBufferSize,getMacroCount=e=>e.macros.macroCount,getExpressions=createSelector(getAST,e=>e.map(t=>{const r=rawSequenceToOptimizedSequence(t);return sequenceToExpression(r)})),getIsDelaySupported=createSelector(getSelectedConnectedDevice,e=>!!e&&isDelaySupported(e.protocol));function isFulfilledPromise(e){return e.status==="fulfilled"}function isAuthorizedDeviceConnected(e,t){return t&&t[e.vendorProductId]&&t[e.vendorProductId][e.requiredDefinitionVersion]}const initialState$9={definitions:{},customDefinitions:{},layoutOptionsMap:{}},definitionsSlice=createSlice({name:"definitions",initialState:initialState$9,reducers:{updateDefinitions:(e,t)=>{e.definitions={...e.definitions,...t.payload}},loadInitialCustomDefinitions:(e,t)=>{e.customDefinitions=t.payload},unloadCustomDefinition:(e,t)=>{const{version:r,id:s}=t.payload,i=e.customDefinitions[s];Object.keys(i).length===1?(delete e.customDefinitions[s],del(s)):(delete i[r],update(s,l=>(delete l[r],l))),e.customDefinitions={...e.customDefinitions}},loadCustomDefinitions:(e,t)=>{const{version:r,definitions:s}=t.payload;s.forEach(i=>{const l=e.customDefinitions[i.vendorProductId]??{};l[r]=i,e.customDefinitions[i.vendorProductId]=l})},updateLayoutOptions:(e,t)=>{e.layoutOptionsMap={...e.layoutOptionsMap,...t.payload}}}}),{loadCustomDefinitions,loadInitialCustomDefinitions,updateDefinitions,unloadCustomDefinition,updateLayoutOptions}=definitionsSlice.actions,definitionsReducer=definitionsSlice.reducer,getBaseDefinitions=e=>e.definitions.definitions,getCustomDefinitions=e=>e.definitions.customDefinitions,getLayoutOptionsMap=e=>e.definitions.layoutOptionsMap,getDefinitions=createSelector(getBaseDefinitions,getCustomDefinitions,(e,t)=>Object.entries(t).reduce((r,[s,i])=>({...r,[s]:{...r[s],...i}}),e)),getSelectedDefinition=createSelector(getDefinitions,getSelectedConnectedDevice,(e,t)=>t&&e&&e[t.vendorProductId]&&e[t.vendorProductId][t.requiredDefinitionVersion]),getBasicKeyToByte=createSelector(getSelectedConnectedDevice,e=>{const t=getBasicKeyDict(e?e.protocol:0);return{basicKeyToByte:t,byteToKey:getByteToKey(t)}}),getSelectedLayoutOptions=createSelector(getSelectedDefinition,getLayoutOptionsMap,getSelectedDevicePath,(e,t,r)=>r&&t[r]||e&&e.layouts.labels&&e.layouts.labels.map(s=>0)||[]),getSelectedOptionKeys=createSelector(getSelectedLayoutOptions,getSelectedDefinition,(e,t)=>t?e.flatMap((r,s)=>t.layouts.optionKeys[s]&&t.layouts.optionKeys[s][r]||[]):[]),getSelectedKeyDefinitions=createSelector(getSelectedDefinition,getSelectedOptionKeys,(e,t)=>e&&t?e.layouts.keys.concat(t):[]),getLightingSupport=createSelector(getSelectedDefinition,e=>e?!!("keycodes"in e&&typeof e.keycodes=="object"&&e.keycodes.find(t=>t.toLowerCase().includes("lighting"))||"menus"in e&&typeof e.menus=="object"&&e.menus.find(t=>t==null?void 0:t.label.toLowerCase().includes("lighting"))):!1),updateLayoutOption=(e,t)=>async(r,s)=>{const i=s(),l=getSelectedDefinition(i),c=getSelectedKeyboardAPI(i),u=getSelectedDevicePath(i);if(!l||!c||!u||!l.layouts.labels)return;const p=l.layouts.labels.map(y=>Array.isArray(y)?y.slice(1).length:2),f=[...getSelectedLayoutOptions(i)];f[e]=t;const m=numIntoBytes(packBits(f.map((y,K)=>[y,p[K]])));try{await c.setKeyboardValue(KeyboardValue.LAYOUT_OPTIONS,...m)}catch{console.warn("Setting layout option command not working")}r(updateLayoutOptions({[u]:f}))},storeCustomDefinitions=({definitions:e,version:t})=>async(r,s)=>{try{const i=getCustomDefinitions(s()),l=e.map(c=>[c.vendorProductId,{...i[c.vendorProductId],[t]:c}]);return setMany(l)}catch(i){throw console.error(i),i}},loadTabkbIds=()=>async(e,t)=>{const s=await(await fetch("/tabkb/supported_kbs.json",{cache:"reload"})).json();e(ensureSupportedIds({productIds:s.v2,version:"v2"})),e(ensureSupportedIds({productIds:s.v3,version:"v3"}))},loadStoredCustomDefinitions=()=>async(e,t)=>{try{const r=await entries(),s=r.filter(([c])=>["string","number"].includes(typeof c)).reduce((c,u)=>({...c,[u[0]]:u[1]}),{});e(loadInitialCustomDefinitions(s));const[i,l]=r.reduce(([c,u],[p,f])=>[f.v2?[...c,Number(p)]:c,f.v3?[...u,Number(p)]:u],[[],[]]);e(ensureSupportedIds({productIds:i,version:"v2"})),e(ensureSupportedIds({productIds:l,version:"v3"}))}catch(r){console.error(r)}},loadLayoutOptions=()=>async(e,t)=>{const r=t(),s=getSelectedDefinition(r),i=getSelectedConnectedDevice(r),l=getSelectedKeyboardAPI(r);if(!i||!s||!s.layouts.labels||!l)return;const{path:c}=i;try{const u=await l.getKeyboardValue(KeyboardValue.LAYOUT_OPTIONS,[],4),p=unpackBits(bytesIntoNum(u),s.layouts.labels.map(f=>Array.isArray(f)?f.slice(1).length:2));e(updateLayoutOptions({[c]:p}))}catch{console.warn("Getting layout options command not working")}},reloadDefinitions=e=>async(t,r)=>{const s=r(),i=getBaseDefinitions(s),l=getDefinitions(s),c=e.filter(({vendorProductId:f,requiredDefinitionVersion:m})=>!l||!l[f]||!l[f][m]),u=await Promise.allSettled(c.map(f=>getMissingDefinition(f,f.requiredDefinitionVersion)));u.forEach((f,m)=>{const y=c[m];if(f.status==="rejected"){const K=extractDeviceInfo(y);t(logAppError({message:`Fetching ${y.requiredDefinitionVersion} definition failed`,deviceInfo:K}))}});const p=u.filter(isFulfilledPromise).map(f=>f.value);p.length&&t(updateDefinitions(p.reduce((f,[m,y])=>({...f,[m.vendorProductId]:{...f[m.vendorProductId],[y]:m}}),i)))},initialState$8={rawDeviceMap:{},numberOfLayers:4,selectedLayerIndex:0,selectedKey:null,selectedKeys:null,configureKeyboardIsSelectable:!1,selectedPaletteColor:[0,0],multiSelectAble:!1,showLabelControl:!0},keymapSlice=createSlice({name:"keymap",initialState:initialState$8,reducers:{setSelectedPaletteColor:(e,t)=>{e.selectedPaletteColor=t.payload},setNumberOfLayers:(e,t)=>{e.numberOfLayers=t.payload},setConfigureKeyboardIsSelectable:(e,t)=>{e.configureKeyboardIsSelectable=t.payload},loadLayerSuccess:(e,t)=>{const{layerIndex:r,keymap:s,devicePath:i}=t.payload;e.rawDeviceMap[i]=e.rawDeviceMap[i]||Array(e.numberOfLayers).fill({keymap:[],isLoaded:!1}),e.rawDeviceMap[i][r]={keymap:s,isLoaded:!0}},setLayer:(e,t)=>{e.selectedLayerIndex=t.payload},clearSelectedKey:e=>{e.selectedKey=null},updateSelectedKey:(e,t)=>{e.selectedKey=t.payload},clearSelectedKeys:e=>{e.selectedKeys=null},toggleSelectedKey:(e,t)=>{e.selectedKeys=e.selectedKeys||[],e.selectedKeys.includes(t.payload)?e.selectedKeys=e.selectedKeys.filter(r=>r!==t.payload):e.selectedKeys=[...e.selectedKeys,t.payload]},updateSelectedKeys:(e,t)=>{e.selectedKeys=[...t.payload]},addSelectedKey:(e,t)=>{e.selectedKeys=e.selectedKeys||[],!e.selectedKeys.includes(t.payload)&&(e.selectedKeys=[...e.selectedKeys,t.payload])},removeSelectedKey:(e,t)=>{e.selectedKeys=e.selectedKeys||[],e.selectedKeys=e.selectedKeys.filter(r=>r!==t.payload)},saveKeymapSuccess:(e,t)=>{const{layers:r,devicePath:s}=t.payload;e.rawDeviceMap[s]=r},setKey:(e,t)=>{const{keymapIndex:r,value:s,devicePath:i}=t.payload,{selectedLayerIndex:l}=e;e.rawDeviceMap[i][l].keymap[r]=s},updateMultiSelectAble:(e,t)=>{e.multiSelectAble=t.payload},updateShowLayerControl:(e,t)=>{e.showLabelControl=t.payload}},extraReducers:e=>{e.addCase(selectDevice,t=>{t.selectedKey=null,t.selectedKeys=[],t.multiSelectAble=!1})}}),{setNumberOfLayers,setLayer,loadLayerSuccess,clearSelectedKey,setKey,updateSelectedKey,saveKeymapSuccess,setConfigureKeyboardIsSelectable,setSelectedPaletteColor,toggleSelectedKey,clearSelectedKeys,addSelectedKey,removeSelectedKey,updateSelectedKeys,updateMultiSelectAble,updateShowLayerControl}=keymapSlice.actions,keymapReducer=keymapSlice.reducer,loadKeymapFromDevice=e=>async(t,r)=>{const s=r();if(getLoadProgress(s)===1)return;const{path:i,vendorProductId:l,requiredDefinitionVersion:c}=e,u=getSelectedKeyboardAPI(s),p=await u.getLayerCount();t(setNumberOfLayers(p));const{matrix:f}=getDefinitions(s)[l][c];for(var m=0;m<p;m++){const y=await u.readRawMatrix(f,m);t(loadLayerSuccess({layerIndex:m,keymap:y,devicePath:i}))}},saveRawKeymapToDevice=(e,t)=>async(r,s)=>{const i=s(),{path:l}=t,c=getSelectedKeyboardAPI(i),u=getSelectedDefinition(i);if(!l||!u||!c)return;const{matrix:p}=u;await c.writeRawMatrix(p,e);const f=e.map(m=>({keymap:m,isLoaded:!0}));r(saveKeymapSuccess({layers:f,devicePath:l}))},updateKey=(e,t)=>async(r,s)=>{const i=s(),l=getSelectedKeyDefinitions(i),c=getSelectedConnectedDevice(i),u=getSelectedKeyboardAPI(i),p=getSelectedDefinition(i);if(!c||!l||!p||!u)return;const f=getSelectedLayerIndex(i),{path:m}=c,{row:y,col:K}=l[e];await u.setKey(f,y,K,t);const{matrix:x}=p,b=y*x.cols+K;r(setKey({keymapIndex:b,value:t,devicePath:m}))},getConfigureKeyboardIsSelectable=e=>e.keymap.configureKeyboardIsSelectable,getSelectedKey=e=>e.keymap.selectedKey,getRawDeviceMap=e=>e.keymap.rawDeviceMap,getNumberOfLayers=e=>e.keymap.numberOfLayers,getSelectedLayerIndex=e=>e.keymap.selectedLayerIndex,getSelected256PaletteColor=e=>e.keymap.selectedPaletteColor,getSelectedPaletteColor=createSelector(getSelected256PaletteColor,([e,t])=>[360*e/255,t/255]),getSelectedKeys=e=>e.keymap.selectedKeys,getMultiSelectAble=e=>e.keymap.multiSelectAble,getShowLayerControl=e=>e.keymap.showLabelControl,getSelectedRawLayers=createSelector(getRawDeviceMap,getSelectedDevicePath,(e,t)=>t&&e[t]||[]),getLoadProgress=createSelector(getSelectedRawLayers,getNumberOfLayers,(e,t)=>e&&e.filter(r=>r.isLoaded).length/t);createSelector(getSelectedRawLayers,getSelectedLayerIndex,(e,t)=>e&&e[t]);const getSelectedKeymaps=createSelector(getSelectedKeyDefinitions,getSelectedDefinition,getSelectedRawLayers,(e,t,r)=>{if(t&&r){const s=r.map(l=>l.keymap),{matrix:{cols:i}}=t;return s.map(l=>e.map(({row:c,col:u})=>l[c*i+u]))}}),getSelectedKeymap=createSelector(getSelectedKeymaps,getSelectedLayerIndex,(e,t)=>e&&e[t]);createSelector(getSelectedKeyDefinitions,getSelectedDefinition,(e,t)=>{if(e&&t){const{matrix:{cols:r}}=t;return e.map(({row:s,col:i})=>s*r+i)}return[]});const commandParamLengths={[dist.LightingValue.BACKLIGHT_COLOR_1]:2,[dist.LightingValue.BACKLIGHT_COLOR_2]:2,[dist.LightingValue.QMK_RGBLIGHT_COLOR]:2,[dist.LightingValue.BACKLIGHT_CUSTOM_COLOR]:2,[dist.LightingValue.BACKLIGHT_CAPS_LOCK_INDICATOR_COLOR]:2,[dist.LightingValue.BACKLIGHT_CAPS_LOCK_INDICATOR_ROW_COL]:2,[dist.LightingValue.BACKLIGHT_LAYER_1_INDICATOR_COLOR]:2,[dist.LightingValue.BACKLIGHT_LAYER_2_INDICATOR_COLOR]:2,[dist.LightingValue.BACKLIGHT_LAYER_3_INDICATOR_COLOR]:2,[dist.LightingValue.BACKLIGHT_LAYER_1_INDICATOR_ROW_COL]:2,[dist.LightingValue.BACKLIGHT_LAYER_2_INDICATOR_ROW_COL]:2,[dist.LightingValue.BACKLIGHT_LAYER_3_INDICATOR_ROW_COL]:2,[dist.LightingValue.BACKLIGHT_EFFECT_SPEED]:1,[dist.LightingValue.BACKLIGHT_USE_7U_SPACEBAR]:1,[dist.LightingValue.BACKLIGHT_USE_ISO_ENTER]:1,[dist.LightingValue.BACKLIGHT_USE_SPLIT_BACKSPACE]:1,[dist.LightingValue.BACKLIGHT_USE_SPLIT_LEFT_SHIFT]:1,[dist.LightingValue.BACKLIGHT_USE_SPLIT_RIGHT_SHIFT]:1,[dist.LightingValue.BACKLIGHT_DISABLE_AFTER_TIMEOUT]:1,[dist.LightingValue.BACKLIGHT_DISABLE_HHKB_BLOCKER_LEDS]:1,[dist.LightingValue.BACKLIGHT_DISABLE_WHEN_USB_SUSPENDED]:1},initialState$7={lightingMap:{}},lightingSlice$1=createSlice({name:"lighting",initialState:initialState$7,reducers:{updateSelectedLightingData:(e,t)=>{const{lightingData:r,devicePath:s}=t.payload;e.lightingMap[s]=r},updateLighting:(e,t)=>{e.lightingMap={...e.lightingMap,...t.payload}}}}),{updateLighting,updateSelectedLightingData}=lightingSlice$1.actions,lightingReducer=lightingSlice$1.reducer,updateBacklightValue=(e,...t)=>async(r,s)=>{const i=s(),l=getSelectedConnectedDevice(i);if(!l)return;const u={...getSelectedLightingData(i),[e]:[...t]},{path:p}=l;r(updateSelectedLightingData({lightingData:u,devicePath:p}));const f=getSelectedKeyboardAPI(i);await f.setBacklightValue(e,...t),await f.saveLighting()},updateCustomColor=(e,t,r)=>async(s,i)=>{const l=i(),c=getSelectedConnectedDevice(l),u=getSelectedKeyboardAPI(l),p=getSelectedLightingData(l);if(!c||!p||!u)return;const f=[...p.customColors||[]];f[e]={hue:t,sat:r};const m={...p,customColors:f},{path:y}=c;s(updateSelectedLightingData({lightingData:m,devicePath:y})),u.setCustomColor(e,t,r),await u.saveLighting()},updateLightingData=e=>async(t,r)=>{const s=r(),i=getSelectedDefinition(s),l=getSelectedKeyboardAPI(s);if(!i||!l)return;const{path:c}=e;if(!dist.isVIADefinitionV2(i))throw new Error("This method is only compatible with v2 definitions");const{lighting:u}=i,{supportedLightingValues:p,effects:f}=dist.getLightingDefinition(u);if(p.length!==0){let m={};if(p.indexOf(dist.LightingValue.BACKLIGHT_CUSTOM_COLOR)!==-1){const x=await Array(Math.max(...f.map(([M,w])=>w))).fill(0).map((M,w)=>l.getCustomColor(w));m={customColors:await Promise.all(x)}}const y=p.map(x=>({command:x,promise:l.getBacklightValue(+x,commandParamLengths[x])})),K=await Promise.all(y.map(x=>x.promise));m=y.reduce(({res:x,ref:b},M,w)=>({ref:b,res:{...x,[M.command]:b[w]}}),{res:m,ref:K}).res,t(updateLighting({[c]:{...m}}))}},getLightingMap=e=>e.lighting.lightingMap,getSelectedLightingData=createSelector(getLightingMap,getSelectedDevicePath,(e,t)=>t&&e[t]);function getIconColor(e){return{style:{color:e?"var(--bg_icon-highlighted)":"var(--bg_control)"}}}const Grid=styled.div`
  height: 100%;
  width: 100%;
  display: grid;
  grid-template-columns: min-content min-content minmax(0, 1fr);
  > div {
    pointer-events: all;
  }
`,Cell=styled.div`
  border-right: 1px solid var(--border_color_cell);
`,MenuCell=styled(Cell)`
  background: var(--bg_menu);
  border-top: 1px solid var(--border_color_cell);
`,OverflowCell=styled(Cell)`
  border-top: 1px solid var(--border_color_cell);
  overflow: auto;
`,SpanOverflowCell=styled(Cell)`
  border-top: 1px solid var(--border_color_cell);
  overflow: auto;
  grid-column: span 2;
`,SubmenuCell=styled(Cell)`
  border-top: 1px solid var(--border_color_cell);
  background: var(--bg_control);
`,SubmenuOverflowCell=styled(SubmenuCell)`
  min-width: 80px;
  overflow: auto;
`,SinglePaneFlexCell=styled(Cell)`
  display: flex;
  overflow: hidden;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  position: relative;
`,ConfigureFlexCell=styled(SinglePaneFlexCell)`
  pointer-events: none;
  height: 500px;
`,CategoryIconContainer=styled.span`
  position: relative;
  color: var(--color_inside-accent);
  height: 35px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  background: ${e=>e.$selected?"var(--color_accent)":"transparent"};
  border-radius: 10px;
  width: 40px;
  &:hover {
    color: ${e=>e.$selected?"var(--color_inside-accent)":"var(--color_accent)"};
    & .tooltip {
      transform: scale(1) translateX(0px);
      opacity: 1;
    }
  }
  .tooltip {
    transform: translateX(-5px) scale(0.6);
    opacity: 0;
  }
`,IconContainer=styled.span`
  display: inline-block;
  text-align: center;
  width: 35px;
  position: relative;
  &:hover > span > div {
    background-color: red;
  }
`,ControlRow=styled.div`
  position: relative;
  width: 100%;
  max-width: 960px;
  border-bottom: 1px solid var(--border_color_cell);
  font-size: 20px;
  justify-content: space-between;
  display: flex;
  line-height: 50px;
  min-height: 50px;
  box-sizing: border-box;
  padding-left: 5px;
  padding-right: 5px;
`,IndentedControlRow=styled(ControlRow)`
  padding-left: 17px;
`,Label$1=styled.label`
  color: var(--color_label);
  font-weight: 400;
`,SubLabel=styled(Label$1)`
  font-size: 18px;
  font-style: italic;
  font-weight: 400;
`,Detail=styled.span`
  color: var(--color_accent);
  display: flex;
  align-items: center;
`,Row=styled.div`
  cursor: pointer;
  white-space: nowrap;
  margin-bottom: 15px;
  font-size: 20px;
  line-height: 20px;
  text-transform: uppercase;
  color: ${e=>getIconColor(e.$selected).style.color};
  border-left: 2px solid transparent;

  svg {
    height: 20px;
    vertical-align: middle;
  }

  &:hover {
    color: var(--color_label-highlighted);
    & .tooltip {
      transform: scale(1) translateX(0px);
      opacity: 1;
    }
  }
  .tooltip {
    transform: translateX(-5px) scale(0.6);
    opacity: 0;
  }
`,SubmenuRow=styled(Row)`
  background: ${e=>e.$selected?"var(--bg_icon)":"inherit"};
  padding: 4px 8px;
  font-weight: 400;
  min-width: min-content;
  border-color: transparent;
  margin-bottom: 11px;
  color: ${e=>e.$selected?"var(--color_label-highlighted)":"var(--color_label)"};
  border-radius: 12px;
`,Pane$c=styled.div`
  background: var(--gradient);
  display: flex;
  flex: 1;
  flex-direction: column;
  height: 100%;
  overflow: hidden;
  background: var(--gradient);
`,CenterPane=styled(Pane$c)`
  overflow: auto;
  display: block;
`,ConfigureBasePane=styled(Pane$c)`
  flex-direction: column;
  align-items: center;
  justify-content: space-evenly;
  background: transparent;
  pointer-events: none;
  z-index: 3;
`,SvgIcLightbulbOutline24Px=e=>jsx("svg",{width:11.9,height:17,...e,children:jsx("path",{d:"M3.4 16.15a.853.853 0 00.85.85h3.4a.852.852 0 00.85-.85v-.85H3.4zM5.95 0a5.947 5.947 0 00-3.4 10.829v1.921a.852.852 0 00.85.85h5.1a.852.852 0 00.85-.85v-1.921A5.947 5.947 0 005.95 0zm2.422 9.435l-.722.51V11.9h-3.4V9.945l-.722-.51a4.25 4.25 0 114.845 0z",fill:"currentColor"})}),title$7="Lighting",component$4=SvgIcLightbulbOutline24Px,AccentButtonBase=styled.button`
  height: 40px;
  padding: 0 15px;
  line-height: 40px;
  min-width: 100px;
  text-align: center;
  outline: none;
  font-size: 20px;
  border-radius: 5px;
  color: var(--color_accent);
  border: 1px solid var(--color_accent);
  display: inline-block;
  box-sizing: border-box;
  pointer-events: ${e=>e.disabled?"none":"auto"};
  cursor: ${e=>e.disabled?"not-allowed":"pointer"};

  &:hover {
    border: 1px solid var(--color_accent);
  }
`,AccentButton=styled(AccentButtonBase)`
  background-color: ${e=>e.disabled?"var(--bg_control-disabled)":"var(--bg_outside-accent)"};
  color: ${e=>e.disabled?"var(--bg_control)":"var(--color_accent)"};
  border-color: ${e=>e.disabled?"var(--bg_control)":"var(--color_accent)"};

  &:hover {
    filter: brightness(0.7);
  }
`,AccentButtonLarge=styled(AccentButton)`
  font-size: 24px;
  line-height: 60px;
  height: 60px;
`,PrimaryAccentButton=styled(AccentButtonBase)`
  color: ${e=>e.disabled?"var(--bg_control)":"var(--color_inside-accent)"};
  border-color: ${e=>e.disabled?"var(--bg_control)":"var(--color_accent)"};
  background-color: ${e=>e.disabled?"transparent":"var(--color_accent)"};
  &:hover {
    filter: brightness(0.7);
  }
`,Keycode$2=styled.span`
  color: var(--color_accent);
  display: flex;
  padding-left: 10px;
`,KeycodeLabel=styled.span`
  color: var(--color_label);
  display: flex;
`,Item=styled.div`
  box-sizing: border-box;
  min-width: 200px;
  padding: 5px 10px;
  display: flex;
  justify-content: space-between;
  background-color: ${e=>e.$selected?"var(--bg_control)":"var(--bg_menu)"};

  &:hover {
    background-color: var(--bg_control);
  }
`,AutocompleteItem=({selected:e,entity:{label:t,code:r}})=>jsxs(Item,{$selected:e,children:[jsx(KeycodeLabel,{children:t})," ",jsx(Keycode$2,{children:r})]}),AutocompleteLoading=()=>jsx("div",{children:"Loading"}),findKeycodes=e=>{const t=e.toUpperCase();return getAutocompleteKeycodes().filter(({name:r,title:s,code:i})=>s?s.toUpperCase().indexOf(t)>-1:r.toUpperCase().indexOf(t)>-1||i.toUpperCase().indexOf(t)>-1).slice(0,10).map(({name:r,code:s,title:i})=>({label:i||r,code:s}))},TextInput=styled.input`
  background: none;
  border: none;
  border-bottom: 1px solid var(--color_accent);
  filter: brightness(0.7);
  color: var(--color_accent);
  font-size: 1.2rem;
  margin-bottom: 1.5rem;
  padding: 0.5rem;
  transition: all 0.2s ease-out;

  &:focus {
    filter: brightness(1);
    color: var(--color_accent);
    outline: none;
  }

  &::placeholder {
    color: var(--color_control);
  }
`,ModalBackground=styled.div`
  position: fixed;
  top: 0;
  left: 0;
  background: rgba(0, 0, 0, 0.75);
  width: 100%;
  height: 100%;
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 4;
`,ModalContainer=styled.div`
  border: 2px solid var(--color_accent);
  min-width: 460px;
  max-width: 550px;
  min-height: 170px;
  gap: 20px;
  background-color: var(--bg_menu);
  border-radius: 6px;
  display: flex;
  justify-content: center;
  align-items: center;
  flex-direction: column;
  padding: 20px;
  box-sizing: border-box;
`,PromptText=styled.div`
  font-weight: 500;
  user-select: none;
  color: var(--color_label);
  font-size: 20px;
  text-align: center;
`,RowDiv$1=styled.div`
  display: flex;
  justify-content: center;
  align-items: center;
  width: 220px;
  gap: 20px;
`,AutocompleteContainer=styled.ul`
  position: fixed;
  background-color: var(--bg_menu);
  max-height: 210px;
  overflow: auto;
  border: 1px solid var(--bg_control);
  margin: 0;
  padding: 0;
  width: auto;
  margin-top: -24px;
  line-height: normal;
`,AutocompleteItemRow=styled.li`
  &:not(:last-child) {
    border-bottom: 1px solid var(--bg_control);
  }
`;function isHex(e){const t=e.toLowerCase();return`0x${parseInt(t,16).toString(16).toLowerCase()}`===t}function inputIsBasicByte(e,t){return e.trim().toUpperCase()in t}function basicByteFromInput(e,t){const r=e.trim().toUpperCase();return t[r]}function inputIsAdvancedKeyCode(e,t){const r=e.trim().toUpperCase();return advancedStringToKeycode(r,t)!==0}function advancedKeyCodeFromInput(e,t){const r=e.trim().toUpperCase();return advancedStringToKeycode(r,t)}function inputIsHex(e){return isHex(e.trim())}function hexFromInput(e){const t=e.toLowerCase();return parseInt(t,16)}function inputIsValid(e,t){return inputIsBasicByte(e,t)||inputIsAdvancedKeyCode(e,t)||inputIsHex(e)}function keycodeFromInput(e,t){return inputIsBasicByte(e,t)?basicByteFromInput(e,t):inputIsAdvancedKeyCode(e,t)?advancedKeyCodeFromInput(e,t):inputIsHex(e)?hexFromInput(e):null}const getInputItems=e=>e.map(t=>({code:t.code,label:t.title??t.name})),KeycodeModal=e=>{const{t}=useTranslation(),r=useAppSelector(getSelectedDefinition),{basicKeyToByte:s,byteToKey:i}=useAppSelector(getBasicKeyToByte);if(!r)return null;const l=getInputItems(getKeycodesForKeyboard(r)),[c,u]=reactExports.useState(l),p=anyKeycodeToString(e.defaultValue,s,i),{getMenuProps:f,getInputProps:m,highlightedIndex:y,inputValue:K,getItemProps:x,isOpen:b}=useCombobox({items:c,initialIsOpen:p==="",defaultInputValue:p,itemToString:w=>(w==null?void 0:w.code)??"",onInputValueChange:({inputValue:w})=>{u(l.filter(({label:L,code:F})=>[L,F].flatMap(I=>I.split(/\s+/)).map(I=>I.toLowerCase()).some(I=>I.startsWith((w??"").toLowerCase()))))}}),M=inputIsValid(K,s);return jsx(ModalBackground,{children:jsxs(ModalContainer,{children:[jsxs(PromptText,{children:[t("Please enter your desired QMK keycode or hex code"),":"]}),jsxs("div",{children:[jsx("div",{children:jsx(TextInput,{...m(),type:"text",placeholder:p||"KC_NO, 0xFF, etc."})}),jsx(AutocompleteContainer,{...f(),style:{display:b&&c.length?"block":"none"},children:b&&c.map((w,L)=>reactExports.createElement(AutocompleteItemRow,{...x({item:w,index:L}),key:w.code},jsx(AutocompleteItem,{selected:y===L,entity:w},w.code)))})]}),jsxs(RowDiv$1,{children:[jsx(AccentButton,{onClick:e.onExit,children:t("Cancel")}),jsx(PrimaryAccentButton,{disabled:!M,onClick:()=>{e.onConfirm(keycodeFromInput(K,s))},children:t("Confirm")})]})]})})},PelpiKeycodeInput=e=>{const[t,r]=React.useState(!1),{basicKeyToByte:s,byteToKey:i}=useAppSelector(getBasicKeyToByte);return jsxs(Fragment,{children:[jsx(AccentButton,{onClick:()=>r(!0),children:anyKeycodeToString(e.value,s,i)}),t&&jsx(KeycodeModal,{defaultValue:e.value,onChange:e.setValue,onConfirm:l=>{e.setValue(l),r(!1)},onExit:()=>r(!1)})]})},HiddenInput$3=styled.input`
  opacity: 0;
  width: 0;
  height: 0;
`,Switch=styled.label`
  position: relative;
  display: inline-block;
  width: 60px;
  height: 34px;
`,Slider$1=styled.span`
  position: absolute;
  cursor: ${e=>e.$disabled?"default":"pointer"};
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: ${e=>e.$ischecked&&!e.$disabled?"var(--color_accent)":"var(--bg_control)"};
  -webkit-transition: 0.4s;
  transition: 0.4s;
  border-radius: 4px;
  &:before {
    position: absolute;
    content: '';
    height: 26px;
    width: 26px;
    left: 4px;
    bottom: 4px;
    border-radius: 4px;
    background-color: ${e=>e.$ischecked?"var(--color_inside-accent)":"var(--bg_icon)"};
    -webkit-transition: 0.4s;
    transition: 0.4s;
    ${e=>e.$ischecked?"transform: translateX(26px)":""};
  }
`;function AccentSlider(e){const{isChecked:t,onChange:r,disabled:s}=e,[i,l]=React.useState(t),c=reactExports.useRef(null);return React.useEffect(()=>{l(t)},[t]),jsxs(Switch,{children:[jsx(HiddenInput$3,{ref:c,type:"checkbox",checked:i,onChange:()=>{if(s)return;const p=!t;l(p),r(p),c.current&&c.current.blur()}}),jsx(Slider$1,{$ischecked:i,$disabled:s})]})}const customStyles={option:(e,t)=>({...e,"&:hover":{backgroundColor:t.isSelected?"var(--color_accent)":"var(--bg_control)"},":active":{backgroundColor:"var(--bg_control)"},background:t.isSelected?"var(--color_accent)":t.isFocused?"var(--bg_control)":"var(--bg_menu)",color:t.isSelected?"var(--color_inside-accent)":(t.isFocused,"var(--color_accent)")}),container:e=>({...e,lineHeight:"initial",flex:1}),input:e=>({...e,color:"var(--color_accent)",opacity:.5}),singleValue:e=>({...e,color:"var(--color_accent)"}),dropdownIndicator:e=>({...e,color:"var(--color_accent)"}),indicatorSeparator:e=>({...e,backgroundColor:"var(--color_accent)"}),menuList:e=>({...e,borderColor:"var(--color_accent)",backgroundColor:"var(--bg_menu)"}),placeholder:e=>({...e,color:"var(--color_accent)"}),valueContainer:e=>({...e,":active":{backgroundColor:"var(--bg_control)",borderColor:"var(--color_accent)"},"&:hover":{borderColor:"var(--color_accent)"},color:"var(--color_accent)",background:"var(--bg_menu)"}),control:(e,t)=>({...e,boxShadow:"none",":active":{backgroundColor:"transparent",borderColor:"var(--color_accent)"},"&:hover":{borderColor:"var(--color_accent)"},color:"var(--color_accent)",borderColor:"1px solid var(--color_accent)",background:"var(--bg_menu)",overflow:"hidden",width:t.selectProps.width||250})},AccentSelect=e=>jsx(Select,{...e,styles:customStyles}),Container$m=styled.span`
  display: inline-flex;
  align-items: center;
  line-height: initial;
  column-gap: 5px;
  min-width: 200px;
`,SliderInput=styled.input.attrs({type:"range"})`
  accent-color: var(--color_accent);
  width: 200px;
`,AccentRange=e=>{const{showLabel:t,...r}=e;return jsxs(Container$m,{children:[e.showLabel&&jsx("span",{children:e.value??e.defaultValue}),jsx(SliderInput,{...r,onChange:s=>{e.onChange&&e.onChange(+s.target.value)}})]})},ColorPickerContainer=styled.div`
  display: flex;
  align-items: center;
`,ColorLens=styled.div`
  position: absolute;
  width: 10px;
  height: 10px;
  border-radius: 50%;
  border: 2px solid black;
  opacity: 0.7;
  background: rgba(255, 255, 255, 0.2);
  pointer-events: none;
  box-sizing: border-box;
  transform: translate3d(195px, 195px, 0);
`,ColorInner=styled.div`
  width: 100%;
  height: 100%;
  background: linear-gradient(to top, white, rgba(0, 0, 0, 0));
`,ColorOuter=styled.div`
  width: 100%;
  height: 100%;
  background: linear-gradient(
    to right,
    red,
    yellow,
    lime,
    aqua,
    blue,
    magenta,
    red
  );
`,ColorThumbnail=styled.div`
  display: inline-block;
  height: 25px;
  width: 25px;
  border-radius: 50%;
  border: 4px solid var(--border_color_cell);
  cursor: pointer;
  &:hover {
    opacity: 0.8;
  }
`,Container$l=styled.div`
  border: 4px solid var(--border_color_cell);
  width: 180px;
  height: 180px;
  position: relative;
`,PickerContainer=styled.div`
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
  flex-direction: column;
  z-index: 1;
  box-shadow: rgba(0, 0, 0, 0.11) 0 1px 1px 1px;
  position: absolute;
  transform: translate3d(-205px, 50px, 0);

  &::after {
    content: '';
    position: absolute;
    width: 0px;
    height: 0px;
    border: 11px solid var(--border_color_cell);
    border-top-color: transparent;
    border-bottom-color: transparent;
    border-right-color: transparent;
    right: -22px;
    top: 66px;
  }
`,ColorPreview$1=styled.div`
  width: 180px;
  height: 24px;
  border: 4px solid var(--border_color_cell);
  border-bottom: none;
`,ColorHexContainer=styled.div`
  border: 4px solid var(--border_color_cell);
  border-bottom: none;
  width: 180px;
  height: 32px;
  line-height: 32px;
  text-align: center;
  background: var(--bg_menu);
`,ColorHexInput=styled.input`
  text-align: center;
  border: none;
  color: var(--color_accent);
  background: var(--bg_menu);
  font-size: 20px;
  font-weight: 300;
  padding: 0;
  width: 100%;
  &:focus {
    outline: none;
    color: var(--color_accent);
    border-color: var(--color_accent);
  }
`;let ColorPicker$1=class extends reactExports.Component{constructor(){super(...arguments);ce(this,"ref",null);ce(this,"refWidth",0);ce(this,"refHeight",0);ce(this,"mouseDown",!1);ce(this,"state",{lensTransform:"",showPicker:!1,offset:[5,5],hexColorCode:getHex(this.props.color)});ce(this,"onMouseMove",r=>{if(this.mouseDown){const{offsetX:s,offsetY:i}=r.nativeEvent,l=`translate3d(${s-5}px, ${i-5}px, 0)`,c=[s,i],{hue:u,sat:p}=this.getLinearHueSat(c),f=getHex(this.props.color);this.props.setColor(Math.round(255*(u/360)),Math.round(255*p)),this.setState({lensTransform:l,offset:c,hexColorCode:f})}});ce(this,"onMouseDown",r=>{this.mouseDown=!0,this.onMouseMove(r),this.ref&&(this.ref.style.cursor="pointer")});ce(this,"onMouseUp",()=>{if(this.mouseDown=!1,this.ref&&(this.ref.style.cursor="auto"),this.props.onMouseUp){const{hue:r,sat:s}=this.getLinearHueSat(this.state.offset);this.props.onMouseUp(r,s)}});ce(this,"onThumbnailClick",()=>{this.props.onOpen&&this.props.onOpen(),this.setState({showPicker:!0})});ce(this,"pickerContainer",React.createRef());ce(this,"colorThumbnail",React.createRef());ce(this,"onDocumentClick",r=>{if(this.state.showPicker&&this.pickerContainer.current&&!this.pickerContainer.current.contains(r.target)&&this.colorThumbnail.current&&!this.colorThumbnail.current.contains(r.target)&&!this.mouseDown){if(this.props.onClose){const{hue:s,sat:i}=this.getLinearHueSat(this.state.offset);this.props.onClose(s,i)}this.mouseDown=!1,this.setState({showPicker:!1,hexColorCode:getHex(this.props.color)})}else this.mouseDown&&this.state.showPicker&&this.pickerContainer.current&&!this.pickerContainer.current.contains(r.target)&&this.colorThumbnail.current&&!this.colorThumbnail.current.contains(r.target)&&this.onMouseUp()});ce(this,"handleHexChange",r=>{let s=r.target.value;s=s.replace(/[^A-Fa-f0-9]/g,""),s.length>0&&s[0]!=="#"&&(s=`#${s}`),s.length>7&&(s=s.substring(0,7)),this.setState({hexColorCode:s})});ce(this,"handleHexBlur",r=>{this.setState({hexColorCode:getHex(this.props.color)})});ce(this,"handleHexSubmit",r=>{if(r.key==="Enter"){if(/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/.test(this.state.hexColorCode)){var s=this.state.hexColorCode.replace("#","");s.length==3&&(s=`${s.split("").map(u=>u+u).join("")}`);const[l,c]=getHSV(s);this.props.setColor(Math.round(255*(l/360)),Math.round(255*c))}this.setState({hexColorCode:getHex(this.props.color)})}})}componentWillUnmount(){document.removeEventListener("mousedown",this.onDocumentClick),document.removeEventListener("click",this.onDocumentClick)}componentDidUpdate({color:r},s){if(this.ref&&this.state.showPicker&&(!s.showPicker||r!==this.props.color)){const{width:i,height:l}=this.ref.getBoundingClientRect();this.refWidth=i,this.refHeight=l;const{hue:c,sat:u}=this.props.color,p=i*c/255,f=l*(1-u/255),m=`translate3d(${p-5}px, ${f-5}px, 0)`;this.setState({lensTransform:m,offset:[p,f]})}}componentDidMount(){document.addEventListener("click",this.onDocumentClick),document.addEventListener("mousedown",this.onDocumentClick)}getRadialHueSat(r){const{offsetX:s,offsetY:i}=r.nativeEvent,l=toDegrees(calcRadialHue(s,i)??0),c=Math.min(1,calcRadialMagnitude(s,i)??0);return{hue:l,sat:c}}getLinearHueSat([r,s]){const i=this.refWidth,l=this.refHeight,[c,u]=[Math.max(0,r),Math.max(0,s)],p=360*Math.min(1,c/i),f=1-Math.min(1,u/l);return{hue:p,sat:f}}render(){const r=getRGB(this.props.color),{isSelected:s=!1}=this.props,{offset:i}=this.state,l=`translate3d(${i[0]-5}px, ${i[1]-5}px, 0)`;return jsx(Fragment,{children:jsxs(ColorPickerContainer,{children:[jsx(ColorThumbnail,{ref:this.colorThumbnail,onClick:this.onThumbnailClick,style:{background:r,borderColor:s?"var(--color_accent)":"var(--border_color_cell)"}}),this.state.showPicker&&jsxs(PickerContainer,{ref:this.pickerContainer,onMouseUp:this.onMouseUp,children:[jsx(ColorHexContainer,{children:jsx(ColorHexInput,{type:"text",value:this.state.hexColorCode,onChange:this.handleHexChange,onBlur:this.handleHexBlur,onKeyDown:this.handleHexSubmit})}),jsx(ColorPreview$1,{style:{background:getRGB(this.props.color)}}),jsx(Container$l,{children:jsx(ColorOuter,{onMouseDown:this.onMouseDown,onMouseMove:this.onMouseMove,ref:c=>this.ref=c,children:jsx(ColorInner,{children:jsx(ColorLens,{style:{transform:l}})})})})]})]})})}};const ArrayColorPicker=e=>{const{color:t,setColor:r}=e;return jsx(ColorPicker$1,{color:{hue:t[0],sat:t[1]},setColor:r})},ColorPalettePickerContainer=styled.div`
  display: flex;
  align-items: center;
  column-gap: 10px;
`,PreviousColorContainer=styled.div`
  display: flex;
  background: var(--bg_control);
  border-radius: 15px;
`,PreviousColorOption=styled.div`
  display: inline-block;
  height: 25px;
  width: 25px;
  border-radius: 50%;
  border: 4px solid var(--border_color_cell);
  cursor: pointer;
  transition: transform 0.2s ease-out;
  &:hover {
    opacity: 0.8;
  }
  transform: ${e=>e.$selected?"scale(0.8)":"scale(0.6)"};
  border-color: ${e=>e.$selected?"var(--color_accent)":"var(--border_color_cell)"};
`,ConnectedColorPalettePicker=()=>{const e=useDispatch(),t=reactExports.useCallback((r,s)=>e(setSelectedPaletteColor([r,s])),[e]);return reactExports.useEffect(()=>(e(updateShowKeyPainter(!0)),()=>{e(updateShowKeyPainter(!1))})),jsx(ColorPalettePicker,{color:[0,0],setColor:t})},ColorPalettePicker=e=>{const{color:t,setColor:r}=e,[s,i]=reactExports.useState(t),[l,c]=reactExports.useState(t),u=reactExports.useMemo(()=>Array(9).fill(0).map((p,f)=>[Math.round(f*255/10),255,255]),[]);return jsxs(ColorPalettePickerContainer,{children:[jsx(PreviousColorContainer,{children:u.map((p,f)=>{const m=s[0]===p[0]&&s[1]===p[1];return jsx(PreviousColorOption,{$selected:m,style:{background:getRGB({hue:p[0]??0,sat:p[1]??0})},onClick:()=>{i(p),r(p[0],p[1])}},f)})}),jsx(ColorPicker$1,{isSelected:l[0]===s[0]&&l[1]===s[1],color:{hue:l[0],sat:l[1]},setColor:(p,f)=>{i([p,f]),c([p,f])},onOpen:()=>{i([l[0],l[1]]),r(l[0],l[1])},onMouseUp:()=>{i([l[0],l[1]]),r(l[0],l[1])}})]})},VIACustomItem=React.memo(e=>{const{t}=useTranslation();return e.value.length===0?jsx(Fragment,{}):jsxs(ControlRow,{id:e._id,children:[jsx(Label$1,{children:t(e.label)}),jsx(Detail,{children:"type"in e?jsx(VIACustomControl,{...e,value:e.value&&Array.from(e.value)}):e.content})]})}),boxOrArr=e=>Array.isArray(e)?e:[e],valueIsChecked=(e,t)=>boxOrArr(e).every((r,s)=>r==t[s]),getRangeValue=(e,t)=>t>255?shiftTo16Bit([e[0],e[1]]):e[0],getRangeBytes=(e,t)=>t>255?shiftFrom16Bit(e):[e],VIACustomControl=e=>{const{t}=useTranslation(),{content:r,type:s,options:i,value:l}=e,[c,...u]=r;switch(s){case"button":{const p=i||[1];return jsx(AccentButton,{onClick:()=>e.updateValue(c,...u,p[0]),children:t("Click")})}case"range":return jsx(AccentRange,{showLabel:!0,min:i[0],max:i[1],defaultValue:getRangeValue(e.value,i[1]),onChange:p=>e.updateValue(c,...u,...getRangeBytes(p,i[1]))});case"keycode":return jsx(PelpiKeycodeInput,{value:shiftTo16Bit([e.value[0],e.value[1]]),meta:{},setValue:p=>e.updateValue(c,...u,...shiftFrom16Bit(p))});case"toggle":{const p=i||[0,1];return jsx(AccentSlider,{isChecked:valueIsChecked(p[1],e.value),onChange:f=>e.updateValue(c,...u,...boxOrArr(p[+f]))})}case"dropdown":{const p=i.map((f,m)=>{const[y,K]=typeof f=="string"?[f,m]:f;return{value:K||m,label:t(y)}});return jsx(AccentSelect,{onChange:f=>f&&e.updateValue(c,...u,+f.value),options:p,defaultValue:p.find(f=>l[0]===f.value),value:p.find(f=>l[0]===f.value)})}case"color":return jsx(ArrayColorPicker,{color:e.value,setColor:(p,f)=>e.updateValue(c,...u,p,f)});case"color-palette":return jsx(ConnectedColorPalettePicker,{})}return null},CustomPane=styled(CenterPane)`
  height: 100%;
  background: var(--color_dark_grey);
`,Container$k=styled.div`
  display: flex;
  align-items: center;
  flex-direction: column;
  padding: 0 12px;
`;function categoryGenerator(e){return e.viaMenu.content.flatMap(t=>submenuGenerator(t,e))}function itemGenerator(e,t){return"showIf"in e&&!dist$1.evalExpr(e.showIf,t.selectedCustomMenuData)?[]:"label"in e?{...e,key:e._id}:e.content.flatMap(r=>itemGenerator(r,t))}const TimeSyncItem=()=>{const{t}=useTranslation(),r=useAppSelector(getSelectedKeyboardAPI),s=reactExports.useRef(),[i,l]=reactExports.useState(new Date),c=i.toLocaleDateString(void 0,{hour:"2-digit",hour12:!1,minute:"2-digit",second:"2-digit"});return reactExports.useEffect(()=>(s.current=setInterval(()=>{l(new Date)},1e3),()=>{clearInterval(s.current)}),[]),jsxs(ControlRow,{children:[jsx(Label$1,{children:c}),jsx(Detail,{children:jsx(AccentButton,{onClick:()=>{if(!r)return;const p=~~(i.getTime()/1e3)-i.getTimezoneOffset()*60;r.setCustomMenuValue(25,...numIntoBytes(p)),r.commitCustomMenu(25)},children:t("Time Sync")})})]})},MenuComponent=React.memo(e=>jsxs(Fragment,{children:[e.elem.content.flatMap(t=>itemGenerator(t,e)).map(t=>jsx(VIACustomItem,{...t,updateValue:e.updateCustomMenuValue,value:e.selectedCustomMenuData[t.content[0]]})),e.elem.label=="Date Time"&&jsx(TimeSyncItem,{})]})),MenuBuilder=e=>t=>reactExports.createElement(MenuComponent,{...t,key:e._id,elem:e});function submenuGenerator(e,t){return"showIf"in e&&!dist$1.evalExpr(e.showIf,t.selectedCustomMenuData)?[]:"label"in e?{label:e.label,Menu:MenuBuilder(e)}:e.content.flatMap(r=>submenuGenerator(r,t))}const Pane$b=e=>{const{t}=useTranslation(),r=useAppDispatch(),s=categoryGenerator(e),[i,l]=reactExports.useState(s[0]||{label:"",Menu:()=>jsx("div",{})}),c=i.Menu,u=useAppSelector(getSelectedDefinition),p=useAppSelector(getSelectedCustomMenuData),f={...e,selectedDefinition:u,selectedCustomMenuData:p,updateCustomMenuValue:(m,...y)=>r(updateCustomMenuValue(m,...y))};return!u||!p?null:jsxs(Fragment,{children:[jsx(SubmenuCell,{children:jsx(MenuContainer$6,{children:s.map(m=>jsx(SubmenuRow,{$selected:i.label===m.label,onClick:()=>l(m),children:t(m.label)},m.label))})}),jsx(OverflowCell,{children:jsx(CustomPane,{children:jsx(Container$k,{children:c(f)})})})]})},MenuContainer$6=styled.div`
  padding: 15px 10px 20px 10px;
`,iconKeywords=[{icon:faLightbulb,keywords:["light","rgb"]},{icon:faHeadphones,keywords:["audio","sound"]},{icon:faDisplay,keywords:["display","oled","lcd"]}],getIconFromLabel=e=>{const t=e.label.toLowerCase(),r={icon:faGear};return(iconKeywords.find(s=>s.keywords.some(i=>t.includes(i)))||r).icon},makeCustomMenu=(e,t)=>({Title:e.label,Icon:()=>jsx(FontAwesomeIcon,{icon:getIconFromLabel(e)}),Pane:r=>reactExports.createElement(Pane$b,{...r,key:`${e.label}-${t}`,viaMenu:e})}),makeCustomMenus=e=>e.map(makeCustomMenu),initialState$6={customMenuDataMap:{},commonMenusMap:{},showKeyPainter:!1,selectedRowTitle:void 0},menusSlice=createSlice({name:"menus",initialState:initialState$6,reducers:{updateShowKeyPainter:(e,t)=>{e.showKeyPainter=t.payload},updateSelectedCustomMenuData:(e,t)=>{const{devicePath:r,menuData:s}=t.payload;e.customMenuDataMap[r]=s},updateCommonMenus:(e,t)=>{const{commonMenuMap:r}=t.payload;e.commonMenusMap=r},updateCustomMenuData:(e,t)=>{e.customMenuDataMap={...e.customMenuDataMap,...t.payload}},updateSelectedRowTitle:(e,t)=>{e.selectedRowTitle=t.payload}}}),{updateShowKeyPainter,updateSelectedCustomMenuData,updateCustomMenuData,updateSelectedRowTitle}=menusSlice.actions,menusReducer=menusSlice.reducer,updateCustomMenuValue=(e,...t)=>async(r,s)=>{const i=s(),l=getSelectedConnectedDevice(i);if(!l)return;const c=getSelectedCustomMenuData(i),u=getCustomCommands(i),p={...c,[e]:[...t.slice(u[e].length)]},{path:f}=l;r(updateSelectedCustomMenuData({menuData:p,devicePath:f}));const m=getSelectedKeyboardAPI(i);m.setCustomMenuValue(...t.slice(0));const y=t[0];m.commitCustomMenu(y)},tryResolveCommonMenu=e=>typeof e=="string"?dist.commonMenus[e]:e,updateV3MenuData=e=>async(t,r)=>{const s=r(),i=getSelectedDefinition(s),l=getSelectedKeyboardAPI(s);if(!dist.isVIADefinitionV3(i))throw new Error("V3 menus are only compatible with V3 VIA definitions.");const u=getV3Menus(s).flatMap(extractCommands),{protocol:p,path:f}=e;if(u.length!==0&&p>=11){let m={};const y=u.map(([b,M,...w])=>({command:b,promise:l.getCustomMenuValue([M].concat(w))})),K=await Promise.all(y.map(b=>b.promise));m=y.reduce(({res:b,ref:M},w,L)=>({ref:M,res:{...b,[w.command]:M[L].slice(1)}}),{res:m,ref:K}).res;const x=Math.max(...i.layouts.keys.map(b=>b.li??-1));if(console.debug(x,"maxLedIndex"),x>=0){const b=await l.getPerKeyRGBMatrix(Array(x+1).fill(0).map((M,w)=>w));m.__perKeyRGB=b}t(updateSelectedCustomMenuData({devicePath:f,menuData:{...m}}))}},extractCommands=e=>typeof e=="string"?[]:"type"in e?[e.content]:"content"in e&&typeof e.content!="string"?e.content.flatMap(extractCommands):[],getShowKeyPainter=e=>e.menus.showKeyPainter,getCustomMenuDataMap=e=>e.menus.customMenuDataMap,getSelectedCustomMenuData=createSelector(getCustomMenuDataMap,getSelectedDevicePath,(e,t)=>t&&e[t]),getSelectedRowTitle=e=>e.menus.selectedRowTitle,getV3Menus=createSelector(getSelectedDefinition,e=>!e||!dist.isVIADefinitionV3(e)?[]:(e.menus||[]).flatMap(tryResolveCommonMenu).map((t,r)=>dist.isVIAMenu(t)?compileMenu("custom_menu",3,t,r):t)),getV3MenuComponents=createSelector(getSelectedDefinition,e=>!e||!dist.isVIADefinitionV3(e)?[]:(e.menus||[]).flatMap(tryResolveCommonMenu).map((t,r)=>dist.isVIAMenu(t)?makeCustomMenu(compileMenu("custom_menu",3,t,r),r):t)),getCustomCommands=createSelector(getSelectedDefinition,getV3Menus,(e,t)=>{if(!e)return[];const r=dist.isVIADefinitionV2(e)?e.customMenus:t;return r===void 0?[]:r.flatMap(extractCommands).reduce((s,i)=>({...s,[i[0]]:i.slice(1)}),{})}),compileMenu=(e,t=0,r,s)=>t===0?r:{...r,_id:`${e}_${s}`,content:r.label!==void 0?typeof r.content=="string"?r.content:r.content.map((i,l)=>compileMenu(`${e}_${l}`,t-1,i,s)):r.content.map((i,l)=>compileMenu(`${e}_${l}`,t,i,s))},initialState$5={showMatrix:!1,selectedOptionKeys:[],selectedDefinitionIndex:0},designSlice=createSlice({name:"design",initialState:initialState$5,reducers:{updateSelectedDefinitionIndex:(e,t)=>{e.selectedDefinitionIndex=t.payload},updateSelectedOptionKeys:(e,t)=>{e.selectedOptionKeys=t.payload},updateShowMatrix:(e,t)=>{e.showMatrix=t.payload}}}),{updateSelectedDefinitionIndex,updateSelectedOptionKeys,updateShowMatrix}=designSlice.actions,designReducer=designSlice.reducer,getSelectedDefinitionIndex=e=>e.design.selectedDefinitionIndex,getDesignSelectedOptionKeys=e=>e.design.selectedOptionKeys,getShowMatrix=e=>e.design.showMatrix,BAUD=115200,BUFFER_SIZE=64,getSerialPort=async e=>{let t=await getFilteredPort(e);if(t||(t=await navigator.serial.requestPort({filters:[{usbVendorId:e.vendorId,usbProductId:e.productId}]})),!t)throw new Error("no serial port");return t},getFilteredPort=async e=>(await navigator.serial.getPorts()).find(s=>{const i=s.getInfo();return i.usbVendorId===e.vendorId&&i.usbProductId===e.productId}),cache={};class TabKeyboardAPI{constructor(t){ce(this,"device");ce(this,"getPort",async()=>{if(this.device.path in cache)return cache[this.device.path];const t=await getSerialPort(this.device);return await t.open({baudRate:BAUD,bufferSize:64}),cache[this.device.path]=t,t});this.device=t}async setMatrixLighting(t,r,s,i,l){const c=await this.seriaCommandWithResponse(192,[t,r,s,i]);if(c&&c[5]===238){const f=new Error("Error: "+c[5]);throw f.cause=c[5],f}const u=!!c[6],p=BUFFER_SIZE-8;for(let f=0;f<l.length;f+=p){const m=l.slice(f,f+p);u?await this.seriaCommandWithResponse(193,[...numIntoBytes(f),m.length,...m]):await this.seriaCommand(193,[...numIntoBytes(f),m.length,...m])}}async setTabFile(t,r,s){const i=await this.seriaCommandWithResponse(224,t.slice(0,20));if(i&&i[21]===238){const c=new Error("Error: "+i[21]);throw c.cause=i[21],c}const l=!!i[22];return this.setTabBuffer(225,t,r,s,l)}async setTabFirmwareBuffer(t,r,s,i){return this.setTabBuffer(241,t,r,s,i)}async setTabFirmwareInfo(t,r){const s=[...numIntoBytes(t),...r],i=await this.seriaCommandWithResponse(240,s);return i&&i[s.length+1]===238?[!1,i[s.length+2]]:[!0,i[s.length+2]]}async firmwareQuery(){return await this.seriaCommandWithResponse(239,[])}async setTabBuffer(t,r,s,i,l){const c=BUFFER_SIZE-8;for(let u=0;u<r.length;u+=c){const p=r.slice(u,u+c);if(l?await this.seriaCommandWithResponse(t,[...numIntoBytes(u),p.length,...p]):await this.seriaCommand(t,[...numIntoBytes(u),p.length,...p]),i&&i()){await this.seriaCommand(226);return}s&&s(u+p.length)}}async seriaCommand(t,r=[]){const s=[t,...r],i=new Array(BUFFER_SIZE).fill(0);s.forEach((c,u)=>{i[u]=c});const l=await this.getPort();if(l.writable){const c=l.writable.getWriter();console.debug("CDC",i),await c.write(new Uint8Array(i)),c.releaseLock()}}async seriaCommandWithResponse(t,r=[]){await this.seriaCommand(t,r);const s=await this.getPort();let i=[];if(s.readable){const l=s.readable.getReader();try{for(;;){const{value:c,done:u}=await l.read();if(console.debug("CDC read",c,u),c&&(i=[...i,...Array.from(c)],i.length===BUFFER_SIZE)){console.debug("done...");break}if(u){console.debug("done");break}}}catch(c){throw console.log(c),c}finally{l.releaseLock()}if(!lodashExports.isEqual(r,i.slice(1,r.length+1)))throw console.error("Command for CDC:",r,"Bad Resp:",i),new Error("Receiving incorrect response for command")}return i}}const tabkbConfigSlice=createSlice({name:"tabkbconfig",initialState:{configs:{}},reducers:{setTabkbConfigs(e,t){e.configs=t.payload}}}),{setTabkbConfigs}=tabkbConfigSlice.actions,tabkbconfigReducer=tabkbConfigSlice.reducer,loadTabkbConfigs=()=>async(e,t)=>{const s=await(await fetch("/tabkb/configs.json",{cache:"reload"})).json();let i={};for(const l of s){if(!l.vendorId||!l.productId)continue;const c=getVendorProductId(parseInt(l.vendorId),parseInt(l.productId));i[c]=l}e(setTabkbConfigs(i))},getConfigs=e=>e.tabkbconfig.configs,getSelectedTabkbConfig=createSelector([getConfigs,getSelectedDefinition],(e,t)=>{if(!(!t||!e[t.vendorProductId]))return e[t.vendorProductId]}),getTabFileAPI=createSelector(getSelectedConnectedDevice,getSelectedDevicePath,getSelectedTabkbConfig,(e,t,r)=>{if(!t||!r||!e)return;const s=new KeyboardAPI(t);return r.cdc?new TabKeyboardAPI(e):s}),getMatrixLightingAPI=createSelector(getSelectedConnectedDevice,getSelectedDevicePath,getSelectedTabkbConfig,(e,t,r)=>{if(!t||!r||!e)return;const s=new KeyboardAPI(t);return r.matrixLighting.cdc?new TabKeyboardAPI(e):s}),getTapDanceKeycodes=createSelector(getSelectedTabkbConfig,e=>!e||!e.tapDance?[]:e.tapDance),getCDCMacIssue=createSelector(getSelectedTabkbConfig,e=>!!(e!=null&&e.cdcMacIssue)),mlHeader=[...new TextEncoder().encode("tabml")],mlHeaderSize=32,DefaultMaxFrame=200,initMatrix=(e,t,r={r:0,g:0,b:0})=>Array(e).fill("").map(()=>Array(t).fill(r)),initialState$4={color:{r:255,g:255,b:255},rows:0,cols:0,fps:10,matrixIdx:0,matrixList:[],saving:!1},lightingSlice=createSlice({name:"matrixlighting",initialState:initialState$4,reducers:{updateColor(e,t){e.color=t.payload},updateMatrix(e,t){const{row:r,col:s}=t.payload;r>e.rows-1||s>e.cols-1||(e.matrixList[e.matrixIdx][r][s]=e.color)},setMatrix(e,t){e.matrixList[e.matrixIdx]=t.payload},updateMatrixIndex(e,t){t.payload!==void 0&&(e.matrixIdx=t.payload)},resetMatrix(e){e.matrixIdx=0,e.matrixList=[initMatrix(e.rows,e.cols)]},addMatrix(e){e.matrixList=[...e.matrixList.slice(0,e.matrixIdx+1),initMatrix(e.rows,e.cols),...e.matrixList.slice(e.matrixIdx+1)],e.matrixIdx+=1},deleteMatrix(e){if(e.matrixList.length===1){e.matrixList[0]=initMatrix(e.rows,e.cols);return}e.matrixList.splice(e.matrixIdx,1),e.matrixIdx>=e.matrixList.length&&(e.matrixIdx-=1)},nextMatrix(e){let t=e.matrixIdx+1;t>=e.matrixList.length&&(t=0),e.matrixIdx=t},copyMatrix(e){e.matrixList=[...e.matrixList.slice(0,e.matrixIdx+1),e.matrixList[e.matrixIdx],...e.matrixList.slice(e.matrixIdx+1)],e.matrixIdx+=1},setMatrixList(e,t){e.matrixList=t.payload,e.matrixIdx=0},shiftLeft(e){const t=e.matrixList[e.matrixIdx],r=initMatrix(e.rows,e.cols);for(let s=0;s<e.rows;s++)for(let i=0;i<e.cols;i++)i>0?r[s][i-1]=t[s][i]:r[s][e.cols-1]=t[s][i];e.matrixList[e.matrixIdx]=r},shiftRight(e){const t=e.matrixList[e.matrixIdx],r=initMatrix(e.rows,e.cols);for(let s=0;s<e.rows;s++)for(let i=0;i<e.cols;i++)i<e.cols-1?r[s][i+1]=t[s][i]:r[s][0]=t[s][i];e.matrixList[e.matrixIdx]=r},shiftUp(e){const t=e.matrixList[e.matrixIdx],r=initMatrix(e.rows,e.cols);for(let s=0;s<e.rows;s++)for(let i=0;i<e.cols;i++)s>0?r[s-1][i]=t[s][i]:r[e.rows-1][i]=t[s][i];e.matrixList[e.matrixIdx]=r},shiftDown(e){const t=e.matrixList[e.matrixIdx],r=initMatrix(e.rows,e.cols);for(let s=0;s<e.rows;s++)for(let i=0;i<e.cols;i++)s<e.rows-1?r[s+1][i]=t[s][i]:r[0][i]=t[s][i];e.matrixList[e.matrixIdx]=r},fillMatrix(e){e.matrixList[e.matrixIdx]=initMatrix(e.rows,e.cols)},sortMatrixByIndex(e,t){const{newIndex:r}=t.payload;if(e.matrixIdx===r)return;const[s]=e.matrixList.splice(e.matrixIdx,1);e.matrixList.splice(r,0,s),e.matrixIdx=r},setRows:(e,t)=>{e.rows=t.payload},setCols:(e,t)=>{e.cols=t.payload},setFps:(e,t)=>{e.fps=t.payload},setSaving:(e,t)=>{e.saving=t.payload},loadFile:(e,t)=>{const r=e.rows,s=e.cols,{frames:i,fps:l,data:c}=t.payload,u=s*r*3,p=Array(i).fill(0).map(()=>Array(r).fill(0).map(()=>Array(s).fill({r:0,g:0,b:0})));for(let f=0;f<c.length;f+=3){const m=~~(f/u),y=f%u/3,K=~~(y/s),x=y%s,b={r:c[f],g:c[f+1],b:c[f+2]};p[m][K][x]=b}e.fps=l,e.matrixIdx=0,e.matrixList=p}},extraReducers(e){e.addCase(selectDevice,t=>{t.saving=!1})}}),{updateColor,updateMatrix,resetMatrix,addMatrix,deleteMatrix,updateMatrixIndex,nextMatrix,copyMatrix,setMatrix,setMatrixList,fillMatrix,sortMatrixByIndex,setRows,setCols,setFps,setSaving,loadFile,shiftLeft,shiftRight,shiftUp,shiftDown}=lightingSlice.actions,matrixlightingReducer=lightingSlice.reducer,saveToKeyboard=()=>async(e,t)=>{const r=t(),s=getMatrixLightingAPI(r),i=getSaving(r);if(!s||i)return;const l=getRows(r),c=getCols(r),u=getFrames(r),p=getFps(r),f=getKBMatrixData(r);e(setSaving(!0)),await s.setMatrixLighting(u,p,l,c,f).finally(()=>{e(setSaving(!1))})},loadMatrixLighintConfig=()=>async(e,t)=>{const r=t(),s=getSelectedTabkbConfig(r);if(!(s!=null&&s.matrixLighting))return;const{cols:i,rows:l}=s.matrixLighting;e(setCols(i)),e(setRows(l)),e(setMatrixList([initMatrix(l,i)]))},getActiveColor=e=>e.matrixlighting.color,getRows=e=>e.matrixlighting.rows,getCols=e=>e.matrixlighting.cols,getMatrixList=e=>e.matrixlighting.matrixList,getMatrixIdx=e=>e.matrixlighting.matrixIdx,getFps=e=>e.matrixlighting.fps,getSaving=e=>e.matrixlighting.saving,getFrames=e=>e.matrixlighting.matrixList.length,getMaxFrame=createSelector(getSelectedTabkbConfig,e=>e?(e==null?void 0:e.matrixLighting.maxFrame)??DefaultMaxFrame:DefaultMaxFrame),getImportEnable=createSelector(getSelectedTabkbConfig,e=>e?!!(e!=null&&e.matrixLighting.importEnable):!1),getActiveMatrix=createSelector(getMatrixList,getMatrixIdx,(e,t)=>e[t]?e[t]:[]),getKBMatrixData=createSelector(getMatrixList,e=>e.flatMap(t=>t.flatMap(r=>r.flatMap(s=>get256HSV([s.r,s.g,s.b]))))),getMatrixData$1=createSelector(getMatrixList,e=>e.flatMap(t=>t.flatMap(r=>r.flatMap(s=>[s.r,s.g,s.b])))),getFileContent=createSelector(getFrames,getRows,getCols,getFps,getMatrixData$1,(e,t,r,s,i)=>{const l=Array(mlHeaderSize).fill(0);return[...mlHeader,e,s,t,r].forEach((u,p)=>{l[p]=u}),[...l,...i]}),MIN_KB_ACTUATION=0,MAX_KB_ACTUATION=400,MIN_ACTUATION=0,MAX_ACTUATION=4,ACTUATION_MULTIPLE=(MAX_KB_ACTUATION-MIN_KB_ACTUATION)/(MAX_ACTUATION-MIN_ACTUATION),actuationFromKeyboard=e=>e===void 0?0:shiftTo16Bit(e)/ACTUATION_MULTIPLE,actuationToKeyboard=e=>e===void 0?[0,0]:shiftFrom16Bit(~~(e*ACTUATION_MULTIPLE));class ActuationApi{constructor(t){this.keyboardApi=t}async getTestActuation(){const[,,t,r]=await this.keyboardApi.actuationCommand(173);return actuationFromKeyboard([t,r])}async getSelfCheckResult(){const[,,t]=await this.keyboardApi.actuationCommand(161);return!!t}async selfCheck(){await this.keyboardApi.actuationCommand(162)}async getAPEnabled(){const[,,t]=await this.keyboardApi.actuationCommand(163);return!!t}async setAPEnabled(t){await this.keyboardApi.actuationCommand(164,[Number(t)])}async setRTEnabled(t){await this.keyboardApi.actuationCommand(168,[Number(t)])}async getAPDefault(){const[,,t,r,s,i,l,c]=await this.keyboardApi.actuationCommand(172),u=actuationFromKeyboard([t,r]),p=actuationFromKeyboard([s,i]),f=actuationFromKeyboard([l,c]);return{ap:u,dzt:p,dzb:f}}async getAPKeySize(){const[,,t]=await this.keyboardApi.actuationCommand(169);return t}async getAPData(t){const r=await this.getAPKeySize(),s=Math.floor(28/r),i=[];for(let p=0;p<t;p+=s)i.push(this.keyboardApi.actuationCommand(170,[p,Math.min(t-p,s)]));const c=(await Promise.all(i)).flatMap(p=>p.slice(4,4+s*r)),u=[];for(let p=0;p<t;p++){const f=c[p*r],m=c[p*r+1],y=c[p*r+2],K=c[p*r+3],x=c[p*r+4],b=c[p*r+5],M=f!==void 0&&m!==void 0?actuationFromKeyboard([f,m]):0,w=y!==void 0&&K!==void 0?actuationFromKeyboard([y,K]):0,L=x!==void 0&&b!==void 0?actuationFromKeyboard([x,b]):0;u[p]={ap:M,dzt:w,dzb:L}}return u}async setAPValue(t,r,s){await this.keyboardApi.actuationCommand(171,[t,r,...actuationToKeyboard(s.ap),...actuationToKeyboard(s.dzt),...actuationToKeyboard(s.dzb)])}async getRTDefault(){const[,,t,r,s,i,l,c]=await this.keyboardApi.actuationCommand(196),u=actuationFromKeyboard([s,i]),p=actuationFromKeyboard([l,c]);return{enabled:!!t,crtEnabled:!!r,rt1:u,rt2:p}}async getRTKeySize(){const[,,t]=await this.keyboardApi.actuationCommand(193);return t}async getRTData(t){const r=await this.getRTKeySize(),s=Math.floor(28/r),i=[];for(let p=0;p<t;p+=s)i.push(this.keyboardApi.actuationCommand(194,[p,Math.min(t-p,s)]));const c=(await Promise.all(i)).flatMap(p=>p.slice(4,4+s*r)),u=[];for(let p=0;p<t;p++){const f=!!c[p*r],m=!!c[p*r+1],y=c[p*r+2],K=c[p*r+3],x=c[p*r+4],b=c[p*r+5],M=y!==void 0&&K!==void 0?actuationFromKeyboard([y,K]):0,w=x!==void 0&&b!==void 0?actuationFromKeyboard([x,b]):0;u[p]={enabled:f,crtEnabled:m,rt1:M,rt2:w}}return u}async setRTValue(t,r,s){await this.keyboardApi.actuationCommand(195,[t,r,Number(s.enabled),Number(s.crtEnabled),...actuationToKeyboard(s.rt1),...actuationToKeyboard(s.rt2)])}async getDKSActuation(){const[,,t,r,s,i,l,c,u,p]=await this.keyboardApi.actuationCommand(208);return[actuationFromKeyboard([t,r]),actuationFromKeyboard([s,i]),actuationFromKeyboard([l,c]),actuationFromKeyboard([u,p])]}async getDKSCount(){const[,,t,r]=await this.keyboardApi.actuationCommand(209);return shiftTo16Bit([t,r])}async getDKSValues(){const t=await this.getDKSCount();if(t===0)return[];const r=[];for(let i=0;i<t;i++)r.push(this.keyboardApi.actuationCommand(210,shiftFrom16Bit(i)));return(await Promise.all(r)).map(i=>{const[,,,,l,c,u,p,f,m,y,K,x,b,M,...w]=i,L=[];for(let I=0;I<4;I++){const[k,j,U]=w.slice(I*3,I*3+3);L.push({key:shiftTo16Bit([k,j]),points:[U>>6&3,U>>4&3,U>>2&3,U&3]})}const F={actuation:[actuationFromKeyboard([p,f]),actuationFromKeyboard([m,y]),actuationFromKeyboard([K,x]),actuationFromKeyboard([b,M])],actions:L};return console.debug(JSON.stringify({layer:l,row:c,col:u,dks:F})),{layer:l,row:c,col:u,dks:F}})}async setDksValue(t,r,s,i){if(i===null){await this.keyboardApi.actuationCommand(212,[t,r,s]);return}const l=i.actions.flatMap(u=>[...shiftFrom16Bit(u.key),u.points.map((p,f)=>p<<(3-f)*2).reduce((p,f)=>f|=p,0)]);console.debug(JSON.stringify({layer:t,row:r,col:s,actuation:i.actuation,keyActionBytes:l}));const c=[t,r,s,...actuationToKeyboard(i.actuation[0]),...actuationToKeyboard(i.actuation[1]),...actuationToKeyboard(i.actuation[2]),...actuationToKeyboard(i.actuation[3]),...l];await this.keyboardApi.actuationCommand(211,c)}async timeout(t){return this.keyboardApi.timeout(t)}}const getActuationApi=e=>new ActuationApi(e),defaultDKSActuation=.7,defaultDKS2ndActuation=3.5,initialState$3={enableAP:!1,apDefault:{ap:0,dzt:0,dzb:0},rtDefault:{enabled:!1,crtEnabled:!1,rt1:0,rt2:0},actuationMap:{},actuationMenu:"AP",selfChecked:!1,selfCheckStartTimeout:0,dksActionIndex:null,dksmap:{},dksActuations:[defaultDKSActuation,defaultDKS2ndActuation,defaultDKS2ndActuation,defaultDKSActuation]},actuationSlice=createSlice({name:"actuation",initialState:initialState$3,reducers:{setAPDefault:(e,t)=>{e.apDefault=t.payload},setRTDefault:(e,t)=>{e.rtDefault=t.payload},setActuation:(e,t)=>{const{devicePath:r,keymapIdxes:s,actuation:i}=t.payload;e.actuationMap[r]=e.actuationMap[r]||[],s.map(l=>{e.actuationMap[r][l]=e.actuationMap[r][l]||{},e.actuationMap[r][l]={...e.actuationMap[r][l],...i}})},resetActuation:(e,t)=>{e.actuationMap[t.payload]=[]},updateMenu:(e,t)=>{e.actuationMenu=t.payload},setEnableAP:(e,t)=>{e.enableAP=t.payload},updateSelfChecked:(e,t)=>{e.selfChecked=t.payload},updateSelfCheckTimeout:(e,t)=>{e.selfCheckStartTimeout=t.payload},updateDksAction:(e,t)=>{e.dksActionIndex=t.payload},setDksData:(e,t)=>{const{keymapIndex:r,value:s,devicePath:i,selectedLayerIndex:l}=t.payload;e.dksmap[i]=e.dksmap[i]||[],e.dksmap[i][l]=e.dksmap[i][l]||[],e.dksmap[i][l][r]=s},resetDksData:(e,t)=>{e.dksmap[t.payload]=[]},deleteDksBaseLayerData:(e,t)=>{var i;const{path:r,keymapIndexes:s}=t.payload;(i=e.dksmap[r])!=null&&i[0]&&s.forEach(l=>{e.dksmap[r][0][l]=null})},setDKSActuations:(e,t)=>{e.dksActuations=t.payload}},extraReducers(e){e.addCase(selectDevice,t=>{t.selfChecked=!1})}}),{setActuation,setAPDefault,setRTDefault,updateMenu,setEnableAP,updateSelfChecked,updateSelfCheckTimeout,updateDksAction,deleteDksBaseLayerData,setDksData,setDKSActuations,resetActuation,resetDksData}=actuationSlice.actions,actuationReducer=actuationSlice.reducer;lodashExports.debounce((e,t,r,s,i,l,c)=>{const u=[],p=[];for(const f of r){const{row:m,col:y}=l[f],K=m*c.cols+y;u.push(K),p.push(t.setAPValue(m,y,s))}Promise.all(p),e(setActuation({devicePath:i,keymapIdxes:u,actuation:{apData:s}}))},100);lodashExports.debounce((e,t,r,s,i,l,c)=>{const u=[],p=[];for(const f of r){const{row:m,col:y}=l[f],K=m*c.cols+y;u.push(K),p.push(t.setRTValue(m,y,s))}Promise.all(p),e(setActuation({devicePath:i,keymapIdxes:u,actuation:{rtData:s}}))},100);const updateEnableAP=e=>async(t,r)=>{const s=r(),i=getSelectedKeyboardAPI(s);if(!i)return;await getActuationApi(i).setAPEnabled(e),t(setEnableAP(e))},saveConfigToDevice=e=>async(t,r)=>{const s=r(),i=getSelectedKeyboardAPI(s),l=getSelectedDevicePath(s),c=getSelectedDefinition(s),u=getNumberOfLayers(s),p=getAPDefault(s),f=getRTDefault(s);if(!c||!i||!l)return;const m=getActuationApi(i);t(updateEnableAP(!!e.apEnabled));const{matrix:{cols:y,rows:K}}=c,x=y*K,b=[],M=[],w=[],L=[],F=[],I=[];e.ap&&e.ap.map(([k,j,U,V])=>{const z={ap:j,dzt:U,dzb:V};b[k]=m.setAPValue(~~(k/y),k%y,z),L.push({devicePath:l,keymapIdxes:[k],actuation:{apData:z}})}),e.rt&&e.rt.map(([k,j,U,V,z])=>{const te={enabled:!!j,crtEnabled:!!U,rt1:V,rt2:z};M[k]=m.setRTValue(~~(k/y),k%y,te),F.push({devicePath:l,keymapIdxes:[k],actuation:{rtData:te}})}),e.dks&&e.dks.map(([k,j,U,V,z,te,...R])=>{const H=[];for(let Q=0;Q<4;Q++){const[X,T,P,q,ae]=R.slice(Q*5,(Q+1)*5);H.push({key:X,points:[T,P,q,ae]})}const N={actuation:[U,V,z,te],actions:H};w[k*j+j]=m.setDksValue(k,~~(j/y),j%y,N),I.push({devicePath:l,selectedLayerIndex:k,keymapIndex:j,value:N})});for(let k=0;k<u;k++)for(let j=0;j<x;j++)k===0&&(b[j]||(b[j]=m.setAPValue(~~(j/y),j%y,p)),M[j]||(M[j]=m.setRTValue(~~(j/y),j%y,f))),w[k*j+j]=m.setDksValue(k,~~(j/y),j%y,null);await Promise.all([Promise.all(b),Promise.all(M),Promise.all(w)]),t(resetActuation(l)),L.map(k=>t(setActuation(k))),F.map(k=>t(setActuation(k))),t(resetDksData(l)),I.map(k=>t(setDksData(k)))},getActuationMap=e=>e.actuation.actuationMap,getMenu=e=>e.actuation.actuationMenu,getEnableAP=e=>e.actuation.enableAP,getSelfChecked=e=>e.actuation.selfChecked,getAPDefault=e=>e.actuation.apDefault,getRTDefault=e=>e.actuation.rtDefault,getDksmap=e=>e.actuation.dksmap,getDKSActuations=e=>e.actuation.dksActuations,getSelectedPerKeyActuation=createSelector(getActuationMap,getSelectedDevicePath,(e,t)=>{if(t&&e[t])return e[t]}),getSelectedActuationMap=createSelector(getSelectedKeyDefinitions,getSelectedDefinition,getSelectedPerKeyActuation,getSelectedLayerIndex,getEnableAP,getRTDefault,getAPDefault,(e,t,r,s,i,l,c)=>{if(s===0&&t){const{matrix:{cols:u}}=t;return e.map(({col:p,row:f})=>{let m={...r&&r[f*u+p]||{apData:c,rtData:l}};return i||(m.apData=c),m})}}),getSelectedDksmap=createSelector(getSelectedKeyDefinitions,getSelectedDefinition,getSelectedDevicePath,getSelectedLayerIndex,getDksmap,(e,t,r,s,i)=>{var l;if(t&&r&&((l=i[r])!=null&&l[s])){const{matrix:{cols:c}}=t;return e.map(({row:u,col:p})=>i[r][s][u*c+p])}}),getSelectedDksRawMap=createSelector(getDksmap,getSelectedDevicePath,(e,t)=>{if(t&&e[t])return e[t]}),getDefaultDksData=createSelector(getSelectedKey,getSelectedKeymap,getDKSActuations,(e,t,r)=>({actuation:r,actions:Array(4).fill(0).map((i,l)=>({key:0,points:[DKSPoint.Hold,DKSPoint.Hold,DKSPoint.Hold,DKSPoint.Hold]}))}));createSelector(getSelectedKey,getSelectedDksmap,getDefaultDksData,(e,t,r)=>e!==null&&t&&t[e]||r);const getActiveMenu=createSelector(getSelfChecked,getMenu,(e,t)=>e?t:"SELF CHECK");createSelector(getSelectedDksRawMap,e=>{if(!e)return[];const t=[];return e.forEach((r,s)=>{r.forEach((i,l)=>{i!==null&&t.push({layerIdx:s,key:l,data:i})})}),t});const KBRE_FLAGS_SWAP_BIT=1,KBRE_FLAGS_ALPHA=2,KBRE_FLAGS_REFPS=8,initialState$2={selectedTool:"video",toolConfigs:{},state:"waiting",bytesSended:0,bufferSize:0,started:0,lastUpdate:0,sendSpeed:0},screenSlice=createSlice({name:"screen",initialState:initialState$2,reducers:{updateTool:(e,t)=>{e.selectedTool=t.payload},updateState(e,t){e.bytesSended=0,e.state=t.payload},updateBytesSended:(e,t)=>{const r=t.payload-e.bytesSended;e.bytesSended=t.payload;const s=Date.now();e.sendSpeed=~~(r/((s-e.lastUpdate)/1e3)),e.lastUpdate=s},updateStarted:e=>{const t=Date.now();e.started=t,e.lastUpdate=t,e.sendSpeed=0,e.state="saving"},initSendState:(e,t)=>{const{size:r}=t.payload;e.bufferSize=r,e.state="waiting",e.bytesSended=0}},extraReducers(e){e.addCase(selectDevice,t=>{t.state="waiting",t.bytesSended=0})}}),{updateTool,updateBytesSended:updateBytesSended$2,updateStarted:updateStarted$2,updateState:updateState$2,initSendState}=screenSlice.actions,screenReducer=screenSlice.reducer,saveTabFile=(e,t)=>async(r,s)=>{const i=s();if(!getSelectedConnectedDevice(i)||getSavingState$2(i)==="saving")return;const c=getTabFileAPI(i);if(!c)return;const u=lodashExports.throttle(p=>{r(updateBytesSended$2(p))},1e3);lodashExports.isArray(e)||(e=[e]);try{r(updateStarted$2());let p=0;for(let f=0;f<e.length;f++){const m=e[f];await c.setTabFile(Array.from(m),y=>{u(p+y)},()=>getSavingState$2(s())==="canceled"),p+=m.length}getSavingState$2(s())!=="canceled"&&r(updateState$2("completed"))}catch(p){console.log(p),t(!1),r(updateState$2("failed"))}finally{u.cancel()}},getSelectedTool=e=>e.screen.selectedTool,getBytesSended$2=e=>e.screen.bytesSended,getBufferSize$2=e=>e.screen.bufferSize,getSendSpeed$2=e=>e.screen.sendSpeed,getSavingState$2=e=>e.screen.state,getDeviceConfig=createSelector(getSelectedTabkbConfig,e=>{if(!(!e||!e.screen))return e.screen}),getExportOptions=createSelector(getDeviceConfig,getSelectedTool,(e,t)=>{if(e&&e.fileTypes){const r=e.fileTypes;switch(t){case"image":return r.filter(s=>s.type==="image");case"video":return r.filter(s=>s.type==="video");case"slider":return r.filter(s=>s.type==="slider");case"theme":return r.filter(s=>s.type==="theme")}}}),getDefaultArea=createSelector(getSelectedTool,getExportOptions,(e,t)=>{if(t!==void 0)return t[0]}),getScreenMenus=createSelector(getDeviceConfig,e=>e&&e.menus?e.menus:[]),getKbresFlags=createSelector(getDeviceConfig,e=>{if(!e)return 0;let t=0;return e.swapBit&&(t|=KBRE_FLAGS_SWAP_BIT),t}),getMaxOutputSize=createSelector(getDeviceConfig,e=>e?e.maxOutputSize??-1:-1),getMaxFgFileCount=createSelector(getDeviceConfig,e=>e?e.maxFgFileCount??0:0),initialState$1={bytesSended:0,bufferSize:0,started:0,lastUpdate:0,sendSpeed:0,state:"waiting"},firmwareSlice=createSlice({name:"firmware",initialState:initialState$1,reducers:{updateState(e,t){e.bytesSended=0,e.state=t.payload},updateBytesSended:(e,t)=>{const r=t.payload-e.bytesSended;e.bytesSended=t.payload;const s=Date.now();e.sendSpeed=~~(r/((s-e.lastUpdate)/1e3)),e.lastUpdate=s},updateStarted:(e,t)=>{const{size:r}=t.payload,s=Date.now();e.started=s,e.lastUpdate=s,e.sendSpeed=0,e.state="saving",e.bytesSended=0,e.bufferSize=r}},extraReducers(e){e.addCase(selectDevice,t=>{t.state="waiting",t.bytesSended=0})}}),{updateState:updateState$1,updateBytesSended:updateBytesSended$1,updateStarted:updateStarted$1}=firmwareSlice.actions,firmwareReducer=firmwareSlice.reducer,saveTabFirmware$1=e=>async(t,r)=>{const s=r();if(getSavingState$1(s)==="saving")return;const i=getSelectedConnectedDevice(s);if(!i)return;const l=new TabKeyboardAPI(i);if(!l)return;const c=lodashExports.throttle(p=>{t(updateBytesSended$1(p))},1e3),u=Array.from(e);try{t(updateStarted$1({size:e.length}));const[p,f]=await l.setTabFirmwareInfo(e.length,u.slice(0,32));if(!p){t(updateState$1("failed"));return}await l.setTabFirmwareBuffer(u,m=>{c(m)},()=>getSavingState$1(r())==="canceled",!!f),getSavingState$1(r())!=="canceled"&&t(updateState$1("completed"))}catch(p){console.log(p),t(updateState$1("failed"))}finally{c.cancel()}},getBytesSended$1=e=>e.firmware.bytesSended,getBufferSize$1=e=>e.firmware.bufferSize,getSendSpeed$1=e=>e.firmware.sendSpeed,getSavingState$1=e=>e.firmware.state,parseVersionStr=e=>{const t=e.split(".");return t.length!==3?0:parseInt(t[0])<<8|parseInt(t[1])<<4|parseInt(t[2])},getSelectedDeviceFirmwareVersion=createSelector(getSelectedConnectedDevice,e=>e&&e.firmware?`${e.firmware>>8&255}.${e.firmware>>4&15}.${e.firmware&15}`:""),getCfgFirmwareVersion=createSelector(getSelectedTabkbConfig,e=>!e||!e.firmware?"0.0.0":e.firmware),getCfgFirmwareVerNum=createSelector(getCfgFirmwareVersion,e=>parseVersionStr(e)),getCfgFirmwareFile=createSelector(getSelectedTabkbConfig,e=>e&&e.firmwareFile?e.firmwareFile:""),getFirmwareNeedUpdate=createSelector(getSelectedConnectedDevice,getCfgFirmwareVerNum,getCfgFirmwareFile,(e,t,r)=>!e||!r||!t||!e.firmware?!1:e.firmware<t),initialState={bytesSended:0,bufferSize:0,started:0,lastUpdate:0,sendSpeed:0,state:"waiting"},bootSlice=createSlice({name:"boot",initialState,reducers:{updateState(e,t){e.bytesSended=0,e.state=t.payload},updateBytesSended:(e,t)=>{const r=t.payload-e.bytesSended;e.bytesSended=t.payload;const s=Date.now();e.sendSpeed=~~(r/((s-e.lastUpdate)/1e3)),e.lastUpdate=s},updateStarted:(e,t)=>{const{size:r}=t.payload,s=Date.now();e.started=s,e.lastUpdate=s,e.sendSpeed=0,e.state="saving",e.bytesSended=0,e.bufferSize=r}},extraReducers(e){e.addCase(selectDevice,t=>{t.state="waiting",t.bytesSended=0})}}),{updateState,updateBytesSended,updateStarted}=bootSlice.actions,bootReducer=bootSlice.reducer,saveTabFirmware=(e,t)=>async(r,s)=>{const i=s();if(getSavingState(i)==="saving")return;const l={path:"boot",vendorId:21675,productId:16980},c=new TabKeyboardAPI(l);if(!c)return;const u=lodashExports.throttle(f=>{r(updateBytesSended(f))},1e3),p=Array.from(e);try{r(updateStarted({size:e.length})),t&&await c.firmwareQuery();const[f,m]=await c.setTabFirmwareInfo(e.length,p.slice(0,32));if(!f){r(updateState("failed"));return}await c.setTabFirmwareBuffer(p,y=>{u(y)},()=>getSavingState(s())==="canceled",!!m),getSavingState(s())!=="canceled"&&r(updateState("completed"))}catch(f){console.log(f),r(updateState("failed"))}finally{u.cancel()}},getBytesSended=e=>e.boot.bytesSended,getBufferSize=e=>e.boot.bufferSize,getSendSpeed=e=>e.boot.sendSpeed,getSavingState=e=>e.boot.state,formatNumberAsHex=(e,t)=>`0x${e.toString(16).padStart(t,"0").toUpperCase()}`,errorsListenerMiddleware=createListenerMiddleware(),captureError=(e,t)=>{captureException(new Error(e),{tags:{productName:t.productName,vendorId:formatNumberAsHex(t.vendorId,4),protocol:t.protocol},extra:{deviceInfo:t}})};errorsListenerMiddleware.startListening({actionCreator:logAppError,effect:async({payload:{message:e,deviceInfo:t}},r)=>{captureError(e,t)}});errorsListenerMiddleware.startListening({actionCreator:logKeyboardAPIError,effect:async({payload:e},t)=>{captureError(extractMessageFromKeyboardAPIError(e),e.deviceInfo)}});const sentryEnhancer=createReduxEnhancer({}),store=configureStore({reducer:{settings:settingsReducer,macros:macrosReducer,devices:devicesReducer,keymap:keymapReducer,definitions:definitionsReducer,lighting:lightingReducer,menus:menusReducer,design:designReducer,errors:errorsReducer,matrixlighting:matrixlightingReducer,actuation:actuationReducer,screen:screenReducer,tabkbconfig:tabkbconfigReducer,firmware:firmwareReducer,boot:bootReducer},enhancers:[sentryEnhancer],middleware:e=>e().prepend(errorsListenerMiddleware.middleware)}),imgSrc="/assets/chippy_600-902171c5.png",defaultChippy={width:300,height:300,src:imgSrc},LoaderContainer=styled.div`
  width: 100%;
  display: flex;
  justify-content: center;
  align-items: center;
`,CircleContainer=styled.div`
  border-radius: 50%;
  background-color: var(--bg_icon);
  height: ${e=>e.$containerHeight}px;
  width: ${e=>e.$containerWidth}px;
  position: relative;
  overflow: hidden;
  box-sizing: border-box;
  display: flex;
  align-items: center;
  justify-content: center;

  animation-duration: 1.5s;
  animation-name: roll;
  animation-iteration-count: infinite;
  animation-direction: alternate;
  animation-timing-function: ease-in-out;

  &::after {
    height: ${e=>e.$containerHeight}px;
    width: ${e=>e.$containerWidth}px;
    position: absolute;
    content: '';
    background-color: ${e=>e.$progressColor};
    top: ${e=>e.$containerHeight+1}px;
    left: 0;
    right: 0;
    transition: transform 0.4s ease-out;
    transform: translate3d(
      0,
      ${e=>-(e.$progress||0)*e.$containerHeight}px,
      0
    );
  }
`,SvgComponent=e=>{const{theme:t}=e,r=getDarkenedColor(t.accent.c,.8),s={"upper-body":t.mod.t,"lower-body":t.mod.c,accent:r,bowtie:r,pins:r,feet:"#000"};return jsxs("svg",{id:"Layer_1",xmlns:"http://www.w3.org/2000/svg",x:0,y:0,viewBox:"0 0 600 600",style:{enableBackground:"new 0 0 600 600"},xmlSpace:"preserve",...e,children:[jsx("style",{children:`.st3{fill:#fdfefe}.st4{fill:${s.bowtie}}.st5{fill-rule:evenodd;clip-rule:evenodd;fill:${s.accent}}.st7,.st9{fill-rule:evenodd;clip-rule:evenodd}.st10,.st9{fill:#fff}`}),jsxs("g",{id:"Layer_2_00000088814685506851870240000015950599998114990989_",children:[jsx("g",{id:"Feet",children:jsx("path",{d:"M169.7 432.1c28.3 0 51.5 23.3 51.5 51.5s-23.3 51.5-51.5 51.5-51.5-23.3-51.5-51.5 23.2-51.5 51.5-51.5zM425.8 432.1c28.3 0 51.5 23.3 51.5 51.5s-23.3 51.5-51.5 51.5-51.5-23.3-51.5-51.5 23.2-51.5 51.5-51.5z"})}),jsxs("g",{id:"Body",children:[jsx("path",{d:"M26.7 66.8h546.2c9.8 0 17.7 7.9 17.7 17.7v273.3H9V84.6c0-9.8 7.9-17.8 17.7-17.8z",style:{fill:s["upper-body"]}}),jsx("path",{d:"M9 357.4h581.6v113.7c0 8.4-6.9 15.3-15.3 15.3h-551c-8.4 0-15.3-6.9-15.3-15.3V357.4z",style:{fill:s["lower-body"]}})]}),jsx("path",{d:"M229.4 262.8s33.5 19.4 66.3 19.4c33.5 0 66.3-19.4 66.3-19.4",style:{fill:"none",stroke:"#000",strokeWidth:6.8265,strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:2.0408},id:"Smile"}),jsxs("g",{id:"Eyes",children:[jsx("path",{d:"M417.1 132.4c26.5 0 48 26.4 48 59.1s-21.4 59.1-48 59.1-48-26.4-48-59.1 21.5-59.1 48-59.1zM175.3 132.4c26.5 0 48 26.4 48 59.1s-21.4 59.1-48 59.1-48-26.4-48-59.1 21.5-59.1 48-59.1z"}),jsx("path",{className:"st3",d:"M422.7 210.7c4.2 0 7.7 3.5 7.7 7.7s-3.5 7.7-7.7 7.7-7.7-3.5-7.7-7.7 3.5-7.7 7.7-7.7zM418.2 159.7c9.5 0 17.3 7.8 17.3 17.3s-7.8 17.3-17.3 17.3-17.3-7.8-17.3-17.3c-.1-9.5 7.7-17.3 17.3-17.3zM179.9 210.7c4.2 0 7.7 3.5 7.7 7.7s-3.5 7.7-7.7 7.7-7.7-3.5-7.7-7.7 3.5-7.7 7.7-7.7zM175.3 159.7c9.5 0 17.3 7.8 17.3 17.3s-7.8 17.3-17.3 17.3S158 186.5 158 177c-.1-9.5 7.8-17.3 17.3-17.3z"})]}),jsx("g",{id:"Pins",children:jsx("path",{className:"st4",d:"M12.6 276h17.5c5.8 0 10.5 6.9 10.5 15.3V324c0 8.4-4.7 15.3-10.5 15.3H12.6C6.7 339.3 2 332.4 2 324v-32.7c0-8.4 4.7-15.3 10.6-15.3zM12.6 190.3h17.5c5.8 0 10.5 6.9 10.5 15.3v32.7c0 8.4-4.7 15.3-10.5 15.3H12.6c-5.8 0-10.5-6.9-10.5-15.3v-32.7c-.1-8.4 4.6-15.3 10.5-15.3zM12.6 102.6h17.5c5.8 0 10.5 6.9 10.5 15.3v32.7c0 8.4-4.7 15.3-10.5 15.3H12.6C6.7 165.8 2 159 2 150.5v-32.7c0-8.4 4.7-15.2 10.6-15.2zM569.6 276h17.5c5.8 0 10.5 6.9 10.5 15.3V324c0 8.4-4.7 15.3-10.5 15.3h-17.5c-5.8 0-10.5-6.9-10.5-15.3v-32.7c0-8.4 4.7-15.3 10.5-15.3zM569.6 190.3h17.5c5.8 0 10.5 6.9 10.5 15.3v32.7c0 8.4-4.7 15.3-10.5 15.3h-17.5c-5.8 0-10.5-6.9-10.5-15.3v-32.7c0-8.4 4.7-15.3 10.5-15.3zM569.6 102.6h17.5c5.8 0 10.5 6.9 10.5 15.3v32.7c0 8.4-4.7 15.3-10.5 15.3h-17.5c-5.8 0-10.5-6.9-10.5-15.3v-32.7c0-8.5 4.7-15.3 10.5-15.3z"})}),jsx("g",{id:"Cheeks",children:jsxs("g",{id:"Layer_8",children:[jsx("ellipse",{transform:"rotate(120 89.724 277.697)",className:"st5",cx:68.5,cy:243.9,rx:12.9,ry:29.3}),jsx("ellipse",{transform:"rotate(150 447.814 278.705)",className:"st5",cx:430.5,cy:271.6,rx:29.3,ry:12.9})]})}),jsx("g",{id:"Bowties",children:jsx("path",{className:"st4",d:"m293.7 356.6 73.5-33.7v67.3l-73.5-33.6zM293.7 356.6l-73.5 33.7V323l73.5 33.6z"})})]}),jsxs("g",{id:"Layer2",style:{opacity:.15},children:[jsx("path",{className:"st7",d:"M6.7 105.2c2.5-2.6 5.8-2.5 5.8-2.5v63.2s-3.9.4-7.1-4c-.7-.7-3.4-5.1-3.4-11.3v-32.4c0-7 2.7-11 4.7-13z"}),jsx("path",{d:"M112.4 486.3H24c-13 0-14.8-14.5-14.8-14.5S9 332.7 9 353.4c0 20.8 79.5 132.9 103.4 132.9z",style:{fillRule:"evenodd",clipRule:"evenodd",fill:"#180000"}}),jsx("path",{className:"st9",d:"M35.9 105.1c-2.5-2.6-5.8-2.5-5.8-2.5v63.2s3.9.4 7.1-4c.7-.7 3.4-5.1 3.4-11.3v-32.4c0-7-2.8-11-4.7-13z"}),jsx("path",{className:"st7",d:"M6.7 192.9c2.5-2.6 5.8-2.5 5.8-2.5v63.2s-3.9.4-7.1-4c-.7-.7-3.4-5.1-3.4-11.3v-32.4c0-7 2.7-11 4.7-13z"}),jsx("path",{className:"st9",d:"M35.9 192.8c-2.5-2.6-5.8-2.5-5.8-2.5v63.2s3.9.4 7.1-4c.7-.7 3.4-5.1 3.4-11.3v-32.4c0-7-2.8-11-4.7-13z"}),jsx("path",{className:"st7",d:"M6.7 278.6c2.5-2.6 5.8-2.5 5.8-2.5v63.2s-3.9.4-7.1-4c-.7-.7-3.4-5.1-3.4-11.3v-32.4c0-6.9 2.7-10.9 4.7-13z"}),jsx("path",{className:"st9",d:"M35.9 278.5c-2.5-2.6-5.8-2.5-5.8-2.5v63.2s3.9.4 7.1-4c.7-.7 3.4-5.1 3.4-11.3v-32.4c0-7-2.8-11-4.7-13z"}),jsx("path",{className:"st7",d:"M563.7 105.2c2.5-2.6 5.8-2.5 5.8-2.5v63.2s-3.9.4-7.1-4c-.7-.7-3.4-5.1-3.4-11.3v-32.4c0-7 2.7-11 4.7-13z"}),jsx("path",{className:"st9",d:"M592.9 105.1c-2.5-2.6-5.8-2.5-5.8-2.5v63.2s3.9.4 7.1-4c.7-.7 3.4-5.1 3.4-11.3v-32.4c0-7-2.7-11-4.7-13z"}),jsx("path",{className:"st7",d:"M563.7 192.9c2.5-2.6 5.8-2.5 5.8-2.5v63.2s-3.9.4-7.1-4c-.7-.7-3.4-5.1-3.4-11.3v-32.4c0-7 2.7-11 4.7-13z"}),jsx("path",{className:"st9",d:"M592.9 192.8c-2.5-2.6-5.8-2.5-5.8-2.5v63.2s3.9.4 7.1-4c.7-.7 3.4-5.1 3.4-11.3v-32.4c0-7-2.7-11-4.7-13z"}),jsx("path",{className:"st7",d:"M563.7 278.6c2.5-2.6 5.8-2.5 5.8-2.5v63.2s-3.9.4-7.1-4c-.7-.7-3.4-5.1-3.4-11.3v-32.4c0-6.9 2.7-10.9 4.7-13z"}),jsx("path",{className:"st9",d:"M592.9 278.5c-2.5-2.6-5.8-2.5-5.8-2.5v63.2s3.9.4 7.1-4c.7-.7 3.4-5.1 3.4-11.3v-32.4c0-7-2.7-11-4.7-13z"}),jsx("path",{className:"st10",d:"M220.2 323.1v34.2l73.4-.6zM293.7 356.6l73.5-33.6v34.3"})]})]})};function ChippyLoader(e){const t=e.width||defaultChippy.width,r=e.width||defaultChippy.height,s=t*.25,[i,l]=[r+s*2,t+s*2],c=useAppSelector(getSelectedTheme);return jsx(LoaderContainer,{children:jsx(CircleContainer,{$progress:e.progress,$progressColor:getDarkenedColor(c.accent.c,.9),$containerHeight:i,$containerWidth:l,children:jsx("div",{style:{zIndex:1,width:t},children:jsx(SvgComponent,{theme:e.theme})})})})}const LoadingText=styled.div`
  font-size: 30px;
  color: var(--color_label-highlighted);
`;function LoadingText$1(e){const{t}=useTranslation();return jsx(LoadingText,{"data-tid":"loading-message",children:t(e.isSearching?"Searching for devices...":"Loading...")})}const Button=styled.div`
  display: flex;
  transition: transform 0.2s ease-out;
  user-select: none;
  color: #717070;
  border: 1px #717070 solid;
  width: 45px;
  height: 45px;
  padding: 2px;
  margin: 2px;
  text-overflow: ellipsis;
  overflow: hidden;
  cursor: pointer;
  font-size: 12px;
  text-align: center;
  border-radius: 4px;
  justify-content: center;
  align-items: center;
  white-space: pre-wrap;
  box-shadow: #8c8c8c 0 1px 0 0;
  &:hover {
    transform: translate3d(0, -2px, 0);
  }
`,title$6="Keymap",component$3=e=>jsx(FontAwesomeIcon,{icon:faBook}),Message$1=styled.span`
  font-size: 18px;
  margin: 8px;
  text-align: center;
`,ErrorMessage=styled(Message$1)`
  color: #d15e5e;
`,SuccessMessage=styled(Message$1)`
  color: #9ab46a;
`,Encoder=styled(CenterPane)`
  height: 100%;
  background: var(--color_dark_grey);
`,Container$j=styled.div`
  display: flex;
  align-items: center;
  flex-direction: column;
  padding: 0 12px;
`,renderEncoderError=()=>jsx(ErrorMessage,{children:"Your current firmware does not support rotary encoders. Install the latest firmware for your device."}),Pane$a=()=>{const[e,t]=reactExports.useState(),[r,s]=reactExports.useState(),i=useAppSelector(getSelectedKey),l=useAppDispatch(),c=useAppSelector(getSelectedKeyDefinitions),u=useAppSelector(w=>getSelectedKeymap(w)||[]),p=useAppSelector(getSelectedLayerIndex),f=useAppSelector(getSelectedConnectedDevice),m=useAppSelector(getSelectedKeyboardAPI),y=u[i??-1],K=c[i??-1],x=!!K&&K.col!==-1&&K.row!==-1,b=(w,L)=>{if(m&&i!==null&&K&&K.ei!==void 0){const F=+K.ei;switch(w){case"ccw":{m.setEncoderValue(p,F,!1,L),s(L);break}case"cw":{m.setEncoderValue(p,F,!0,L),t(L);break}case"click":{l(updateKey(i,L));break}}}},M=async(w,L,F)=>{const I=await F.getEncoderValue(w,L,!0),k=await F.getEncoderValue(w,L,!1);t(I),s(k)};return reactExports.useEffect(()=>{if(f&&f.protocol>=10&&K!==void 0&&K.ei!==void 0&&m){const w=+K.ei;M(p,w,m)}},[K,f,p]),K===void 0||f&&f.protocol<10||r===void 0||e===void 0?jsx(SpanOverflowCell,{children:renderEncoderError()}):jsx(SpanOverflowCell,{children:jsx(Encoder,{children:jsxs(Container$j,{children:[jsxs(ControlRow,{children:[jsx(Label$1,{children:"Rotate Counterclockwise"}),jsx(Detail,{children:jsx(PelpiKeycodeInput,{value:r,meta:{},setValue:w=>b("ccw",w)})})]}),jsxs(ControlRow,{children:[jsx(Label$1,{children:"Rotate Clockwise"}),jsx(Detail,{children:jsx(PelpiKeycodeInput,{value:e,meta:{},setValue:w=>b("cw",w)})})]}),x&&jsxs(ControlRow,{children:[jsx(Label$1,{children:"Press Encoder"}),jsx(Detail,{children:jsx(PelpiKeycodeInput,{value:y,meta:{},setValue:w=>b("click",w)})})]})]})})})},KeycodeList=styled.div`
  display: grid;
  grid-template-columns: repeat(auto-fill, 64px);
  grid-auto-rows: 64px;
  justify-content: center;
  grid-gap: 10px;
`,MenuContainer$5=styled.div`
  padding: 15px 20px 20px 10px;
`,Keycode=styled(Button)`
  width: 50px;
  height: 50px;
  line-height: 18px;
  border-radius: 64px;
  font-size: 14px;
  border: 4px solid var(--border_color_icon);
  background: var(--bg_control);
  color: var(--color_label-highlighted);
  margin: 0;
  box-shadow: none;
  position: relative;
  border-radius: 10px;
  &:hover {
    border-color: var(--color_accent);
    transform: translate3d(0, -2px, 0);
  }
  ${e=>e.disabled&&"cursor:not-allowed;filter:opacity(50%);"}
`,KeycodeContent=styled.div`
  text-overflow: ellipsis;
  overflow: hidden;
  text-transform: capitalize;
`,CustomKeycode=styled(Button)`
  width: 50px;
  height: 50px;
  line-height: 18px;
  border-radius: 10px;
  font-size: 14px;
  border: 4px solid var(--border_color_icon);
  background: var(--color_accent);
  border-color: var(--color_inside_accent);
  color: var(--color_inside_accent);
  margin: 0;
`,KeycodeContainer=styled.div`
  padding: 12px;
  padding-bottom: 30px;
`,KeycodeDesc=styled.div`
  position: fixed;
  bottom: 0;
  background: #d9d9d97a;
  box-sizing: border-box;
  transition: opacity 0.4s ease-out;
  height: 25px;
  width: 100%;
  line-height: 14px;
  padding: 5px;
  font-size: 14px;
  opacity: 1;
  pointer-events: none;
  &:empty {
    opacity: 0;
  }
`,generateKeycodeCategories=(e,t=16)=>getKeycodes(t).concat(getOtherMenu(e)),maybeFilter=(e,t)=>e?()=>!0:t,Pane$9=()=>{const e=useAppSelector(getSelectedKey),t=useAppDispatch(),r=useAppSelector(getSelectedKeyDefinitions);return reactExports.useEffect(()=>()=>{t(updateSelectedKey(null))},[]),e!==null&&r[e].ei!==void 0?jsx(Pane$a,{}):jsx(KeycodePane,{})},KeycodePane=()=>{var X;const{t:e}=useTranslation(),t=useAppDispatch(),r=useAppSelector(T=>T.macros),s=useAppSelector(getSelectedDefinition),i=useAppSelector(getSelectedConnectedDevice),l=useAppSelector(getSelectedKeymap),c=useAppSelector(getSelectedKey),u=useAppSelector(getDisableFastRemap),p=useAppSelector(getSelectedKeyDefinitions),{basicKeyToByte:f}=useAppSelector(getBasicKeyToByte),m=useAppSelector(getMacroCount),y=useAppSelector(getTapDanceKeycodes),K=reactExports.useMemo(()=>generateKeycodeCategories(f,m),[f,m]);if(!s||!i||!l)return null;const[x,b]=reactExports.useState(K[0].id),[M,w]=reactExports.useState(null),[L,F]=reactExports.useState(!1),I=()=>{if(dist.isVIADefinitionV3(s))return k(s);const{lighting:T,customKeycodes:P}=s,{keycodes:q}=dist.getLightingDefinition(T);return K.filter(maybeFilter(q===dist.KeycodeType.QMK,({id:ae})=>ae!=="qmk_lighting")).filter(maybeFilter(q===dist.KeycodeType.WT,({id:ae})=>ae!=="lighting")).filter(maybeFilter(typeof P<"u",({id:ae})=>ae!=="custom"))},k=T=>{const q=["default",...T.keycodes||[]].flatMap(ae=>categoriesForKeycodeModule(ae));return(s.customKeycodes||[]).length!==0&&q.push("custom"),K.filter(ae=>q.includes(ae.id))},j=()=>jsx(ErrorMessage,{children:e("Your current firmware does not support macros. Install the latest firmware for your device.")}),U=()=>{const{t:T}=useTranslation();return jsx(MenuContainer$5,{children:I().map(({id:P,label:q})=>jsx(SubmenuRow,{$selected:P===x,onClick:()=>b(P),children:T(q)},P))})},V=()=>(t(disableGlobalHotKeys()),jsx(KeycodeModal,{defaultValue:c!==null?l[c]:void 0,onExit:()=>{t(enableGlobalHotKeys()),F(!1)},onConfirm:T=>{t(enableGlobalHotKeys()),z(T),F(!1)}})),z=T=>{c!==null&&(t(updateKey(c,T)),t(updateSelectedKey(u||!p?null:getNextKey(c,p))))},te=(T,P)=>{if(T=="text")F(!0);else return keycodeInMaster(T,f)&&z(getByteForCode(T,f))},R=(T,P)=>{const{code:q,title:ae,name:he}=T;return jsx(Keycode,{disabled:!keycodeInMaster(q,f)&&q!="text",onClick:()=>te(q),onMouseOver:()=>w(ae?`${q}: ${ae}`:q),onMouseOut:()=>w(null),children:jsx(KeycodeContent,{children:he})},q)},H=()=>jsx(CustomKeycode,{onClick:()=>c!==null&&te("text"),onMouseOver:()=>w("Enter any QMK Keycode"),onMouseOut:()=>w(null),children:"Any"},"customKeycode"),N=(T,P)=>{const{t:q}=useTranslation(),ae=T.map((he,Te)=>R(he));switch(P){case"macro":return r.isFeatureSupported?jsx(KeycodeList,{children:ae}):j();case"special":return jsx(KeycodeList,{children:ae.concat(H())});case"custom":return!dist.isVIADefinitionV2(s)&&!dist.isVIADefinitionV3(s)||!s.customKeycodes&&y.length==0?null:jsxs(KeycodeList,{children:[s.customKeycodes&&s.customKeycodes.map((he,Te)=>R({...he,title:q(he.title),code:`CUSTOM(${Te})`})),y.map((he,Te)=>R({...he,title:he.title?q(he.title):he.title,code:`TD(${Te})`}))]});default:return jsx(KeycodeList,{children:ae})}},Q=(X=K.find(({id:T})=>T===x))==null?void 0:X.keycodes;return jsxs(Fragment,{children:[jsx(SubmenuOverflowCell,{children:U()}),jsxs(OverflowCell,{children:[jsx(KeycodeContainer,{children:N(Q,x)}),jsx(KeycodeDesc,{children:M}),L&&V()]})]})},Icon$8=component$3,Title$9=title$6,Keycode$1=Object.freeze(Object.defineProperty({__proto__:null,Icon:Icon$8,KeycodePane,Pane:Pane$9,Title:Title$9},Symbol.toStringTag,{value:"Module"})),LightingControl=e=>{const t=useAppDispatch(),r=useAppSelector(getSelectedLightingData),s=useAppSelector(getSelectedDefinition),[i,l,c]=e.meta,u=r&&r[i];if(!u||!s)return null;const p=typeof l=="string"?l:l(e);switch(c.type){case"slider":return jsxs(ControlRow,{children:[jsx(Label$1,{children:p}),jsx(Detail,{children:jsx(AccentSlider,{isChecked:!!u[0],onChange:f=>t(updateBacklightValue(i,+f))})})]});case"range":return jsxs(ControlRow,{children:[jsx(Label$1,{children:p}),jsx(Detail,{children:jsx(AccentRange,{max:c.max,min:c.min,defaultValue:u[0],onChange:f=>t(updateBacklightValue(i,f))})})]});case"color":return jsxs(ControlRow,{children:[jsx(Label$1,{children:p}),jsx(Detail,{children:jsx(ArrayColorPicker,{color:u,setColor:(f,m)=>t(updateBacklightValue(i,f,m))})})]});case"select":{const f=c.getOptions(s).map((m,y)=>({value:y,label:m}));return jsxs(ControlRow,{children:[jsx(Label$1,{children:p}),jsx(Detail,{children:jsx(AccentSelect,{onChange:m=>{m&&t(updateBacklightValue(i,+m.value))},options:f,defaultValue:f.find(m=>u[0]===m.value)})})]})}case"row_col":return jsxs(ControlRow,{children:[jsx(Label$1,{children:p}),jsx(Detail,{children:jsx(AccentSlider,{isChecked:u[0]!==255,onChange:f=>{t(updateBacklightValue(i,...f?[254,254]:[255,255]))}})})]})}return null},BacklightControls=[[dist.LightingValue.BACKLIGHT_BRIGHTNESS,"Brightness",{type:"range",min:0,max:255}],[dist.LightingValue.BACKLIGHT_EFFECT,"Effect",{type:"select",getOptions:e=>dist.isVIADefinitionV2(e)&&dist.getLightingDefinition(e.lighting).effects.map(([t])=>t)}],[dist.LightingValue.BACKLIGHT_EFFECT_SPEED,"Effect Speed",{type:"range",min:0,max:3}]],UnderglowControls=[[dist.LightingValue.QMK_RGBLIGHT_BRIGHTNESS,"Underglow Brightness",{type:"range",min:0,max:255}],[dist.LightingValue.QMK_RGBLIGHT_EFFECT,"Underglow Effect",{type:"select",getOptions:e=>dist.isVIADefinitionV2(e)&&dist.getLightingDefinition(e.lighting).underglowEffects.map(([t])=>t)}],[dist.LightingValue.QMK_RGBLIGHT_EFFECT_SPEED,"Underglow Effect Speed",{type:"range",min:0,max:3}]],GeneralPane=()=>{const e=useAppDispatch(),t=useAppSelector(getSelectedLightingData),r=useAppSelector(getSelectedDefinition);if(!t)return null;if(!dist.isVIADefinitionV2(r))throw new Error("This lighting component is only compatible with v2 definitions");const s=dist.getLightingDefinition(r.lighting),{supportedLightingValues:i}=s;if(s.supportedLightingValues.length!==0){const l=s.effects.map(([x,b])=>b),c=s.underglowEffects.map(([x,b])=>b),u=t[dist.LightingValue.BACKLIGHT_EFFECT],p=t[dist.LightingValue.QMK_RGBLIGHT_EFFECT],f=u&&l[u[0]]||0,m=p&&c[p[0]]===1,K=!!t.customColors&&f>2;return jsxs(Fragment,{children:[BacklightControls.filter(x=>i.indexOf(x[0])!==-1).map(x=>jsx(LightingControl,{meta:x})),UnderglowControls.filter(x=>i.indexOf(x[0])!==-1).map(x=>jsx(LightingControl,{meta:x})),new Array(f).fill(1).map((x,b)=>x+b).map(x=>{let b,M;const w=x===1?dist.LightingValue.BACKLIGHT_COLOR_1:dist.LightingValue.BACKLIGHT_COLOR_2,L=t[w];if(K&&t.customColors)[b,M]=[t.customColors[x-1],(F,I)=>e(updateCustomColor(x-1,F,I))];else if(L)[b,M]=[{hue:L[0],sat:L[1]},(F,I)=>e(updateBacklightValue(w,F,I))];else return null;return jsxs(ControlRow,{children:[jsxs(Label$1,{children:["Color ",x]}),jsx(Detail,{children:jsx(ColorPicker$1,{color:b,setColor:M})})]},x)}),m&&jsx(LightingControl,{meta:[dist.LightingValue.QMK_RGBLIGHT_COLOR,"Underglow Color",{type:"color"}]})]})}return null},LayoutConfigValues=[dist.LightingValue.BACKLIGHT_USE_7U_SPACEBAR,dist.LightingValue.BACKLIGHT_USE_ISO_ENTER,dist.LightingValue.BACKLIGHT_USE_SPLIT_BACKSPACE,dist.LightingValue.BACKLIGHT_USE_SPLIT_LEFT_SHIFT,dist.LightingValue.BACKLIGHT_USE_SPLIT_RIGHT_SHIFT,dist.LightingValue.BACKLIGHT_DISABLE_HHKB_BLOCKER_LEDS],BooleanControls=[[dist.LightingValue.BACKLIGHT_USE_7U_SPACEBAR,"Use 7U Spacebar LEDs"],[dist.LightingValue.BACKLIGHT_USE_ISO_ENTER,"Use ISO Enter LEDs"],[dist.LightingValue.BACKLIGHT_USE_SPLIT_BACKSPACE,"Use Split Backspace LEDs"],[dist.LightingValue.BACKLIGHT_USE_SPLIT_LEFT_SHIFT,"Use Split Left Shift LEDs"],[dist.LightingValue.BACKLIGHT_USE_SPLIT_RIGHT_SHIFT,"Use Split Right Shift LEDs"],[dist.LightingValue.BACKLIGHT_DISABLE_HHKB_BLOCKER_LEDS,"Disable HHKB Blocker LEDs"]],Pane$8=()=>{const e=useAppDispatch(),t=useAppSelector(getSelectedLightingData),r=useAppSelector(getSelectedDefinition);if(!t)return null;if(!dist.isVIADefinitionV2(r))throw new Error("This lighting component is only compatible with v2 definitions");const s=dist.getLightingDefinition(r.lighting);if(s.supportedLightingValues.length!==0){const i=BooleanControls.filter(l=>s.supportedLightingValues.indexOf(l[0])!==-1);return jsx(Fragment,{children:i.map(([l,c])=>{const u=t&&t[l],p=u&&u[0];return jsxs(ControlRow,{children:[jsx(Label$1,{children:c}),jsx(Detail,{children:jsx(AccentSlider,{isChecked:!!p,onChange:f=>e(updateBacklightValue(l,+f))})})]},l)})})}return null},AdvancedLightingValues=[dist.LightingValue.BACKLIGHT_DISABLE_WHEN_USB_SUSPENDED,dist.LightingValue.BACKLIGHT_DISABLE_AFTER_TIMEOUT,dist.LightingValue.BACKLIGHT_CAPS_LOCK_INDICATOR_COLOR,dist.LightingValue.BACKLIGHT_CAPS_LOCK_INDICATOR_ROW_COL,dist.LightingValue.BACKLIGHT_LAYER_1_INDICATOR_COLOR,dist.LightingValue.BACKLIGHT_LAYER_1_INDICATOR_ROW_COL,dist.LightingValue.BACKLIGHT_LAYER_2_INDICATOR_COLOR,dist.LightingValue.BACKLIGHT_LAYER_2_INDICATOR_ROW_COL,dist.LightingValue.BACKLIGHT_LAYER_3_INDICATOR_COLOR,dist.LightingValue.BACKLIGHT_LAYER_3_INDICATOR_ROW_COL],AccentText=styled.span`
  color: var(--color_accent);
`,RGBControls=[[dist.LightingValue.BACKLIGHT_DISABLE_WHEN_USB_SUSPENDED,"Disable LEDs when USB is suspended",{type:"slider"}],[dist.LightingValue.BACKLIGHT_DISABLE_AFTER_TIMEOUT,()=>{const e=useAppSelector(getSelectedLightingData),t=e&&e[dist.LightingValue.BACKLIGHT_DISABLE_AFTER_TIMEOUT];return t?jsxs("span",{children:["LED Sleep Timeout:"," ",jsx(AccentText,{children:t[0]?`After ${t[0]} mins`:"Never"})]}):null},{type:"range",min:0,max:255}],[dist.LightingValue.BACKLIGHT_CAPS_LOCK_INDICATOR_COLOR,"Caps Lock indicator color",{type:"color"}],[dist.LightingValue.BACKLIGHT_CAPS_LOCK_INDICATOR_ROW_COL,"Caps Lock indicator",{type:"row_col"}],[dist.LightingValue.BACKLIGHT_LAYER_1_INDICATOR_COLOR,"Layer 1 indicator color",{type:"color"}],[dist.LightingValue.BACKLIGHT_LAYER_1_INDICATOR_ROW_COL,"Layer 1 indicator",{type:"row_col"}],[dist.LightingValue.BACKLIGHT_LAYER_2_INDICATOR_COLOR,"Layer 2 indicator color",{type:"color"}],[dist.LightingValue.BACKLIGHT_LAYER_2_INDICATOR_ROW_COL,"Layer 2 indicator",{type:"row_col"}],[dist.LightingValue.BACKLIGHT_LAYER_3_INDICATOR_COLOR,"Layer 3 indicator color",{type:"color"}],[dist.LightingValue.BACKLIGHT_LAYER_3_INDICATOR_ROW_COL,"Layer 3 indicator",{type:"row_col"}]],AdvancedPane=()=>{const e=useAppSelector(getSelectedLightingData),t=useAppSelector(getSelectedDefinition);if(dist.isVIADefinitionV2(t)&&e){const{supportedLightingValues:r}=dist.getLightingDefinition(t.lighting);return jsx(Fragment,{children:RGBControls.filter(s=>r.indexOf(s[0])!==-1).map(s=>jsx(LightingControl,{meta:s}))})}return null},Category={General:{label:"General",Menu:GeneralPane},Layout:{label:"Layout",Menu:Pane$8},Advanced:{label:"Advanced",Menu:AdvancedPane}},LightingPane=styled(CenterPane)`
  height: 100%;
  background: var(--color_dark_grey);
`,Container$i=styled.div`
  display: flex;
  align-items: center;
  flex-direction: column;
  padding: 0 12px;
`,MenuContainer$4=styled.div`
  padding: 15px 20px 20px 10px;
`,Pane$7=()=>{const e=useAppSelector(getSelectedDefinition),[t,r]=reactExports.useState(Category.General);return jsxs(Fragment,{children:[jsx(SubmenuCell,{children:jsx(MenuContainer$4,{children:(()=>{if(!dist.isVIADefinitionV2(e))throw new Error("This lighting component is only compatible with v2 definitions");const i=LayoutConfigValues.some(c=>dist.getLightingDefinition(e.lighting).supportedLightingValues.indexOf(c)!==-1),l=AdvancedLightingValues.some(c=>dist.getLightingDefinition(e.lighting).supportedLightingValues.indexOf(c)!==-1);return[Category.General,...i?[Category.Layout]:[],...l?[Category.Advanced]:[]].filter(({Menu:c})=>!!c)})().map(i=>jsx(SubmenuRow,{$selected:t===i,onClick:()=>r(i),children:i.label},i.label))})}),jsx(OverflowCell,{children:jsx(LightingPane,{children:jsx(Container$i,{children:jsx(t.Menu,{})})})})]})},Icon$7=component$4,Title$8=title$7,Lighting$1=Object.freeze(Object.defineProperty({__proto__:null,Category,Icon:Icon$7,Pane:Pane$7,Title:Title$8},Symbol.toStringTag,{value:"Module"})),SvgIcAdjust24Px=e=>jsx("svg",{width:16.571,height:16.571,...e,children:jsx("path",{d:"M8.285 0a8.285 8.285 0 108.285 8.285A8.3 8.3 0 008.285 0zm0 14.914a6.628 6.628 0 116.628-6.628 6.637 6.637 0 01-6.628 6.628zm2.486-6.628A2.486 2.486 0 118.285 5.8a2.482 2.482 0 012.486 2.485z",fill:"currentColor"})}),title$5="Macros",component$2=SvgIcAdjust24Px,matrixKeycodes=[basicKeyToByte.KC_ESC,basicKeyToByte.KC_F1,basicKeyToByte.KC_F2,basicKeyToByte.KC_F3,basicKeyToByte.KC_F4,basicKeyToByte.KC_F5,basicKeyToByte.KC_F6,basicKeyToByte.KC_F7,basicKeyToByte.KC_F8,basicKeyToByte.KC_F9,basicKeyToByte.KC_F10,basicKeyToByte.KC_F11,basicKeyToByte.KC_F12,basicKeyToByte.KC_PSCR,basicKeyToByte.KC_SLCK,basicKeyToByte.KC_PAUS,basicKeyToByte.KC_SLEP,basicKeyToByte.KC_MUTE,basicKeyToByte.KC_VOLD,basicKeyToByte.KC_VOLU,basicKeyToByte.KC_GRV,basicKeyToByte.KC_1,basicKeyToByte.KC_2,basicKeyToByte.KC_3,basicKeyToByte.KC_4,basicKeyToByte.KC_5,basicKeyToByte.KC_6,basicKeyToByte.KC_7,basicKeyToByte.KC_8,basicKeyToByte.KC_9,basicKeyToByte.KC_0,basicKeyToByte.KC_MINS,basicKeyToByte.KC_EQL,basicKeyToByte.KC_BSPC,basicKeyToByte.KC_INS,basicKeyToByte.KC_HOME,basicKeyToByte.KC_PGUP,basicKeyToByte.KC_NLCK,basicKeyToByte.KC_PSLS,basicKeyToByte.KC_PAST,basicKeyToByte.KC_PMNS,basicKeyToByte.KC_TAB,basicKeyToByte.KC_Q,basicKeyToByte.KC_W,basicKeyToByte.KC_E,basicKeyToByte.KC_R,basicKeyToByte.KC_T,basicKeyToByte.KC_Y,basicKeyToByte.KC_U,basicKeyToByte.KC_I,basicKeyToByte.KC_O,basicKeyToByte.KC_P,basicKeyToByte.KC_LBRC,basicKeyToByte.KC_RBRC,basicKeyToByte.KC_BSLS,basicKeyToByte.KC_DEL,basicKeyToByte.KC_END,basicKeyToByte.KC_PGDN,basicKeyToByte.KC_P7,basicKeyToByte.KC_P8,basicKeyToByte.KC_P9,basicKeyToByte.KC_PPLS,basicKeyToByte.KC_CAPS,basicKeyToByte.KC_A,basicKeyToByte.KC_S,basicKeyToByte.KC_D,basicKeyToByte.KC_F,basicKeyToByte.KC_G,basicKeyToByte.KC_H,basicKeyToByte.KC_J,basicKeyToByte.KC_K,basicKeyToByte.KC_L,basicKeyToByte.KC_SCLN,basicKeyToByte.KC_QUOT,basicKeyToByte.KC_ENT,basicKeyToByte.KC_P4,basicKeyToByte.KC_P5,basicKeyToByte.KC_P6,basicKeyToByte.KC_LSFT,basicKeyToByte.KC_Z,basicKeyToByte.KC_X,basicKeyToByte.KC_C,basicKeyToByte.KC_V,basicKeyToByte.KC_B,basicKeyToByte.KC_N,basicKeyToByte.KC_M,basicKeyToByte.KC_COMM,basicKeyToByte.KC_DOT,basicKeyToByte.KC_SLSH,basicKeyToByte.KC_RSFT,basicKeyToByte.KC_UP,basicKeyToByte.KC_P1,basicKeyToByte.KC_P2,basicKeyToByte.KC_P3,basicKeyToByte.KC_PENT,basicKeyToByte.KC_LCTL,basicKeyToByte.KC_LGUI,basicKeyToByte.KC_LALT,basicKeyToByte.KC_SPC,basicKeyToByte.KC_RALT,basicKeyToByte.KC_RGUI,basicKeyToByte.KC_MENU,basicKeyToByte.KC_RCTL,basicKeyToByte.KC_LEFT,basicKeyToByte.KC_DOWN,basicKeyToByte.KC_RGHT,basicKeyToByte.KC_P0,basicKeyToByte.KC_PDOT],evtToKeyByte={Digit1:basicKeyToByte.KC_1,Digit2:basicKeyToByte.KC_2,Digit3:basicKeyToByte.KC_3,Digit4:basicKeyToByte.KC_4,Digit5:basicKeyToByte.KC_5,Digit6:basicKeyToByte.KC_6,Digit7:basicKeyToByte.KC_7,Digit8:basicKeyToByte.KC_8,Digit9:basicKeyToByte.KC_9,Digit0:basicKeyToByte.KC_0,KeyA:basicKeyToByte.KC_A,KeyB:basicKeyToByte.KC_B,KeyC:basicKeyToByte.KC_C,KeyD:basicKeyToByte.KC_D,KeyE:basicKeyToByte.KC_E,KeyF:basicKeyToByte.KC_F,KeyG:basicKeyToByte.KC_G,KeyH:basicKeyToByte.KC_H,KeyI:basicKeyToByte.KC_I,KeyJ:basicKeyToByte.KC_J,KeyK:basicKeyToByte.KC_K,KeyL:basicKeyToByte.KC_L,KeyM:basicKeyToByte.KC_M,KeyN:basicKeyToByte.KC_N,KeyO:basicKeyToByte.KC_O,KeyP:basicKeyToByte.KC_P,KeyQ:basicKeyToByte.KC_Q,KeyR:basicKeyToByte.KC_R,KeyS:basicKeyToByte.KC_S,KeyT:basicKeyToByte.KC_T,KeyU:basicKeyToByte.KC_U,KeyV:basicKeyToByte.KC_V,KeyW:basicKeyToByte.KC_W,KeyX:basicKeyToByte.KC_X,KeyY:basicKeyToByte.KC_Y,KeyZ:basicKeyToByte.KC_Z,Comma:basicKeyToByte.KC_COMM,Period:basicKeyToByte.KC_DOT,Semicolon:basicKeyToByte.KC_SCLN,Quote:basicKeyToByte.KC_QUOT,BracketLeft:basicKeyToByte.KC_LBRC,BracketRight:basicKeyToByte.KC_RBRC,Backspace:basicKeyToByte.KC_BSPC,Backquote:basicKeyToByte.KC_GRV,Slash:basicKeyToByte.KC_SLSH,Backslash:basicKeyToByte.KC_BSLS,Minus:basicKeyToByte.KC_MINS,Equal:basicKeyToByte.KC_EQL,IntlRo:basicKeyToByte.KC_RO,IntlYen:basicKeyToByte.KC_JYEN,AltLeft:basicKeyToByte.KC_LALT,AltRight:basicKeyToByte.KC_RALT,CapsLock:basicKeyToByte.KC_CAPS,ControlLeft:basicKeyToByte.KC_LCTL,ControlRight:basicKeyToByte.KC_RCTL,MetaLeft:basicKeyToByte.KC_LGUI,MetaRight:basicKeyToByte.KC_RGUI,OSLeft:basicKeyToByte.KC_LGUI,OSRight:basicKeyToByte.KC_RGUI,ShiftLeft:basicKeyToByte.KC_LSFT,ShiftRight:basicKeyToByte.KC_RSFT,ContextMenu:basicKeyToByte.KC_APP,Enter:basicKeyToByte.KC_ENT,Space:basicKeyToByte.KC_SPC,Tab:basicKeyToByte.KC_TAB,Delete:basicKeyToByte.KC_DEL,End:basicKeyToByte.KC_END,Help:basicKeyToByte.KC_HELP,Home:basicKeyToByte.KC_HOME,Insert:basicKeyToByte.KC_INS,PageDown:basicKeyToByte.KC_PGDN,PageUp:basicKeyToByte.KC_PGUP,ArrowDown:basicKeyToByte.KC_DOWN,ArrowLeft:basicKeyToByte.KC_LEFT,ArrowRight:basicKeyToByte.KC_RGHT,ArrowUp:basicKeyToByte.KC_UP,Escape:basicKeyToByte.KC_ESC,PrintScreen:basicKeyToByte.KC_PSCR,ScrollLock:basicKeyToByte.KC_SLCK,AudioVolumeUp:basicKeyToByte.KC_VOLU,AudioVolumeDown:basicKeyToByte.KC_VOLD,AudioVolumeMute:basicKeyToByte.KC_MUTE,Pause:basicKeyToByte.KC_PAUS,F1:basicKeyToByte.KC_F1,F2:basicKeyToByte.KC_F2,F3:basicKeyToByte.KC_F3,F4:basicKeyToByte.KC_F4,F5:basicKeyToByte.KC_F5,F6:basicKeyToByte.KC_F6,F7:basicKeyToByte.KC_F7,F8:basicKeyToByte.KC_F8,F9:basicKeyToByte.KC_F9,F10:basicKeyToByte.KC_F10,F11:basicKeyToByte.KC_F11,F12:basicKeyToByte.KC_F12,F13:basicKeyToByte.KC_F13,F14:basicKeyToByte.KC_F14,F15:basicKeyToByte.KC_F15,F16:basicKeyToByte.KC_F16,F17:basicKeyToByte.KC_F17,F18:basicKeyToByte.KC_F18,F19:basicKeyToByte.KC_F19,F20:basicKeyToByte.KC_F20,F21:basicKeyToByte.KC_F21,F22:basicKeyToByte.KC_F22,F23:basicKeyToByte.KC_F23,F24:basicKeyToByte.KC_F24,NumLock:basicKeyToByte.KC_NLCK,Numpad0:basicKeyToByte.KC_P0,Numpad1:basicKeyToByte.KC_P1,Numpad2:basicKeyToByte.KC_P2,Numpad3:basicKeyToByte.KC_P3,Numpad4:basicKeyToByte.KC_P4,Numpad5:basicKeyToByte.KC_P5,Numpad6:basicKeyToByte.KC_P6,Numpad7:basicKeyToByte.KC_P7,Numpad8:basicKeyToByte.KC_P8,Numpad9:basicKeyToByte.KC_P9,NumpadAdd:basicKeyToByte.KC_PPLS,NumpadComma:basicKeyToByte.KC_COMM,NumpadDecimal:basicKeyToByte.KC_PDOT,NumpadDivide:basicKeyToByte.KC_PSLS,NumpadEnter:basicKeyToByte.KC_PENT,NumpadEqual:basicKeyToByte.KC_PEQL,NumpadMultiply:basicKeyToByte.KC_PAST,NumpadSubtract:basicKeyToByte.KC_PMNS};function getIndexByEvent(e){const t=e.code,r=evtToKeyByte[t]||evtToKeyByte[e.key];return r?matrixKeycodes.indexOf(r):-1}function mapEvtToKeycode(e){switch(e.code){case"Digit1":return"KC_1";case"Digit2":return"KC_2";case"Digit3":return"KC_3";case"Digit4":return"KC_4";case"Digit5":return"KC_5";case"Digit6":return"KC_6";case"Digit7":return"KC_7";case"Digit8":return"KC_8";case"Digit9":return"KC_9";case"Digit0":return"KC_0";case"KeyA":return"KC_A";case"KeyB":return"KC_B";case"KeyC":return"KC_C";case"KeyD":return"KC_D";case"KeyE":return"KC_E";case"KeyF":return"KC_F";case"KeyG":return"KC_G";case"KeyH":return"KC_H";case"KeyI":return"KC_I";case"KeyJ":return"KC_J";case"KeyK":return"KC_K";case"KeyL":return"KC_L";case"KeyM":return"KC_M";case"KeyN":return"KC_N";case"KeyO":return"KC_O";case"KeyP":return"KC_P";case"KeyQ":return"KC_Q";case"KeyR":return"KC_R";case"KeyS":return"KC_S";case"KeyT":return"KC_T";case"KeyU":return"KC_U";case"KeyV":return"KC_V";case"KeyW":return"KC_W";case"KeyX":return"KC_X";case"KeyY":return"KC_Y";case"KeyZ":return"KC_Z";case"Comma":return"KC_COMM";case"Period":return"KC_DOT";case"Semicolon":return"KC_SCLN";case"Quote":return"KC_QUOT";case"BracketLeft":return"KC_LBRC";case"BracketRight":return"KC_RBRC";case"Backquote":return"KC_GRV";case"Slash":return"KC_SLSH";case"Backspace":return"KC_BSPC";case"Backslash":return"KC_BSLS";case"Minus":return"KC_MINS";case"Equal":return"KC_EQL";case"IntlRo":return"KC_RO";case"IntlYen":return"KC_JYEN";case"AltLeft":return"KC_LALT";case"AltRight":return"KC_RALT";case"CapsLock":return"KC_CAPS";case"ControlLeft":return"KC_LCTL";case"ControlRight":return"KC_RCTL";case"MetaLeft":return"KC_LGUI";case"MetaRight":return"KC_RGUI";case"OSLeft":return"KC_LGUI";case"OSRight":return"KC_RGUI";case"ShiftLeft":return"KC_LSFT";case"ShiftRight":return"KC_RSFT";case"ContextMenu":return"KC_APP";case"Apps":return"KC_APP";case"Enter":return"KC_ENT";case"Space":return"KC_SPC";case"Tab":return"KC_TAB";case"Delete":return"KC_DEL";case"End":return"KC_END";case"Help":return"KC_HELP";case"Home":return"KC_HOME";case"Insert":return"KC_INS";case"PageDown":return"KC_PGDN";case"PageUp":return"KC_PGUP";case"ArrowDown":return"KC_DOWN";case"ArrowLeft":return"KC_LEFT";case"ArrowRight":return"KC_RGHT";case"ArrowUp":return"KC_UP";case"Escape":return"KC_ESC";case"PrintScreen":return"KC_PSCR";case"ScrollLock":return"KC_SLCK";case"Pause":return"KC_PAUS";case"F1":return"KC_F1";case"F2":return"KC_F2";case"F3":return"KC_F3";case"F4":return"KC_F4";case"F5":return"KC_F5";case"F6":return"KC_F6";case"F7":return"KC_F7";case"F8":return"KC_F8";case"F9":return"KC_F9";case"F10":return"KC_F10";case"F11":return"KC_F11";case"F12":return"KC_F12";case"F13":return"KC_F13";case"F14":return"KC_F14";case"F15":return"KC_F15";case"F16":return"KC_F16";case"F17":return"KC_F17";case"F18":return"KC_F18";case"F19":return"KC_F19";case"F20":return"KC_F20";case"F21":return"KC_F21";case"F22":return"KC_F22";case"F23":return"KC_F23";case"F24":return"KC_F24";case"NumLock":return"KC_NLCK";case"Numpad0":return"KC_P0";case"Numpad1":return"KC_P1";case"Numpad2":return"KC_P2";case"Numpad3":return"KC_P3";case"Numpad4":return"KC_P4";case"Numpad5":return"KC_P5";case"Numpad6":return"KC_P6";case"Numpad7":return"KC_P7";case"Numpad8":return"KC_P8";case"Numpad9":return"KC_P9";case"NumpadAdd":return"KC_PPLS";case"NumpadComma":return"KC_COMM";case"NumpadDecimal":return"KC_PDOT";case"NumpadDivide":return"KC_PSLS";case"NumpadEnter":return"KC_PENT";case"NumpadEqual":return"KC_PEQL";case"NumpadMultiply":return"KC_PAST";case"NumpadSubtract":return"KC_PMNS";case"AudioVolumeUp":return"KC_VOLU";case"AudioVolumeDown":return"KC_VOLD";case"AudioVolumeMute":return"KC_MUTE";default:console.error("Unreacheable keydown code",e)}}let heldKeys={},lastEvtTime=0;const useKeycodeRecorder=(e,t)=>{const r=reactExports.useState([]),[,s]=r,i=reactExports.useMemo(()=>getKeycodes().flatMap(p=>p.keycodes),[]),l=reactExports.useCallback((p,f)=>{p.preventDefault(),e&&!p.repeat&&s(m=>{const y=i.find(b=>b.code===mapEvtToKeycode(p)),K=Date.now(),x=y==null?void 0:y.code;return m.length&&t&&m.push([RawKeycodeSequenceAction.Delay,K-lastEvtTime]),x&&m.push([f,x]),lastEvtTime=K,[...m]})},[e,t]),c=reactExports.useCallback(p=>{p.repeat||(heldKeys[p.code]=!0,l(p,RawKeycodeSequenceAction.Down))},[e]),u=reactExports.useCallback(p=>{heldKeys[p.code]=!1,l(p,RawKeycodeSequenceAction.Up)},[e]);return reactExports.useEffect(()=>(heldKeys={},e&&(window.addEventListener("keydown",c),window.addEventListener("keyup",u)),()=>{heldKeys={},window.removeEventListener("keydown",c),window.removeEventListener("keyup",u)}),[e]),r};styled.div`
  border: 2px solid var(--bg_control);
  transition: border-color 0.2s ease-in-out;
  margin: 15px 0px;
  display: inline-block;
  &:focus-within {
    border-color: var(--color_accent);
  }
  border-radius: 4px;
  font-size: 16px;
`;const KeycodeSequenceLabel=styled.div`
  display: inline-flex;
  user-select: none;
  color: #717070;
  padding: 6px 4px;
  text-overflow: ellipsis;
  min-width: 30px;
  font-size: 12px;
  text-align: center;
  border-radius: 4px;
  justify-content: center;
  align-items: center;
  white-space: pre-wrap;
  font-size: 16px;
  border: 2px solid var(--border_color_icon);
  background: var(--bg_control);
  color: var(--color_label-highlighted);
  margin: 0;
  box-shadow: none;
  position: relative;
  border-radius: 2px;
  white-space: nowrap;
  position: relative;
  margin: 15px 0px;
`,KeycodeDownLabel=styled(KeycodeSequenceLabel)`
  &::after {
    border-style: solid;
    border-color: transparent;
    content: '';
    border-left: 6px solid transparent;
    border-right: 6px solid transparent;
    border-top: 6px solid var(--color_accent);
    position: absolute;
    margin-top: 55px;
    width: 0;
  }
`,SequenceLabelSeparator=styled.div`
  width: 20px;
  display: inline-flex;
  vertical-align: middle;
  border: 1px solid var(--color_accent);
`,CharacterStreamLabel=styled(KeycodeSequenceLabel)`
  border-color: var(--border_color_cell);
  background: var(--bg_menu);
  white-space: pre-wrap;
  min-height: 1.25em;
  letter-spacing: 2px;
`,KeycodePressLabel=styled(KeycodeSequenceLabel)`
  border-color: var(--color_accent);
`,KeycodeUpLabel=styled(KeycodeSequenceLabel)`
  &::after {
    content: '';
    border-style: solid;
    margin-top: -55px;
    border-color: transparent;
    border-left: 6px solid transparent;
    border-right: 6px solid transparent;
    border-bottom: 6px solid var(--color_accent);
    position: absolute;
    width: 0;
  }
`,KeycodeSequenceWait=styled.div`
  display: inline-flex;
  font-weight: bold;
  user-select: none;
  color: #717070;
  text-overflow: ellipsis;
  min-width: 30px;
  text-align: center;
  justify-content: center;
  align-items: center;
  white-space: pre-wrap;
  font-size: 16px;
  color: var(--color_label-highlighted);
  box-shadow: none;
  position: relative;
  white-space: nowrap;
  position: relative;
  margin: 15px 0px;
  box-sizing: border-box;
  border: 2px solid;
  padding: 4px 4px;
  border-color: var(--color_accent);
  border-radius: 2px;
`,NumberInput=styled.input.attrs({type:"number",placeholder:"XXXXX"})`
  appearance: none;
  background: none;
  border: none;
  border-bottom: 1px solid;
  color: var(--color_label);
  width: 45px;
  text-align: center;
  font-family: inherit;
  font-size: inherit;
  color: var(--color_label-highlighted);
  margin: 0 5px 0 0;
  &:focus {
    color: var(--color_accent);
  }
  &::-webkit-inner-spin-button {
    appearance: none;
    display: none;
  }
  &:invalid {
    color: red;
  }
  &:placeholder-shown {
    color: red;
  }
`,WaitInput=e=>{const t=reactExports.useRef(null),r=i=>{(!i.data||!/^\d$/.test(i.data))&&i.preventDefault()},s=i=>{+i.target.value>0&&+i.target.value<1e5&&e.updateValue(e.index,+i.target.value)};return jsxs(KeycodeSequenceWait,{children:[jsx(NumberInput,{ref:t,onBeforeInput:r,value:e.value,onChange:s}),"ms"]})},getSequenceItemComponent=e=>e===RawKeycodeSequenceAction.Down?KeycodeDownLabel:e===RawKeycodeSequenceAction.Up?KeycodeUpLabel:e===RawKeycodeSequenceAction.CharacterStream?CharacterStreamLabel:KeycodePressLabel;function capitalize(e){return e[0].toUpperCase()+e.slice(1)}const getSequenceLabel=e=>{const t=(e==null?void 0:e.keys)??(e==null?void 0:e.shortName)??(e==null?void 0:e.name)??"";return t.length>1?capitalize(t):t},SimpleIconButton=styled.button`
  appearance: none;
  position: relative;
  display: inline-block;
  background: transparent;
  border: none;
  cursor: pointer;
  line-height: initial;
  font-size: initial;
  padding: 0;
  &:disabled {
    cursor: not-allowed;
    cursor: not-allowed;
  }
  svg {
    color: ${e=>e.disabled?"var(--bg_control)":"var(--border_color_icon);"};
  }
  &:hover {
    svg {
      color: ${e=>e.disabled?"var(--bg_control)":"var(--color_accent)"};
    }
  }
`,IconButton=styled.button`
  appearance: none;
  width: 40px;
  position: relative;
  display: inline-block;
  background: transparent;
  border: none;
  cursor: pointer;
  padding: 10px 10px;
  line-height: initial;
  font-size: initial;
  color: ${e=>e.disabled?"var(--bg_control)":"var(--color_accent)"};
  border-color: ${e=>e.disabled?"var(--bg_control)":"var(--color_accent)"};
  &:disabled {
    cursor: not-allowed;
    border-right: 1px solid var(--border_color_icon);
    cursor: not-allowed;
    background: var(--bg_menu);
  }
  &:hover {
    color: ${e=>e.disabled?"var(--bg_control)":"var(--color_inside-accent)"};
    border-color: ${e=>e.disabled?"var(--bg_control)":"var(--color_accent)"};
    border-right: 1px solid var(--border_color_icon);
    background-color: ${e=>e.disabled?"var(--bg_menu)":"var(--color_accent)"};
  }

  svg {
    color: ${e=>e.disabled?"var(--bg_control)":"var(--color_accent)"};
  }
  &:hover {
    svg {
      color: ${e=>e.disabled?"var(--bg_control)":"var(--color_inside-accent)"};
    }

    color: var(--color_label-highlighted);
    & .tooltip {
      transform: scale(1) translateX(0px);
      opacity: 1;
    }
  }
  .tooltip {
    transform: translateX(-5px) scale(0.6);
    opacity: 0;
  }
`,IconButtonUnfilledContainer=styled(IconButton)`
  cursor: pointer;
  background: inherit;
  border: 1px solid var(--color_accent);
  width: 30px;
  height: 30px;
  justify-content: center;
  display: inline-flex;
  align-items: center;
`,IconButtonContainer=styled(IconButton)`
  cursor: pointer;
  background: var(--bg_control);
  border-right: 1px solid var(--border_color_icon);
`,IconToggleContainer=styled(IconButton)`
  cursor: pointer;
  transition: all 0.4s ease;
  background: ${e=>e.$selected?"var(--color_accent)":"var(--bg_menu)"};
  svg {
    color: ${e=>e.$selected?"var(--color_inside-accent)":"var(--bg_icon)"};
  }
  &:hover {
    background: ${e=>e.$selected?"var(--color_accent)":"var(--bg_menu)"};
    svg {
      color: ${e=>e.$selected?"var(--color_inside-accent)":"var(--bg_icon)"};
    }
  }
  border-right: 1px solid var(--border_color_icon);
`,Keycap2DTooltip=e=>{const t=reactExports.useMemo(()=>({containerStyles:{position:"absolute",left:"50%",transformOrigin:"left",transition:"all 0.1s ease-in-out",top:0,marginTop:-40,zIndex:4,pointerEvents:"none",filter:"drop-shadow(0px 0px 1px white)"},contentStyles:{padding:"5px 8px",borderRadius:10,background:"var(--color_accent)",color:"var(--color_inside-accent)",fontFamily:"'Fira Sans Condensed', Helvetica, Helvetica Neue, Arial, serif",fontSize:16,fontWeight:500,whiteSpace:"nowrap",display:"flex",justifyContent:"center",alignItems:"center",textTransform:"uppercase",zIndex:5,transform:"translateX(-50%)"},pointerStyles:{borderStyle:"solid",borderColor:"transparent",borderLeft:"6px solid transparent",borderRight:"6px solid transparent",borderTop:"6px solid var(--color_accent)",position:"absolute",marginLeft:-6,width:0}}),[]);return jsx(Tooltip,{...e,containerStyles:t.containerStyles,contentStyles:t.contentStyles,pointerStyles:t.pointerStyles})},KeycapTooltip=e=>{const t=reactExports.useMemo(()=>({containerStyles:{display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column",marginTop:-800},contentStyles:{padding:"70px 70px",background:"var(--color_accent)",color:"var(--color_inside-accent)",borderRadius:100,fontSize:200,fontFamily:"'Fira Sans', Helvetica, Helvetica Neue, Arial, serif",whiteSpace:"nowrap",letterSpacing:1,display:"flex",justifyContent:"center",alignItems:"center",fontWeight:"bold"},pointerStyles:{height:150,width:150,marginTop:-100,transform:"rotate(45deg)",background:"var(--color_accent)"}}),[]);return jsx(Tooltip,{...e,containerStyles:t.containerStyles,contentStyles:t.contentStyles,pointerStyles:t.pointerStyles})},CategoryMenuTooltip=e=>{const t=reactExports.useMemo(()=>({containerStyles:{position:"absolute",top:45,left:0,transformOrigin:"left",transition:"all 0.1s ease-in-out",marginTop:0,zIndex:4,pointerEvents:"none"},contentStyles:{padding:"5px 10px",borderRadius:10,background:"var(--color_accent)",color:"var(--color_inside-accent)",fontFamily:"'Fira Sans Condensed', Helvetica, Helvetica Neue, Arial, serif",fontSize:18,fontWeight:500,whiteSpace:"nowrap",display:"flex",justifyContent:"center",alignItems:"center",textTransform:"uppercase",zIndex:5,transform:"translateX(-50%)",marginLeft:18},pointerStyles:{borderStyle:"solid",borderColor:"transparent",borderLeft:"6px solid transparent",borderRight:"6px solid transparent",borderBottom:"6px solid var(--color_accent)",position:"absolute",marginLeft:15,marginTop:-41,width:0}}),[]);return jsx(Tooltip,{...e,containerStyles:t.containerStyles,contentStyles:t.contentStyles,pointerStyles:t.pointerStyles})},ProgressBarTooltip=e=>{const t=reactExports.useMemo(()=>({containerStyles:{position:"absolute",left:"50%",transformOrigin:"left",transition:"all 0.1s ease-in-out",top:0,marginTop:-40,zIndex:4,pointerEvents:"none"},contentStyles:{padding:"5px 10px",borderRadius:10,background:"var(--color_inside-accent)",color:"var(--color_accent)",fontFamily:"'Fira Sans Condensed', Helvetica, Helvetica Neue, Arial, serif",fontSize:18,fontWeight:500,whiteSpace:"nowrap",display:"flex",justifyContent:"center",alignItems:"center",textTransform:"uppercase",zIndex:5,transform:"translateX(-50%)"},pointerStyles:{borderStyle:"solid",borderColor:"transparent",borderLeft:"6px solid transparent",borderRight:"6px solid transparent",borderTop:"6px solid var(--color_inside-accent)",position:"absolute",marginLeft:-6,width:0}}),[]);return jsx(Tooltip,{...e,containerStyles:t.containerStyles,contentStyles:t.contentStyles,pointerStyles:t.pointerStyles})},IconButtonTooltip=e=>{const t=reactExports.useMemo(()=>({containerStyles:{position:"absolute",top:50,left:0,transformOrigin:"left",transition:"all 0.1s ease-in-out",marginTop:0,zIndex:4,pointerEvents:"none"},contentStyles:{padding:"5px 10px",borderRadius:10,background:"var(--color_inside-accent)",color:"var(--color_accent)",fontFamily:"'Fira Sans Condensed', Helvetica, Helvetica Neue, Arial, serif",fontSize:18,fontWeight:500,whiteSpace:"nowrap",display:"flex",justifyContent:"center",alignItems:"center",textTransform:"uppercase",zIndex:5,transform:"translateX(-50%)",marginLeft:18},pointerStyles:{borderStyle:"solid",borderColor:"transparent",borderLeft:"6px solid transparent",borderRight:"6px solid transparent",borderBottom:"6px solid var(--color_inside-accent)",position:"absolute",marginLeft:15,marginTop:-41,width:0}}),[]);return jsx(Tooltip,{...e,containerStyles:t.containerStyles,contentStyles:t.contentStyles,pointerStyles:t.pointerStyles})},MenuTooltip=e=>{const t=reactExports.useMemo(()=>({containerStyles:{position:"absolute",top:0,left:45,transformOrigin:"left",transition:"all 0.1s ease-in-out",marginTop:-5,zIndex:4,pointerEvents:"none"},contentStyles:{padding:"5px 5px",background:"var(--color_inside-accent)",color:"var(--color_accent)",borderRadius:10,fontFamily:"'Fira Sans Condensed', Helvetica, Helvetica Neue, Arial, serif",fontWeight:400,whiteSpace:"nowrap",display:"flex",justifyContent:"center",alignItems:"center",zIndex:5},pointerStyles:{borderStyle:"solid",borderColor:"transparent",borderTop:"6px solid transparent",borderBottom:"6px solid transparent",borderRight:"6px solid var(--color_inside-accent)",position:"absolute",marginLeft:-9,marginTop:-21,width:0}}),[]);return jsx(Tooltip,{...e,containerStyles:t.containerStyles,contentStyles:t.contentStyles,pointerStyles:t.pointerStyles})},Tooltip=e=>{const{containerStyles:t,contentStyles:r,pointerStyles:s}=e;return jsxs("div",{style:t,className:"tooltip",children:[jsx("div",{style:r,children:e.children}),jsx("div",{style:s})]})},MacroEditControlsContainer=styled.div`
  background: var(--bg_menu);
  display: inline-flex;
  align-items: center;
  padding: 0 10px;
`,MacroControlGroupContainer=styled.div`
  border-radius: 2px;
  border: 1px solid var(--border_color_icon);
  display: inline-flex;
  > button:last-child {
    border: none;
  }
`,MacroControlGroupDivider=styled.div`
  background: var(--border_color_icon);
  width: 1px;
  height: 80%;
  margin: 0 10px;
`,MacroEditControls=({isFullscreen:e,isRecording:t,recordingToggleChange:r,hasUnsavedChanges:s,undoChanges:i,saveChanges:l,recordDelays:c,toggleRecordDelays:u,optimizeRecording:p,toggleOptimizeRecording:f,isEmpty:m,deleteMacro:y,toggleFullscreen:K,isDelaySupported:x})=>{const{t:b}=useTranslation(),M=jsxs(IconButtonContainer,{onClick:()=>{r(!t)},disabled:!e,children:[jsx(FontAwesomeIcon,{size:"sm",color:"var(--color_label)",icon:t?faSquare:faCircle}),jsx(IconButtonTooltip,{children:b(e?t?"Stop Recording":"Record Keystrokes":"Can only record when fullscreen")})]});return jsxs(MacroEditControlsContainer,{children:[s?jsx(Fragment,{children:t?null:jsxs(Fragment,{children:[jsxs(MacroControlGroupContainer,{children:[jsxs(IconButtonContainer,{disabled:!s||t,onClick:i,children:[jsx(FontAwesomeIcon,{size:"sm",color:"var(--color_label)",icon:faUndo}),jsx(IconButtonTooltip,{children:b("Undo Changes")})]}),jsxs(IconButtonContainer,{disabled:!s||t,onClick:()=>l(),children:[jsx(FontAwesomeIcon,{size:"sm",color:"var(--color_label)",icon:faSave}),jsx(IconButtonTooltip,{children:b("Save Changes")})]})]}),jsx(MacroControlGroupDivider,{})]})}):m?jsx(Fragment,{}):jsxs(Fragment,{children:[jsx(MacroControlGroupContainer,{children:jsxs(IconButtonContainer,{disabled:s||t,onClick:y,children:[jsx(FontAwesomeIcon,{size:"sm",color:"var(--color_label)",icon:faTrash}),jsx(IconButtonTooltip,{children:b("Delete Macro")})]})}),jsx(MacroControlGroupDivider,{})]}),jsxs(MacroControlGroupContainer,{children:[M,jsxs(IconButtonContainer,{onClick:K,children:[jsx(FontAwesomeIcon,{size:"sm",color:"var(--color_label)",icon:e?faCompress:faExpand}),jsx(IconButtonTooltip,{children:b(e?"Exit Fullscreen":"Fullscreen")})]})]}),t?null:jsxs(Fragment,{children:[jsx(MacroControlGroupDivider,{}),jsxs(MacroControlGroupContainer,{children:[jsxs(IconToggleContainer,{$selected:p,onClick:f,children:[jsx(FontAwesomeIcon,{size:"sm",icon:faMagicWandSparkles}),jsx(IconButtonTooltip,{children:b(p?"Skip Smart Optimization":"Use Smart Optimization")})]}),jsxs(IconToggleContainer,{disabled:!x,$selected:c,onClick:u,children:[jsx(FontAwesomeIcon,{size:"sm",icon:faStopwatch,className:"fa-stack-1x"}),jsx(IconButtonTooltip,{children:b(x?c?"Skip Recording Delays":"Record Delays":"Upgrade firmware to use delays")})]})]})]})]})},DeletableContainer=styled.div`
  display: inline-flex;
  vertical-align: middle;
  position: relative;
  svg {
    color: var(--bg_icon-highlighted);
    position: absolute;
    right: -5px;
    top: 6px;
    opacity: 0;
    cursor: pointer;
    transition: transform 0.2s ease-in-out;
    background: var(--bg_icon);
    border-radius: 50%;
    transform: scale(0.8);
  }
  &:hover svg {
    opacity: 1;
    transform: scale(1);
  }
`,Deletable=e=>jsxs(DeletableContainer,{style:{pointerEvents:e.disabled?"none":"all"},children:[e.children,jsx(FontAwesomeIcon,{icon:faXmarkCircle,size:"lg",onClick:()=>e.deleteItem(e.index)})]}),pipeline=(e,...t)=>t.reduce((r,s)=>s(r),e),NoMacroRecorded=styled.div`
  font-style: italic;
  color: var(--color_label-highlighted);
`,MacroSequenceContainer=styled.div`
  max-width: 960px;
  width: 100%;
  display: block;
  border: 1px solid var(--border_color_cell);
  border-style: ${e=>e.$isModified?"dashed":"solid"};
  padding: 30px 20px;
  border-radius: 15px;
  margin-top: 10px;
  box-sizing: border-box;
}
`,componentJoin=(e,t)=>e.reduce((r,s,i)=>(i&&r.push({...t,key:i}),r.push(s),r),[]),KeycodeMap=getKeycodes().flatMap(e=>e.keycodes).reduce((e,t)=>({...e,[t.code]:t}),{}),optimizeKeycodeSequence=e=>pipeline(e,convertCharacterTaps,trimLastWait,mergeConsecutiveWaits,foldKeydownKeyupKeys,convertToCharacterStreams),cleanKeycodeSequence=e=>pipeline(e,mergeConsecutiveWaits),MacroRecorder=({selectedMacro:e,setUnsavedMacro:t,saveMacro:r,undoMacro:s,isDelaySupported:i})=>{const{t:l}=useTranslation(),[c,u]=reactExports.useState(!0),[p,f]=reactExports.useState(!1),[m,y]=reactExports.useState(!1),[K,x]=reactExports.useState(!!document.fullscreenElement),{smartOptimizeEnabled:b,recordDelaysEnabled:M}=useAppSelector(getMacroEditorSettings),w=useDispatch(),[L,F]=useKeycodeRecorder(p,M),I=reactExports.useRef(null),k=reactExports.useCallback(async X=>{f(X),X?(await navigator.keyboard.lock(),F([]),u(!1),y(!0)):(navigator.keyboard.unlock(),b&&F(optimizeKeycodeSequence(L)),y(!1))},[L,f]),j=reactExports.useCallback(()=>{r(""),u(!0),y(!1)},[F,r]),U=reactExports.useCallback(()=>{s(),F([]),u(!0),y(!1)},[s]);reactExports.useEffect(()=>{u(!0),y(!1),F([])},[e]);const V=()=>[...c?e??[]:L],z=reactExports.useMemo(()=>{let X,T=V();return c||!m||!b?X=T:X=optimizeKeycodeSequence(T),X},[L,c,b,m,e]);reactExports.useEffect(()=>{z&&t(sequenceToExpression(z))},[z]);const te=reactExports.useCallback(()=>{c&&u(!1)},[c]),R=reactExports.useCallback(X=>{const T=V();T.splice(X,1),F(cleanKeycodeSequence(T)),te()},[z,e,L,c]),H=reactExports.useCallback((X,T)=>{const P=V();P.splice(X,1,[RawKeycodeSequenceAction.Delay,T]),F(cleanKeycodeSequence(P)),te()},[z,e,L,c]),N=reactExports.useMemo(()=>componentJoin(z.map(([X,T],P)=>{const q=getSequenceItemComponent(X);return jsx(Deletable,{index:P,deleteItem:R,disabled:p,children:RawKeycodeSequenceAction.Delay!==X?jsx(q,{children:X===RawKeycodeSequenceAction.CharacterStream?componentJoin(String(T).split(" ").map((ae,he)=>jsx("span",{children:ae},he)),jsx("span",{style:{fontFamily:"fantasy, cursive, monospace"},children:"␣"})):Array.isArray(T)?T.map(ae=>getSequenceLabel(KeycodeMap[ae])??ae).join(" + "):getSequenceLabel(KeycodeMap[T])}):jsx(WaitInput,{index:P,value:Number(T),updateValue:H})},`${P}-${X}`)}),jsx(SequenceLabelSeparator,{})),[z]);reactExports.useEffect(()=>{const X=()=>{x(!!document.fullscreenElement)};return document.documentElement.addEventListener("fullscreenchange",X),()=>{k(!1),document.documentElement.removeEventListener("fullscreenchange",X)}},[x]);const Q=reactExports.useCallback(()=>{document.fullscreenElement?document.exitFullscreen&&(k(!1),document.exitFullscreen()):document.documentElement.requestFullscreen()},[k]);return jsxs(Fragment,{children:[jsx(MacroSequenceContainer,{ref:I,$isModified:!c,children:N.length?N:jsx(NoMacroRecorded,{children:l("No macro recorded yet...")})}),jsx("div",{style:{border:"none",maxWidth:960,width:"100%",display:"flex",justifyContent:"center",transform:"translate(-0px, -21px)"},children:jsx(MacroEditControls,{isFullscreen:K,isEmpty:!e||!e.length,optimizeRecording:b,recordDelays:M,isRecording:p,addText:()=>{},deleteMacro:j,toggleOptimizeRecording:()=>{w(setMacroEditorSettings({smartOptimizeEnabled:!b}))},toggleRecordDelays:()=>{w(setMacroEditorSettings({recordDelaysEnabled:!M}))},toggleFullscreen:Q,undoChanges:U,saveChanges:()=>r(),hasUnsavedChanges:!c,recordingToggleChange:k,isDelaySupported:i})})]})},TextArea=styled.textarea`
  box-sizing: border-box;
  background: var(--bg_control);
  padding: 5px 10px;
  border-color: var(--border_color_icon);
  color: var(--color_label);
  width: 100%;
  height: 200px;
  font-size: 16px;
  line-height: 18px;
  resize: none;
  font-family: 'Source Code Pro';
  font-weight: 500;
  &::placeholder {
    color: var(--color_label);
  }
  &:focus {
    color: var(--color_accent);
    outline-color: var(--color_accent);
  }
`,ToastErrorMessage=styled(ErrorMessage)`
  margin: 0;
  width: 100%;
  font-size: 14px;
  display: block;
  &:empty {
    display: none;
  }
`,Message=styled.div`
  color: var(--color_accent);
`,Link=styled.a`
  font-size: 18x !important;
  color: var(--color_accent);
  text-decoration: underline;
`,DescriptionLabel=styled(Label$1)`
  margin: 1em 0;
  font-size: 14px;
  line-height: 18px;
  font-style: oblique;
  padding-left: 5px;
`,AutoHeightRow=styled(ControlRow)`
  height: auto;
`,ScriptMode=({macro:e,protocol:t,setUnsavedMacro:r,saveMacros:s,macroIndex:i,isDelaySupported:l})=>{const{t:c}=useTranslation(),u=e.trimEnd(),[p,f]=React.useState(u),[m,y]=React.useState(void 0);reactExports.useEffect(()=>{r(p)},[p]);const K=()=>{const M=getMacroValidator(t)(p);M.isValid?(s(p),y(void 0)):y(M.errorMessage)};return jsxs(Fragment,{children:[jsx(AutoHeightRow,{children:jsx(ReactTextareaAutocomplete,{value:p,onChange:b=>f(b.target.value),loadingComponent:AutocompleteLoading,style:{fontSize:"16px",lineHeight:"18px",width:"100%",height:"140px",fontFamily:"monospace",resize:"none",borderColor:m!==void 0?"var(--color_error)":"var(--border_color_icon)"},containerStyle:{border:"none",lineHeight:"20px"},itemStyle:{borderColor:"var(--border_color_cell)",backgroundColor:"var(--bg_menu)"},dropdownStyle:{zIndex:999,backgroundColor:"var(--bg_menu)"},listStyle:{position:"fixed",backgroundColor:"var(--bg_menu)",maxHeight:"210px",overflow:"auto",border:"1px solid var(--border_color_cell)"},minChar:0,textAreaComponent:TextArea,movePopupAsYouType:!0,placeholder:`Enter the macro you want M${i} to execute...`,trigger:{"?":{dataProvider:findKeycodes,component:AutocompleteItem,output:b=>({text:b.code,caretPosition:"end"})},"{":{dataProvider:findKeycodes,component:AutocompleteItem,output:b=>({text:`{${b.code},`,caretPosition:"end"})},",":{dataProvider:findKeycodes,component:AutocompleteItem,output:b=>({text:`,${b.code},`,caretPosition:"end"})}}})}),jsxs(AutoHeightRow,{children:[jsxs(DescriptionLabel,{children:[jsx(ToastErrorMessage,{children:m}),jsxs(Message,{children:[c("Enter text directly, or wrap")," ",jsx(Link,{href:"https://docs.qmk.fm/#/keycodes_basic",target:"_blank",children:c("Basic Keycodes")})," ",c("in")," ","{}"]}),jsxs(Message,{children:[c("Single tap"),": ","{KC_XXX}"]}),jsxs(Message,{children:[c("Chord"),": ","{KC_XXX, KC_YYY, KC_ZZZ}"]}),jsxs(Message,{children:[c("Keydown"),": ","{+KC_XXX}"]}),jsxs(Message,{children:[c("Keyup"),": ","{-KC_XXX}"]}),l?jsxs(Message,{children:[c("Delay")," (ms): ","{NNNN}"," "]}):"Upgrade firmware to use delays",jsx(Message,{children:c("Type ? to search for keycodes")})]}),jsx(Detail,{children:jsx(AccentButton,{disabled:e===p,onClick:K,children:"Save"})})]})]})},ProgressBarContainer$1=styled.div`
  position: relative;
  margin-top: 10px;
  &:hover {
    & .tooltip {
      transform: scale(1) translateY(0px);
      opacity: 1;
    }
  }
  .tooltip {
    transform: translateY(5px) scale(0.6);
    opacity: 0;
  }
`,ProgressBar$1=styled.div`
  background: var(--bg_control);
  position: relative;
  padding: 5px;
  border-radius: 5px;
  overflow: hidden;
  margin-bottom: 10px;
  cursor: pointer;
  width: 250px;

  > span {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    background: var(--color_accent);
    height: 10px;
    width: 100%;
    transform: scaleX(0.1);
    transform-origin: left;
    transition: transform 0.4s ease-in-out;
  }
`,MacroTab=styled.span`
  display: inline-flex;
  border: 1px solid;
  line-height: initial;
  border-top: none;
  padding: 8px;
  border-bottom-left-radius: 6px;
  border-bottom-right-radius: 6px;
  min-width: 38px;
  justify-content: center;
  box-sizing: border-box;
  color: ${e=>e.$selected?"var(--color_accent)":"var(--bg_icon)"};
  cursor: pointer;
  &:hover {
    color: ${e=>e.$selected?"var(--color_accent)":"var(--bg_icon-highlighted)"};
  }
`,TabBar=styled.div`
  display: flex;
  column-gap: 10px;
`,TabContainer=styled.div`
  display: flex;
  margin-bottom: 10px;
  width: 100%;
  max-width: 960px;
`,CenterTabContainer=styled(TabContainer)`
  justify-content: center;
`,printBytesUsed=(e,t)=>{const{t:r}=useTranslation(),s=["Bytes","kB","MB","GB"],i=Math.floor(Math.log10(t)/3),l=s[i],c=i===0?1:Math.pow(1e3,i),u=e/c,p=t/c;return`${u.toFixed(i)} / ${p.toFixed(i)} ${l} ${r("space used")}`},BufferSizeUsage=()=>{const e=useAppSelector(u=>u.macros.ast),t=useAppSelector(getMacroBufferSize),r=useAppSelector(getSelectedConnectedDevice),s=useAppSelector(getSelectedKeyboardAPI);if(!r||!s)return null;const{protocol:i}=r,c=getMacroAPI(i,s).rawKeycodeSequencesToMacroBytes(e).length;return jsxs(ProgressBarContainer$1,{children:[jsx(ProgressBar$1,{children:jsx("span",{style:{transform:`scaleX(${c/t})`}})}),jsx(ProgressBarTooltip,{children:printBytesUsed(c,t)})]})},MacroDetailPane=e=>{const t=e.macroExpressions[e.selectedMacro]||"",[r,s]=React.useState(!1),i=useAppSelector(m=>m.macros.ast),l=useAppSelector(getIsDelaySupported),[c,u]=reactExports.useState(t);reactExports.useEffect(()=>{u(t)},[t]);const p=reactExports.useCallback(()=>{u(t)},[t]),f=reactExports.useCallback(m=>{m!==void 0?(e.saveMacros(""),u("")):c!==t&&(e.saveMacros(c),u(c))},[c]);return jsxs(Fragment,{children:[jsx(CenterTabContainer,{children:jsxs(TabBar,{children:[jsx(MacroTab,{$selected:!r,onClick:()=>s(!1),children:jsx(FontAwesomeIcon,{icon:faClapperboard})}),jsx(MacroTab,{$selected:r,onClick:()=>s(!0),children:jsx(FontAwesomeIcon,{icon:faCode})})]})}),jsx(BufferSizeUsage,{}),r?jsx(ScriptMode,{macro:t,macroIndex:e.selectedMacro,protocol:e.protocol,isDelaySupported:l,setUnsavedMacro:u,saveMacros:e.saveMacros},e.selectedMacro):jsx(MacroRecorder,{selectedMacro:i[e.selectedMacro],setUnsavedMacro:u,undoMacro:p,saveMacro:f,isDelaySupported:l})]})},MacroPane=styled(CenterPane)`
  height: 100%;
  background: var(--color_dark_grey);
`,Container$h=styled.div`
  display: flex;
  align-items: center;
  flex-direction: column;
  padding: 12px;
  padding-top: 0;
`,MenuContainer$3=styled.div`
  padding: 15px 10px 20px 10px;
`,Pane$6=()=>{const e=useAppDispatch(),t=useAppSelector(getSelectedConnectedDevice),r=useAppSelector(getExpressions),s=useAppSelector(getMacroCount),[i,l]=reactExports.useState(0),c=reactExports.useCallback(async p=>{if(!t)return;const f=r.map((m,y)=>y===i?p:m);e(saveMacros(t,f))},[r,saveMacros,e,t,i]),u=reactExports.useMemo(()=>Array(s).fill(0).map((p,f)=>f).map(p=>jsx(SubmenuRow,{$selected:i===p,onClick:()=>l(p),style:{borderWidth:0,textAlign:"center"},children:`M${p}`},p)),[i,s]);return t?jsxs(Fragment,{children:[jsx(SubmenuOverflowCell,{children:jsx(MenuContainer$3,{children:u})}),jsx(OverflowCell,{children:jsx(MacroPane,{children:jsx(Container$h,{children:jsx(MacroDetailPane,{macroExpressions:r,selectedMacro:i,saveMacros:c,protocol:t?t.protocol:-1})})})})]}):null},Icon$6=component$2,Title$7=title$5,Macros=Object.freeze(Object.defineProperty({__proto__:null,Icon:Icon$6,Pane:Pane$6,Title:Title$7},Symbol.toStringTag,{value:"Module"}));function AccentUploadButton(e){const t=e.inputRef||React.useRef();function r(s){e.onLoad(s.target.files),t.current.value=null}return jsxs(AccentButton,{onClick:()=>t.current&&t.current.click(),children:[e.children,jsx("input",{ref:t,type:"file",multiple:e.multiple,accept:"application/json",style:{display:"none"},onChange:r})]})}const deprecatedKeycodes={KC_TILD:"S(KC_GRV)",KC_EXLM:"S(KC_1)",KC_AT:"S(KC_2)",KC_HASH:"S(KC_3)",KC_DLR:"S(KC_4)",KC_PERC:"S(KC_5)",KC_CIRC:"S(KC_6)",KC_AMPR:"S(KC_7)",KC_ASTR:"S(KC_8)",KC_LPRN:"S(KC_9)",KC_RPRN:"S(KC_0)",KC_UNDS:"S(KC_MINS)",KC_PLUS:"S(KC_EQL)",KC_LCBR:"S(KC_LBRC)",KC_RCBR:"S(KC_RBRC)",KC_PIPE:"S(KC_BSLS)",KC_COLN:"S(KC_SCLN)",KC_DQUO:"S(KC_QUOT)",KC_LT:"S(KC_COMM)",KC_GT:"S(KC_DOT)",KC_QUES:"S(KC_SLSH)",SPC_FN1:"LT(1,KC_SPC)",SPC_FN2:"LT(2,KC_SPC)",SPC_FN3:"LT(3,KC_SPC)",MACRO00:"MACRO(0)",MACRO01:"MACRO(1)",MACRO02:"MACRO(2)",MACRO03:"MACRO(3)",MACRO04:"MACRO(4)",MACRO05:"MACRO(5)",MACRO06:"MACRO(6)",MACRO07:"MACRO(7)",MACRO08:"MACRO(8)",MACRO09:"MACRO(9)",MACRO10:"MACRO(10)",MACRO11:"MACRO(11)",MACRO12:"MACRO(12)",MACRO13:"MACRO(13)",MACRO14:"MACRO(14)",MACRO15:"MACRO(15)",USER00:"CUSTOM(0)",USER01:"CUSTOM(1)",USER02:"CUSTOM(2)",USER03:"CUSTOM(3)",USER04:"CUSTOM(4)",USER05:"CUSTOM(5)",USER06:"CUSTOM(6)",USER07:"CUSTOM(7)",USER08:"CUSTOM(8)",USER09:"CUSTOM(9)",USER10:"CUSTOM(10)",USER11:"CUSTOM(11)",USER12:"CUSTOM(12)",USER13:"CUSTOM(13)",USER14:"CUSTOM(14)",USER15:"CUSTOM(15)"},title$4="Save + Load",component$1=()=>jsx(FontAwesomeIcon,{icon:faFloppyDisk}),isViaSaveFile=e=>e&&e.name&&e.layers&&e.vendorProductId,SaveLoadPane=styled(CenterPane)`
  height: 100%;
  background: var(--color_dark_grey);
`,Container$g=styled.div`
  display: flex;
  align-items: center;
  flex-direction: column;
  padding: 0 12px;
`,Pane$5=()=>{var U;const{t:e}=useTranslation(),t=useAppDispatch(),r=useAppSelector(getSelectedDefinition),s=useAppSelector(getSelectedConnectedDevice),i=useAppSelector(getSelectedKeyboardAPI),l=useAppSelector(getSelectedRawLayers),c=useAppSelector(V=>V.macros),u=useAppSelector(getExpressions),{basicKeyToByte:p,byteToKey:f}=useAppSelector(getBasicKeyToByte),m=useAppSelector(getSelectedDevicePath),y=(U=useAppSelector(getSelectedTabkbConfig))==null?void 0:U.actuation,K=useAppSelector(getActuationMap),x=useAppSelector(getDksmap),b=useAppSelector(getEnableAP);if(!r||!s||!i||!m)return null;const[M,w]=reactExports.useState(null),[L,F]=reactExports.useState(null),I=async()=>{const{layouts:V}=r,{keys:z,optionKeys:te}=V,R=[...z,...Object.values(te).flatMap(H=>Object.values(H)).flat()].filter(H=>"ei"in H).map(H=>H.ei);if(R.length>0){const H=Math.max(...R)+1,N=l.length;return await Promise.all(Array(H).fill(0).map((X,T)=>Promise.all(Array(N).fill(0).map((P,q)=>Promise.all([i.getEncoderValue(q,T,!1),i.getEncoderValue(q,T,!0)]).then(ae=>ae.map(he=>getCodeForByte(he,p,f)||""))))))}else return[]},k=async()=>{const{name:V,vendorProductId:z}=r,te=V.replace(/[^a-zA-Z0-9]/g,"_").toLowerCase()+".layout.json";try{const R=await window.showSaveFilePicker({suggestedName:te}),H=await I(),N={name:V,vendorProductId:z,macros:[...u],layers:l.map(P=>P.keymap.map(q=>getCodeForByte(q,p,f)||"")),encoders:H};y&&(N.actuation={apEnabled:b,ap:K[m]?K[m].map((P,q)=>P.apData?[q,P.apData.ap,P.apData.dzt,P.apData.dzb]:null).filter(P=>P!==null):[],rt:K[m]?K[m].map((P,q)=>P.rtData?[q,Number(P.rtData.enabled),Number(P.rtData.crtEnabled),P.rtData.rt1,P.rtData.rt2]:null).filter(P=>P!==null):[],dks:x[m]?x[m].flatMap((P,q)=>P===null?null:P.map((ae,he)=>ae===null?null:[q,he,...ae.actuation,...ae.actions.flatMap(Te=>[Te.key,...Te.points.map(Ae=>Ae)])]).filter(ae=>ae!==null)).filter(P=>P!==null):[]});const Q=stringify(N),X=new Blob([Q],{type:"application/json"}),T=await R.createWritable();await T.write(X),await T.close()}catch{console.log("User cancelled save file request")}},j=([V])=>{w(null),F(null);const z=new FileReader;z.onabort=()=>w(e("File reading was cancelled.")),z.onerror=()=>w(e("Failed to read file.")),z.onload=async()=>{const te=JSON.parse(z.result.toString());if(!isViaSaveFile(te)){w(e("Could not load file: invalid data."));return}if(te.vendorProductId!==r.vendorProductId){w(`${e("Could not import layout. This file was created for a different keyboard")}: ${te.name}`);return}if(te.layers.findIndex((H,N)=>H.length!==l[N].keymap.length)>-1){w(e("Could not import layout: incorrect number of keys in one or more layers."));return}if(c.isFeatureSupported&&te.macros){if(te.macros.length!==u.length){w(e("Could not import layout: incorrect number of macros."));return}t(saveMacros(s,te.macros))}y&&te.actuation&&await t(saveConfigToDevice(te.actuation));const R=te.layers.map(H=>H.map(N=>getByteForCode(`${deprecatedKeycodes[N]??N}`,p)));await t(saveRawKeymapToDevice(R,s)),te.encoders&&await Promise.all(te.encoders.map((H,N)=>Promise.all(H.map((Q,X)=>Promise.all([i.setEncoderValue(X,N,!1,getByteForCode(`${deprecatedKeycodes[Q[0]]??Q[0]}`,p)),i.setEncoderValue(X,N,!0,getByteForCode(`${deprecatedKeycodes[Q[1]]??Q[1]}`,p))]))))),F(e("Successfully updated layout!"))},z.readAsBinaryString(V)};return jsx(SpanOverflowCell,{children:jsx(SaveLoadPane,{children:jsxs(Container$g,{children:[jsxs(ControlRow,{children:[jsx(Label$1,{children:e("Save Current Layout")}),jsx(Detail,{children:jsx(AccentButton,{onClick:k,children:e("Save")})})]}),jsxs(ControlRow,{children:[jsx(Label$1,{children:e("Load Saved Layout")}),jsx(Detail,{children:jsx(AccentUploadButton,{onLoad:j,children:e("Load")})})]}),M?jsx(ErrorMessage,{children:M}):null,L?jsx(SuccessMessage,{children:L}):null]})})})},Icon$5=component$1,Title$6=title$4,SaveLoad=Object.freeze(Object.defineProperty({__proto__:null,Icon:Icon$5,Pane:Pane$5,Title:Title$6},Symbol.toStringTag,{value:"Module"})),SvgIcKeyboard24Px=e=>jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",children:[jsx("path",{d:"M0 0h24v24H0z",fill:"none"}),jsx("path",{d:"M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z",fill:"currentColor"})]}),title$3="Layouts",component=SvgIcKeyboard24Px,LayoutControl=e=>{const{t}=useTranslation(),{onChange:r,meta:s}=e,{labels:i,selectedOption:l}=s;if(Array.isArray(i)){const[c,...u]=i,p=u.map((f,m)=>({label:t(f),value:`${m}`}));return jsxs(ControlRow,{children:[jsx(Label$1,{children:t(c)}),jsx(Detail,{children:jsx(AccentSelect,{defaultValue:p[l],options:p,onChange:f=>{f&&r(+f.value)}})})]})}else return jsxs(ControlRow,{children:[jsx(Label$1,{children:t(i)}),jsx(Detail,{children:jsx(AccentSlider,{isChecked:!!l,onChange:c=>r(+c)})})]})},ContainerPane=styled(CenterPane)`
  height: 100%;
  background: var(--color_dark_grey);
`,Container$f=styled.div`
  display: flex;
  align-items: center;
  flex-direction: column;
  padding: 0 12px;
`,Pane$4=()=>{const e=useAppDispatch(),t=useAppSelector(getSelectedDefinition),r=useAppSelector(getSelectedLayoutOptions);if(!t||!r)return null;const{layouts:s}=t,i=s.labels||[];return jsx(SpanOverflowCell,{children:jsx(ContainerPane,{children:jsx(Container$f,{children:i.map((l,c)=>jsx(LayoutControl,{onChange:u=>e(updateLayoutOption(c,u)),meta:{labels:l,selectedOption:r[c]}},c))})})})},Title$5=title$3,Icon$4=component,Layouts$1=Object.freeze(Object.defineProperty({__proto__:null,Icon:Icon$4,Pane:Pane$4,Title:Title$5},Symbol.toStringTag,{value:"Module"})),GET_KEYBOARD_VALUE=2,SET_KEYBOARD_VALUE=3,KB_VALUES={ENABLED_ENCODER_MODES:128,OLED_DEFAULT_MODE:129,ENCODER_CUSTOM:130,OLED_MODE:131},getEncoderModes=async e=>{const t=[KB_VALUES.ENABLED_ENCODER_MODES],[,,r]=await e.hidCommand(GET_KEYBOARD_VALUE,t);return r},setEncoderModes=async(e,t)=>{const r=[KB_VALUES.ENABLED_ENCODER_MODES,t];await e.hidCommand(SET_KEYBOARD_VALUE,r)},getDefaultOLED=async e=>{const t=[KB_VALUES.OLED_DEFAULT_MODE],[,,r]=await e.hidCommand(GET_KEYBOARD_VALUE,t);return r},setDefaultOLED=async(e,t)=>{const r=[KB_VALUES.OLED_DEFAULT_MODE,t];await e.hidCommand(SET_KEYBOARD_VALUE,r)},getOLEDMode=async e=>{const t=[KB_VALUES.OLED_MODE],[,,r]=await e.hidCommand(GET_KEYBOARD_VALUE,t);return r},setOLEDMode=async(e,t)=>{const r=[KB_VALUES.OLED_MODE,t];await e.hidCommand(SET_KEYBOARD_VALUE,r)},getCustomEncoderConfig=async(e,t)=>{const r=[KB_VALUES.ENCODER_CUSTOM,t],s=await e.hidCommand(GET_KEYBOARD_VALUE,r),[,,,i,l,c,u,p,f]=s;return[i<<8|l,c<<8|u,p<<8|f]},setCustomEncoderConfig=async(e,t,r,s)=>{const i=(s&65280)>>8,l=s&255,c=[KB_VALUES.ENCODER_CUSTOM,t,r,i,l];await e.hidCommand(SET_KEYBOARD_VALUE,c)},MODES={ENC_MODE_VOLUME:0,ENC_MODE_MEDIA:1,ENC_MODE_SCROLL:2,ENC_MODE_BRIGHTNESS:3,ENC_MODE_BACKLIGHT:4,ENC_MODE_CUSTOM0:5,ENC_MODE_CUSTOM1:6,ENC_MODE_CUSTOM2:7},MODE_LABELS={ENC_MODE_VOLUME:"Volume",ENC_MODE_MEDIA:"Media",ENC_MODE_SCROLL:"Scroll",ENC_MODE_BRIGHTNESS:"Brightness",ENC_MODE_BACKLIGHT:"Backlight",ENC_MODE_CUSTOM0:"Custom 0",ENC_MODE_CUSTOM1:"Custom 1",ENC_MODE_CUSTOM2:"Custom 2"},CenteredColumnDiv=styled.div`
  display: flex;
  flex-direction: column;
  align-items: center;
`,ColumnDiv=styled.div`
  display: flex;
  flex-direction: column;
`;class EncoderModeToggle extends React.Component{constructor(){super(...arguments);ce(this,"handleInputChange",r=>{const{enabledModes:s,onChange:i}=this.props,{target:{checked:l,name:c}}=r,u=1<<MODES[c],p=l?s|u:s&~u;i(p)});ce(this,"isChecked",r=>(1<<r&this.props.enabledModes)>0)}render(){return jsxs(CenteredColumnDiv,{children:[jsx("h3",{children:"Enabled Encoder Modes:"}),jsx("p",{children:"Only the selected encoder modes will be available on the keyboard"}),jsx(ColumnDiv,{children:Object.entries(MODES).map(([r,s])=>jsxs("label",{htmlFor:MODE_LABELS[r],children:[jsx("input",{name:r,id:MODE_LABELS[r],type:"checkbox",checked:this.isChecked(s),onChange:this.handleInputChange},s),MODE_LABELS[r]]},s))})]})}}const NormalInput=styled.input`
  border: none;
  border-bottom: 1px solid var(--bg_control);
  color: var(--color_accent);
  background: var(--bg_menu);
  transition: all 0.4s ease-out;
  font-size: 18px;
  margin-bottom: 25px;
  height: 30px;
  padding: 0 5px;
  &:focus {
    outline: none;
    color: var(--color_accent);
    border-color: var(--color_accent);
  }
  &::placeholder {
    color: var(--bg_control);
  }
`,ErrorInput=styled(NormalInput)`
  border-color: #d15e5e;
  color: #d15e5e;
`;class KeycodeTextInput extends React.Component{constructor(r){super(r);ce(this,"handleChange",r=>{const s=r.target.value;this.setState({currentValue:s})});ce(this,"handleBlur",r=>{const{onBlur:s,basicKeyToByte:i}=this.props,{lastDefault:l}=this.state,c=r.target.value.trim().toUpperCase(),u=advancedStringToKeycode(c,i);Object.keys(i).includes(c)?(l!==i[c]&&s(i[c]),this.setState({isError:!1})):u!==0?(l!==u&&s(u),this.setState({isError:!1})):new RegExp(/^0x[0-9A-Fa-f]{1,4}$/g).test(r.target.value.trim())?(s(parseInt(r.target.value.trim(),16)),this.setState({isError:!1})):this.setState({isError:!0})});const{defaultValue:s,basicKeyToByte:i,byteToKey:l}=r;let c=anyKeycodeToString(s,i,l);this.state={lastDefault:s,defaultValueAsString:c,currentParsed:s,currentValue:c,isError:!1}}static getDerivedStateFromProps(r,s){return s.lastDefault!==r.defaultValue&&s.currentParsed!==r.defaultValue?{...s,currentValue:anyKeycodeToString(r.defaultValue,r.basicKeyToByte,r.byteToKey),currentParsed:r.defaultValue,lastDefault:r.defaultValue}:s}render(){const{currentValue:r,isError:s}=this.state;return jsx(s?ErrorInput:NormalInput,{type:"text",placeholder:this.props.defaultValue?this.state.defaultValueAsString:"KC_NO, 0xFF, etc.",value:r,onChange:this.handleChange,onBlur:this.handleBlur,className:this.props.className})}}const RowDiv=styled.div`
  display: flex;
  flex-direction: row;
  margin-top: 4px;
`,LabelText$1=styled.span`
  font-weight: 650;
  margin-right: 8px;
  width: 80px;
`,KeyInput=styled(KeycodeTextInput)`
  width: 64px;
  margin-right: 8px;
`,EncoderCustomConfig=e=>{const{encoderIdx:t,onChange:r,title:s,behaviors:[i,l,c]}=e,{basicKeyToByte:u,byteToKey:p}=useAppSelector(getBasicKeyToByte),f=(m,y)=>{r(t,y,m)};return jsxs(RowDiv,{children:[jsx(LabelText$1,{children:s}),jsx(KeyInput,{defaultValue:i,basicKeyToByte:u,byteToKey:p,onBlur:m=>f(m,0)}),jsx(KeyInput,{defaultValue:l,basicKeyToByte:u,byteToKey:p,onBlur:m=>f(m,1)}),jsx(KeyInput,{defaultValue:c,basicKeyToByte:u,byteToKey:p,onBlur:m=>f(m,2)})]})},MenuContainer$2=styled.div`
  display: flex;
  color: #717070;
  padding: 24px;
  font-family: GothamRounded;
  h3 {
    margin: 4px 0;
  }
  p {
    margin: 4px 0 8px 0;
    width: 288px;
    font-size: 13px;
    text-align: center;
  }
`,SectionContainer=styled.div`
  display: flex;
  flex: 1;
  flex-direction: column;
  align-items: center;
`,OLEDSelectContainer=styled.div`
  width: 156px;
  margin-bottom: 12px;
`,CustomEncoderContainer=styled.div`
  padding-left: 112px;
  display: flex;
  flex-direction: row;
`,LabelText=styled.span`
  font-weight: 650;
  margin-right: 8px;
  width: 64px;
`,OLED_OPTIONS=[{value:0,label:"Default"},{value:1,label:"Time"},{value:2,label:"Off"}],SatisfactionMenu=()=>{const e=useAppSelector(getSelectedKeyboardAPI);return e?jsx(BaseSatisfactionMenu,{api:e}):null};class BaseSatisfactionMenu extends reactExports.Component{constructor(){super(...arguments);ce(this,"state",{enabledModes:31,defaultOLEDMode:0,currOLEDMode:0,encoderBehaviors:[[0,0,0],[0,0,0],[0,0,0]]});ce(this,"fetchDataAndSet",async()=>{const{api:r}=this.props,s=[getEncoderModes(r),getDefaultOLED(r),getOLEDMode(r),getCustomEncoderConfig(r,0),getCustomEncoderConfig(r,1),getCustomEncoderConfig(r,2)],[i,l,c,u,p,f]=await Promise.all(s);this.setState({enabledModes:i,defaultOLEDMode:l,currOLEDMode:c,encoderBehaviors:[u,p,f]})});ce(this,"onEncoderModeChange",r=>{const{api:s}=this.props,{enabledModes:i}=this.state;i!==r&&(this.setState({enabledModes:r}),setEncoderModes(s,r))});ce(this,"onEncoderCustomConfigChange",(r,s,i)=>{const{api:l}=this.props,c=[...this.state.encoderBehaviors];c[r][s]=i,this.setState({encoderBehaviors:c}),setCustomEncoderConfig(l,r,s,i)});ce(this,"onOLEDDefaultChange",r=>{const{value:s}=r,{api:i}=this.props,{defaultOLEDMode:l}=this.state;l!==s&&(this.setState({defaultOLEDMode:s}),setDefaultOLED(i,s))});ce(this,"onOLEDChange",r=>{const{value:s}=r,{api:i}=this.props,{currOLEDMode:l}=this.state;l!==s&&(this.setState({currOLEDMode:s}),setOLEDMode(i,s))})}componentDidMount(){this.fetchDataAndSet()}render(){const{api:r}=this.props,{enabledModes:s,defaultOLEDMode:i,currOLEDMode:l,encoderBehaviors:c}=this.state;return r?jsxs(MenuContainer$2,{children:[jsx(SectionContainer,{children:jsx(EncoderModeToggle,{onChange:this.onEncoderModeChange,enabledModes:s})}),jsxs(SectionContainer,{children:[jsx("h3",{children:"Default OLED Mode:"}),jsx("p",{children:"This is the OLED mode that will be selected by default when you plug in your keyboard."}),jsx(OLEDSelectContainer,{children:jsx(Select,{value:OLED_OPTIONS.find(u=>u.value===i),onChange:this.onOLEDDefaultChange,options:OLED_OPTIONS})}),jsx("h3",{children:"Current OLED Mode:"}),jsxs("p",{children:["Change your ","keyboard's"," current OLED mode"]}),jsx(OLEDSelectContainer,{children:jsx(Select,{value:OLED_OPTIONS.find(u=>u.value===l),onChange:this.onOLEDChange,options:OLED_OPTIONS,menuPlacement:"top"})})]}),jsxs(SectionContainer,{children:[jsx("h3",{children:"Custom Encoder Configuration:"}),jsx("p",{children:"Configure the behavior of encoder custom modes"}),jsxs(CustomEncoderContainer,{children:[jsx(LabelText,{children:"CW"}),jsx(LabelText,{children:"CCW"}),jsx(LabelText,{children:"Press"})]}),jsx(EncoderCustomConfig,{title:"Custom 0",encoderIdx:0,behaviors:c[0],onChange:this.onEncoderCustomConfigChange}),jsx(EncoderCustomConfig,{title:"Custom 1",encoderIdx:1,behaviors:c[1],onChange:this.onEncoderCustomConfigChange}),jsx(EncoderCustomConfig,{title:"Custom 2",encoderIdx:2,behaviors:c[2],onChange:this.onEncoderCustomConfigChange})]})]}):null}}const size$1=16.187,SvgIcMemory24Px=e=>jsx("svg",{width:size$1,height:size$1,...e,children:jsx("path",{d:"M10.791 5.4H5.4v5.4h5.4zM8.991 9h-1.8V7.2h1.8zm7.194-1.8V5.4h-1.8V3.6a1.8 1.8 0 00-1.8-1.8h-1.8V0h-1.8v1.8h-1.8V0H5.4v1.8H3.6a1.8 1.8 0 00-1.8 1.8v1.8H0v1.8h1.8V9H0v1.8h1.8v1.8a1.8 1.8 0 001.8 1.8h1.8v1.8h1.8v-1.8H9v1.8h1.8v-1.8h1.8a1.8 1.8 0 001.8-1.8v-1.8h1.8V9h-1.8V7.2zm-3.6 5.4H3.6v-9h8.99z",fill:"currentColor"})}),Pane$3=SatisfactionMenu,Title$4="Custom Features",Icon$3=SvgIcMemory24Px,RotaryEncoder=Object.freeze(Object.defineProperty({__proto__:null,Icon:Icon$3,Pane:Pane$3,Title:Title$4},Symbol.toStringTag,{value:"Module"})),pixleImg=(e,t,r)=>{const s=document.createElement("canvas");s.width=e.width,s.height=e.height;const i=e.width*.2,l=e.height*.2,c=s.getContext("2d");c.drawImage(e,0,0,i,l),c.imageSmoothingEnabled=!1;const u=document.createElement("canvas");u.width=t,u.height=r;const p=u.getContext("2d",{willReadFrequently:!0});p.imageSmoothingEnabled=!1;const f=t/r;let m,y,K,x,b;return b=i/l,b<=f?(K=i,x=K/f,m=0,y=(l-x)/2):(x=l,K=x*f,m=(i-K)/2,y=0),p.drawImage(s,m,y,K,x,0,0,u.width,u.height),Uint8Array.from(p.getImageData(0,0,t,r,{colorSpace:"srgb"}).data)};var createModule=(()=>{var e=import.meta.url;return async function(t={}){var r=t,s,i;r.ready=new Promise((o,n)=>{s=o,i=n}),["_memory","___indirect_function_table","_ff_h264_cabac_tables","___set_stack_limits","onRuntimeInitialized"].forEach(o=>{Object.getOwnPropertyDescriptor(r.ready,o)||Object.defineProperty(r.ready,o,{get:()=>ie("You are getting "+o+" on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js"),set:()=>ie("You are setting "+o+" on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")})});var l=Object.assign({},r),c="./this.program",u=typeof window=="object",p=typeof importScripts=="function",f=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",m=!u&&!f&&!p;if(r.ENVIRONMENT)throw new Error("Module.ENVIRONMENT has been deprecated. To force the environment, use the ENVIRONMENT compile-time option (for example, -sENVIRONMENT=web or -sENVIRONMENT=node)");var y="";function K(o){return r.locateFile?r.locateFile(o,y):y+o}var x,b,M;if(f){if(typeof process>"u"||!process.release||process.release.name!=="node")throw new Error("not compiled for this environment (did you build to HTML and try to run it not on the web, or set ENVIRONMENT to something - like node - and run it someplace else - like on the web?)");var w=process.versions.node,L=w.split(".").slice(0,3);if(L=L[0]*1e4+L[1]*100+L[2].split("-")[0]*1,L<16e4)throw new Error("This emscripten-generated code requires node v16.0.0 (detected v"+w+")");const{createRequire:o}=await __vitePreload(()=>import("./__vite-browser-external-b25bb000.js"),[]);var F=o(import.meta.url),I=F("fs"),k=F("path");p?y=k.dirname(y)+"/":y=F("url").fileURLToPath(new URL("./",self.location)),x=(n,a)=>(n=Pe(n)?new URL(n):k.normalize(n),I.readFileSync(n,a?void 0:"utf8")),M=n=>{var a=x(n,!0);return a.buffer||(a=new Uint8Array(a)),R(a.buffer),a},b=(n,a,d,h=!0)=>{n=Pe(n)?new URL(n):k.normalize(n),I.readFile(n,h?void 0:"utf8",(g,C)=>{g?d(g):a(h?C.buffer:C)})},!r.thisProgram&&process.argv.length>1&&(c=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2)}else if(m){if(typeof process=="object"&&typeof F=="function"||typeof window=="object"||typeof importScripts=="function")throw new Error("not compiled for this environment (did you build to HTML and try to run it not on the web, or set ENVIRONMENT to something - like node - and run it someplace else - like on the web?)");typeof read<"u"&&(x=read),M=o=>{if(typeof readbuffer=="function")return new Uint8Array(readbuffer(o));let n=read(o,"binary");return R(typeof n=="object"),n},b=(o,n,a)=>{setTimeout(()=>n(M(o)))},typeof clearTimeout>"u"&&(globalThis.clearTimeout=o=>{}),typeof setTimeout>"u"&&(globalThis.setTimeout=o=>typeof o=="function"?o():ie()),typeof scriptArgs<"u"&&scriptArgs,typeof print<"u"&&(typeof console>"u"&&(console={}),console.log=print,console.warn=console.error=typeof printErr<"u"?printErr:print)}else if(u||p){if(p?y=self.location.href:typeof document<"u"&&document.currentScript&&(y=document.currentScript.src),e&&(y=e),y.startsWith("blob:")?y="":y=y.substr(0,y.replace(/[?#].*/,"").lastIndexOf("/")+1),!(typeof window=="object"||typeof importScripts=="function"))throw new Error("not compiled for this environment (did you build to HTML and try to run it not on the web, or set ENVIRONMENT to something - like node - and run it someplace else - like on the web?)");x=o=>{var n=new XMLHttpRequest;return n.open("GET",o,!1),n.send(null),n.responseText},p&&(M=o=>{var n=new XMLHttpRequest;return n.open("GET",o,!1),n.responseType="arraybuffer",n.send(null),new Uint8Array(n.response)}),b=(o,n,a)=>{var d=new XMLHttpRequest;d.open("GET",o,!0),d.responseType="arraybuffer",d.onload=()=>{if(d.status==200||d.status==0&&d.response){n(d.response);return}a()},d.onerror=a,d.send(null)}}else throw new Error("environment detection error");var j=r.print||console.log.bind(console),U=r.printErr||console.error.bind(console);Object.assign(r,l),l=null,Ts(),r.arguments&&r.arguments,qe("arguments","arguments_"),r.thisProgram&&(c=r.thisProgram),qe("thisProgram","thisProgram"),r.quit&&r.quit,qe("quit","quit_"),R(typeof r.memoryInitializerPrefixURL>"u","Module.memoryInitializerPrefixURL option was removed, use Module.locateFile instead"),R(typeof r.pthreadMainPrefixURL>"u","Module.pthreadMainPrefixURL option was removed, use Module.locateFile instead"),R(typeof r.cdInitializerPrefixURL>"u","Module.cdInitializerPrefixURL option was removed, use Module.locateFile instead"),R(typeof r.filePackagePrefixURL>"u","Module.filePackagePrefixURL option was removed, use Module.locateFile instead"),R(typeof r.read>"u","Module.read option was removed (modify read_ in JS)"),R(typeof r.readAsync>"u","Module.readAsync option was removed (modify readAsync in JS)"),R(typeof r.readBinary>"u","Module.readBinary option was removed (modify readBinary in JS)"),R(typeof r.setWindowTitle>"u","Module.setWindowTitle option was removed (modify emscripten_set_window_title in JS)"),R(typeof r.TOTAL_MEMORY>"u","Module.TOTAL_MEMORY has been renamed Module.INITIAL_MEMORY"),qe("asm","wasmExports"),qe("read","read_"),qe("readAsync","readAsync"),qe("readBinary","readBinary"),qe("setWindowTitle","setWindowTitle"),R(!m,"shell environment detected but not enabled at build time.  Add `shell` to `-sENVIRONMENT` to enable.");var V;r.wasmBinary&&(V=r.wasmBinary),qe("wasmBinary","wasmBinary"),typeof WebAssembly!="object"&&ie("no native wasm support detected");var z,te=!1;function R(o,n){o||ie("Assertion failed"+(n?": "+n:""))}var H,N,Q,X,T,P,q,ae;function he(){var o=z.buffer;r.HEAP8=H=new Int8Array(o),r.HEAP16=Q=new Int16Array(o),r.HEAPU8=N=new Uint8Array(o),r.HEAPU16=X=new Uint16Array(o),r.HEAP32=T=new Int32Array(o),r.HEAPU32=P=new Uint32Array(o),r.HEAPF32=q=new Float32Array(o),r.HEAPF64=ae=new Float64Array(o)}R(!r.STACK_SIZE,"STACK_SIZE can no longer be set at runtime.  Use -sSTACK_SIZE at link time"),R(typeof Int32Array<"u"&&typeof Float64Array<"u"&&Int32Array.prototype.subarray!=null&&Int32Array.prototype.set!=null,"JS engine does not provide full typed array support"),R(!r.wasmMemory,"Use of `wasmMemory` detected.  Use -sIMPORTED_MEMORY to define wasmMemory externally"),R(!r.INITIAL_MEMORY,"Detected runtime INITIAL_MEMORY setting.  Use -sIMPORTED_MEMORY to define wasmMemory dynamically");function Te(){var o=Lt();R((o&3)==0),o==0&&(o+=4),P[o>>2]=34821223,Y(34821223),P[o+4>>2]=2310721022,Y(2310721022),P[0]=1668509029,Y(1668509029)}function Ae(){if(!te){var o=Lt();o==0&&(o+=4);var n=P[o>>2],a=P[o+4>>2];(n!=34821223||a!=2310721022)&&ie(`Stack overflow! Stack cookie has been overwritten at ${Je(o)}, expected hex dwords 0x89BACDFE and 0x2135467, but received ${Je(a)} ${Je(n)}`),P[0]!=1668509029&&ie("Runtime error: The application has corrupted its heap memory area (address zero)!")}}(function(){var o=new Int16Array(1),n=new Int8Array(o.buffer);if(o[0]=25459,n[0]!==115||n[1]!==99)throw"Runtime error: expected the system to be little-endian! (Run with -sSUPPORT_BIG_ENDIAN to bypass)"})();var $e=[],Ye=[],ot=[],Qe=!1;function Xe(){if(r.preRun)for(typeof r.preRun=="function"&&(r.preRun=[r.preRun]);r.preRun.length;)oe(r.preRun.shift());Jt($e)}function it(){R(!Qe),Qe=!0,Ae(),go(),Ee.root=_.mount(Ee,{},null),!r.noFSInit&&!_.init.initialized&&_.init(),_.ignorePermissions=!1,Jt(Ye)}function ct(){if(Ae(),r.postRun)for(typeof r.postRun=="function"&&(r.postRun=[r.postRun]);r.postRun.length;)we(r.postRun.shift());Jt(ot)}function oe(o){$e.unshift(o)}function ne(o){Ye.unshift(o)}function we(o){ot.unshift(o)}R(Math.imul,"This browser does not support Math.imul(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill"),R(Math.fround,"This browser does not support Math.fround(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill"),R(Math.clz32,"This browser does not support Math.clz32(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill"),R(Math.trunc,"This browser does not support Math.trunc(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill");var Se=0,pe=null,fe=null,De={};function re(o){for(var n=o;;){if(!De[o])return o;o=n+Math.random()}}function ue(o){var n;Se++,(n=r.monitorRunDependencies)==null||n.call(r,Se),o?(R(!De[o]),De[o]=1,pe===null&&typeof setInterval<"u"&&(pe=setInterval(()=>{if(te){clearInterval(pe),pe=null;return}var a=!1;for(var d in De)a||(a=!0,U("still waiting on run dependencies:")),U(`dependency: ${d}`);a&&U("(end of list)")},1e4))):U("warning: run dependency added without ID")}function Ke(o){var a;if(Se--,(a=r.monitorRunDependencies)==null||a.call(r,Se),o?(R(De[o]),delete De[o]):U("warning: run dependency removed without ID"),Se==0&&(pe!==null&&(clearInterval(pe),pe=null),fe)){var n=fe;fe=null,n()}}function ie(o){var a;(a=r.onAbort)==null||a.call(r,o),o="Aborted("+o+")",U(o),te=!0;var n=new WebAssembly.RuntimeError(o);throw i(n),n}var ge="data:application/octet-stream;base64,",je=o=>o.startsWith(ge),Pe=o=>o.startsWith("file://");function _e(o){return(...n)=>{R(Qe,`native function \`${o}\` called before runtime initialization`);var a=rt[o];return R(a,`exported native function \`${o}\` not found`),a(...n)}}var Oe;r.locateFile?(Oe="kbres.wasm",je(Oe)||(Oe=K(Oe))):Oe=new URL("/assets/kbres-20adae5e.wasm",self.location).href;function Fe(o){if(o==Oe&&V)return new Uint8Array(V);if(M)return M(o);throw"both async and sync fetching of the wasm failed"}function nt(o){if(!V&&(u||p)){if(typeof fetch=="function"&&!Pe(o))return fetch(o,{credentials:"same-origin"}).then(n=>{if(!n.ok)throw`failed to load wasm binary file at '${o}'`;return n.arrayBuffer()}).catch(()=>Fe(o));if(b)return new Promise((n,a)=>{b(o,d=>n(new Uint8Array(d)),a)})}return Promise.resolve().then(()=>Fe(o))}function ke(o,n,a){return nt(o).then(d=>WebAssembly.instantiate(d,n)).then(a,d=>{U(`failed to asynchronously prepare wasm: ${d}`),Pe(Oe)&&U(`warning: Loading from a file URI (${Oe}) is not supported in most browsers. See https://emscripten.org/docs/getting_started/FAQ.html#how-do-i-run-a-local-webserver-for-testing-why-does-my-program-stall-in-downloading-or-preparing`),ie(d)})}function St(o,n,a,d){return!o&&typeof WebAssembly.instantiateStreaming=="function"&&!je(n)&&!Pe(n)&&!f&&typeof fetch=="function"?fetch(n,{credentials:"same-origin"}).then(h=>{var g=WebAssembly.instantiateStreaming(h,a);return g.then(d,function(C){return U(`wasm streaming compile failed: ${C}`),U("falling back to ArrayBuffer instantiation"),ke(n,a,d)})}):ke(n,a,d)}function qt(){var o={env:Zr,wasi_snapshot_preview1:Zr};function n(h,g){return rt=h.exports,z=rt.memory,R(z,"memory not found in wasm exports"),he(),Vt=rt.__indirect_function_table,R(Vt,"table not found in wasm exports"),ne(rt.__wasm_call_ctors),Ke("wasm-instantiate"),rt}ue("wasm-instantiate");var a=r;function d(h){R(r===a,"the Module object should not be replaced during async compilation - perhaps the order of HTML elements is wrong?"),a=null,n(h.instance)}if(r.instantiateWasm)try{return r.instantiateWasm(o,n)}catch(h){U(`Module.instantiateWasm callback failed with error: ${h}`),i(h)}return St(V,Oe,o,d).catch(i),{}}var ee,xe;function qe(o,n,a=!0){Object.getOwnPropertyDescriptor(r,o)||Object.defineProperty(r,o,{configurable:!0,get(){let d=a?" (the initial value can be provided on Module, but after startup the value is only looked for on a local variable of that name)":"";ie(`\`Module.${o}\` has been replaced by \`${n}\``+d)}})}function no(o){Object.getOwnPropertyDescriptor(r,o)&&ie(`\`Module.${o}\` was supplied but \`${o}\` not included in INCOMING_MODULE_JS_API`)}function yr(o){return o==="FS_createPath"||o==="FS_createDataFile"||o==="FS_createPreloadedFile"||o==="FS_unlink"||o==="addRunDependency"||o==="FS_createLazyFile"||o==="FS_createDevice"||o==="removeRunDependency"}function Sr(o,n){typeof globalThis<"u"&&Object.defineProperty(globalThis,o,{configurable:!0,get(){Ze(`\`${o}\` is not longer defined by emscripten. ${n}`)}})}Sr("buffer","Please use HEAP8.buffer or wasmMemory.buffer"),Sr("asm","Please use wasmExports instead");function so(o){typeof globalThis<"u"&&!Object.getOwnPropertyDescriptor(globalThis,o)&&Object.defineProperty(globalThis,o,{configurable:!0,get(){var n=`\`${o}\` is a library symbol and not included by default; add it to your library.js __deps or to DEFAULT_LIBRARY_FUNCS_TO_INCLUDE on the command line`,a=o;a.startsWith("_")||(a="$"+o),n+=` (e.g. -sDEFAULT_LIBRARY_FUNCS_TO_INCLUDE='${a}')`,yr(o)&&(n+=". Alternatively, forcing filesystem support (-sFORCE_FILESYSTEM) can export this for you"),Ze(n)}}),xr(o)}function xr(o){Object.getOwnPropertyDescriptor(r,o)||Object.defineProperty(r,o,{configurable:!0,get(){var n=`'${o}' was not exported. add it to EXPORTED_RUNTIME_METHODS (see the Emscripten FAQ)`;yr(o)&&(n+=". Alternatively, forcing filesystem support (-sFORCE_FILESYSTEM) can export this for you"),ie(n)}})}var ao=2**8-1,io=2**16-1,co=2**32-1,lo=2**64-1,uo=-(2**(8-1))+1,po=-(2**(16-1))+1,ho=-(2**(32-1))+1,_o=-(2**(64-1))+1;function Dt(o,n,a,d){R(Number.isInteger(Number(o)),`attempt to write non-integer (${o}) into integer heap`),R(o<=d,`value (${o}) too large to write as ${n}-bit value`),R(o>=a,`value (${o}) too small to write as ${n}-bit value`)}var lt=o=>Dt(o,8,uo,ao),He=o=>Dt(o,16,po,io),Y=o=>Dt(o,32,ho,co),ze=o=>Dt(o,64,_o,lo);function fo(...o){console.warn(...o)}var Jt=o=>{for(;o.length>0;)o.shift()(r)};r.noExitRuntime;var Je=o=>(R(typeof o=="number"),o>>>=0,"0x"+o.toString(16).padStart(8,"0")),go=()=>{var o=Cr(),n=Lt();Is(o,n)},Ze=o=>{Ze.shown||(Ze.shown={}),Ze.shown[o]||(Ze.shown[o]=1,f&&(o="warning: "+o),U(o))},Kr=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0,ht=(o,n,a)=>{for(var d=n+a,h=n;o[h]&&!(h>=d);)++h;if(h-n>16&&o.buffer&&Kr)return Kr.decode(o.subarray(n,h));for(var g="";n<h;){var C=o[n++];if(!(C&128)){g+=String.fromCharCode(C);continue}var S=o[n++]&63;if((C&224)==192){g+=String.fromCharCode((C&31)<<6|S);continue}var v=o[n++]&63;if((C&240)==224?C=(C&15)<<12|S<<6|v:((C&248)!=240&&Ze("Invalid UTF-8 leading byte "+Je(C)+" encountered when deserializing a UTF-8 string in wasm memory to a JS string!"),C=(C&7)<<18|S<<12|v<<6|o[n++]&63),C<65536)g+=String.fromCharCode(C);else{var A=C-65536;g+=String.fromCharCode(55296|A>>10,56320|A&1023)}}return g},We=(o,n)=>(R(typeof o=="number",`UTF8ToString expects a number (got ${typeof o})`),o?ht(N,o,n):""),Co=(o,n,a,d)=>{ie(`Assertion failed: ${We(o)}, at: `+[n?We(n):"unknown filename",a,d?We(d):"unknown function"])};class mo{constructor(n){this.excPtr=n,this.ptr=n-24}set_type(n){P[this.ptr+4>>2]=n}get_type(){return P[this.ptr+4>>2]}set_destructor(n){P[this.ptr+8>>2]=n}get_destructor(){return P[this.ptr+8>>2]}set_caught(n){n=n?1:0,H[this.ptr+12]=n,lt(n)}get_caught(){return H[this.ptr+12]!=0}set_rethrown(n){n=n?1:0,H[this.ptr+13]=n,lt(n)}get_rethrown(){return H[this.ptr+13]!=0}init(n,a){this.set_adjusted_ptr(0),this.set_type(n),this.set_destructor(a)}set_adjusted_ptr(n){P[this.ptr+16>>2]=n}get_adjusted_ptr(){return P[this.ptr+16>>2]}get_exception_ptr(){var n=Rs(this.get_type());if(n)return P[this.excPtr>>2];var a=this.get_adjusted_ptr();return a!==0?a:this.excPtr}}var yo=(o,n,a)=>{var d=new mo(o);d.init(n,a),R(!1,"Exception thrown, but exception catching is not enabled. Compile with -sNO_DISABLE_EXCEPTION_CATCHING or -sEXCEPTION_CATCHING_ALLOWED=[..] to catch.")},So=o=>{var n=Cr(),a=Lt();ie(`stack overflow (Attempt to set SP to ${Je(o)}, with stack limits [${Je(a)} - ${Je(n)}]). If you require more stack space build with -sSTACK_SIZE=<bytes>`)},xo=()=>{if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function")return d=>crypto.getRandomValues(d);if(f)try{var o=F("crypto"),n=o.randomFillSync;if(n)return d=>o.randomFillSync(d);var a=o.randomBytes;return d=>(d.set(a(d.byteLength)),d)}catch{}ie("no cryptographic support found for randomDevice. consider polyfilling it if you want to use something insecure like Math.random(), e.g. put this in a --pre-js: var crypto = { getRandomValues: (array) => { for (var i = 0; i < array.length; i++) array[i] = (Math.random()*256)|0 } };")},br=o=>(br=xo())(o),be={isAbs:o=>o.charAt(0)==="/",splitPath:o=>{var n=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;return n.exec(o).slice(1)},normalizeArray:(o,n)=>{for(var a=0,d=o.length-1;d>=0;d--){var h=o[d];h==="."?o.splice(d,1):h===".."?(o.splice(d,1),a++):a&&(o.splice(d,1),a--)}if(n)for(;a;a--)o.unshift("..");return o},normalize:o=>{var n=be.isAbs(o),a=o.substr(-1)==="/";return o=be.normalizeArray(o.split("/").filter(d=>!!d),!n).join("/"),!o&&!n&&(o="."),o&&a&&(o+="/"),(n?"/":"")+o},dirname:o=>{var n=be.splitPath(o),a=n[0],d=n[1];return!a&&!d?".":(d&&(d=d.substr(0,d.length-1)),a+d)},basename:o=>{if(o==="/")return"/";o=be.normalize(o),o=o.replace(/\/$/,"");var n=o.lastIndexOf("/");return n===-1?o:o.substr(n+1)},join:(...o)=>be.normalize(o.join("/")),join2:(o,n)=>be.normalize(o+"/"+n)},et={resolve:(...o)=>{for(var n="",a=!1,d=o.length-1;d>=-1&&!a;d--){var h=d>=0?o[d]:_.cwd();if(typeof h!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!h)return"";n=h+"/"+n,a=be.isAbs(h)}return n=be.normalizeArray(n.split("/").filter(g=>!!g),!a).join("/"),(a?"/":"")+n||"."},relative:(o,n)=>{o=et.resolve(o).substr(1),n=et.resolve(n).substr(1);function a(A){for(var O=0;O<A.length&&A[O]==="";O++);for(var B=A.length-1;B>=0&&A[B]==="";B--);return O>B?[]:A.slice(O,B-O+1)}for(var d=a(o.split("/")),h=a(n.split("/")),g=Math.min(d.length,h.length),C=g,S=0;S<g;S++)if(d[S]!==h[S]){C=S;break}for(var v=[],S=C;S<d.length;S++)v.push("..");return v=v.concat(h.slice(C)),v.join("/")}},Zt=[],Rt=o=>{for(var n=0,a=0;a<o.length;++a){var d=o.charCodeAt(a);d<=127?n++:d<=2047?n+=2:d>=55296&&d<=57343?(n+=4,++a):n+=3}return n},er=(o,n,a,d)=>{if(R(typeof o=="string",`stringToUTF8Array expects a string (got ${typeof o})`),!(d>0))return 0;for(var h=a,g=a+d-1,C=0;C<o.length;++C){var S=o.charCodeAt(C);if(S>=55296&&S<=57343){var v=o.charCodeAt(++C);S=65536+((S&1023)<<10)|v&1023}if(S<=127){if(a>=g)break;n[a++]=S}else if(S<=2047){if(a+1>=g)break;n[a++]=192|S>>6,n[a++]=128|S&63}else if(S<=65535){if(a+2>=g)break;n[a++]=224|S>>12,n[a++]=128|S>>6&63,n[a++]=128|S&63}else{if(a+3>=g)break;S>1114111&&Ze("Invalid Unicode code point "+Je(S)+" encountered when serializing a JS string to a UTF-8 string in wasm memory! (Valid unicode code points should be in range 0-0x10FFFF)."),n[a++]=240|S>>18,n[a++]=128|S>>12&63,n[a++]=128|S>>6&63,n[a++]=128|S&63}}return n[a]=0,a-h};function It(o,n,a){var d=a>0?a:Rt(o)+1,h=new Array(d),g=er(o,h,0,h.length);return n&&(h.length=g),h}var Ko=()=>{if(!Zt.length){var o=null;if(f){var n=256,a=Buffer.alloc(n),d=0,h=process.stdin.fd;try{d=I.readSync(h,a)}catch(g){if(g.toString().includes("EOF"))d=0;else throw g}d>0?o=a.slice(0,d).toString("utf-8"):o=null}else typeof window<"u"&&typeof window.prompt=="function"?(o=window.prompt("Input: "),o!==null&&(o+=`
`)):typeof readline=="function"&&(o=readline(),o!==null&&(o+=`
`));if(!o)return null;Zt=It(o,!0)}return Zt.shift()},dt={ttys:[],init(){},shutdown(){},register(o,n){dt.ttys[o]={input:[],output:[],ops:n},_.registerDevice(o,dt.stream_ops)},stream_ops:{open(o){var n=dt.ttys[o.node.rdev];if(!n)throw new _.ErrnoError(43);o.tty=n,o.seekable=!1},close(o){o.tty.ops.fsync(o.tty)},fsync(o){o.tty.ops.fsync(o.tty)},read(o,n,a,d,h){if(!o.tty||!o.tty.ops.get_char)throw new _.ErrnoError(60);for(var g=0,C=0;C<d;C++){var S;try{S=o.tty.ops.get_char(o.tty)}catch{throw new _.ErrnoError(29)}if(S===void 0&&g===0)throw new _.ErrnoError(6);if(S==null)break;g++,n[a+C]=S}return g&&(o.node.timestamp=Date.now()),g},write(o,n,a,d,h){if(!o.tty||!o.tty.ops.put_char)throw new _.ErrnoError(60);try{for(var g=0;g<d;g++)o.tty.ops.put_char(o.tty,n[a+g])}catch{throw new _.ErrnoError(29)}return d&&(o.node.timestamp=Date.now()),g}},default_tty_ops:{get_char(o){return Ko()},put_char(o,n){n===null||n===10?(j(ht(o.output,0)),o.output=[]):n!=0&&o.output.push(n)},fsync(o){o.output&&o.output.length>0&&(j(ht(o.output,0)),o.output=[])},ioctl_tcgets(o){return{c_iflag:25856,c_oflag:5,c_cflag:191,c_lflag:35387,c_cc:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},ioctl_tcsets(o,n,a){return 0},ioctl_tiocgwinsz(o){return[24,80]}},default_tty1_ops:{put_char(o,n){n===null||n===10?(U(ht(o.output,0)),o.output=[]):n!=0&&o.output.push(n)},fsync(o){o.output&&o.output.length>0&&(U(ht(o.output,0)),o.output=[])}}},vr=(o,n)=>(N.fill(0,o,o+n),o),wr=o=>{ie("internal error: mmapAlloc called but `emscripten_builtin_memalign` native symbol not exported")},de={ops_table:null,mount(o){return de.createNode(null,"/",16895,0)},createNode(o,n,a,d){if(_.isBlkdev(a)||_.isFIFO(a))throw new _.ErrnoError(63);de.ops_table||(de.ops_table={dir:{node:{getattr:de.node_ops.getattr,setattr:de.node_ops.setattr,lookup:de.node_ops.lookup,mknod:de.node_ops.mknod,rename:de.node_ops.rename,unlink:de.node_ops.unlink,rmdir:de.node_ops.rmdir,readdir:de.node_ops.readdir,symlink:de.node_ops.symlink},stream:{llseek:de.stream_ops.llseek}},file:{node:{getattr:de.node_ops.getattr,setattr:de.node_ops.setattr},stream:{llseek:de.stream_ops.llseek,read:de.stream_ops.read,write:de.stream_ops.write,allocate:de.stream_ops.allocate,mmap:de.stream_ops.mmap,msync:de.stream_ops.msync}},link:{node:{getattr:de.node_ops.getattr,setattr:de.node_ops.setattr,readlink:de.node_ops.readlink},stream:{}},chrdev:{node:{getattr:de.node_ops.getattr,setattr:de.node_ops.setattr},stream:_.chrdev_stream_ops}});var h=_.createNode(o,n,a,d);return _.isDir(h.mode)?(h.node_ops=de.ops_table.dir.node,h.stream_ops=de.ops_table.dir.stream,h.contents={}):_.isFile(h.mode)?(h.node_ops=de.ops_table.file.node,h.stream_ops=de.ops_table.file.stream,h.usedBytes=0,h.contents=null):_.isLink(h.mode)?(h.node_ops=de.ops_table.link.node,h.stream_ops=de.ops_table.link.stream):_.isChrdev(h.mode)&&(h.node_ops=de.ops_table.chrdev.node,h.stream_ops=de.ops_table.chrdev.stream),h.timestamp=Date.now(),o&&(o.contents[n]=h,o.timestamp=h.timestamp),h},getFileDataAsTypedArray(o){return o.contents?o.contents.subarray?o.contents.subarray(0,o.usedBytes):new Uint8Array(o.contents):new Uint8Array(0)},expandFileStorage(o,n){var a=o.contents?o.contents.length:0;if(!(a>=n)){var d=1024*1024;n=Math.max(n,a*(a<d?2:1.125)>>>0),a!=0&&(n=Math.max(n,256));var h=o.contents;o.contents=new Uint8Array(n),o.usedBytes>0&&o.contents.set(h.subarray(0,o.usedBytes),0)}},resizeFileStorage(o,n){if(o.usedBytes!=n)if(n==0)o.contents=null,o.usedBytes=0;else{var a=o.contents;o.contents=new Uint8Array(n),a&&o.contents.set(a.subarray(0,Math.min(n,o.usedBytes))),o.usedBytes=n}},node_ops:{getattr(o){var n={};return n.dev=_.isChrdev(o.mode)?o.id:1,n.ino=o.id,n.mode=o.mode,n.nlink=1,n.uid=0,n.gid=0,n.rdev=o.rdev,_.isDir(o.mode)?n.size=4096:_.isFile(o.mode)?n.size=o.usedBytes:_.isLink(o.mode)?n.size=o.link.length:n.size=0,n.atime=new Date(o.timestamp),n.mtime=new Date(o.timestamp),n.ctime=new Date(o.timestamp),n.blksize=4096,n.blocks=Math.ceil(n.size/n.blksize),n},setattr(o,n){n.mode!==void 0&&(o.mode=n.mode),n.timestamp!==void 0&&(o.timestamp=n.timestamp),n.size!==void 0&&de.resizeFileStorage(o,n.size)},lookup(o,n){throw _.genericErrors[44]},mknod(o,n,a,d){return de.createNode(o,n,a,d)},rename(o,n,a){if(_.isDir(o.mode)){var d;try{d=_.lookupNode(n,a)}catch{}if(d)for(var h in d.contents)throw new _.ErrnoError(55)}delete o.parent.contents[o.name],o.parent.timestamp=Date.now(),o.name=a,n.contents[a]=o,n.timestamp=o.parent.timestamp,o.parent=n},unlink(o,n){delete o.contents[n],o.timestamp=Date.now()},rmdir(o,n){var a=_.lookupNode(o,n);for(var d in a.contents)throw new _.ErrnoError(55);delete o.contents[n],o.timestamp=Date.now()},readdir(o){var n=[".",".."];for(var a of Object.keys(o.contents))n.push(a);return n},symlink(o,n,a){var d=de.createNode(o,n,41471,0);return d.link=a,d},readlink(o){if(!_.isLink(o.mode))throw new _.ErrnoError(28);return o.link}},stream_ops:{read(o,n,a,d,h){var g=o.node.contents;if(h>=o.node.usedBytes)return 0;var C=Math.min(o.node.usedBytes-h,d);if(R(C>=0),C>8&&g.subarray)n.set(g.subarray(h,h+C),a);else for(var S=0;S<C;S++)n[a+S]=g[h+S];return C},write(o,n,a,d,h,g){if(R(!(n instanceof ArrayBuffer)),n.buffer===H.buffer&&(g=!1),!d)return 0;var C=o.node;if(C.timestamp=Date.now(),n.subarray&&(!C.contents||C.contents.subarray)){if(g)return R(h===0,"canOwn must imply no weird position inside the file"),C.contents=n.subarray(a,a+d),C.usedBytes=d,d;if(C.usedBytes===0&&h===0)return C.contents=n.slice(a,a+d),C.usedBytes=d,d;if(h+d<=C.usedBytes)return C.contents.set(n.subarray(a,a+d),h),d}if(de.expandFileStorage(C,h+d),C.contents.subarray&&n.subarray)C.contents.set(n.subarray(a,a+d),h);else for(var S=0;S<d;S++)C.contents[h+S]=n[a+S];return C.usedBytes=Math.max(C.usedBytes,h+d),d},llseek(o,n,a){var d=n;if(a===1?d+=o.position:a===2&&_.isFile(o.node.mode)&&(d+=o.node.usedBytes),d<0)throw new _.ErrnoError(28);return d},allocate(o,n,a){de.expandFileStorage(o.node,n+a),o.node.usedBytes=Math.max(o.node.usedBytes,n+a)},mmap(o,n,a,d,h){if(!_.isFile(o.node.mode))throw new _.ErrnoError(43);var g,C,S=o.node.contents;if(!(h&2)&&S.buffer===H.buffer)C=!1,g=S.byteOffset;else{if((a>0||a+n<S.length)&&(S.subarray?S=S.subarray(a,a+n):S=Array.prototype.slice.call(S,a,a+n)),C=!0,g=wr(),!g)throw new _.ErrnoError(48);H.set(S,g)}return{ptr:g,allocated:C}},msync(o,n,a,d,h){return de.stream_ops.write(o,n,0,d,a,!1),0}}},bo=(o,n,a,d)=>{var h=d?"":re(`al ${o}`);b(o,g=>{R(g,`Loading data file "${o}" failed (no arrayBuffer).`),n(new Uint8Array(g)),h&&Ke(h)},g=>{if(a)a();else throw`Loading data file "${o}" failed.`}),h&&ue(h)},vo=(o,n,a,d,h,g)=>{_.createDataFile(o,n,a,d,h,g)},wo=r.preloadPlugins||[],Eo=(o,n,a,d)=>{typeof Browser<"u"&&Browser.init();var h=!1;return wo.forEach(g=>{h||g.canHandle(n)&&(g.handle(o,n,a,d),h=!0)}),h},Mo=(o,n,a,d,h,g,C,S,v,A)=>{var O=n?et.resolve(be.join2(o,n)):o,B=re(`cp ${O}`);function G(W){function se(ve){A==null||A(),S||vo(o,n,ve,d,h,v),g==null||g(),Ke(B)}Eo(W,O,se,()=>{C==null||C(),Ke(B)})||se(W)}ue(B),typeof a=="string"?bo(a,G,C):G(a)},To=o=>{var n={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090},a=n[o];if(typeof a>"u")throw new Error(`Unknown file open mode: ${o}`);return a},tr=(o,n)=>{var a=0;return o&&(a|=365),n&&(a|=146),a},Le={dbs:{},indexedDB:()=>{if(typeof indexedDB<"u")return indexedDB;var o=null;return typeof window=="object"&&(o=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB),R(o,"IDBFS used, but indexedDB not supported"),o},DB_VERSION:21,DB_STORE_NAME:"FILE_DATA",mount:(...o)=>de.mount(...o),syncfs:(o,n,a)=>{Le.getLocalSet(o,(d,h)=>{if(d)return a(d);Le.getRemoteSet(o,(g,C)=>{if(g)return a(g);var S=n?C:h,v=n?h:C;Le.reconcile(S,v,a)})})},quit:()=>{Object.values(Le.dbs).forEach(o=>o.close()),Le.dbs={}},getDB:(o,n)=>{var a=Le.dbs[o];if(a)return n(null,a);var d;try{d=Le.indexedDB().open(o,Le.DB_VERSION)}catch(h){return n(h)}if(!d)return n("Unable to connect to IndexedDB");d.onupgradeneeded=h=>{var g=h.target.result,C=h.target.transaction,S;g.objectStoreNames.contains(Le.DB_STORE_NAME)?S=C.objectStore(Le.DB_STORE_NAME):S=g.createObjectStore(Le.DB_STORE_NAME),S.indexNames.contains("timestamp")||S.createIndex("timestamp","timestamp",{unique:!1})},d.onsuccess=()=>{a=d.result,Le.dbs[o]=a,n(null,a)},d.onerror=h=>{n(h.target.error),h.preventDefault()}},getLocalSet:(o,n)=>{var a={};function d(v){return v!=="."&&v!==".."}function h(v){return A=>be.join2(v,A)}for(var g=_.readdir(o.mountpoint).filter(d).map(h(o.mountpoint));g.length;){var C=g.pop(),S;try{S=_.stat(C)}catch(v){return n(v)}_.isDir(S.mode)&&g.push(..._.readdir(C).filter(d).map(h(C))),a[C]={timestamp:S.mtime}}return n(null,{type:"local",entries:a})},getRemoteSet:(o,n)=>{var a={};Le.getDB(o.mountpoint,(d,h)=>{if(d)return n(d);try{var g=h.transaction([Le.DB_STORE_NAME],"readonly");g.onerror=v=>{n(v.target.error),v.preventDefault()};var C=g.objectStore(Le.DB_STORE_NAME),S=C.index("timestamp");S.openKeyCursor().onsuccess=v=>{var A=v.target.result;if(!A)return n(null,{type:"remote",db:h,entries:a});a[A.primaryKey]={timestamp:A.key},A.continue()}}catch(v){return n(v)}})},loadLocalEntry:(o,n)=>{var a,d;try{var h=_.lookupPath(o);d=h.node,a=_.stat(o)}catch(g){return n(g)}return _.isDir(a.mode)?n(null,{timestamp:a.mtime,mode:a.mode}):_.isFile(a.mode)?(d.contents=de.getFileDataAsTypedArray(d),n(null,{timestamp:a.mtime,mode:a.mode,contents:d.contents})):n(new Error("node type not supported"))},storeLocalEntry:(o,n,a)=>{try{if(_.isDir(n.mode))_.mkdirTree(o,n.mode);else if(_.isFile(n.mode))_.writeFile(o,n.contents,{canOwn:!0});else return a(new Error("node type not supported"));_.chmod(o,n.mode),_.utime(o,n.timestamp,n.timestamp)}catch(d){return a(d)}a(null)},removeLocalEntry:(o,n)=>{try{var a=_.stat(o);_.isDir(a.mode)?_.rmdir(o):_.isFile(a.mode)&&_.unlink(o)}catch(d){return n(d)}n(null)},loadRemoteEntry:(o,n,a)=>{var d=o.get(n);d.onsuccess=h=>a(null,h.target.result),d.onerror=h=>{a(h.target.error),h.preventDefault()}},storeRemoteEntry:(o,n,a,d)=>{try{var h=o.put(a,n)}catch(g){d(g);return}h.onsuccess=g=>d(),h.onerror=g=>{d(g.target.error),g.preventDefault()}},removeRemoteEntry:(o,n,a)=>{var d=o.delete(n);d.onsuccess=h=>a(),d.onerror=h=>{a(h.target.error),h.preventDefault()}},reconcile:(o,n,a)=>{var d=0,h=[];Object.keys(o.entries).forEach(function(B){var G=o.entries[B],W=n.entries[B];(!W||G.timestamp.getTime()!=W.timestamp.getTime())&&(h.push(B),d++)});var g=[];if(Object.keys(n.entries).forEach(function(B){o.entries[B]||(g.push(B),d++)}),!d)return a(null);var C=!1,S=o.type==="remote"?o.db:n.db,v=S.transaction([Le.DB_STORE_NAME],"readwrite"),A=v.objectStore(Le.DB_STORE_NAME);function O(B){if(B&&!C)return C=!0,a(B)}v.onerror=v.onabort=B=>{O(B.target.error),B.preventDefault()},v.oncomplete=B=>{C||a(null)},h.sort().forEach(B=>{n.type==="local"?Le.loadRemoteEntry(A,B,(G,W)=>{if(G)return O(G);Le.storeLocalEntry(B,W,O)}):Le.loadLocalEntry(B,(G,W)=>{if(G)return O(G);Le.storeRemoteEntry(A,B,W,O)})}),g.sort().reverse().forEach(B=>{n.type==="local"?Le.removeLocalEntry(B,O):Le.removeRemoteEntry(A,B,O)})}},Ao={0:"Success",1:"Arg list too long",2:"Permission denied",3:"Address already in use",4:"Address not available",5:"Address family not supported by protocol family",6:"No more processes",7:"Socket already connected",8:"Bad file number",9:"Trying to read unreadable message",10:"Mount device busy",11:"Operation canceled",12:"No children",13:"Connection aborted",14:"Connection refused",15:"Connection reset by peer",16:"File locking deadlock error",17:"Destination address required",18:"Math arg out of domain of func",19:"Quota exceeded",20:"File exists",21:"Bad address",22:"File too large",23:"Host is unreachable",24:"Identifier removed",25:"Illegal byte sequence",26:"Connection already in progress",27:"Interrupted system call",28:"Invalid argument",29:"I/O error",30:"Socket is already connected",31:"Is a directory",32:"Too many symbolic links",33:"Too many open files",34:"Too many links",35:"Message too long",36:"Multihop attempted",37:"File or path name too long",38:"Network interface is not configured",39:"Connection reset by network",40:"Network is unreachable",41:"Too many open files in system",42:"No buffer space available",43:"No such device",44:"No such file or directory",45:"Exec format error",46:"No record locks available",47:"The link has been severed",48:"Not enough core",49:"No message of desired type",50:"Protocol not available",51:"No space left on device",52:"Function not implemented",53:"Socket is not connected",54:"Not a directory",55:"Directory not empty",56:"State not recoverable",57:"Socket operation on non-socket",59:"Not a typewriter",60:"No such device or address",61:"Value too large for defined data type",62:"Previous owner died",63:"Not super-user",64:"Broken pipe",65:"Protocol error",66:"Unknown protocol",67:"Protocol wrong type for socket",68:"Math result not representable",69:"Read only file system",70:"Illegal seek",71:"No such process",72:"Stale file handle",73:"Connection timed out",74:"Text file busy",75:"Cross-device link",100:"Device not a stream",101:"Bad font file fmt",102:"Invalid slot",103:"Invalid request code",104:"No anode",105:"Block device required",106:"Channel number out of range",107:"Level 3 halted",108:"Level 3 reset",109:"Link number out of range",110:"Protocol driver not attached",111:"No CSI structure available",112:"Level 2 halted",113:"Invalid exchange",114:"Invalid request descriptor",115:"Exchange full",116:"No data (for no delay io)",117:"Timer expired",118:"Out of streams resources",119:"Machine is not on the network",120:"Package not installed",121:"The object is remote",122:"Advertise error",123:"Srmount error",124:"Communication error on send",125:"Cross mount point (not really error)",126:"Given log. name not unique",127:"f.d. invalid for this operation",128:"Remote address changed",129:"Can   access a needed shared lib",130:"Accessing a corrupted shared lib",131:".lib section in a.out corrupted",132:"Attempting to link in too many libs",133:"Attempting to exec a shared library",135:"Streams pipe error",136:"Too many users",137:"Socket type not supported",138:"Not supported",139:"Protocol family not supported",140:"Can't send after socket shutdown",141:"Too many references",142:"Host is down",148:"No medium (in tape drive)",156:"Level 2 not synchronized"},Er={EPERM:63,ENOENT:44,ESRCH:71,EINTR:27,EIO:29,ENXIO:60,E2BIG:1,ENOEXEC:45,EBADF:8,ECHILD:12,EAGAIN:6,EWOULDBLOCK:6,ENOMEM:48,EACCES:2,EFAULT:21,ENOTBLK:105,EBUSY:10,EEXIST:20,EXDEV:75,ENODEV:43,ENOTDIR:54,EISDIR:31,EINVAL:28,ENFILE:41,EMFILE:33,ENOTTY:59,ETXTBSY:74,EFBIG:22,ENOSPC:51,ESPIPE:70,EROFS:69,EMLINK:34,EPIPE:64,EDOM:18,ERANGE:68,ENOMSG:49,EIDRM:24,ECHRNG:106,EL2NSYNC:156,EL3HLT:107,EL3RST:108,ELNRNG:109,EUNATCH:110,ENOCSI:111,EL2HLT:112,EDEADLK:16,ENOLCK:46,EBADE:113,EBADR:114,EXFULL:115,ENOANO:104,EBADRQC:103,EBADSLT:102,EDEADLOCK:16,EBFONT:101,ENOSTR:100,ENODATA:116,ETIME:117,ENOSR:118,ENONET:119,ENOPKG:120,EREMOTE:121,ENOLINK:47,EADV:122,ESRMNT:123,ECOMM:124,EPROTO:65,EMULTIHOP:36,EDOTDOT:125,EBADMSG:9,ENOTUNIQ:126,EBADFD:127,EREMCHG:128,ELIBACC:129,ELIBBAD:130,ELIBSCN:131,ELIBMAX:132,ELIBEXEC:133,ENOSYS:52,ENOTEMPTY:55,ENAMETOOLONG:37,ELOOP:32,EOPNOTSUPP:138,EPFNOSUPPORT:139,ECONNRESET:15,ENOBUFS:42,EAFNOSUPPORT:5,EPROTOTYPE:67,ENOTSOCK:57,ENOPROTOOPT:50,ESHUTDOWN:140,ECONNREFUSED:14,EADDRINUSE:3,ECONNABORTED:13,ENETUNREACH:40,ENETDOWN:38,ETIMEDOUT:73,EHOSTDOWN:142,EHOSTUNREACH:23,EINPROGRESS:26,EALREADY:7,EDESTADDRREQ:17,EMSGSIZE:35,EPROTONOSUPPORT:66,ESOCKTNOSUPPORT:137,EADDRNOTAVAIL:4,ENETRESET:39,EISCONN:30,ENOTCONN:53,ETOOMANYREFS:141,EUSERS:136,EDQUOT:19,ESTALE:72,ENOTSUP:138,ENOMEDIUM:148,EILSEQ:25,EOVERFLOW:61,ECANCELED:11,ENOTRECOVERABLE:56,EOWNERDEAD:62,ESTRPIPE:135},_={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:!1,ignorePermissions:!0,ErrnoError:class extends Error{constructor(o){super(Ao[o]),this.name="ErrnoError",this.errno=o;for(var n in Er)if(Er[n]===o){this.code=n;break}}},genericErrors:{},filesystems:null,syncFSRequests:0,lookupPath(o,n={}){if(o=et.resolve(o),!o)return{path:"",node:null};var a={follow_mount:!0,recurse_count:0};if(n=Object.assign(a,n),n.recurse_count>8)throw new _.ErrnoError(32);for(var d=o.split("/").filter(B=>!!B),h=_.root,g="/",C=0;C<d.length;C++){var S=C===d.length-1;if(S&&n.parent)break;if(h=_.lookupNode(h,d[C]),g=be.join2(g,d[C]),_.isMountpoint(h)&&(!S||S&&n.follow_mount)&&(h=h.mounted.root),!S||n.follow)for(var v=0;_.isLink(h.mode);){var A=_.readlink(g);g=et.resolve(be.dirname(g),A);var O=_.lookupPath(g,{recurse_count:n.recurse_count+1});if(h=O.node,v++>40)throw new _.ErrnoError(32)}}return{path:g,node:h}},getPath(o){for(var n;;){if(_.isRoot(o)){var a=o.mount.mountpoint;return n?a[a.length-1]!=="/"?`${a}/${n}`:a+n:a}n=n?`${o.name}/${n}`:o.name,o=o.parent}},hashName(o,n){for(var a=0,d=0;d<n.length;d++)a=(a<<5)-a+n.charCodeAt(d)|0;return(o+a>>>0)%_.nameTable.length},hashAddNode(o){var n=_.hashName(o.parent.id,o.name);o.name_next=_.nameTable[n],_.nameTable[n]=o},hashRemoveNode(o){var n=_.hashName(o.parent.id,o.name);if(_.nameTable[n]===o)_.nameTable[n]=o.name_next;else for(var a=_.nameTable[n];a;){if(a.name_next===o){a.name_next=o.name_next;break}a=a.name_next}},lookupNode(o,n){var a=_.mayLookup(o);if(a)throw new _.ErrnoError(a);for(var d=_.hashName(o.id,n),h=_.nameTable[d];h;h=h.name_next){var g=h.name;if(h.parent.id===o.id&&g===n)return h}return _.lookup(o,n)},createNode(o,n,a,d){R(typeof o=="object");var h=new _.FSNode(o,n,a,d);return _.hashAddNode(h),h},destroyNode(o){_.hashRemoveNode(o)},isRoot(o){return o===o.parent},isMountpoint(o){return!!o.mounted},isFile(o){return(o&61440)===32768},isDir(o){return(o&61440)===16384},isLink(o){return(o&61440)===40960},isChrdev(o){return(o&61440)===8192},isBlkdev(o){return(o&61440)===24576},isFIFO(o){return(o&61440)===4096},isSocket(o){return(o&49152)===49152},flagsToPermissionString(o){var n=["r","w","rw"][o&3];return o&512&&(n+="w"),n},nodePermissions(o,n){return _.ignorePermissions?0:n.includes("r")&&!(o.mode&292)||n.includes("w")&&!(o.mode&146)||n.includes("x")&&!(o.mode&73)?2:0},mayLookup(o){if(!_.isDir(o.mode))return 54;var n=_.nodePermissions(o,"x");return n||(o.node_ops.lookup?0:2)},mayCreate(o,n){try{var a=_.lookupNode(o,n);return 20}catch{}return _.nodePermissions(o,"wx")},mayDelete(o,n,a){var d;try{d=_.lookupNode(o,n)}catch(g){return g.errno}var h=_.nodePermissions(o,"wx");if(h)return h;if(a){if(!_.isDir(d.mode))return 54;if(_.isRoot(d)||_.getPath(d)===_.cwd())return 10}else if(_.isDir(d.mode))return 31;return 0},mayOpen(o,n){return o?_.isLink(o.mode)?32:_.isDir(o.mode)&&(_.flagsToPermissionString(n)!=="r"||n&512)?31:_.nodePermissions(o,_.flagsToPermissionString(n)):44},MAX_OPEN_FDS:4096,nextfd(){for(var o=0;o<=_.MAX_OPEN_FDS;o++)if(!_.streams[o])return o;throw new _.ErrnoError(33)},getStreamChecked(o){var n=_.getStream(o);if(!n)throw new _.ErrnoError(8);return n},getStream:o=>_.streams[o],createStream(o,n=-1){return _.FSStream||(_.FSStream=function(){this.shared={}},_.FSStream.prototype={},Object.defineProperties(_.FSStream.prototype,{object:{get(){return this.node},set(a){this.node=a}},isRead:{get(){return(this.flags&2097155)!==1}},isWrite:{get(){return(this.flags&2097155)!==0}},isAppend:{get(){return this.flags&1024}},flags:{get(){return this.shared.flags},set(a){this.shared.flags=a}},position:{get(){return this.shared.position},set(a){this.shared.position=a}}})),o=Object.assign(new _.FSStream,o),n==-1&&(n=_.nextfd()),o.fd=n,_.streams[n]=o,o},closeStream(o){_.streams[o]=null},chrdev_stream_ops:{open(o){var a,d;var n=_.getDevice(o.node.rdev);o.stream_ops=n.stream_ops,(d=(a=o.stream_ops).open)==null||d.call(a,o)},llseek(){throw new _.ErrnoError(70)}},major:o=>o>>8,minor:o=>o&255,makedev:(o,n)=>o<<8|n,registerDevice(o,n){_.devices[o]={stream_ops:n}},getDevice:o=>_.devices[o],getMounts(o){for(var n=[],a=[o];a.length;){var d=a.pop();n.push(d),a.push(...d.mounts)}return n},syncfs(o,n){typeof o=="function"&&(n=o,o=!1),_.syncFSRequests++,_.syncFSRequests>1&&U(`warning: ${_.syncFSRequests} FS.syncfs operations in flight at once, probably just doing extra work`);var a=_.getMounts(_.root.mount),d=0;function h(C){return R(_.syncFSRequests>0),_.syncFSRequests--,n(C)}function g(C){if(C)return g.errored?void 0:(g.errored=!0,h(C));++d>=a.length&&h(null)}a.forEach(C=>{if(!C.type.syncfs)return g(null);C.type.syncfs(C,o,g)})},mount(o,n,a){if(typeof o=="string")throw o;var d=a==="/",h=!a,g;if(d&&_.root)throw new _.ErrnoError(10);if(!d&&!h){var C=_.lookupPath(a,{follow_mount:!1});if(a=C.path,g=C.node,_.isMountpoint(g))throw new _.ErrnoError(10);if(!_.isDir(g.mode))throw new _.ErrnoError(54)}var S={type:o,opts:n,mountpoint:a,mounts:[]},v=o.mount(S);return v.mount=S,S.root=v,d?_.root=v:g&&(g.mounted=S,g.mount&&g.mount.mounts.push(S)),v},unmount(o){var n=_.lookupPath(o,{follow_mount:!1});if(!_.isMountpoint(n.node))throw new _.ErrnoError(28);var a=n.node,d=a.mounted,h=_.getMounts(d);Object.keys(_.nameTable).forEach(C=>{for(var S=_.nameTable[C];S;){var v=S.name_next;h.includes(S.mount)&&_.destroyNode(S),S=v}}),a.mounted=null;var g=a.mount.mounts.indexOf(d);R(g!==-1),a.mount.mounts.splice(g,1)},lookup(o,n){return o.node_ops.lookup(o,n)},mknod(o,n,a){var d=_.lookupPath(o,{parent:!0}),h=d.node,g=be.basename(o);if(!g||g==="."||g==="..")throw new _.ErrnoError(28);var C=_.mayCreate(h,g);if(C)throw new _.ErrnoError(C);if(!h.node_ops.mknod)throw new _.ErrnoError(63);return h.node_ops.mknod(h,g,n,a)},create(o,n){return n=n!==void 0?n:438,n&=4095,n|=32768,_.mknod(o,n,0)},mkdir(o,n){return n=n!==void 0?n:511,n&=1023,n|=16384,_.mknod(o,n,0)},mkdirTree(o,n){for(var a=o.split("/"),d="",h=0;h<a.length;++h)if(a[h]){d+="/"+a[h];try{_.mkdir(d,n)}catch(g){if(g.errno!=20)throw g}}},mkdev(o,n,a){return typeof a>"u"&&(a=n,n=438),n|=8192,_.mknod(o,n,a)},symlink(o,n){if(!et.resolve(o))throw new _.ErrnoError(44);var a=_.lookupPath(n,{parent:!0}),d=a.node;if(!d)throw new _.ErrnoError(44);var h=be.basename(n),g=_.mayCreate(d,h);if(g)throw new _.ErrnoError(g);if(!d.node_ops.symlink)throw new _.ErrnoError(63);return d.node_ops.symlink(d,h,o)},rename(o,n){var a=be.dirname(o),d=be.dirname(n),h=be.basename(o),g=be.basename(n),C,S,v;if(C=_.lookupPath(o,{parent:!0}),S=C.node,C=_.lookupPath(n,{parent:!0}),v=C.node,!S||!v)throw new _.ErrnoError(44);if(S.mount!==v.mount)throw new _.ErrnoError(75);var A=_.lookupNode(S,h),O=et.relative(o,d);if(O.charAt(0)!==".")throw new _.ErrnoError(28);if(O=et.relative(n,a),O.charAt(0)!==".")throw new _.ErrnoError(55);var B;try{B=_.lookupNode(v,g)}catch{}if(A!==B){var G=_.isDir(A.mode),W=_.mayDelete(S,h,G);if(W)throw new _.ErrnoError(W);if(W=B?_.mayDelete(v,g,G):_.mayCreate(v,g),W)throw new _.ErrnoError(W);if(!S.node_ops.rename)throw new _.ErrnoError(63);if(_.isMountpoint(A)||B&&_.isMountpoint(B))throw new _.ErrnoError(10);if(v!==S&&(W=_.nodePermissions(S,"w"),W))throw new _.ErrnoError(W);_.hashRemoveNode(A);try{S.node_ops.rename(A,v,g)}catch(se){throw se}finally{_.hashAddNode(A)}}},rmdir(o){var n=_.lookupPath(o,{parent:!0}),a=n.node,d=be.basename(o),h=_.lookupNode(a,d),g=_.mayDelete(a,d,!0);if(g)throw new _.ErrnoError(g);if(!a.node_ops.rmdir)throw new _.ErrnoError(63);if(_.isMountpoint(h))throw new _.ErrnoError(10);a.node_ops.rmdir(a,d),_.destroyNode(h)},readdir(o){var n=_.lookupPath(o,{follow:!0}),a=n.node;if(!a.node_ops.readdir)throw new _.ErrnoError(54);return a.node_ops.readdir(a)},unlink(o){var n=_.lookupPath(o,{parent:!0}),a=n.node;if(!a)throw new _.ErrnoError(44);var d=be.basename(o),h=_.lookupNode(a,d),g=_.mayDelete(a,d,!1);if(g)throw new _.ErrnoError(g);if(!a.node_ops.unlink)throw new _.ErrnoError(63);if(_.isMountpoint(h))throw new _.ErrnoError(10);a.node_ops.unlink(a,d),_.destroyNode(h)},readlink(o){var n=_.lookupPath(o),a=n.node;if(!a)throw new _.ErrnoError(44);if(!a.node_ops.readlink)throw new _.ErrnoError(28);return et.resolve(_.getPath(a.parent),a.node_ops.readlink(a))},stat(o,n){var a=_.lookupPath(o,{follow:!n}),d=a.node;if(!d)throw new _.ErrnoError(44);if(!d.node_ops.getattr)throw new _.ErrnoError(63);return d.node_ops.getattr(d)},lstat(o){return _.stat(o,!0)},chmod(o,n,a){var d;if(typeof o=="string"){var h=_.lookupPath(o,{follow:!a});d=h.node}else d=o;if(!d.node_ops.setattr)throw new _.ErrnoError(63);d.node_ops.setattr(d,{mode:n&4095|d.mode&-4096,timestamp:Date.now()})},lchmod(o,n){_.chmod(o,n,!0)},fchmod(o,n){var a=_.getStreamChecked(o);_.chmod(a.node,n)},chown(o,n,a,d){var h;if(typeof o=="string"){var g=_.lookupPath(o,{follow:!d});h=g.node}else h=o;if(!h.node_ops.setattr)throw new _.ErrnoError(63);h.node_ops.setattr(h,{timestamp:Date.now()})},lchown(o,n,a){_.chown(o,n,a,!0)},fchown(o,n,a){var d=_.getStreamChecked(o);_.chown(d.node,n,a)},truncate(o,n){if(n<0)throw new _.ErrnoError(28);var a;if(typeof o=="string"){var d=_.lookupPath(o,{follow:!0});a=d.node}else a=o;if(!a.node_ops.setattr)throw new _.ErrnoError(63);if(_.isDir(a.mode))throw new _.ErrnoError(31);if(!_.isFile(a.mode))throw new _.ErrnoError(28);var h=_.nodePermissions(a,"w");if(h)throw new _.ErrnoError(h);a.node_ops.setattr(a,{size:n,timestamp:Date.now()})},ftruncate(o,n){var a=_.getStreamChecked(o);if(!(a.flags&2097155))throw new _.ErrnoError(28);_.truncate(a.node,n)},utime(o,n,a){var d=_.lookupPath(o,{follow:!0}),h=d.node;h.node_ops.setattr(h,{timestamp:Math.max(n,a)})},open(o,n,a){if(o==="")throw new _.ErrnoError(44);n=typeof n=="string"?To(n):n,a=typeof a>"u"?438:a,n&64?a=a&4095|32768:a=0;var d;if(typeof o=="object")d=o;else{o=be.normalize(o);try{var h=_.lookupPath(o,{follow:!(n&131072)});d=h.node}catch{}}var g=!1;if(n&64)if(d){if(n&128)throw new _.ErrnoError(20)}else d=_.mknod(o,a,0),g=!0;if(!d)throw new _.ErrnoError(44);if(_.isChrdev(d.mode)&&(n&=-513),n&65536&&!_.isDir(d.mode))throw new _.ErrnoError(54);if(!g){var C=_.mayOpen(d,n);if(C)throw new _.ErrnoError(C)}n&512&&!g&&_.truncate(d,0),n&=-131713;var S=_.createStream({node:d,path:_.getPath(d),flags:n,seekable:!0,position:0,stream_ops:d.stream_ops,ungotten:[],error:!1});return S.stream_ops.open&&S.stream_ops.open(S),r.logReadFiles&&!(n&1)&&(_.readFiles||(_.readFiles={}),o in _.readFiles||(_.readFiles[o]=1)),S},close(o){if(_.isClosed(o))throw new _.ErrnoError(8);o.getdents&&(o.getdents=null);try{o.stream_ops.close&&o.stream_ops.close(o)}catch(n){throw n}finally{_.closeStream(o.fd)}o.fd=null},isClosed(o){return o.fd===null},llseek(o,n,a){if(_.isClosed(o))throw new _.ErrnoError(8);if(!o.seekable||!o.stream_ops.llseek)throw new _.ErrnoError(70);if(a!=0&&a!=1&&a!=2)throw new _.ErrnoError(28);return o.position=o.stream_ops.llseek(o,n,a),o.ungotten=[],o.position},read(o,n,a,d,h){if(R(a>=0),d<0||h<0)throw new _.ErrnoError(28);if(_.isClosed(o))throw new _.ErrnoError(8);if((o.flags&2097155)===1)throw new _.ErrnoError(8);if(_.isDir(o.node.mode))throw new _.ErrnoError(31);if(!o.stream_ops.read)throw new _.ErrnoError(28);var g=typeof h<"u";if(!g)h=o.position;else if(!o.seekable)throw new _.ErrnoError(70);var C=o.stream_ops.read(o,n,a,d,h);return g||(o.position+=C),C},write(o,n,a,d,h,g){if(R(a>=0),d<0||h<0)throw new _.ErrnoError(28);if(_.isClosed(o))throw new _.ErrnoError(8);if(!(o.flags&2097155))throw new _.ErrnoError(8);if(_.isDir(o.node.mode))throw new _.ErrnoError(31);if(!o.stream_ops.write)throw new _.ErrnoError(28);o.seekable&&o.flags&1024&&_.llseek(o,0,2);var C=typeof h<"u";if(!C)h=o.position;else if(!o.seekable)throw new _.ErrnoError(70);var S=o.stream_ops.write(o,n,a,d,h,g);return C||(o.position+=S),S},allocate(o,n,a){if(_.isClosed(o))throw new _.ErrnoError(8);if(n<0||a<=0)throw new _.ErrnoError(28);if(!(o.flags&2097155))throw new _.ErrnoError(8);if(!_.isFile(o.node.mode)&&!_.isDir(o.node.mode))throw new _.ErrnoError(43);if(!o.stream_ops.allocate)throw new _.ErrnoError(138);o.stream_ops.allocate(o,n,a)},mmap(o,n,a,d,h){if(d&2&&!(h&2)&&(o.flags&2097155)!==2)throw new _.ErrnoError(2);if((o.flags&2097155)===1)throw new _.ErrnoError(2);if(!o.stream_ops.mmap)throw new _.ErrnoError(43);return o.stream_ops.mmap(o,n,a,d,h)},msync(o,n,a,d,h){return R(a>=0),o.stream_ops.msync?o.stream_ops.msync(o,n,a,d,h):0},munmap:o=>0,ioctl(o,n,a){if(!o.stream_ops.ioctl)throw new _.ErrnoError(59);return o.stream_ops.ioctl(o,n,a)},readFile(o,n={}){if(n.flags=n.flags||0,n.encoding=n.encoding||"binary",n.encoding!=="utf8"&&n.encoding!=="binary")throw new Error(`Invalid encoding type "${n.encoding}"`);var a,d=_.open(o,n.flags),h=_.stat(o),g=h.size,C=new Uint8Array(g);return _.read(d,C,0,g,0),n.encoding==="utf8"?a=ht(C,0):n.encoding==="binary"&&(a=C),_.close(d),a},writeFile(o,n,a={}){a.flags=a.flags||577;var d=_.open(o,a.flags,a.mode);if(typeof n=="string"){var h=new Uint8Array(Rt(n)+1),g=er(n,h,0,h.length);_.write(d,h,0,g,void 0,a.canOwn)}else if(ArrayBuffer.isView(n))_.write(d,n,0,n.byteLength,void 0,a.canOwn);else throw new Error("Unsupported data type");_.close(d)},cwd:()=>_.currentPath,chdir(o){var n=_.lookupPath(o,{follow:!0});if(n.node===null)throw new _.ErrnoError(44);if(!_.isDir(n.node.mode))throw new _.ErrnoError(54);var a=_.nodePermissions(n.node,"x");if(a)throw new _.ErrnoError(a);_.currentPath=n.path},createDefaultDirectories(){_.mkdir("/tmp"),_.mkdir("/home"),_.mkdir("/home/web_user")},createDefaultDevices(){_.mkdir("/dev"),_.registerDevice(_.makedev(1,3),{read:()=>0,write:(d,h,g,C,S)=>C}),_.mkdev("/dev/null",_.makedev(1,3)),dt.register(_.makedev(5,0),dt.default_tty_ops),dt.register(_.makedev(6,0),dt.default_tty1_ops),_.mkdev("/dev/tty",_.makedev(5,0)),_.mkdev("/dev/tty1",_.makedev(6,0));var o=new Uint8Array(1024),n=0,a=()=>(n===0&&(n=br(o).byteLength),o[--n]);_.createDevice("/dev","random",a),_.createDevice("/dev","urandom",a),_.mkdir("/dev/shm"),_.mkdir("/dev/shm/tmp")},createSpecialDirectories(){_.mkdir("/proc");var o=_.mkdir("/proc/self");_.mkdir("/proc/self/fd"),_.mount({mount(){var n=_.createNode(o,"fd",16895,73);return n.node_ops={lookup(a,d){var h=+d,g=_.getStreamChecked(h),C={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:()=>g.path}};return C.parent=C,C}},n}},{},"/proc/self/fd")},createStandardStreams(){r.stdin?_.createDevice("/dev","stdin",r.stdin):_.symlink("/dev/tty","/dev/stdin"),r.stdout?_.createDevice("/dev","stdout",null,r.stdout):_.symlink("/dev/tty","/dev/stdout"),r.stderr?_.createDevice("/dev","stderr",null,r.stderr):_.symlink("/dev/tty1","/dev/stderr");var o=_.open("/dev/stdin",0),n=_.open("/dev/stdout",1),a=_.open("/dev/stderr",1);R(o.fd===0,`invalid handle for stdin (${o.fd})`),R(n.fd===1,`invalid handle for stdout (${n.fd})`),R(a.fd===2,`invalid handle for stderr (${a.fd})`)},staticInit(){[44].forEach(o=>{_.genericErrors[o]=new _.ErrnoError(o),_.genericErrors[o].stack="<generic error, no stack>"}),_.nameTable=new Array(4096),_.mount(de,{},"/"),_.createDefaultDirectories(),_.createDefaultDevices(),_.createSpecialDirectories(),_.filesystems={MEMFS:de,IDBFS:Le}},init(o,n,a){R(!_.init.initialized,"FS.init was previously called. If you want to initialize later with custom parameters, remove any earlier calls (note that one is automatically added to the generated code)"),_.init.initialized=!0,r.stdin=o||r.stdin,r.stdout=n||r.stdout,r.stderr=a||r.stderr,_.createStandardStreams()},quit(){_.init.initialized=!1,As(0);for(var o=0;o<_.streams.length;o++){var n=_.streams[o];n&&_.close(n)}},findObject(o,n){var a=_.analyzePath(o,n);return a.exists?a.object:null},analyzePath(o,n){try{var a=_.lookupPath(o,{follow:!n});o=a.path}catch{}var d={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var a=_.lookupPath(o,{parent:!0});d.parentExists=!0,d.parentPath=a.path,d.parentObject=a.node,d.name=be.basename(o),a=_.lookupPath(o,{follow:!n}),d.exists=!0,d.path=a.path,d.object=a.node,d.name=a.node.name,d.isRoot=a.path==="/"}catch(h){d.error=h.errno}return d},createPath(o,n,a,d){o=typeof o=="string"?o:_.getPath(o);for(var h=n.split("/").reverse();h.length;){var g=h.pop();if(g){var C=be.join2(o,g);try{_.mkdir(C)}catch{}o=C}}return C},createFile(o,n,a,d,h){var g=be.join2(typeof o=="string"?o:_.getPath(o),n),C=tr(d,h);return _.create(g,C)},createDataFile(o,n,a,d,h,g){var C=n;o&&(o=typeof o=="string"?o:_.getPath(o),C=n?be.join2(o,n):o);var S=tr(d,h),v=_.create(C,S);if(a){if(typeof a=="string"){for(var A=new Array(a.length),O=0,B=a.length;O<B;++O)A[O]=a.charCodeAt(O);a=A}_.chmod(v,S|146);var G=_.open(v,577);_.write(G,a,0,a.length,0,g),_.close(G),_.chmod(v,S)}},createDevice(o,n,a,d){var h=be.join2(typeof o=="string"?o:_.getPath(o),n),g=tr(!!a,!!d);_.createDevice.major||(_.createDevice.major=64);var C=_.makedev(_.createDevice.major++,0);return _.registerDevice(C,{open(S){S.seekable=!1},close(S){var v;(v=d==null?void 0:d.buffer)!=null&&v.length&&d(10)},read(S,v,A,O,B){for(var G=0,W=0;W<O;W++){var se;try{se=a()}catch{throw new _.ErrnoError(29)}if(se===void 0&&G===0)throw new _.ErrnoError(6);if(se==null)break;G++,v[A+W]=se}return G&&(S.node.timestamp=Date.now()),G},write(S,v,A,O,B){for(var G=0;G<O;G++)try{d(v[A+G])}catch{throw new _.ErrnoError(29)}return O&&(S.node.timestamp=Date.now()),G}}),_.mkdev(h,g,C)},forceLoadFile(o){if(o.isDevice||o.isFolder||o.link||o.contents)return!0;if(typeof XMLHttpRequest<"u")throw new Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");if(x)try{o.contents=It(x(o.url),!0),o.usedBytes=o.contents.length}catch{throw new _.ErrnoError(29)}else throw new Error("Cannot load without read() or XMLHttpRequest.")},createLazyFile(o,n,a,d,h){function g(){this.lengthKnown=!1,this.chunks=[]}if(g.prototype.get=function(W){if(!(W>this.length-1||W<0)){var se=W%this.chunkSize,ve=W/this.chunkSize|0;return this.getter(ve)[se]}},g.prototype.setDataGetter=function(W){this.getter=W},g.prototype.cacheLength=function(){var W=new XMLHttpRequest;if(W.open("HEAD",a,!1),W.send(null),!(W.status>=200&&W.status<300||W.status===304))throw new Error("Couldn't load "+a+". Status: "+W.status);var se=Number(W.getResponseHeader("Content-length")),ve,Me=(ve=W.getResponseHeader("Accept-Ranges"))&&ve==="bytes",Re=(ve=W.getResponseHeader("Content-Encoding"))&&ve==="gzip",$=1024*1024;Me||($=se);var Z=(ye,Be)=>{if(ye>Be)throw new Error("invalid range ("+ye+", "+Be+") or no bytes requested!");if(Be>se-1)throw new Error("only "+se+" bytes available! programmer error!");var Ie=new XMLHttpRequest;if(Ie.open("GET",a,!1),se!==$&&Ie.setRequestHeader("Range","bytes="+ye+"-"+Be),Ie.responseType="arraybuffer",Ie.overrideMimeType&&Ie.overrideMimeType("text/plain; charset=x-user-defined"),Ie.send(null),!(Ie.status>=200&&Ie.status<300||Ie.status===304))throw new Error("Couldn't load "+a+". Status: "+Ie.status);return Ie.response!==void 0?new Uint8Array(Ie.response||[]):It(Ie.responseText||"",!0)},me=this;me.setDataGetter(ye=>{var Be=ye*$,Ie=(ye+1)*$-1;if(Ie=Math.min(Ie,se-1),typeof me.chunks[ye]>"u"&&(me.chunks[ye]=Z(Be,Ie)),typeof me.chunks[ye]>"u")throw new Error("doXHR failed!");return me.chunks[ye]}),(Re||!se)&&($=se=1,se=this.getter(0).length,$=se,j("LazyFiles on gzip forces download of the whole file when length is accessed")),this._length=se,this._chunkSize=$,this.lengthKnown=!0},typeof XMLHttpRequest<"u"){if(!p)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var C=new g;Object.defineProperties(C,{length:{get:function(){return this.lengthKnown||this.cacheLength(),this._length}},chunkSize:{get:function(){return this.lengthKnown||this.cacheLength(),this._chunkSize}}});var S={isDevice:!1,contents:C}}else var S={isDevice:!1,url:a};var v=_.createFile(o,n,S,d,h);S.contents?v.contents=S.contents:S.url&&(v.contents=null,v.url=S.url),Object.defineProperties(v,{usedBytes:{get:function(){return this.contents.length}}});var A={},O=Object.keys(v.stream_ops);O.forEach(G=>{var W=v.stream_ops[G];A[G]=(...se)=>(_.forceLoadFile(v),W(...se))});function B(G,W,se,ve,Me){var Re=G.node.contents;if(Me>=Re.length)return 0;var $=Math.min(Re.length-Me,ve);if(R($>=0),Re.slice)for(var Z=0;Z<$;Z++)W[se+Z]=Re[Me+Z];else for(var Z=0;Z<$;Z++)W[se+Z]=Re.get(Me+Z);return $}return A.read=(G,W,se,ve,Me)=>(_.forceLoadFile(v),B(G,W,se,ve,Me)),A.mmap=(G,W,se,ve,Me)=>{_.forceLoadFile(v);var Re=wr();if(!Re)throw new _.ErrnoError(48);return B(G,H,Re,W,se),{ptr:Re,allocated:!0}},v.stream_ops=A,v},absolutePath(){ie("FS.absolutePath has been removed; use PATH_FS.resolve instead")},createFolder(){ie("FS.createFolder has been removed; use FS.mkdir instead")},createLink(){ie("FS.createLink has been removed; use FS.symlink instead")},joinPath(){ie("FS.joinPath has been removed; use PATH.join instead")},mmapAlloc(){ie("FS.mmapAlloc has been replaced by the top level function mmapAlloc")},standardizePath(){ie("FS.standardizePath has been removed; use PATH.normalize instead")}},Ee={mount(o){return r.websocket=r.websocket&&typeof r.websocket=="object"?r.websocket:{},r.websocket._callbacks={},r.websocket.on=function(n,a){return typeof a=="function"&&(this._callbacks[n]=a),this},r.websocket.emit=function(n,a){typeof this._callbacks[n]=="function"&&this._callbacks[n].call(this,a)},_.createNode(null,"/",16895,0)},createSocket(o,n,a){n&=-526337;var d=n==1;if(d&&a&&a!=6)throw new _.ErrnoError(66);var h={family:o,type:n,protocol:a,server:null,error:null,peers:{},pending:[],recv_queue:[],sock_ops:Ee.websocket_sock_ops},g=Ee.nextname(),C=_.createNode(Ee.root,g,49152,0);C.sock=h;var S=_.createStream({path:g,node:C,flags:2,seekable:!1,stream_ops:Ee.stream_ops});return h.stream=S,h},getSocket(o){var n=_.getStream(o);return!n||!_.isSocket(n.node.mode)?null:n.node.sock},stream_ops:{poll(o){var n=o.node.sock;return n.sock_ops.poll(n)},ioctl(o,n,a){var d=o.node.sock;return d.sock_ops.ioctl(d,n,a)},read(o,n,a,d,h){var g=o.node.sock,C=g.sock_ops.recvmsg(g,d);return C?(n.set(C.buffer,a),C.buffer.length):0},write(o,n,a,d,h){var g=o.node.sock;return g.sock_ops.sendmsg(g,n,a,d)},close(o){var n=o.node.sock;n.sock_ops.close(n)}},nextname(){return Ee.nextname.current||(Ee.nextname.current=0),"socket["+Ee.nextname.current+++"]"},websocket_sock_ops:{createPeer(o,n,a){var d;if(typeof n=="object"&&(d=n,n=null,a=null),d)if(d._socket)n=d._socket.remoteAddress,a=d._socket.remotePort;else{var h=/ws[s]?:\/\/([^:]+):(\d+)/.exec(d.url);if(!h)throw new Error("WebSocket URL must be in the format ws(s)://address:port");n=h[1],a=parseInt(h[2],10)}else try{var g=r.websocket&&typeof r.websocket=="object",C="ws:#".replace("#","//");if(g&&typeof r.websocket.url=="string"&&(C=r.websocket.url),C==="ws://"||C==="wss://"){var S=n.split("/");C=C+S[0]+":"+a+"/"+S.slice(1).join("/")}var v="binary";g&&typeof r.websocket.subprotocol=="string"&&(v=r.websocket.subprotocol);var A=void 0;v!=="null"&&(v=v.replace(/^ +| +$/g,"").split(/ *, */),A=v),g&&r.websocket.subprotocol===null&&(v="null",A=void 0);var O;f?O=F("ws"):O=WebSocket,d=new O(C,A),d.binaryType="arraybuffer"}catch{throw new _.ErrnoError(23)}var B={addr:n,port:a,socket:d,dgram_send_queue:[]};return Ee.websocket_sock_ops.addPeer(o,B),Ee.websocket_sock_ops.handlePeerEvents(o,B),o.type===2&&typeof o.sport<"u"&&B.dgram_send_queue.push(new Uint8Array([255,255,255,255,"p".charCodeAt(0),"o".charCodeAt(0),"r".charCodeAt(0),"t".charCodeAt(0),(o.sport&65280)>>8,o.sport&255])),B},getPeer(o,n,a){return o.peers[n+":"+a]},addPeer(o,n){o.peers[n.addr+":"+n.port]=n},removePeer(o,n){delete o.peers[n.addr+":"+n.port]},handlePeerEvents(o,n){var a=!0,d=function(){r.websocket.emit("open",o.stream.fd);try{for(var g=n.dgram_send_queue.shift();g;)n.socket.send(g),g=n.dgram_send_queue.shift()}catch{n.socket.close()}};function h(g){if(typeof g=="string"){var C=new TextEncoder;g=C.encode(g)}else{if(R(g.byteLength!==void 0),g.byteLength==0)return;g=new Uint8Array(g)}var S=a;if(a=!1,S&&g.length===10&&g[0]===255&&g[1]===255&&g[2]===255&&g[3]===255&&g[4]==="p".charCodeAt(0)&&g[5]==="o".charCodeAt(0)&&g[6]==="r".charCodeAt(0)&&g[7]==="t".charCodeAt(0)){var v=g[8]<<8|g[9];Ee.websocket_sock_ops.removePeer(o,n),n.port=v,Ee.websocket_sock_ops.addPeer(o,n);return}o.recv_queue.push({addr:n.addr,port:n.port,data:g}),r.websocket.emit("message",o.stream.fd)}f?(n.socket.on("open",d),n.socket.on("message",function(g,C){C&&h(new Uint8Array(g).buffer)}),n.socket.on("close",function(){r.websocket.emit("close",o.stream.fd)}),n.socket.on("error",function(g){o.error=14,r.websocket.emit("error",[o.stream.fd,o.error,"ECONNREFUSED: Connection refused"])})):(n.socket.onopen=d,n.socket.onclose=function(){r.websocket.emit("close",o.stream.fd)},n.socket.onmessage=function(C){h(C.data)},n.socket.onerror=function(g){o.error=14,r.websocket.emit("error",[o.stream.fd,o.error,"ECONNREFUSED: Connection refused"])})},poll(o){if(o.type===1&&o.server)return o.pending.length?65:0;var n=0,a=o.type===1?Ee.websocket_sock_ops.getPeer(o,o.daddr,o.dport):null;return(o.recv_queue.length||!a||a&&a.socket.readyState===a.socket.CLOSING||a&&a.socket.readyState===a.socket.CLOSED)&&(n|=65),(!a||a&&a.socket.readyState===a.socket.OPEN)&&(n|=4),(a&&a.socket.readyState===a.socket.CLOSING||a&&a.socket.readyState===a.socket.CLOSED)&&(n|=16),n},ioctl(o,n,a){switch(n){case 21531:var d=0;return o.recv_queue.length&&(d=o.recv_queue[0].data.length),T[a>>2]=d,Y(d),0;default:return 28}},close(o){if(o.server){try{o.server.close()}catch{}o.server=null}for(var n=Object.keys(o.peers),a=0;a<n.length;a++){var d=o.peers[n[a]];try{d.socket.close()}catch{}Ee.websocket_sock_ops.removePeer(o,d)}return 0},bind(o,n,a){if(typeof o.saddr<"u"||typeof o.sport<"u")throw new _.ErrnoError(28);if(o.saddr=n,o.sport=a,o.type===2){o.server&&(o.server.close(),o.server=null);try{o.sock_ops.listen(o,0)}catch(d){if(d.name!=="ErrnoError"||d.errno!==138)throw d}}},connect(o,n,a){if(o.server)throw new _.ErrnoError(138);if(typeof o.daddr<"u"&&typeof o.dport<"u"){var d=Ee.websocket_sock_ops.getPeer(o,o.daddr,o.dport);if(d)throw d.socket.readyState===d.socket.CONNECTING?new _.ErrnoError(7):new _.ErrnoError(30)}var h=Ee.websocket_sock_ops.createPeer(o,n,a);throw o.daddr=h.addr,o.dport=h.port,new _.ErrnoError(26)},listen(o,n){if(!f)throw new _.ErrnoError(138);if(o.server)throw new _.ErrnoError(28);var a=F("ws").Server,d=o.saddr;o.server=new a({host:d,port:o.sport}),r.websocket.emit("listen",o.stream.fd),o.server.on("connection",function(h){if(o.type===1){var g=Ee.createSocket(o.family,o.type,o.protocol),C=Ee.websocket_sock_ops.createPeer(g,h);g.daddr=C.addr,g.dport=C.port,o.pending.push(g),r.websocket.emit("connection",g.stream.fd)}else Ee.websocket_sock_ops.createPeer(o,h),r.websocket.emit("connection",o.stream.fd)}),o.server.on("close",function(){r.websocket.emit("close",o.stream.fd),o.server=null}),o.server.on("error",function(h){o.error=23,r.websocket.emit("error",[o.stream.fd,o.error,"EHOSTUNREACH: Host is unreachable"])})},accept(o){if(!o.server||!o.pending.length)throw new _.ErrnoError(28);var n=o.pending.shift();return n.stream.flags=o.stream.flags,n},getname(o,n){var a,d;if(n){if(o.daddr===void 0||o.dport===void 0)throw new _.ErrnoError(53);a=o.daddr,d=o.dport}else a=o.saddr||0,d=o.sport||0;return{addr:a,port:d}},sendmsg(o,n,a,d,h,g){if(o.type===2){if((h===void 0||g===void 0)&&(h=o.daddr,g=o.dport),h===void 0||g===void 0)throw new _.ErrnoError(17)}else h=o.daddr,g=o.dport;var C=Ee.websocket_sock_ops.getPeer(o,h,g);if(o.type===1){if(!C||C.socket.readyState===C.socket.CLOSING||C.socket.readyState===C.socket.CLOSED)throw new _.ErrnoError(53);if(C.socket.readyState===C.socket.CONNECTING)throw new _.ErrnoError(6)}ArrayBuffer.isView(n)&&(a+=n.byteOffset,n=n.buffer);var S;if(S=n.slice(a,a+d),o.type===2&&(!C||C.socket.readyState!==C.socket.OPEN))return(!C||C.socket.readyState===C.socket.CLOSING||C.socket.readyState===C.socket.CLOSED)&&(C=Ee.websocket_sock_ops.createPeer(o,h,g)),C.dgram_send_queue.push(S),d;try{return C.socket.send(S),d}catch{throw new _.ErrnoError(28)}},recvmsg(o,n){if(o.type===1&&o.server)throw new _.ErrnoError(53);var a=o.recv_queue.shift();if(!a){if(o.type===1){var d=Ee.websocket_sock_ops.getPeer(o,o.daddr,o.dport);if(!d)throw new _.ErrnoError(53);if(d.socket.readyState===d.socket.CLOSING||d.socket.readyState===d.socket.CLOSED)return null;throw new _.ErrnoError(6)}throw new _.ErrnoError(6)}var h=a.data.byteLength||a.data.length,g=a.data.byteOffset||0,C=a.data.buffer||a.data,S=Math.min(n,h),v={buffer:new Uint8Array(C,g,S),addr:a.addr,port:a.port};if(o.type===1&&S<h){var A=h-S;a.data=new Uint8Array(C,g+S,A),o.recv_queue.unshift(a)}return v}}},_t=o=>{var n=Ee.getSocket(o);if(!n)throw new _.ErrnoError(8);return n},rr=o=>(o&255)+"."+(o>>8&255)+"."+(o>>16&255)+"."+(o>>24&255),Mr=o=>{var n="",a=0,d=0,h=0,g=0,C=0,S=0,v=[o[0]&65535,o[0]>>16,o[1]&65535,o[1]>>16,o[2]&65535,o[2]>>16,o[3]&65535,o[3]>>16],A=!0,O="";for(S=0;S<5;S++)if(v[S]!==0){A=!1;break}if(A){if(O=rr(v[6]|v[7]<<16),v[5]===-1)return n="::ffff:",n+=O,n;if(v[5]===0)return n="::",O==="0.0.0.0"&&(O=""),O==="0.0.0.1"&&(O="1"),n+=O,n}for(a=0;a<8;a++)v[a]===0&&(a-h>1&&(C=0),h=a,C++),C>d&&(d=C,g=a-d+1);for(a=0;a<8;a++){if(d>1&&v[a]===0&&a>=g&&a<g+d){a===g&&(n+=":",g===0&&(n+=":"));continue}n+=Number(eo(v[a]&65535)).toString(16),n+=a<7?":":""}return n},Tr=(o,n)=>{var a=Q[o>>1],d=eo(X[o+2>>1]),h;switch(a){case 2:if(n!==16)return{errno:28};h=T[o+4>>2],h=rr(h);break;case 10:if(n!==28)return{errno:28};h=[T[o+8>>2],T[o+12>>2],T[o+16>>2],T[o+20>>2]],h=Mr(h);break;default:return{errno:5}}return{family:a,addr:h,port:d}},Ot=o=>{for(var n=o.split("."),a=0;a<4;a++){var d=Number(n[a]);if(isNaN(d))return null;n[a]=d}return(n[0]|n[1]<<8|n[2]<<16|n[3]<<24)>>>0},Pt=o=>parseInt(o),or=o=>{var n,a,d,h,g=/^((?=.*::)(?!.*::.+::)(::)?([\dA-F]{1,4}:(:|\b)|){5}|([\dA-F]{1,4}:){6})((([\dA-F]{1,4}((?!\3)::|:\b|$))|(?!\2\3)){2}|(((2[0-4]|1\d|[1-9])?\d|25[0-5])\.?\b){4})$/i,C=[];if(!g.test(o))return null;if(o==="::")return[0,0,0,0,0,0,0,0];for(o.startsWith("::")?o=o.replace("::","Z:"):o=o.replace("::",":Z:"),o.indexOf(".")>0?(o=o.replace(new RegExp("[.]","g"),":"),n=o.split(":"),n[n.length-4]=Pt(n[n.length-4])+Pt(n[n.length-3])*256,n[n.length-3]=Pt(n[n.length-2])+Pt(n[n.length-1])*256,n=n.slice(0,n.length-2)):n=o.split(":"),d=0,h=0,a=0;a<n.length;a++)if(typeof n[a]=="string")if(n[a]==="Z"){for(h=0;h<8-n.length+1;h++)C[a+h]=0;d=h-1}else C[a+d]=At(parseInt(n[a],16));else C[a+d]=n[a];return[C[1]<<16|C[0],C[3]<<16|C[2],C[5]<<16|C[4],C[7]<<16|C[6]]},Ge={address_map:{id:1,addrs:{},names:{}},lookup_name(o){var n=Ot(o);if(n!==null||(n=or(o),n!==null))return o;var a;if(Ge.address_map.addrs[o])a=Ge.address_map.addrs[o];else{var d=Ge.address_map.id++;R(d<65535,"exceeded max address mappings of 65535"),a="172.29."+(d&255)+"."+(d&65280),Ge.address_map.names[a]=o,Ge.address_map.addrs[o]=a}return a},lookup_addr(o){return Ge.address_map.names[o]?Ge.address_map.names[o]:null}},nr=(o,n,a)=>{if(a&&o===0)return null;var d=Tr(o,n);if(d.errno)throw new _.ErrnoError(d.errno);return d.addr=Ge.lookup_addr(d.addr)||d.addr,d};function Lo(o,n,a,d,h,g){try{var C=_t(o),S=nr(n,a);return C.sock_ops.bind(C,S.addr,S.port),0}catch(v){if(typeof _>"u"||v.name!=="ErrnoError")throw v;return-v.errno}}function Do(o,n,a,d,h,g){try{var C=_t(o),S=nr(n,a);return C.sock_ops.connect(C,S.addr,S.port),0}catch(v){if(typeof _>"u"||v.name!=="ErrnoError")throw v;return-v.errno}}var le={DEFAULT_POLLMASK:5,calculateAt(o,n,a){if(be.isAbs(n))return n;var d;if(o===-100)d=_.cwd();else{var h=le.getStreamFromFD(o);d=h.path}if(n.length==0){if(!a)throw new _.ErrnoError(44);return d}return be.join2(d,n)},doStat(o,n,a){var d=o(n);T[a>>2]=d.dev,Y(d.dev),T[a+4>>2]=d.mode,Y(d.mode),P[a+8>>2]=d.nlink,Y(d.nlink),T[a+12>>2]=d.uid,Y(d.uid),T[a+16>>2]=d.gid,Y(d.gid),T[a+20>>2]=d.rdev,Y(d.rdev),xe=[d.size>>>0,(ee=d.size,+Math.abs(ee)>=1?ee>0?+Math.floor(ee/4294967296)>>>0:~~+Math.ceil((ee-+(~~ee>>>0))/4294967296)>>>0:0)],T[a+24>>2]=xe[0],T[a+28>>2]=xe[1],ze(d.size),T[a+32>>2]=4096,Y(4096),T[a+36>>2]=d.blocks,Y(d.blocks);var h=d.atime.getTime(),g=d.mtime.getTime(),C=d.ctime.getTime();return xe=[Math.floor(h/1e3)>>>0,(ee=Math.floor(h/1e3),+Math.abs(ee)>=1?ee>0?+Math.floor(ee/4294967296)>>>0:~~+Math.ceil((ee-+(~~ee>>>0))/4294967296)>>>0:0)],T[a+40>>2]=xe[0],T[a+44>>2]=xe[1],ze(Math.floor(h/1e3)),P[a+48>>2]=h%1e3*1e3,Y(h%1e3*1e3),xe=[Math.floor(g/1e3)>>>0,(ee=Math.floor(g/1e3),+Math.abs(ee)>=1?ee>0?+Math.floor(ee/4294967296)>>>0:~~+Math.ceil((ee-+(~~ee>>>0))/4294967296)>>>0:0)],T[a+56>>2]=xe[0],T[a+60>>2]=xe[1],ze(Math.floor(g/1e3)),P[a+64>>2]=g%1e3*1e3,Y(g%1e3*1e3),xe=[Math.floor(C/1e3)>>>0,(ee=Math.floor(C/1e3),+Math.abs(ee)>=1?ee>0?+Math.floor(ee/4294967296)>>>0:~~+Math.ceil((ee-+(~~ee>>>0))/4294967296)>>>0:0)],T[a+72>>2]=xe[0],T[a+76>>2]=xe[1],ze(Math.floor(C/1e3)),P[a+80>>2]=C%1e3*1e3,Y(C%1e3*1e3),xe=[d.ino>>>0,(ee=d.ino,+Math.abs(ee)>=1?ee>0?+Math.floor(ee/4294967296)>>>0:~~+Math.ceil((ee-+(~~ee>>>0))/4294967296)>>>0:0)],T[a+88>>2]=xe[0],T[a+92>>2]=xe[1],ze(d.ino),0},doMsync(o,n,a,d,h){if(!_.isFile(n.node.mode))throw new _.ErrnoError(43);if(d&2)return 0;var g=N.slice(o,o+a);_.msync(n,g,h,a,d)},varargs:void 0,get(){R(le.varargs!=null);var o=T[+le.varargs>>2];return le.varargs+=4,o},getp(){return le.get()},getStr(o){var n=We(o);return n},getStreamFromFD(o){var n=_.getStreamChecked(o);return n}};function Ro(o,n,a,d){try{if(n=le.getStr(n),R(d===0),n=le.calculateAt(o,n),a&-8)return-28;var h=_.lookupPath(n,{follow:!0}),g=h.node;if(!g)return-44;var C="";return a&4&&(C+="r"),a&2&&(C+="w"),a&1&&(C+="x"),C&&_.nodePermissions(g,C)?-2:0}catch(S){if(typeof _>"u"||S.name!=="ErrnoError")throw S;return-S.errno}}function Io(o,n,a){le.varargs=a;try{var d=le.getStreamFromFD(o);switch(n){case 0:{var h=le.get();if(h<0)return-28;for(;_.streams[h];)h++;var g;return g=_.createStream(d,h),g.fd}case 1:case 2:return 0;case 3:return d.flags;case 4:{var h=le.get();return d.flags|=h,0}case 12:{var h=le.getp(),C=0;return Q[h+C>>1]=2,He(2),0}case 13:case 14:return 0}return-28}catch(S){if(typeof _>"u"||S.name!=="ErrnoError")throw S;return-S.errno}}function Oo(o,n){try{var a=le.getStreamFromFD(o);return le.doStat(_.stat,a.path,n)}catch(d){if(typeof _>"u"||d.name!=="ErrnoError")throw d;return-d.errno}}var xt=(o,n,a)=>(R(typeof a=="number","stringToUTF8(str, outPtr, maxBytesToWrite) is missing the third parameter that specifies the length of the output buffer!"),er(o,N,n,a));function Po(o,n,a){try{var d=le.getStreamFromFD(o);d.getdents||(d.getdents=_.readdir(d.path));for(var h=280,g=0,C=_.llseek(d,0,1),S=Math.floor(C/h);S<d.getdents.length&&g+h<=a;){var v,A,O=d.getdents[S];if(O===".")v=d.node.id,A=4;else if(O===".."){var B=_.lookupPath(d.path,{parent:!0});v=B.node.id,A=4}else{var G=_.lookupNode(d.node,O);v=G.id,A=_.isChrdev(G.mode)?2:_.isDir(G.mode)?4:_.isLink(G.mode)?10:8}R(v),xe=[v>>>0,(ee=v,+Math.abs(ee)>=1?ee>0?+Math.floor(ee/4294967296)>>>0:~~+Math.ceil((ee-+(~~ee>>>0))/4294967296)>>>0:0)],T[n+g>>2]=xe[0],T[n+g+4>>2]=xe[1],ze(v),xe=[(S+1)*h>>>0,(ee=(S+1)*h,+Math.abs(ee)>=1?ee>0?+Math.floor(ee/4294967296)>>>0:~~+Math.ceil((ee-+(~~ee>>>0))/4294967296)>>>0:0)],T[n+g+8>>2]=xe[0],T[n+g+12>>2]=xe[1],ze((S+1)*h),Q[n+g+16>>1]=280,He(280),H[n+g+18]=A,lt(A),xt(O,n+g+19,256),g+=h,S+=1}return _.llseek(d,S*h,0),g}catch(W){if(typeof _>"u"||W.name!=="ErrnoError")throw W;return-W.errno}}var sr=(o,n,a,d,h)=>{switch(n){case 2:a=Ot(a),vr(o,16),h&&(T[h>>2]=16,Y(16)),Q[o>>1]=n,He(n),T[o+4>>2]=a,Y(a),Q[o+2>>1]=At(d),He(At(d));break;case 10:a=or(a),vr(o,28),h&&(T[h>>2]=28,Y(28)),T[o>>2]=n,Y(n),T[o+8>>2]=a[0],Y(a[0]),T[o+12>>2]=a[1],Y(a[1]),T[o+16>>2]=a[2],Y(a[2]),T[o+20>>2]=a[3],Y(a[3]),Q[o+2>>1]=At(d),He(At(d));break;default:return 5}return 0};function ko(o,n,a,d,h,g){try{var C=_t(o),S=sr(n,C.family,Ge.lookup_name(C.saddr||"0.0.0.0"),C.sport,a);return R(!S),0}catch(v){if(typeof _>"u"||v.name!=="ErrnoError")throw v;return-v.errno}}function Fo(o,n,a,d,h,g){try{var C=_t(o);return n===1&&a===4?(T[d>>2]=C.error,Y(C.error),T[h>>2]=4,Y(4),C.error=null,0):-50}catch(S){if(typeof _>"u"||S.name!=="ErrnoError")throw S;return-S.errno}}function jo(o,n,a){le.varargs=a;try{var d=le.getStreamFromFD(o);switch(n){case 21509:return d.tty?0:-59;case 21505:{if(!d.tty)return-59;if(d.tty.ops.ioctl_tcgets){var h=d.tty.ops.ioctl_tcgets(d),g=le.getp();T[g>>2]=h.c_iflag||0,Y(h.c_iflag||0),T[g+4>>2]=h.c_oflag||0,Y(h.c_oflag||0),T[g+8>>2]=h.c_cflag||0,Y(h.c_cflag||0),T[g+12>>2]=h.c_lflag||0,Y(h.c_lflag||0);for(var C=0;C<32;C++)H[g+C+17]=h.c_cc[C]||0,lt(h.c_cc[C]||0);return 0}return 0}case 21510:case 21511:case 21512:return d.tty?0:-59;case 21506:case 21507:case 21508:{if(!d.tty)return-59;if(d.tty.ops.ioctl_tcsets){for(var g=le.getp(),S=T[g>>2],v=T[g+4>>2],A=T[g+8>>2],O=T[g+12>>2],B=[],C=0;C<32;C++)B.push(H[g+C+17]);return d.tty.ops.ioctl_tcsets(d.tty,n,{c_iflag:S,c_oflag:v,c_cflag:A,c_lflag:O,c_cc:B})}return 0}case 21519:{if(!d.tty)return-59;var g=le.getp();return T[g>>2]=0,Y(0),0}case 21520:return d.tty?-28:-59;case 21531:{var g=le.getp();return _.ioctl(d,n,g)}case 21523:{if(!d.tty)return-59;if(d.tty.ops.ioctl_tiocgwinsz){var G=d.tty.ops.ioctl_tiocgwinsz(d.tty),g=le.getp();Q[g>>1]=G[0],He(G[0]),Q[g+2>>1]=G[1],He(G[1])}return 0}case 21524:return d.tty?0:-59;case 21515:return d.tty?0:-59;default:return-28}}catch(W){if(typeof _>"u"||W.name!=="ErrnoError")throw W;return-W.errno}}function Bo(o,n){try{return o=le.getStr(o),le.doStat(_.lstat,o,n)}catch(a){if(typeof _>"u"||a.name!=="ErrnoError")throw a;return-a.errno}}function No(o,n,a,d){try{n=le.getStr(n);var h=d&256,g=d&4096;return d=d&-6401,R(!d,`unknown flags in __syscall_newfstatat: ${d}`),n=le.calculateAt(o,n,g),le.doStat(h?_.lstat:_.stat,n,a)}catch(C){if(typeof _>"u"||C.name!=="ErrnoError")throw C;return-C.errno}}function $o(o,n,a,d){le.varargs=d;try{n=le.getStr(n),n=le.calculateAt(o,n);var h=d?le.get():0;return _.open(n,a,h).fd}catch(g){if(typeof _>"u"||g.name!=="ErrnoError")throw g;return-g.errno}}function Go(o,n,a){try{for(var d=0,h=0;h<n;h++){var g=o+8*h,C=T[g>>2],S=Q[g+4>>1],v=32,A=_.getStream(C);A&&(v=le.DEFAULT_POLLMASK,A.stream_ops.poll&&(v=A.stream_ops.poll(A,-1))),v&=S|8|16,v&&d++,Q[g+6>>1]=v,He(v)}return d}catch(O){if(typeof _>"u"||O.name!=="ErrnoError")throw O;return-O.errno}}function Uo(o,n,a,d,h,g){try{var C=_t(o),S=C.sock_ops.recvmsg(C,a);if(!S)return 0;if(h){var v=sr(h,C.family,Ge.lookup_name(S.addr),S.port,g);R(!v)}return N.set(S.buffer,n),S.buffer.byteLength}catch(A){if(typeof _>"u"||A.name!=="ErrnoError")throw A;return-A.errno}}function Vo(o,n,a,d){try{return n=le.getStr(n),d=le.getStr(d),n=le.calculateAt(o,n),d=le.calculateAt(a,d),_.rename(n,d),0}catch(h){if(typeof _>"u"||h.name!=="ErrnoError")throw h;return-h.errno}}function Ho(o){try{return o=le.getStr(o),_.rmdir(o),0}catch(n){if(typeof _>"u"||n.name!=="ErrnoError")throw n;return-n.errno}}function zo(o,n,a,d,h,g){try{var C=_t(o),S=nr(h,g,!0);return S?C.sock_ops.sendmsg(C,H,n,a,S.addr,S.port):_.write(C.stream,H,n,a)}catch(v){if(typeof _>"u"||v.name!=="ErrnoError")throw v;return-v.errno}}function Wo(o,n,a){try{var d=Ee.createSocket(o,n,a);return R(d.stream.fd<64),d.stream.fd}catch(h){if(typeof _>"u"||h.name!=="ErrnoError")throw h;return-h.errno}}function Yo(o,n){try{return o=le.getStr(o),le.doStat(_.stat,o,n)}catch(a){if(typeof _>"u"||a.name!=="ErrnoError")throw a;return-a.errno}}function Qo(o,n,a){try{return n=le.getStr(n),n=le.calculateAt(o,n),a===0?_.unlink(n):a===512?_.rmdir(n):ie("Invalid flags passed to unlinkat"),0}catch(d){if(typeof _>"u"||d.name!=="ErrnoError")throw d;return-d.errno}}var Xo=(o,n,a,d,h)=>{},qo=()=>{for(var o=new Array(256),n=0;n<256;++n)o[n]=String.fromCharCode(n);Ar=o},Ar,Ue=o=>{for(var n="",a=o;N[a];)n+=Ar[N[a++]];return n},ft={},ut={},kt={},gt,Ce=o=>{throw new gt(o)},Lr,Ft=o=>{throw new Lr(o)},Ct=(o,n,a)=>{o.forEach(function(S){kt[S]=n});function d(S){var v=a(S);v.length!==o.length&&Ft("Mismatched type converter count");for(var A=0;A<o.length;++A)tt(o[A],v[A])}var h=new Array(n.length),g=[],C=0;n.forEach((S,v)=>{ut.hasOwnProperty(S)?h[v]=ut[S]:(g.push(S),ft.hasOwnProperty(S)||(ft[S]=[]),ft[S].push(()=>{h[v]=ut[S],++C,C===g.length&&d(h)}))}),g.length===0&&d(h)};function Jo(o,n,a={}){var d=n.name;if(o||Ce(`type "${d}" must have a positive integer typeid pointer`),ut.hasOwnProperty(o)){if(a.ignoreDuplicateRegistrations)return;Ce(`Cannot register type '${d}' twice`)}if(ut[o]=n,delete kt[o],ft.hasOwnProperty(o)){var h=ft[o];delete ft[o],h.forEach(g=>g())}}function tt(o,n,a={}){if(!("argPackAdvance"in n))throw new TypeError("registerType registeredInstance requires argPackAdvance");return Jo(o,n,a)}var st=8,Zo=(o,n,a,d)=>{n=Ue(n),tt(o,{name:n,fromWireType:function(h){return!!h},toWireType:function(h,g){return g?a:d},argPackAdvance:st,readValueFromPointer:function(h){return this.fromWireType(N[h])},destructorFunction:null})},en=o=>({count:o.count,deleteScheduled:o.deleteScheduled,preservePointerOnDelete:o.preservePointerOnDelete,ptr:o.ptr,ptrType:o.ptrType,smartPtr:o.smartPtr,smartPtrType:o.smartPtrType}),ar=o=>{function n(a){return a.$$.ptrType.registeredClass.name}Ce(n(o)+" instance already deleted")},ir=!1,Dr=o=>{},tn=o=>{o.smartPtr?o.smartPtrType.rawDestructor(o.smartPtr):o.ptrType.registeredClass.rawDestructor(o.ptr)},Rr=o=>{o.count.value-=1;var n=o.count.value===0;n&&tn(o)},Ir=(o,n,a)=>{if(n===a)return o;if(a.baseClass===void 0)return null;var d=Ir(o,n,a.baseClass);return d===null?null:a.downcast(d)},Or={},rn=()=>Object.keys(vt).length,on=()=>{var o=[];for(var n in vt)vt.hasOwnProperty(n)&&o.push(vt[n]);return o},Kt=[],cr=()=>{for(;Kt.length;){var o=Kt.pop();o.$$.deleteScheduled=!1,o.delete()}},bt,nn=o=>{bt=o,Kt.length&&bt&&bt(cr)},sn=()=>{r.getInheritedInstanceCount=rn,r.getLiveInheritedInstances=on,r.flushPendingDeletes=cr,r.setDelayFunction=nn},vt={},an=(o,n)=>{for(n===void 0&&Ce("ptr should not be undefined");o.baseClass;)n=o.upcast(n),o=o.baseClass;return n},cn=(o,n)=>(n=an(o,n),vt[n]),jt=(o,n)=>{(!n.ptrType||!n.ptr)&&Ft("makeClassHandle requires ptr and ptrType");var a=!!n.smartPtrType,d=!!n.smartPtr;return a!==d&&Ft("Both smartPtrType and smartPtr must be specified"),n.count={value:1},wt(Object.create(o,{$$:{value:n,writable:!0}}))};function Pr(o){var n=this.getPointee(o);if(!n)return this.destructor(o),null;var a=cn(this.registeredClass,n);if(a!==void 0){if(a.$$.count.value===0)return a.$$.ptr=n,a.$$.smartPtr=o,a.clone();var d=a.clone();return this.destructor(o),d}function h(){return this.isSmartPointer?jt(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:n,smartPtrType:this,smartPtr:o}):jt(this.registeredClass.instancePrototype,{ptrType:this,ptr:o})}var g=this.registeredClass.getActualType(n),C=Or[g];if(!C)return h.call(this);var S;this.isConst?S=C.constPointerType:S=C.pointerType;var v=Ir(n,this.registeredClass,S.registeredClass);return v===null?h.call(this):this.isSmartPointer?jt(S.registeredClass.instancePrototype,{ptrType:S,ptr:v,smartPtrType:this,smartPtr:o}):jt(S.registeredClass.instancePrototype,{ptrType:S,ptr:v})}var wt=o=>typeof FinalizationRegistry>"u"?(wt=n=>n,o):(ir=new FinalizationRegistry(n=>{console.warn(n.leakWarning.stack.replace(/^Error: /,"")),Rr(n.$$)}),wt=n=>{var a=n.$$,d=!!a.smartPtr;if(d){var h={$$:a},g=a.ptrType.registeredClass;h.leakWarning=new Error(`Embind found a leaked C++ instance ${g.name} <${Je(a.ptr)}>.
We'll free it automatically in this case, but this functionality is not reliable across various environments.
Make sure to invoke .delete() manually once you're done with the instance instead.
Originally allocated`),"captureStackTrace"in Error&&Error.captureStackTrace(h.leakWarning,Pr),ir.register(n,h,n)}return n},Dr=n=>ir.unregister(n),wt(o)),ln=()=>{Object.assign(Bt.prototype,{isAliasOf(o){if(!(this instanceof Bt)||!(o instanceof Bt))return!1;var n=this.$$.ptrType.registeredClass,a=this.$$.ptr;o.$$=o.$$;for(var d=o.$$.ptrType.registeredClass,h=o.$$.ptr;n.baseClass;)a=n.upcast(a),n=n.baseClass;for(;d.baseClass;)h=d.upcast(h),d=d.baseClass;return n===d&&a===h},clone(){if(this.$$.ptr||ar(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var o=wt(Object.create(Object.getPrototypeOf(this),{$$:{value:en(this.$$)}}));return o.$$.count.value+=1,o.$$.deleteScheduled=!1,o},delete(){this.$$.ptr||ar(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&Ce("Object already scheduled for deletion"),Dr(this),Rr(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)},isDeleted(){return!this.$$.ptr},deleteLater(){return this.$$.ptr||ar(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&Ce("Object already scheduled for deletion"),Kt.push(this),Kt.length===1&&bt&&bt(cr),this.$$.deleteScheduled=!0,this}})};function Bt(){}var Nt=(o,n)=>Object.defineProperty(n,"name",{value:o}),kr=(o,n,a)=>{if(o[n].overloadTable===void 0){var d=o[n];o[n]=function(...h){return o[n].overloadTable.hasOwnProperty(h.length)||Ce(`Function '${a}' called with an invalid number of arguments (${h.length}) - expects one of (${o[n].overloadTable})!`),o[n].overloadTable[h.length].apply(this,h)},o[n].overloadTable=[],o[n].overloadTable[d.argCount]=d}},Fr=(o,n,a)=>{r.hasOwnProperty(o)?((a===void 0||r[o].overloadTable!==void 0&&r[o].overloadTable[a]!==void 0)&&Ce(`Cannot register public name '${o}' twice`),kr(r,o,o),r.hasOwnProperty(a)&&Ce(`Cannot register multiple overloads of a function with the same number of arguments (${a})!`),r[o].overloadTable[a]=n):(r[o]=n,a!==void 0&&(r[o].numArguments=a))},dn=48,un=57,pn=o=>{if(o===void 0)return"_unknown";o=o.replace(/[^a-zA-Z0-9_]/g,"$");var n=o.charCodeAt(0);return n>=dn&&n<=un?`_${o}`:o};function hn(o,n,a,d,h,g,C,S){this.name=o,this.constructor=n,this.instancePrototype=a,this.rawDestructor=d,this.baseClass=h,this.getActualType=g,this.upcast=C,this.downcast=S,this.pureVirtualFunctions=[]}var lr=(o,n,a)=>{for(;n!==a;)n.upcast||Ce(`Expected null or instance of ${a.name}, got an instance of ${n.name}`),o=n.upcast(o),n=n.baseClass;return o};function _n(o,n){if(n===null)return this.isReference&&Ce(`null is not a valid ${this.name}`),0;n.$$||Ce(`Cannot pass "${yt(n)}" as a ${this.name}`),n.$$.ptr||Ce(`Cannot pass deleted object as a pointer of type ${this.name}`);var a=n.$$.ptrType.registeredClass,d=lr(n.$$.ptr,a,this.registeredClass);return d}function fn(o,n){var a;if(n===null)return this.isReference&&Ce(`null is not a valid ${this.name}`),this.isSmartPointer?(a=this.rawConstructor(),o!==null&&o.push(this.rawDestructor,a),a):0;(!n||!n.$$)&&Ce(`Cannot pass "${yt(n)}" as a ${this.name}`),n.$$.ptr||Ce(`Cannot pass deleted object as a pointer of type ${this.name}`),!this.isConst&&n.$$.ptrType.isConst&&Ce(`Cannot convert argument of type ${n.$$.smartPtrType?n.$$.smartPtrType.name:n.$$.ptrType.name} to parameter type ${this.name}`);var d=n.$$.ptrType.registeredClass;if(a=lr(n.$$.ptr,d,this.registeredClass),this.isSmartPointer)switch(n.$$.smartPtr===void 0&&Ce("Passing raw pointer to smart pointer is illegal"),this.sharingPolicy){case 0:n.$$.smartPtrType===this?a=n.$$.smartPtr:Ce(`Cannot convert argument of type ${n.$$.smartPtrType?n.$$.smartPtrType.name:n.$$.ptrType.name} to parameter type ${this.name}`);break;case 1:a=n.$$.smartPtr;break;case 2:if(n.$$.smartPtrType===this)a=n.$$.smartPtr;else{var h=n.clone();a=this.rawShare(a,zt.toHandle(()=>h.delete())),o!==null&&o.push(this.rawDestructor,a)}break;default:Ce("Unsupporting sharing policy")}return a}function gn(o,n){if(n===null)return this.isReference&&Ce(`null is not a valid ${this.name}`),0;n.$$||Ce(`Cannot pass "${yt(n)}" as a ${this.name}`),n.$$.ptr||Ce(`Cannot pass deleted object as a pointer of type ${this.name}`),n.$$.ptrType.isConst&&Ce(`Cannot convert argument of type ${n.$$.ptrType.name} to parameter type ${this.name}`);var a=n.$$.ptrType.registeredClass,d=lr(n.$$.ptr,a,this.registeredClass);return d}function $t(o){return this.fromWireType(P[o>>2])}var Cn=()=>{Object.assign(Gt.prototype,{getPointee(o){return this.rawGetPointee&&(o=this.rawGetPointee(o)),o},destructor(o){var n;(n=this.rawDestructor)==null||n.call(this,o)},argPackAdvance:st,readValueFromPointer:$t,fromWireType:Pr})};function Gt(o,n,a,d,h,g,C,S,v,A,O){this.name=o,this.registeredClass=n,this.isReference=a,this.isConst=d,this.isSmartPointer=h,this.pointeeType=g,this.sharingPolicy=C,this.rawGetPointee=S,this.rawConstructor=v,this.rawShare=A,this.rawDestructor=O,!h&&n.baseClass===void 0?d?(this.toWireType=_n,this.destructorFunction=null):(this.toWireType=gn,this.destructorFunction=null):this.toWireType=fn}var jr=(o,n,a)=>{r.hasOwnProperty(o)||Ft("Replacing nonexistant public symbol"),r[o].overloadTable!==void 0&&a!==void 0?r[o].overloadTable[a]=n:(r[o]=n,r[o].argCount=a)},mn=(o,n,a)=>{R("dynCall_"+o in r,`bad function pointer type - dynCall function not found for sig '${o}'`),a!=null&&a.length?R(a.length===o.substring(1).replace(/j/g,"--").length):R(o.length==1);var d=r["dynCall_"+o];return d(n,...a)},Ut=[],Vt,dr=o=>{var n=Ut[o];return n||(o>=Ut.length&&(Ut.length=o+1),Ut[o]=n=Vt.get(o)),R(Vt.get(o)==n,"JavaScript-side Wasm function table mirror is out of date!"),n},yn=(o,n,a=[])=>{if(o.includes("j"))return mn(o,n,a);R(dr(n),`missing table entry in dynCall: ${n}`);var d=dr(n)(...a);return d},Sn=(o,n)=>(R(o.includes("j")||o.includes("p"),"getDynCaller should only be called with i64 sigs"),(...a)=>yn(o,n,a)),pt=(o,n)=>{o=Ue(o);function a(){return o.includes("j")?Sn(o,n):dr(n)}var d=a();return typeof d!="function"&&Ce(`unknown function pointer with signature ${o}: ${n}`),d},xn=(o,n)=>{var a=Nt(n,function(d){this.name=n,this.message=d;var h=new Error(d).stack;h!==void 0&&(this.stack=this.toString()+`
`+h.replace(/^Error(:[^\n]*)?\n/,""))});return a.prototype=Object.create(o.prototype),a.prototype.constructor=a,a.prototype.toString=function(){return this.message===void 0?this.name:`${this.name}: ${this.message}`},a},Br,Nr=o=>{var n=Ls(o),a=Ue(n);return at(n),a},Ht=(o,n)=>{var a=[],d={};function h(g){if(!d[g]&&!ut[g]){if(kt[g]){kt[g].forEach(h);return}a.push(g),d[g]=!0}}throw n.forEach(h),new Br(`${o}: `+a.map(Nr).join([", "]))},Kn=(o,n,a,d,h,g,C,S,v,A,O,B,G)=>{O=Ue(O),g=pt(h,g),S&&(S=pt(C,S)),A&&(A=pt(v,A)),G=pt(B,G);var W=pn(O);Fr(W,function(){Ht(`Cannot construct ${O} due to unbound types`,[d])}),Ct([o,n,a],d?[d]:[],se=>{var Ie;se=se[0];var ve,Me;d?(ve=se.registeredClass,Me=ve.instancePrototype):Me=Bt.prototype;var Re=Nt(O,function(...mr){if(Object.getPrototypeOf(this)!==$)throw new gt("Use 'new' to construct "+O);if(Z.constructor_body===void 0)throw new gt(O+" has no accessible constructor");var oo=Z.constructor_body[mr.length];if(oo===void 0)throw new gt(`Tried to invoke ctor of ${O} with invalid number of parameters (${mr.length}) - expected (${Object.keys(Z.constructor_body).toString()}) parameters instead!`);return oo.apply(this,mr)}),$=Object.create(Me,{constructor:{value:Re}});Re.prototype=$;var Z=new hn(O,Re,$,G,ve,g,S,A);Z.baseClass&&((Ie=Z.baseClass).__derivedClasses??(Ie.__derivedClasses=[]),Z.baseClass.__derivedClasses.push(Z));var me=new Gt(O,Z,!0,!1,!1),ye=new Gt(O+"*",Z,!1,!1,!1),Be=new Gt(O+" const*",Z,!1,!0,!1);return Or[o]={pointerType:ye,constPointerType:Be},jr(W,Re),[me,ye,Be]})},ur=(o,n)=>{for(var a=[],d=0;d<o;d++)a.push(P[n+d*4>>2]);return a},bn=o=>{for(;o.length;){var n=o.pop(),a=o.pop();a(n)}};function $r(o){for(var n=1;n<o.length;++n)if(o[n]!==null&&o[n].destructorFunction===void 0)return!0;return!1}function vn(o,n){if(!(o instanceof Function))throw new TypeError(`new_ called with constructor type ${typeof o} which is not a function`);var a=Nt(o.name||"unknownFunctionName",function(){});a.prototype=o.prototype;var d=new a,h=o.apply(d,n);return h instanceof Object?h:d}function wn(o,n,a,d){for(var h=$r(o),g=o.length,C="",S="",v=0;v<g-2;++v)C+=(v!==0?", ":"")+"arg"+v,S+=(v!==0?", ":"")+"arg"+v+"Wired";var A=`
        return function (${C}) {
        if (arguments.length !== ${g-2}) {
          throwBindingError('function ' + humanName + ' called with ' + arguments.length + ' arguments, expected ${g-2}');
        }`;h&&(A+=`var destructors = [];
`);var O=h?"destructors":"null",B=["humanName","throwBindingError","invoker","fn","runDestructors","retType","classParam"];n&&(A+="var thisWired = classParam['toWireType']("+O+`, this);
`);for(var v=0;v<g-2;++v)A+="var arg"+v+"Wired = argType"+v+"['toWireType']("+O+", arg"+v+`);
`,B.push("argType"+v);if(n&&(S="thisWired"+(S.length>0?", ":"")+S),A+=(a||d?"var rv = ":"")+"invoker(fn"+(S.length>0?", ":"")+S+`);
`,h)A+=`runDestructors(destructors);
`;else for(var v=n?1:2;v<o.length;++v){var G=v===1?"thisWired":"arg"+(v-2)+"Wired";o[v].destructorFunction!==null&&(A+=`${G}_dtor(${G});
`,B.push(`${G}_dtor`))}return a&&(A+=`var ret = retType['fromWireType'](rv);
return ret;
`),A+=`}
`,A=`if (arguments.length !== ${B.length}){ throw new Error(humanName + "Expected ${B.length} closure arguments " + arguments.length + " given."); }
${A}`,[B,A]}function pr(o,n,a,d,h,g){var C=n.length;C<2&&Ce("argTypes array size mismatch! Must at least get return value and 'this' types!"),R(!g,"Async bindings are only supported with JSPI.");for(var S=n[1]!==null&&a!==null,v=$r(n),A=n[0].name!=="void",O=[o,Ce,d,h,bn,n[0],n[1]],B=0;B<C-2;++B)O.push(n[B+2]);if(!v)for(var B=S?1:2;B<n.length;++B)n[B].destructorFunction!==null&&O.push(n[B].destructorFunction);let[G,W]=wn(n,S,A,g);G.push(W);var se=vn(Function,G)(...O);return Nt(o,se)}var En=(o,n,a,d,h,g)=>{R(n>0);var C=ur(n,a);h=pt(d,h),Ct([],[o],S=>{S=S[0];var v=`constructor ${S.name}`;if(S.registeredClass.constructor_body===void 0&&(S.registeredClass.constructor_body=[]),S.registeredClass.constructor_body[n-1]!==void 0)throw new gt(`Cannot register multiple constructors with identical number of parameters (${n-1}) for class '${S.name}'! Overload resolution is currently only performed using the parameter count, not actual type info!`);return S.registeredClass.constructor_body[n-1]=()=>{Ht(`Cannot construct ${S.name} due to unbound types`,C)},Ct([],C,A=>(A.splice(1,0,null),S.registeredClass.constructor_body[n-1]=pr(v,A,null,h,g),[])),[]})},Gr=o=>{o=o.trim();const n=o.indexOf("(");return n!==-1?(R(o[o.length-1]==")","Parentheses for argument names should match."),o.substr(0,n)):o},Mn=(o,n,a,d,h,g,C,S,v)=>{var A=ur(a,d);n=Ue(n),n=Gr(n),g=pt(h,g),Ct([],[o],O=>{O=O[0];var B=`${O.name}.${n}`;n.startsWith("@@")&&(n=Symbol[n.substring(2)]),S&&O.registeredClass.pureVirtualFunctions.push(n);function G(){Ht(`Cannot call ${B} due to unbound types`,A)}var W=O.registeredClass.instancePrototype,se=W[n];return se===void 0||se.overloadTable===void 0&&se.className!==O.name&&se.argCount===a-2?(G.argCount=a-2,G.className=O.name,W[n]=G):(kr(W,n,B),W[n].overloadTable[a-2]=G),Ct([],A,ve=>{var Me=pr(B,ve,O,g,C,v);return W[n].overloadTable===void 0?(Me.argCount=a-2,W[n]=Me):W[n].overloadTable[a-2]=Me,[]}),[]})},hr=[],Ve=[],Ur=o=>{o>9&&--Ve[o+1]===0&&(R(Ve[o]!==void 0,"Decref for unallocated handle."),Ve[o]=void 0,hr.push(o))},Tn=()=>Ve.length/2-5-hr.length,An=()=>{Ve.push(0,1,void 0,1,null,1,!0,1,!1,1),R(Ve.length===5*2),r.count_emval_handles=Tn},zt={toValue:o=>(o||Ce("Cannot use deleted val. handle = "+o),R(o===2||Ve[o]!==void 0&&o%2===0,`invalid handle: ${o}`),Ve[o]),toHandle:o=>{switch(o){case void 0:return 2;case null:return 4;case!0:return 6;case!1:return 8;default:{const n=hr.pop()||Ve.length;return Ve[n]=o,Ve[n+1]=1,n}}}},Ln={name:"emscripten::val",fromWireType:o=>{var n=zt.toValue(o);return Ur(o),n},toWireType:(o,n)=>zt.toHandle(n),argPackAdvance:st,readValueFromPointer:$t,destructorFunction:null},Vr=o=>tt(o,Ln),yt=o=>{if(o===null)return"null";var n=typeof o;return n==="object"||n==="array"||n==="function"?o.toString():""+o},Dn=(o,n)=>{switch(n){case 4:return function(a){return this.fromWireType(q[a>>2])};case 8:return function(a){return this.fromWireType(ae[a>>3])};default:throw new TypeError(`invalid float width (${n}): ${o}`)}},Rn=(o,n,a)=>{n=Ue(n),tt(o,{name:n,fromWireType:d=>d,toWireType:(d,h)=>{if(typeof h!="number"&&typeof h!="boolean")throw new TypeError(`Cannot convert ${yt(h)} to ${this.name}`);return h},argPackAdvance:st,readValueFromPointer:Dn(n,a),destructorFunction:null})},In=(o,n,a,d,h,g,C)=>{var S=ur(n,a);o=Ue(o),o=Gr(o),h=pt(d,h),Fr(o,function(){Ht(`Cannot call ${o} due to unbound types`,S)},n-1),Ct([],S,v=>{var A=[v[0],null].concat(v.slice(1));return jr(o,pr(o,A,null,h,g,C),n-1),[]})},On=(o,n,a)=>{switch(n){case 1:return a?d=>H[d]:d=>N[d];case 2:return a?d=>Q[d>>1]:d=>X[d>>1];case 4:return a?d=>T[d>>2]:d=>P[d>>2];default:throw new TypeError(`invalid integer width (${n}): ${o}`)}},Pn=(o,n,a,d,h)=>{n=Ue(n),h===-1&&(h=4294967295);var g=O=>O;if(d===0){var C=32-8*a;g=O=>O<<C>>>C}var S=n.includes("unsigned"),v=(O,B)=>{if(typeof O!="number"&&typeof O!="boolean")throw new TypeError(`Cannot convert "${yt(O)}" to ${B}`);if(O<d||O>h)throw new TypeError(`Passing a number "${yt(O)}" from JS side to C/C++ side to an argument of type "${n}", which is outside the valid range [${d}, ${h}]!`)},A;S?A=function(O,B){return v(B,this.name),B>>>0}:A=function(O,B){return v(B,this.name),B},tt(o,{name:n,fromWireType:g,toWireType:A,argPackAdvance:st,readValueFromPointer:On(n,a,d!==0),destructorFunction:null})},kn=(o,n,a)=>{var d=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],h=d[n];function g(C){var S=P[C>>2],v=P[C+4>>2];return new h(H.buffer,v,S)}a=Ue(a),tt(o,{name:a,fromWireType:g,argPackAdvance:st,readValueFromPointer:g},{ignoreDuplicateRegistrations:!0})},Fn=(o,n)=>{Vr(o)},jn=(o,n)=>{n=Ue(n);var a=n==="std::string";tt(o,{name:n,fromWireType(d){var h=P[d>>2],g=d+4,C;if(a)for(var S=g,v=0;v<=h;++v){var A=g+v;if(v==h||N[A]==0){var O=A-S,B=We(S,O);C===void 0?C=B:(C+=String.fromCharCode(0),C+=B),S=A+1}}else{for(var G=new Array(h),v=0;v<h;++v)G[v]=String.fromCharCode(N[g+v]);C=G.join("")}return at(d),C},toWireType(d,h){h instanceof ArrayBuffer&&(h=new Uint8Array(h));var g,C=typeof h=="string";C||h instanceof Uint8Array||h instanceof Uint8ClampedArray||h instanceof Int8Array||Ce("Cannot pass non-string to std::string"),a&&C?g=Rt(h):g=h.length;var S=Tt(4+g+1),v=S+4;if(P[S>>2]=g,Y(g),a&&C)xt(h,v,g+1);else if(C)for(var A=0;A<g;++A){var O=h.charCodeAt(A);O>255&&(at(v),Ce("String has UTF-16 code units that do not fit in 8 bits")),N[v+A]=O}else for(var A=0;A<g;++A)N[v+A]=h[A];return d!==null&&d.push(at,S),S},argPackAdvance:st,readValueFromPointer:$t,destructorFunction(d){at(d)}})},Hr=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0,Bn=(o,n)=>{R(o%2==0,"Pointer passed to UTF16ToString must be aligned to two bytes!");for(var a=o,d=a>>1,h=d+n/2;!(d>=h)&&X[d];)++d;if(a=d<<1,a-o>32&&Hr)return Hr.decode(N.subarray(o,a));for(var g="",C=0;!(C>=n/2);++C){var S=Q[o+C*2>>1];if(S==0)break;g+=String.fromCharCode(S)}return g},Nn=(o,n,a)=>{if(R(n%2==0,"Pointer passed to stringToUTF16 must be aligned to two bytes!"),R(typeof a=="number","stringToUTF16(str, outPtr, maxBytesToWrite) is missing the third parameter that specifies the length of the output buffer!"),a??(a=2147483647),a<2)return 0;a-=2;for(var d=n,h=a<o.length*2?a/2:o.length,g=0;g<h;++g){var C=o.charCodeAt(g);Q[n>>1]=C,He(C),n+=2}return Q[n>>1]=0,He(0),n-d},$n=o=>o.length*2,Gn=(o,n)=>{R(o%4==0,"Pointer passed to UTF32ToString must be aligned to four bytes!");for(var a=0,d="";!(a>=n/4);){var h=T[o+a*4>>2];if(h==0)break;if(++a,h>=65536){var g=h-65536;d+=String.fromCharCode(55296|g>>10,56320|g&1023)}else d+=String.fromCharCode(h)}return d},Un=(o,n,a)=>{if(R(n%4==0,"Pointer passed to stringToUTF32 must be aligned to four bytes!"),R(typeof a=="number","stringToUTF32(str, outPtr, maxBytesToWrite) is missing the third parameter that specifies the length of the output buffer!"),a??(a=2147483647),a<4)return 0;for(var d=n,h=d+a-4,g=0;g<o.length;++g){var C=o.charCodeAt(g);if(C>=55296&&C<=57343){var S=o.charCodeAt(++g);C=65536+((C&1023)<<10)|S&1023}if(T[n>>2]=C,Y(C),n+=4,n+4>h)break}return T[n>>2]=0,Y(0),n-d},Vn=o=>{for(var n=0,a=0;a<o.length;++a){var d=o.charCodeAt(a);d>=55296&&d<=57343&&++a,n+=4}return n},Hn=(o,n,a)=>{a=Ue(a);var d,h,g,C;n===2?(d=Bn,h=Nn,C=$n,g=S=>X[S>>1]):n===4&&(d=Gn,h=Un,C=Vn,g=S=>P[S>>2]),tt(o,{name:a,fromWireType:S=>{for(var v=P[S>>2],A,O=S+4,B=0;B<=v;++B){var G=S+4+B*n;if(B==v||g(G)==0){var W=G-O,se=d(O,W);A===void 0?A=se:(A+=String.fromCharCode(0),A+=se),O=G+n}}return at(S),A},toWireType:(S,v)=>{typeof v!="string"&&Ce(`Cannot pass non-string to C++ string type ${a}`);var A=C(v),O=Tt(4+A+n);return P[O>>2]=A/n,Y(A/n),h(v,O+4,A+n),S!==null&&S.push(at,O),O},argPackAdvance:st,readValueFromPointer:$t,destructorFunction(S){at(S)}})},zn=(o,n)=>{n=Ue(n),tt(o,{isVoid:!0,name:n,argPackAdvance:0,fromWireType:()=>{},toWireType:(a,d)=>{}})},Wn=1,Yn=()=>Wn,Qn=o=>{o>9&&(Ve[o+1]+=1)},Xn=(o,n)=>{var a=ut[o];return a===void 0&&Ce(`${n} has unknown type ${Nr(o)}`),a},qn=(o,n)=>{o=Xn(o,"_emval_take_value");var a=o.readValueFromPointer(n);return zt.toHandle(a)},_r=(o,n)=>(R(o==o>>>0||o==(o|0)),R(n===(n|0)),n+2097152>>>0<4194305-!!o?(o>>>0)+n*4294967296:NaN);function Jn(o,n,a){var d=_r(o,n),h=new Date(d*1e3);T[a>>2]=h.getUTCSeconds(),Y(h.getUTCSeconds()),T[a+4>>2]=h.getUTCMinutes(),Y(h.getUTCMinutes()),T[a+8>>2]=h.getUTCHours(),Y(h.getUTCHours()),T[a+12>>2]=h.getUTCDate(),Y(h.getUTCDate()),T[a+16>>2]=h.getUTCMonth(),Y(h.getUTCMonth()),T[a+20>>2]=h.getUTCFullYear()-1900,Y(h.getUTCFullYear()-1900),T[a+24>>2]=h.getUTCDay(),Y(h.getUTCDay());var g=Date.UTC(h.getUTCFullYear(),0,1,0,0,0,0),C=(h.getTime()-g)/(1e3*60*60*24)|0;T[a+28>>2]=C,Y(C)}var Et=o=>o%4===0&&(o%100!==0||o%400===0),Zn=[0,31,60,91,121,152,182,213,244,274,305,335],es=[0,31,59,90,120,151,181,212,243,273,304,334],zr=o=>{var n=Et(o.getFullYear()),a=n?Zn:es,d=a[o.getMonth()]+o.getDate()-1;return d};function ts(o,n,a){var d=_r(o,n),h=new Date(d*1e3);T[a>>2]=h.getSeconds(),Y(h.getSeconds()),T[a+4>>2]=h.getMinutes(),Y(h.getMinutes()),T[a+8>>2]=h.getHours(),Y(h.getHours()),T[a+12>>2]=h.getDate(),Y(h.getDate()),T[a+16>>2]=h.getMonth(),Y(h.getMonth()),T[a+20>>2]=h.getFullYear()-1900,Y(h.getFullYear()-1900),T[a+24>>2]=h.getDay(),Y(h.getDay());var g=zr(h)|0;T[a+28>>2]=g,Y(g),T[a+36>>2]=-(h.getTimezoneOffset()*60),Y(-(h.getTimezoneOffset()*60));var C=new Date(h.getFullYear(),0,1),S=new Date(h.getFullYear(),6,1).getTimezoneOffset(),v=C.getTimezoneOffset(),A=(S!=v&&h.getTimezoneOffset()==Math.min(v,S))|0;T[a+32>>2]=A,Y(A)}var rs=function(o){var n=(()=>{var a=new Date(T[o+20>>2]+1900,T[o+16>>2],T[o+12>>2],T[o+8>>2],T[o+4>>2],T[o>>2],0),d=T[o+32>>2],h=a.getTimezoneOffset(),g=new Date(a.getFullYear(),0,1),C=new Date(a.getFullYear(),6,1).getTimezoneOffset(),S=g.getTimezoneOffset(),v=Math.min(S,C);if(d<0)T[o+32>>2]=+(C!=S&&v==h),Y(+(C!=S&&v==h));else if(d>0!=(v==h)){var A=Math.max(S,C),O=d>0?v:A;a.setTime(a.getTime()+(O-h)*6e4)}T[o+24>>2]=a.getDay(),Y(a.getDay());var B=zr(a)|0;T[o+28>>2]=B,Y(B),T[o>>2]=a.getSeconds(),Y(a.getSeconds()),T[o+4>>2]=a.getMinutes(),Y(a.getMinutes()),T[o+8>>2]=a.getHours(),Y(a.getHours()),T[o+12>>2]=a.getDate(),Y(a.getDate()),T[o+16>>2]=a.getMonth(),Y(a.getMonth()),T[o+20>>2]=a.getYear(),Y(a.getYear());var G=a.getTime();return isNaN(G)?-1:G/1e3})();return Ds((ee=n,+Math.abs(ee)>=1?ee>0?+Math.floor(ee/4294967296)>>>0:~~+Math.ceil((ee-+(~~ee>>>0))/4294967296)>>>0:0)),n>>>0},Wr=o=>{var n=Rt(o)+1,a=Tt(n);return a&&xt(o,a,n),a},os=(o,n,a)=>{var d=new Date().getFullYear(),h=new Date(d,0,1),g=new Date(d,6,1),C=h.getTimezoneOffset(),S=g.getTimezoneOffset(),v=Math.max(C,S);P[o>>2]=v*60,Y(v*60),T[n>>2]=+(C!=S),Y(+(C!=S));function A(se){var ve=se.toTimeString().match(/\(([A-Za-z ]+)\)$/);return ve?ve[1]:"GMT"}var O=A(h),B=A(g),G=Wr(O),W=Wr(B);S<C?(P[a>>2]=G,Y(G),P[a+4>>2]=W,Y(W)):(P[a>>2]=W,Y(W),P[a+4>>2]=G,Y(G))},ns=()=>{ie("native code called abort()")},ss=()=>Date.now(),as=o=>U(We(o)),Yr=()=>2147483648,is=()=>Yr(),Wt;Wt=()=>performance.now();var cs=(o,n,a)=>N.copyWithin(o,n,n+a),ls=o=>{var n=z.buffer,a=(o-n.byteLength+65535)/65536;try{return z.grow(a),he(),1}catch(d){U(`growMemory: Attempted to grow heap from ${n.byteLength} bytes to ${o} bytes, but got error: ${d}`)}},ds=o=>{var n=N.length;o>>>=0,R(o>n);var a=Yr();if(o>a)return U(`Cannot enlarge memory, requested ${o} bytes, but the limit is ${a} bytes!`),!1;for(var d=(O,B)=>O+(B-O%B)%B,h=1;h<=4;h*=2){var g=n*(1+.2/h);g=Math.min(g,o+100663296);var C=Math.min(a,d(Math.max(o,g),65536)),S=Wt(),v=ls(C),A=Wt();if(fo(`Heap resize call from ${n} to ${C} took ${A-S} msecs. Success: ${!!v}`),v)return!0}return U(`Failed to grow the heap from ${n} bytes to ${C} bytes, not enough memory!`),!1},fr={},us=()=>c||"./this.program",Mt=()=>{if(!Mt.strings){var o=(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",n={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:o,_:us()};for(var a in fr)fr[a]===void 0?delete n[a]:n[a]=fr[a];var d=[];for(var a in n)d.push(`${a}=${n[a]}`);Mt.strings=d}return Mt.strings},ps=(o,n)=>{for(var a=0;a<o.length;++a)R(o.charCodeAt(a)===(o.charCodeAt(a)&255)),H[n++]=o.charCodeAt(a),lt(o.charCodeAt(a));H[n]=0,lt(0)},hs=(o,n)=>{var a=0;return Mt().forEach((d,h)=>{var g=n+a;P[o+h*4>>2]=g,Y(g),ps(d,g),a+=d.length+1}),0},_s=(o,n)=>{var a=Mt();P[o>>2]=a.length,Y(a.length);var d=0;return a.forEach(h=>d+=h.length+1),P[n>>2]=d,Y(d),0};function fs(o){try{var n=le.getStreamFromFD(o);return _.close(n),0}catch(a){if(typeof _>"u"||a.name!=="ErrnoError")throw a;return a.errno}}function gs(o,n){try{var a=0,d=0,h=0,g=le.getStreamFromFD(o),C=g.tty?2:_.isDir(g.mode)?3:_.isLink(g.mode)?7:4;return H[n]=C,lt(C),Q[n+2>>1]=h,He(h),xe=[a>>>0,(ee=a,+Math.abs(ee)>=1?ee>0?+Math.floor(ee/4294967296)>>>0:~~+Math.ceil((ee-+(~~ee>>>0))/4294967296)>>>0:0)],T[n+8>>2]=xe[0],T[n+12>>2]=xe[1],ze(a),xe=[d>>>0,(ee=d,+Math.abs(ee)>=1?ee>0?+Math.floor(ee/4294967296)>>>0:~~+Math.ceil((ee-+(~~ee>>>0))/4294967296)>>>0:0)],T[n+16>>2]=xe[0],T[n+20>>2]=xe[1],ze(d),0}catch(S){if(typeof _>"u"||S.name!=="ErrnoError")throw S;return S.errno}}var Cs=(o,n,a,d)=>{for(var h=0,g=0;g<a;g++){var C=P[n>>2],S=P[n+4>>2];n+=8;var v=_.read(o,H,C,S,d);if(v<0)return-1;if(h+=v,v<S)break;typeof d<"u"&&(d+=v)}return h};function ms(o,n,a,d){try{var h=le.getStreamFromFD(o),g=Cs(h,n,a);return P[d>>2]=g,Y(g),0}catch(C){if(typeof _>"u"||C.name!=="ErrnoError")throw C;return C.errno}}function ys(o,n,a,d,h){var g=_r(n,a);try{if(isNaN(g))return 61;var C=le.getStreamFromFD(o);return _.llseek(C,g,d),xe=[C.position>>>0,(ee=C.position,+Math.abs(ee)>=1?ee>0?+Math.floor(ee/4294967296)>>>0:~~+Math.ceil((ee-+(~~ee>>>0))/4294967296)>>>0:0)],T[h>>2]=xe[0],T[h+4>>2]=xe[1],ze(C.position),C.getdents&&g===0&&d===0&&(C.getdents=null),0}catch(S){if(typeof _>"u"||S.name!=="ErrnoError")throw S;return S.errno}}var Ss=(o,n,a,d)=>{for(var h=0,g=0;g<a;g++){var C=P[n>>2],S=P[n+4>>2];n+=8;var v=_.write(o,H,C,S,d);if(v<0)return-1;h+=v,typeof d<"u"&&(d+=v)}return h};function xs(o,n,a,d){try{var h=le.getStreamFromFD(o),g=Ss(h,n,a);return P[d>>2]=g,Y(g),0}catch(C){if(typeof _>"u"||C.name!=="ErrnoError")throw C;return C.errno}}var Ks=(o,n,a,d)=>{var h=0,g=0,C=0,S=0,v=0,A=0,O;function B(G,W,se,ve,Me,Re){var $,Z,me,ye;return Z=G===10?28:16,Me=G===10?Mr(Me):rr(Me),$=Tt(Z),ye=sr($,G,Me,Re),R(!ye),me=Tt(32),T[me+4>>2]=G,Y(G),T[me+8>>2]=W,Y(W),T[me+12>>2]=se,Y(se),P[me+24>>2]=ve,P[me+20>>2]=$,G===10?(T[me+16>>2]=28,Y(28)):(T[me+16>>2]=16,Y(16)),T[me+28>>2]=0,Y(0),me}if(a&&(C=T[a>>2],S=T[a+4>>2],v=T[a+8>>2],A=T[a+12>>2]),v&&!A&&(A=v===2?17:6),!v&&A&&(v=A===17?2:1),A===0&&(A=6),v===0&&(v=1),!o&&!n)return-2;if(C&-1088||a!==0&&T[a>>2]&2&&!o)return-1;if(C&32)return-2;if(v!==0&&v!==1&&v!==2)return-7;if(S!==0&&S!==2&&S!==10)return-6;if(n&&(n=We(n),g=parseInt(n,10),isNaN(g)))return C&1024?-2:-8;if(!o)return S===0&&(S=2),C&1||(S===2?h=gr(2130706433):h=[0,0,0,1]),O=B(S,v,A,null,h,g),P[d>>2]=O,0;if(o=We(o),h=Ot(o),h!==null)if(S===0||S===2)S=2;else if(S===10&&C&8)h=[0,0,gr(65535),h],S=10;else return-2;else if(h=or(o),h!==null)if(S===0||S===10)S=10;else return-2;return h!=null?(O=B(S,v,A,o,h,g),P[d>>2]=O,0):C&4?-2:(o=Ge.lookup_name(o),h=Ot(o),S===0?S=2:S===10&&(h=[0,0,gr(65535),h]),O=B(S,v,A,null,h,g),P[d>>2]=O,0)},bs=(o,n,a,d,h,g,C)=>{var S=Tr(o,n);if(S.errno)return-6;var v=S.port,A=S.addr,O=!1;if(a&&d){var B;if(C&1||!(B=Ge.lookup_addr(A))){if(C&8)return-2}else A=B;var G=xt(A,a,d);G+1>=d&&(O=!0)}if(h&&g){v=""+v;var G=xt(v,h,g);G+1>=g&&(O=!0)}return O?-12:0},vs=(o,n)=>{for(var a=0,d=0;d<=n;a+=o[d++]);return a},Qr=[31,29,31,30,31,30,31,31,30,31,30,31],Xr=[31,28,31,30,31,30,31,31,30,31,30,31],ws=(o,n)=>{for(var a=new Date(o.getTime());n>0;){var d=Et(a.getFullYear()),h=a.getMonth(),g=(d?Qr:Xr)[h];if(n>g-a.getDate())n-=g-a.getDate()+1,a.setDate(1),h<11?a.setMonth(h+1):(a.setMonth(0),a.setFullYear(a.getFullYear()+1));else return a.setDate(a.getDate()+n),a}return a},Es=(o,n)=>{R(o.length>=0,"writeArrayToMemory array must have a length (should be an array or typed array)"),H.set(o,n)},qr=(o,n,a,d)=>{var h=P[d+40>>2],g={tm_sec:T[d>>2],tm_min:T[d+4>>2],tm_hour:T[d+8>>2],tm_mday:T[d+12>>2],tm_mon:T[d+16>>2],tm_year:T[d+20>>2],tm_wday:T[d+24>>2],tm_yday:T[d+28>>2],tm_isdst:T[d+32>>2],tm_gmtoff:T[d+36>>2],tm_zone:h?We(h):""},C=We(a),S={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var v in S)C=C.replace(new RegExp(v,"g"),S[v]);var A=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],O=["January","February","March","April","May","June","July","August","September","October","November","December"];function B($,Z,me){for(var ye=typeof $=="number"?$.toString():$||"";ye.length<Z;)ye=me[0]+ye;return ye}function G($,Z){return B($,Z,"0")}function W($,Z){function me(Be){return Be<0?-1:Be>0?1:0}var ye;return(ye=me($.getFullYear()-Z.getFullYear()))===0&&(ye=me($.getMonth()-Z.getMonth()))===0&&(ye=me($.getDate()-Z.getDate())),ye}function se($){switch($.getDay()){case 0:return new Date($.getFullYear()-1,11,29);case 1:return $;case 2:return new Date($.getFullYear(),0,3);case 3:return new Date($.getFullYear(),0,2);case 4:return new Date($.getFullYear(),0,1);case 5:return new Date($.getFullYear()-1,11,31);case 6:return new Date($.getFullYear()-1,11,30)}}function ve($){var Z=ws(new Date($.tm_year+1900,0,1),$.tm_yday),me=new Date(Z.getFullYear(),0,4),ye=new Date(Z.getFullYear()+1,0,4),Be=se(me),Ie=se(ye);return W(Be,Z)<=0?W(Ie,Z)<=0?Z.getFullYear()+1:Z.getFullYear():Z.getFullYear()-1}var Me={"%a":$=>A[$.tm_wday].substring(0,3),"%A":$=>A[$.tm_wday],"%b":$=>O[$.tm_mon].substring(0,3),"%B":$=>O[$.tm_mon],"%C":$=>{var Z=$.tm_year+1900;return G(Z/100|0,2)},"%d":$=>G($.tm_mday,2),"%e":$=>B($.tm_mday,2," "),"%g":$=>ve($).toString().substring(2),"%G":ve,"%H":$=>G($.tm_hour,2),"%I":$=>{var Z=$.tm_hour;return Z==0?Z=12:Z>12&&(Z-=12),G(Z,2)},"%j":$=>G($.tm_mday+vs(Et($.tm_year+1900)?Qr:Xr,$.tm_mon-1),3),"%m":$=>G($.tm_mon+1,2),"%M":$=>G($.tm_min,2),"%n":()=>`
`,"%p":$=>$.tm_hour>=0&&$.tm_hour<12?"AM":"PM","%S":$=>G($.tm_sec,2),"%t":()=>"	","%u":$=>$.tm_wday||7,"%U":$=>{var Z=$.tm_yday+7-$.tm_wday;return G(Math.floor(Z/7),2)},"%V":$=>{var Z=Math.floor(($.tm_yday+7-($.tm_wday+6)%7)/7);if(($.tm_wday+371-$.tm_yday-2)%7<=2&&Z++,Z){if(Z==53){var ye=($.tm_wday+371-$.tm_yday)%7;ye!=4&&(ye!=3||!Et($.tm_year))&&(Z=1)}}else{Z=52;var me=($.tm_wday+7-$.tm_yday-1)%7;(me==4||me==5&&Et($.tm_year%400-1))&&Z++}return G(Z,2)},"%w":$=>$.tm_wday,"%W":$=>{var Z=$.tm_yday+7-($.tm_wday+6)%7;return G(Math.floor(Z/7),2)},"%y":$=>($.tm_year+1900).toString().substring(2),"%Y":$=>$.tm_year+1900,"%z":$=>{var Z=$.tm_gmtoff,me=Z>=0;return Z=Math.abs(Z)/60,Z=Z/60*100+Z%60,(me?"+":"-")+("0000"+Z).slice(-4)},"%Z":$=>$.tm_zone,"%%":()=>"%"};C=C.replace(/%%/g,"\0\0");for(var v in Me)C.includes(v)&&(C=C.replace(new RegExp(v,"g"),Me[v](g)));C=C.replace(/\0\0/g,"%");var Re=It(C,!1);return Re.length>n?0:(Es(Re,o),Re.length-1)},Ms=(o,n,a,d,h)=>qr(o,n,a,d),Jr=function(o,n,a,d){o||(o=this),this.parent=o,this.mount=o.mount,this.mounted=null,this.id=_.nextInode++,this.name=n,this.mode=a,this.node_ops={},this.stream_ops={},this.rdev=d},Yt=365,Qt=146;Object.defineProperties(Jr.prototype,{read:{get:function(){return(this.mode&Yt)===Yt},set:function(o){o?this.mode|=Yt:this.mode&=~Yt}},write:{get:function(){return(this.mode&Qt)===Qt},set:function(o){o?this.mode|=Qt:this.mode&=~Qt}},isFolder:{get:function(){return _.isDir(this.mode)}},isDevice:{get:function(){return _.isChrdev(this.mode)}}}),_.FSNode=Jr,_.createPreloadedFile=Mo,_.staticInit(),r.FS_createPath=_.createPath,r.FS_createDataFile=_.createDataFile,r.FS_createPreloadedFile=_.createPreloadedFile,r.FS_unlink=_.unlink,r.FS_createLazyFile=_.createLazyFile,r.FS_createDevice=_.createDevice,qo(),gt=r.BindingError=class extends Error{constructor(n){super(n),this.name="BindingError"}},Lr=r.InternalError=class extends Error{constructor(n){super(n),this.name="InternalError"}},ln(),sn(),Cn(),Br=r.UnboundTypeError=xn(Error,"UnboundTypeError"),An();function Ts(){no("fetchSettings")}var Zr={__assert_fail:Co,__cxa_throw:yo,__handle_stack_overflow:So,__syscall_bind:Lo,__syscall_connect:Do,__syscall_faccessat:Ro,__syscall_fcntl64:Io,__syscall_fstat64:Oo,__syscall_getdents64:Po,__syscall_getsockname:ko,__syscall_getsockopt:Fo,__syscall_ioctl:jo,__syscall_lstat64:Bo,__syscall_newfstatat:No,__syscall_openat:$o,__syscall_poll:Go,__syscall_recvfrom:Uo,__syscall_renameat:Vo,__syscall_rmdir:Ho,__syscall_sendto:zo,__syscall_socket:Wo,__syscall_stat64:Yo,__syscall_unlinkat:Qo,_embind_register_bigint:Xo,_embind_register_bool:Zo,_embind_register_class:Kn,_embind_register_class_constructor:En,_embind_register_class_function:Mn,_embind_register_emval:Vr,_embind_register_float:Rn,_embind_register_function:In,_embind_register_integer:Pn,_embind_register_memory_view:kn,_embind_register_optional:Fn,_embind_register_std_string:jn,_embind_register_std_wstring:Hn,_embind_register_void:zn,_emscripten_get_now_is_monotonic:Yn,_emval_decref:Ur,_emval_incref:Qn,_emval_take_value:qn,_gmtime_js:Jn,_localtime_js:ts,_mktime_js:rs,_tzset_js:os,abort:ns,emscripten_date_now:ss,emscripten_err:as,emscripten_get_heap_max:is,emscripten_get_now:Wt,emscripten_memcpy_js:cs,emscripten_resize_heap:ds,environ_get:hs,environ_sizes_get:_s,fd_close:fs,fd_fdstat_get:gs,fd_read:ms,fd_seek:ys,fd_write:xs,getaddrinfo:Ks,getnameinfo:bs,strftime:qr,strftime_l:Ms},rt=qt(),Tt=_e("malloc"),at=_e("free"),As=_e("fflush"),Ls=_e("__getTypeName"),gr=_e("htonl"),At=_e("htons"),eo=_e("ntohs"),Ds=_e("setTempRet0"),to=()=>(to=rt.emscripten_stack_init)(),Cr=()=>(Cr=rt.emscripten_stack_get_base)(),Lt=()=>(Lt=rt.emscripten_stack_get_end)(),Rs=_e("__cxa_is_pointer_type"),Is=r.___set_stack_limits=_e("__set_stack_limits");r.dynCall_jiji=_e("dynCall_jiji"),r.dynCall_iiiji=_e("dynCall_iiiji"),r.dynCall_iiijjji=_e("dynCall_iiijjji"),r.dynCall_jiiij=_e("dynCall_jiiij"),r.dynCall_iiiiij=_e("dynCall_iiiiij"),r.dynCall_iiiiiij=_e("dynCall_iiiiiij"),r.dynCall_jiiji=_e("dynCall_jiiji"),r.dynCall_ijii=_e("dynCall_ijii"),r.dynCall_viiiiij=_e("dynCall_viiiiij"),r.dynCall_iiij=_e("dynCall_iiij"),r.dynCall_iiijiiii=_e("dynCall_iiijiiii"),r.dynCall_ji=_e("dynCall_ji"),r.dynCall_viijii=_e("dynCall_viijii"),r.dynCall_iiiiijj=_e("dynCall_iiiiijj"),r.dynCall_iiiiiijj=_e("dynCall_iiiiiijj"),r._ff_h264_cabac_tables=806268,r.addRunDependency=ue,r.removeRunDependency=Ke,r.FS_createPath=_.createPath,r.FS_createLazyFile=_.createLazyFile,r.FS_createDevice=_.createDevice,r.FS_createPreloadedFile=_.createPreloadedFile,r.FS=_,r.FS_createDataFile=_.createDataFile,r.FS_unlink=_.unlink;var Os=["writeI53ToI64","writeI53ToI64Clamped","writeI53ToI64Signaling","writeI53ToU64Clamped","writeI53ToU64Signaling","readI53FromI64","readI53FromU64","convertI32PairToI53","convertU32PairToI53","exitJS","getCallstack","emscriptenLog","convertPCtoSourceLocation","readEmAsmArgs","listenOnce","autoResumeAudioContext","handleException","keepRuntimeAlive","runtimeKeepalivePush","runtimeKeepalivePop","callUserCallback","maybeExit","asmjsMangle","HandleAllocator","getNativeTypeSize","STACK_SIZE","STACK_ALIGN","POINTER_SIZE","ASSERTIONS","getCFunc","ccall","cwrap","uleb128Encode","sigToWasmTypes","generateFuncType","convertJsFunctionToWasm","getEmptyTableSlot","updateTableMap","getFunctionAddress","addFunction","removeFunction","reallyNegative","unSign","strLen","reSign","formatString","intArrayToString","AsciiToString","stringToUTF8OnStack","registerKeyEventCallback","maybeCStringToJsString","findEventTarget","getBoundingClientRect","fillMouseEventData","registerMouseEventCallback","registerWheelEventCallback","registerUiEventCallback","registerFocusEventCallback","fillDeviceOrientationEventData","registerDeviceOrientationEventCallback","fillDeviceMotionEventData","registerDeviceMotionEventCallback","screenOrientation","fillOrientationChangeEventData","registerOrientationChangeEventCallback","fillFullscreenChangeEventData","registerFullscreenChangeEventCallback","JSEvents_requestFullscreen","JSEvents_resizeCanvasForFullscreen","registerRestoreOldStyle","hideEverythingExceptGivenElement","restoreHiddenElements","setLetterbox","softFullscreenResizeWebGLRenderTarget","doRequestFullscreen","fillPointerlockChangeEventData","registerPointerlockChangeEventCallback","registerPointerlockErrorEventCallback","requestPointerLock","fillVisibilityChangeEventData","registerVisibilityChangeEventCallback","registerTouchEventCallback","fillGamepadEventData","registerGamepadEventCallback","registerBeforeUnloadEventCallback","fillBatteryEventData","battery","registerBatteryEventCallback","setCanvasElementSize","getCanvasElementSize","jsStackTrace","stackTrace","checkWasiClock","wasiRightsToMuslOFlags","wasiOFlagsToMuslOFlags","createDyncallWrapper","safeSetTimeout","setImmediateWrapped","clearImmediateWrapped","polyfillSetImmediate","getPromise","makePromise","idsToPromises","makePromiseCallback","findMatchingCatch","Browser_asyncPrepareDataCounter","setMainLoop","FS_mkdirTree","_setNetworkCallback","heapObjectForWebGLType","toTypedArrayIndex","webgl_enable_ANGLE_instanced_arrays","webgl_enable_OES_vertex_array_object","webgl_enable_WEBGL_draw_buffers","webgl_enable_WEBGL_multi_draw","emscriptenWebGLGet","computeUnpackAlignedImageSize","colorChannelsInGlTextureFormat","emscriptenWebGLGetTexPixelData","emscriptenWebGLGetUniform","webglGetUniformLocation","webglPrepareUniformLocationsBeforeFirstUse","webglGetLeftBracePos","emscriptenWebGLGetVertexAttrib","__glGetActiveAttribOrUniform","writeGLArray","registerWebGlEventCallback","runAndAbortIfError","SDL_unicode","SDL_ttfContext","SDL_audio","ALLOC_NORMAL","ALLOC_STACK","allocate","writeStringToMemory","writeAsciiToMemory","setErrNo","demangle","getFunctionArgsName","createJsInvokerSignature","registerInheritedInstance","unregisterInheritedInstance","enumReadValueFromPointer","validateThis","getStringOrSymbol","emval_get_global","emval_returnValue","emval_lookupTypes","emval_addMethodCaller"];Os.forEach(so);var Ps=["run","addOnPreRun","addOnInit","addOnPreMain","addOnExit","addOnPostRun","FS_createFolder","FS_createLink","FS_readFile","out","err","callMain","abort","wasmMemory","wasmExports","stackAlloc","stackSave","stackRestore","getTempRet0","setTempRet0","writeStackCookie","checkStackCookie","convertI32PairToI53Checked","ptrToString","zeroMemory","getHeapMax","growMemory","ENV","setStackLimits","MONTH_DAYS_REGULAR","MONTH_DAYS_LEAP","MONTH_DAYS_REGULAR_CUMULATIVE","MONTH_DAYS_LEAP_CUMULATIVE","isLeapYear","ydayFromDate","arraySum","addDays","ERRNO_CODES","ERRNO_MESSAGES","inetPton4","inetNtop4","inetPton6","inetNtop6","readSockaddr","writeSockaddr","DNS","Protocols","Sockets","initRandomFill","randomFill","timers","warnOnce","UNWIND_CACHE","readEmAsmArgsArray","jstoi_q","jstoi_s","getExecutableName","dynCallLegacy","getDynCaller","dynCall","asyncLoad","alignMemory","mmapAlloc","wasmTable","noExitRuntime","freeTableIndexes","functionsInTableMap","setValue","getValue","PATH","PATH_FS","UTF8Decoder","UTF8ArrayToString","UTF8ToString","stringToUTF8Array","stringToUTF8","lengthBytesUTF8","intArrayFromString","stringToAscii","UTF16Decoder","UTF16ToString","stringToUTF16","lengthBytesUTF16","UTF32ToString","stringToUTF32","lengthBytesUTF32","stringToNewUTF8","writeArrayToMemory","JSEvents","specialHTMLTargets","findCanvasEventTarget","currentFullscreenStrategy","restoreOldWindowedStyle","ExitStatus","getEnvStrings","doReadv","doWritev","promiseMap","uncaughtExceptionCount","exceptionLast","exceptionCaught","ExceptionInfo","Browser","getPreloadedImageData__data","wget","SYSCALLS","getSocketFromFD","getSocketAddress","preloadPlugins","FS_modeStringToFlags","FS_getMode","FS_stdin_getChar_buffer","FS_stdin_getChar","MEMFS","TTY","PIPEFS","SOCKFS","tempFixedLengthArray","miniTempWebGLFloatBuffers","miniTempWebGLIntBuffers","GL","AL","GLUT","EGL","GLEW","IDBStore","SDL","SDL_gfx","allocateUTF8","allocateUTF8OnStack","InternalError","BindingError","throwInternalError","throwBindingError","registeredTypes","awaitingDependencies","typeDependencies","tupleRegistrations","structRegistrations","sharedRegisterType","whenDependentTypesAreResolved","embind_charCodes","embind_init_charCodes","readLatin1String","getTypeName","getFunctionName","heap32VectorToArray","requireRegisteredType","usesDestructorStack","createJsInvoker","UnboundTypeError","PureVirtualError","GenericWireTypeSize","EmValType","init_embind","throwUnboundTypeError","ensureOverloadTable","exposePublicSymbol","replacePublicSymbol","extendError","createNamedFunction","embindRepr","registeredInstances","getBasestPointer","getInheritedInstance","getInheritedInstanceCount","getLiveInheritedInstances","registeredPointers","registerType","integerReadValueFromPointer","floatReadValueFromPointer","readPointer","runDestructors","newFunc","craftInvokerFunction","embind__requireFunction","genericPointerToWireType","constNoSmartPtrRawPointerToWireType","nonConstNoSmartPtrRawPointerToWireType","init_RegisteredPointer","RegisteredPointer","RegisteredPointer_fromWireType","runDestructor","releaseClassHandle","finalizationRegistry","detachFinalizer_deps","detachFinalizer","attachFinalizer","makeClassHandle","init_ClassHandle","ClassHandle","throwInstanceAlreadyDeleted","deletionQueue","flushPendingDeletes","delayFunction","setDelayFunction","RegisteredClass","shallowCopyInternalPointer","downcastPointer","upcastPointer","char_0","char_9","makeLegalFunctionName","emval_freelist","emval_handles","emval_symbols","init_emval","count_emval_handles","Emval","emval_methodCallers","reflectConstruct","IDBFS"];Ps.forEach(xr);var Xt;fe=function o(){Xt||ro(),Xt||(fe=o)};function ks(){to(),Te()}function ro(){if(Se>0||(ks(),Xe(),Se>0))return;function o(){Xt||(Xt=!0,r.calledRun=!0,!te&&(it(),s(r),r.onRuntimeInitialized&&r.onRuntimeInitialized(),R(!r._main,'compiled without a main, but one is present. if you added it from JS, use Module["onRuntimeInitialized"]'),ct()))}r.setStatus?(r.setStatus("Running..."),setTimeout(function(){setTimeout(function(){r.setStatus("")},1),o()},1)):o(),Ae()}if(r.preInit)for(typeof r.preInit=="function"&&(r.preInit=[r.preInit]);r.preInit.length>0;)r.preInit.pop()();return ro(),t.ready}})();let module,loading=!1;const useKbres=()=>{const[e,t]=reactExports.useState(null),[r,s]=reactExports.useState(!1),i=reactExports.useRef();return reactExports.useEffect(()=>{if(loading){i.current=setInterval(()=>{module!==void 0&&(s(!0),t(module),clearInterval(i.current))},1e3);return}if(module!==void 0){s(!0),t(module);return}return loading=!0,console.log("kbres loading"),createModule().then(l=>{module=l,s(!0),t(l)}).catch(l=>{console.log(l)}).finally(()=>{loading=!1,console.log("kbres load ended")}),()=>{clearInterval(i.current)}},[]),{kbres:e,loaded:r}},title$2="Matrix Lighting",MatrixLightingPane=styled(CenterPane)`
  height: 100%;
  overflow: auto;
  grid-column: span 2;
`,Container$e=styled.div`
  display: flex;
  align-items: center;
  padding: 16px;
  flex-direction: column;
`,MatrixEditor=styled.div`
  display: flex;
  // align-items: flex-end;
  justify-content: center;
  width: 100%;
  max-width: 960px;
`,MatrixConfigure=styled.div`
  margin-left: 20px;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
`,MatrixControlRows=styled.div`
  width: 400px;
`,MatrixIndex=styled.div`
  font-size: 14px;
  color: var(--color_label);
`,MatrixWrapper=styled.div`
  border: 1px solid var(--border_color_cell);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  border-radius: 5px;
  padding: 1px;
  background: var(--bg_menu);
  height: fit-content;
`,Light=styled.div.attrs(({$color:e})=>({style:{background:`rgb(${e.r},${e.g},${e.b})`,boxShadow:`rgba(0, 0, 0, 0.15) 0px 0px 0px 1px inset, rgb(${e.r},${e.g},${e.b}) 0px 0px 3px`}}))`
  width: 20px;
  height: 20px;
  display: inline-block;
  border-radius: 50%;
  cursor: pointer;
  margin: 1px;
`,ColorPicker=styled(SketchPicker)`
  line-height: 1;
  input {
    color: var(--color_accent);
    background: none;
    border: none !important;
    border-bottom: 1px solid var(--color_accent) !important;
    box-shadow: none !important;
    text-align: center;
  }
  label {
    color: var(--color_accent) !important;
  }
  .flexbox-fix {
    border: none !important;
  }
  position: absolute;
  transform: translate3d(14px, -22px, 0);
  z-index: 1;
  &::after {
    content: '';
    position: absolute;
    width: 0px;
    height: 0px;
    border: 11px solid var(--border_color_cell);
    border-top-color: transparent;
    border-bottom-color: transparent;
    border-left-color: transparent;
    top: 12px;
    left: -22px;
    pointer-events: none;
  }
`,ColorPreview=styled.div`
  width: 20px;
  height: 20px;
  border-radius: 20px;
  background: ${e=>`rgb(${e.$color.r},${e.$color.g},${e.$color.b})`};
  border: 1px solid var(--color_accent);
  cursor: pointer;
  margin-left: 5px;
`,MatrixList=styled.div`
  margin-top: 20px;
  display: flex;
  width: 100%;
  border-top: 1px solid var(--border_color_cell);
  padding-top: 10px;
  flex-wrap: wrap;
  & > div {
    margin: 0 6px 6px 0;
  }
`,MatrixButtons=styled.div`
  border-radius: 2px;
  border: 1px solid var(--border_color_icon);
  display: inline-flex;
  > button:last-child {
    border: none;
  }
`,FpsSelect=styled(AccentSelect)`
  > div[class*='-control'] {
    width: 100%;
  }
`,FlexLabel$1=styled.div`
  color: var(--color_label);
  font-weight: 400;
  display: inline-flex;
  align-items: center;
`,HiddenInput$2=styled.input`
  display: none;
`,MainMatrixContainer=styled.div`
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
`,getMatrixData=(e,t,r,s,i)=>{const l=r*s*i,c=Array(s).fill(0).map(()=>Array(r).fill({r:0,g:0,b:0}));for(let u=t;u<t+l;u+=i){const p=u%l/i,f=~~(p/r),m=p%r,[y,K,x]=[e[u],e[u+1],e[u+2]];c[f][m]={r:y,g:K,b:x}}return c},Lighting=reactExports.memo(({color:e,row:t,col:r,changing:s})=>{const i=useAppDispatch(),l=f=>{f.button===0&&(s.current=!0,i(updateMatrix({row:t,col:r})),window.addEventListener("pointerup",u))},c=()=>{s.current&&i(updateMatrix({row:t,col:r}))},u=()=>{s.current=!1,window.removeEventListener("pointerup",u)};return jsx(Light,{onContextMenu:f=>{f.preventDefault(),i(updateColor(e))},onPointerDown:l,onPointerOver:c,$color:e})},shallowEqual),MatrixFrame=reactExports.memo(({matrix:e,index:t,active:r})=>{const s=useAppDispatch(),i=reactExports.useRef(null),l=e.length,c=e[0].length,u=c*5,p=l*5,f=x=>{x.preventDefault()},m=x=>{s(updateMatrixIndex(t))},y=x=>{t!==void 0&&s(sortMatrixByIndex({newIndex:t}))},K=reactExports.useCallback(()=>{if(!i.current)return;const x=i.current;x.width=10*c,x.height=10*l;const b=x.getContext("2d");for(let M=0;M<l;M++)for(let w=0;w<c;w++){const L=e[M][w];b.beginPath(),b.arc(w*10+5,M*10+5,4,0,Math.PI*2),b.fillStyle=`rgb(${L.r}, ${L.g}, ${L.b})`,b.shadowOffsetX=0,b.shadowOffsetY=0,b.shadowBlur=5,b.shadowColor=`rgb(${L.r}, ${L.g}, ${L.b})`,b.fill()}},[e]);return reactExports.useEffect(K,[e]),jsx("div",{style:{width:u,height:p,background:"#000",border:r?"1px solid var(--color_accent)":"1px solid var(--border_color_cell)",borderRadius:5,cursor:"pointer"},draggable:!0,onDragStart:m,onDragOver:f,onDragEnter:y,onClick:()=>s(updateMatrixIndex(t)),children:jsx("canvas",{style:{width:"100%",height:"100%"},ref:i})})},shallowEqual),MatrixPane=reactExports.memo(({matrix:e})=>{const t=reactExports.useRef(!1);return jsx(MatrixWrapper,{children:e.map((r,s)=>jsx("div",{style:{display:"flex"},children:r.map((i,l)=>jsx(Lighting,{color:i,row:s,col:l,changing:t},l))},s))})},shallowEqual),Pane$2=()=>{var fe,De;const{t:e,i18n:t}=useTranslation(),r=useAppDispatch(),{kbres:s}=useKbres(),i=useAppSelector(getActiveColor),l=useAppSelector(getMatrixList),c=useAppSelector(getMatrixIdx),u=useAppSelector(getActiveMatrix),p=useAppSelector(getFps),f=useAppSelector(getSaving),m=useAppSelector(getFileContent),y=useAppSelector(getRows),K=useAppSelector(getCols),[x,b]=reactExports.useState(!1),[M,w]=reactExports.useState(null),[L,F]=reactExports.useState(null),[I,k]=reactExports.useState(!1),[j,U]=reactExports.useState(!1),V=useAppSelector(getImportEnable),z=useAppSelector(getMaxFrame),te=useAppSelector(getCDCMacIssue);useAppSelector(getSelectedConnectedDevice);const R=(De=(fe=useAppSelector(getSelectedTabkbConfig))==null?void 0:fe.matrixLighting)==null?void 0:De.shareApi,H=reactExports.useMemo(()=>[5,10,15,20].map(re=>({label:re+" "+e("FPS"),value:re})),[t.language]),N=H.find(re=>re.value===p),Q=reactExports.useRef(null),X=reactExports.useRef(null),T=reactExports.useRef(null),P=reactExports.useRef(null),q=reactExports.useRef(null),ae=reactExports.useRef(),he={default:{picker:{background:"var(--border_color_cell)"}}},Te=["#000","#fff","#f00","#0f0","#00f","#ff0","#f0f","#0ff"],Ae=re=>{!I||!Q.current||!X.current||re.target!==X.current&&!Q.current.contains(re.target)&&k(!1)},$e=re=>{if(!re.target.files)return;const ue=new Image,Ke=URL.createObjectURL(re.target.files[0]);ue.onload=()=>{const ie=pixleImg(ue,K,y);r(setMatrix(getMatrixData(ie,0,K,y,4))),URL.revokeObjectURL(Ke),T.current&&(T.current.value="")},ue.src=Ke},Ye=async re=>{if(!re.target.files||!s||x)return;b(!0);const ue="pixel.out",Ke=re.target.files[0],ie=await Ke.arrayBuffer(),ge=new Uint8Array(ie);s.FS.writeFile(Ke.name,ge);const je=new s.IntVec;je.push_back(K),je.push_back(y),s.pixelit(Ke.name,ue,je,z);const Pe=s.FS.readFile(ue),_e=[],Oe=y*K*3;for(let Fe=0;Fe<Pe.length;Fe+=Oe)_e.push(getMatrixData(Pe,Fe,K,y,3));r(setMatrixList(_e)),P.current&&(P.current.value=""),b(!1)},ot=async re=>{if(w(null),!re.target.files)return;const ue=re.target.files[0];if(!ue)return;const Ke=new FileReader;Ke.onabort=()=>w(e("File reading was cancelled.")),Ke.onerror=()=>w(e("Failed to read file.")),Ke.onload=()=>{if(Ke.result){const ie=Array.from(new Uint8Array(Ke.result)),ge=ie.slice(0,mlHeaderSize),je=ie.slice(mlHeaderSize);if(!lodashExports.isEqual(mlHeader,ge.slice(0,mlHeader.length))){w(e("Could not load file: invalid data."));return}const[Pe,_e,Oe,Fe]=ge.slice(mlHeader.length);if(Pe===0||y!==Oe||K!==Fe||K*y*3*Pe!==je.length){w(e("Could not load file: invalid data."));return}r(loadFile({frames:Pe,fps:_e,data:je}))}},Ke.readAsArrayBuffer(ue),q.current&&(q.current.value="")},Qe=async()=>{try{await r(saveToKeyboard())}catch{w(e("Failed to save."))}},Xe=()=>{var re;(re=q.current)==null||re.click()},it=async()=>{const re=`via_lighting_${K}_${y}.tabml`;try{const ue=await window.showSaveFilePicker({suggestedName:re}),Ke=new Blob([Uint8Array.from(m)],{type:"octet/stream"}),ie=await ue.createWritable();await ie.write(Ke),await ie.close()}catch(ue){console.log(ue)}},[ct,oe]=reactExports.useState(!1),ne=()=>{if(ct||!R)return;const re=new AbortController,ue=re.signal;let Ke=new FormData;Ke.append("file",new Blob([Uint8Array.from(m)])),w(null),oe(!0),fetch(R,{method:"POST",body:Ke,signal:ue}).then(ie=>{if(ie.status!==200){console.log(ie.status),w(e("Sharing failed"));return}ie.json().then(ge=>{ge.error?(console.log(ge.error),w(e("Sharing failed"))):F(e("Sharing success")),setTimeout(()=>{F(null)},3e3)})}).catch(ie=>{console.log(ie),w(e("Sharing failed"))}).finally(()=>{oe(!1)}),setTimeout(()=>{re.abort(),oe(!1)},60*1e3)};reactExports.useEffect(()=>(document.addEventListener("click",Ae),()=>{document.removeEventListener("click",Ae)}),[I]),reactExports.useEffect(()=>(clearInterval(ae.current),j&&(ae.current=setInterval(()=>{r(nextMatrix())},1e3/p)),()=>{clearInterval(ae.current)}),[j,p]);const we=re=>{re.key==="ArrowRight"?r(shiftRight()):re.key==="ArrowLeft"?r(shiftLeft()):re.key==="ArrowUp"?r(shiftUp()):re.key==="ArrowDown"&&r(shiftDown())};reactExports.useEffect(()=>(window.addEventListener("keyup",we),()=>{window.removeEventListener("keyup",we)}),[]);const pe=navigator.userAgent.includes("Mac")&&te;return jsx(MatrixLightingPane,{onDragOver:re=>{re.preventDefault()},children:jsxs(Container$e,{children:[jsxs(MatrixEditor,{children:[jsxs(MainMatrixContainer,{children:[jsx(MatrixPane,{matrix:u}),jsxs(MatrixIndex,{children:[c+1,"/",l.length]})]}),jsx(MatrixConfigure,{children:jsxs(MatrixControlRows,{children:[jsxs(ControlRow,{style:{pointerEvents:j?"none":"auto"},children:[jsxs(FlexLabel$1,{children:[jsx(ColorPreview,{ref:X,onMouseOver:()=>k(!0),$color:i}),I&&jsx("div",{ref:Q,children:jsx(ColorPicker,{styles:he,presetColors:Te,disableAlpha:!0,color:i,onChange:re=>{r(updateColor(re.rgb))}})}),jsx(Fragment,{})]}),jsx(Detail,{children:jsx(MatrixButtons,{children:jsxs(IconButtonContainer,{onClick:()=>r(resetMatrix()),children:[jsx(FontAwesomeIcon,{size:"sm",icon:faTrash}),jsx(IconButtonTooltip,{children:e("Delete All")})]})})})]}),jsxs(ControlRow,{style:{pointerEvents:j?"none":"auto"},children:[jsx(FlexLabel$1,{children:jsxs(MatrixButtons,{children:[jsxs(IconButtonContainer,{disabled:l.length>=z,onClick:()=>r(copyMatrix()),children:[jsx(FontAwesomeIcon,{size:"sm",icon:faCopy}),jsx(IconButtonTooltip,{children:e("Copy")})]}),jsxs(IconButtonContainer,{disabled:l.length>=z,onClick:()=>r(addMatrix()),children:[jsx(FontAwesomeIcon,{size:"sm",icon:faAdd}),jsx(IconButtonTooltip,{children:e("Add")})]}),jsxs(IconButtonContainer,{onClick:()=>r(deleteMatrix()),children:[jsx(FontAwesomeIcon,{size:"sm",icon:faMinus}),jsx(IconButtonTooltip,{children:e("Delete")})]}),jsxs(IconButtonContainer,{onClick:()=>r(fillMatrix()),children:[jsx(FontAwesomeIcon,{size:"sm",icon:faRotateLeft}),jsx(IconButtonTooltip,{children:e("Reset")})]}),V&&jsxs(Fragment,{children:[jsxs(IconButtonContainer,{onClick:()=>{var re;return(re=T.current)==null?void 0:re.click()},children:[jsx(FontAwesomeIcon,{size:"sm",icon:faImage}),jsx(IconButtonTooltip,{children:e("Import Image")})]}),jsxs(IconButtonContainer,{onClick:()=>{var re;return(re=P.current)==null?void 0:re.click()},children:[jsx(FontAwesomeIcon,{size:"sm",icon:faVideo}),jsx(IconButtonTooltip,{children:e("Import Video")})]})]})]})}),jsxs(Detail,{children:[jsx(HiddenInput$2,{accept:"image/*",onChange:$e,type:"file",ref:T}),jsx(HiddenInput$2,{accept:"video/mp4,image/gif",onChange:Ye,type:"file",ref:P})]})]}),jsxs(ControlRow,{children:[jsx(FlexLabel$1,{children:jsx(Detail,{children:jsx(FpsSelect,{value:N,onChange:re=>r(setFps(re.value)),options:H})})}),jsx(Detail,{children:jsx(MatrixButtons,{children:jsxs(IconButtonContainer,{onClick:()=>U(!j),children:[jsx(FontAwesomeIcon,{size:"sm",icon:j?faStop:faPlay}),jsx(IconButtonTooltip,{children:e(j?"Stop":"Play")})]})})})]}),jsxs(ControlRow,{children:[jsx(FlexLabel$1,{children:jsxs(MatrixButtons,{children:[jsxs(IconButtonContainer,{onClick:Xe,children:[jsx(FontAwesomeIcon,{size:"sm",icon:faFileImport}),jsx(IconButtonTooltip,{children:e("Import File")})]}),jsx(HiddenInput$2,{accept:".tabml",onChange:ot,type:"file",ref:q}),jsxs(IconButtonContainer,{onClick:it,children:[jsx(FontAwesomeIcon,{size:"sm",icon:faDownload}),jsx(IconButtonTooltip,{children:e("Download File")})]}),R&&jsxs(IconButtonContainer,{onClick:ne,children:[jsx(FontAwesomeIcon,{size:"sm",icon:faShare}),jsx(IconButtonTooltip,{children:e("Share")})]})]})}),jsx(Detail,{children:jsx(AccentButton,{disabled:f||pe,onClick:Qe,children:e("Save")})})]}),M?jsx(ErrorMessage,{onClick:()=>w(null),children:M}):null,L?jsx(SuccessMessage,{onClick:()=>F(null),children:L}):null]})})]}),pe&&jsx("div",{style:{padding:"20px 0 0",color:"var(--color_label)"},children:e("MATRIX_LED_MAC_NOTSUPPORT")}),jsx(MatrixList,{children:l.map((re,ue)=>jsx(MatrixFrame,{matrix:re,index:ue,active:ue===c},ue))})]})})},Icon$2=()=>jsx("svg",{viewBox:"-1 -1 18 18",fill:"currentColor",children:jsx("path",{d:"M3.5 2.25a1.25 1.25 0 11-2.5 0 1.25 1.25 0 012.5 0zm11.5 0a1.25 1.25 0 11-2.5 0 1.25 1.25 0 012.5 0zm-1.25 7a1.25 1.25 0 100-2.5 1.25 1.25 0 000 2.5zm1.25 4.5a1.25 1.25 0 11-2.5 0 1.25 1.25 0 012.5 0zM2.25 9.25a1.25 1.25 0 100-2.5 1.25 1.25 0 000 2.5zm7-1.25a1.25 1.25 0 11-2.5 0 1.25 1.25 0 012.5 0zM8 15a1.25 1.25 0 100-2.5A1.25 1.25 0 008 15zM9.25 2.25a1.25 1.25 0 11-2.5 0 1.25 1.25 0 012.5 0zM2.25 15a1.25 1.25 0 100-2.5 1.25 1.25 0 000 2.5z"})}),Title$3=title$2,MatrixLighting=Object.freeze(Object.defineProperty({__proto__:null,Icon:Icon$2,Pane:Pane$2,Title:Title$3},Symbol.toStringTag,{value:"Module"}));var ThemeAnim=(e=>(e[e.ANIM_NONE=0]="ANIM_NONE",e[e.ANIM_A=1]="ANIM_A",e[e.ANIM_B=2]="ANIM_B",e))(ThemeAnim||{});const ProgressBarContainer=styled.div`
  position: relative;
  margin-top: 10px;
  line-height: 1;
  &:hover {
    & .tooltip {
      transform: scale(1) translateY(0px);
      opacity: 1;
    }
  }
  .tooltip {
    transform: translateY(5px) scale(0.6);
    opacity: 0;
  }
`,ProgressBar=styled.div`
  background: var(--bg_control);
  position: relative;
  padding: 5px;
  border-radius: 5px;
  overflow: hidden;
  margin-bottom: 10px;
  cursor: pointer;
  width: 250px;

  > span {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    background: var(--color_accent);
    height: 10px;
    width: 100%;
    transform: scaleX(0.01);
    transform-origin: left;
    transition: transform 0.4s ease-in-out;
  }
`,HiddenInput$1=styled.input`
  display: none;
`,MediaRow=styled.div`
  max-width: 960px;
  width: 100%;
  display: flex;
  flex-direction: column;
  border: 1px solid var(--border_color_cell);
  border-style: dashed;
  justify-content: center;
  align-items: center;
  padding: 10px;
  border-radius: 15px;
  min-height: 100px;
  margin-bottom: 10px;
  box-sizing: border-box;
  text-align: center;
  color: var(--color_label-highlighted);
`,FlexLabel=styled.div`
  color: var(--color_label);
  font-weight: 400;
  display: inline-flex;
  align-items: center;
  position: relative;
`,getScreenFiles=e=>{const t=s=>new Promise((i,l)=>{const c=document.createElement("video");c.onloadedmetadata=()=>{i([c.videoWidth,c.videoHeight])},c.src=s,c.load()}),r=s=>new Promise((i,l)=>{const c=document.createElement("img");c.onload=()=>{i([c.width,c.height])},c.src=s});return Promise.all(e.map(async s=>{const i=URL.createObjectURL(s),l=await s.arrayBuffer(),c=new Uint8Array(l);let u=0,p=0;return s.type.startsWith("video")?[u,p]=await t(i):s.type.startsWith("image")&&([u,p]=await r(i)),{name:s.name,type:s.type,src:i,width:u,height:p,byteArray:c}}))},ExportSelect=({area:e,onChange:t})=>{const{t:r}=useTranslation(),s=useAppSelector(getSelectedTool),i=useAppSelector(getExportOptions),l=useAppSelector(getSelectedConnectedDevice),c=l?l.vendorProductId:-1;if(!i)return null;const u=i.map(f=>({label:`${r(f.label)} (${f.owidth}x${f.oheight})`,value:f})),p=u.find(f=>f.value===e);return jsx(Fragment,{children:jsx(AccentSelect,{onChange:t,value:p,options:u},c+s)})},printBytes=e=>{if(e===0)return 0;const t=["Bytes","kB","MB","GB"],r=Math.floor(Math.log10(e)/3),s=t[r],i=r===0?1:Math.pow(1e3,r);return`${(e/i).toFixed(r)} ${s}`},SavingStatus=styled.div`
  margin-left: 10px;
`,printTime=e=>{e=~~e;const t=~~(e/60),r=e%60;return`${t}:${r<10?"0":""}${r}`},SavingProgress=({bufferSize:e,bytesSended:t,sendSpeed:r})=>{const{t:s}=useTranslation();return jsxs(Fragment,{children:[jsxs(ProgressBarContainer,{children:[jsx(ProgressBar,{children:jsx("span",{style:{transform:`scaleX(${t/e})`}})}),jsxs(ProgressBarTooltip,{children:[printBytes(r),"/s,"," ",`  -${printTime((e-t)/r)}`]})]}),jsxs(SavingStatus,{children:[~~(t/e*100)," % (",printBytes(t)," /"," ",printBytes(e),")"," ",t===0&&s("Initializing")]})]})},Dialog=e=>{const{t}=useTranslation(),r=e.cancelText??"Cancel",s=e.confirmText??"Confirm";return jsx(ModalBackground,{children:jsxs(ModalContainer,{children:[jsx(PromptText,{children:e.text&&e.text}),jsxs(RowDiv$1,{children:[jsx(AccentButton,{onClick:e.onExit,children:t(r)}),jsx(PrimaryAccentButton,{onClick:e.onConfirm,children:t(s)})]})]})})},FileSaveControl=({area:e,setArea:t,generate:r,disabled:s,wasmLoaded:i})=>{const{t:l}=useTranslation(),c=useAppDispatch(),u=useAppSelector(getSavingState$2),[p,f]=reactExports.useState(""),m=useAppSelector(getBufferSize$2),y=useAppSelector(getBytesSended$2),K=useAppSelector(getSendSpeed$2),[x,b]=reactExports.useState(!1),[M,w]=reactExports.useState(!1),L=useAppSelector(getSelectedTool),F=useAppSelector(getLightingSupport),I=async()=>{f(""),b(!0);const k=async()=>{let j=null;try{j=r()}catch(V){console.log(V)}if(b(!1),j==null){f(l("Failed to process."));return}let U=lodashExports.isArray(j)?j.reduce((V,z)=>V+z.length,0):j.length;await c(initSendState({size:U})),c(saveTabFile(j,V=>{V||f(l("Failed to save."))}))};setTimeout(()=>{k()},300)};return reactExports.useEffect(()=>{u!=="saving"&&w(!1)},[u]),jsxs(Fragment,{children:[e&&t&&jsxs(ControlRow,{children:[jsxs(Label$1,{children:[l("Type"),"："]}),jsx(Detail,{children:jsx(ExportSelect,{area:e,onChange:k=>t(k.value)})})]}),jsxs(ControlRow,{children:[jsxs(FlexLabel,{children:[p&&jsxs(Fragment,{children:[jsx(FontAwesomeIcon,{icon:faWarning,size:"xs",style:{color:"gold",marginRight:5}}),p]})," ",x&&l("Processing"),u==="saving"&&jsx(SavingProgress,{bufferSize:m,sendSpeed:K,bytesSended:y})]}),jsxs(Detail,{children:[u==="saving"&&y>0&&jsxs(Fragment,{children:[jsx(AccentButton,{onClick:()=>w(!0),children:l("Cancel")}),M&&u==="saving"&&y>0&&jsx(Dialog,{text:l(`Cancel transfer will revert to factory default ${L}, confirm cancel?`),cancelText:"No",confirmText:"Yes",onConfirm:()=>{c(updateState$2("canceled")),w(!1)},onExit:()=>w(!1)})]}),u!=="saving"&&jsx(Fragment,{children:jsx(AccentButton,{onClick:I,disabled:s||!i,children:l("Save")})})]})]}),F&&jsx(ControlRow,{children:jsx(Label$1,{style:{fontSize:16},children:l(i?"To boost the data transfer speed, the backlight will shut off during transfer period and resume afterwards.":"Loading resources...")})}),jsx(ControlRow,{children:jsx(Label$1,{style:{fontSize:16},children:l("TRANS_TIP")})})]})},MediaContainer$1=styled.div.attrs(({$width:e,$height:t})=>({style:{width:e,height:t,display:e>0&&t>0?"block":"none"}}))`
  position: relative;
`,Dragger$1=styled.div`
  top: 0;
  left: 0;
  position: absolute;
  cursor: move;
  cursor: grab;
  transition: all 0.3s;
  z-index: 1;
  &.react-draggable-dragging {
    transition: none;
    cursor: grabbing;
  }
`,getDimension$1=(e,t)=>{if(e&&t){const[r,s]=[t.width,t.height],[i,l]=[e.owidth,e.oheight],c=r/s,u=i/l;return c>u?[~~(c*l),l]:[i,~~(i/c)]}return[0,0]},CropTool=reactExports.memo(()=>{const{t:e}=useTranslation(),t=useAppSelector(getSelectedTool),r=useAppSelector(getDefaultArea),s=useAppSelector(getKbresFlags);if(!r)return null;const[i,l]=reactExports.useState([]),[c,u]=reactExports.useState(r),p=i[0],f=reactExports.useRef(null),[m,y]=getDimension$1(c,p),[K,x]=reactExports.useState(Math.floor((m-c.owidth)/2)),[b,M]=reactExports.useState(Math.floor((y-c.oheight)/2)),w={left:0,top:0,right:m-c.owidth,bottom:y-c.oheight},L=t==="video"?"image/gif,video/mp4":"image/png,image/jpeg,image/bmp",F=()=>{var H;(H=f.current)==null||H.click()},{kbres:I,loaded:k}=useKbres(),j=async H=>{H.target.files&&l(await getScreenFiles(Array.from(H.target.files)))},U=(H,N)=>{x(N.x),M(N.y)},V=reactExports.useRef(null),z=reactExports.useRef(0),te=()=>{if(!V.current){z.current=0;return}const H=V.current,N=H.getContext("2d");N.clearRect(0,0,H.width,H.height);const Q=5;N.setLineDash([Q,Q]),N.lineDashOffset=z.current,N.strokeStyle="white",N.beginPath(),N.rect(0,0,H.width,H.height),N.stroke(),N.lineDashOffset=z.current+Q,N.strokeStyle="black",N.beginPath(),N.rect(0,0,H.width,H.height),N.stroke(),z.current+=3,setTimeout(te,200)};reactExports.useEffect(()=>{setTimeout(()=>{x(Math.floor((m-c.owidth)/2)),M(Math.floor((y-c.oheight)/2)),z.current===0&&te()},0)},[c,m,y]);const R=()=>{if(!I)return null;const H="/tabkb";try{I.FS.stat(H)}catch{I.FS.mkdir(H)}const N=`${c.format}`,Q=H+"/"+p.name;I.FS.writeFile(Q,p.byteArray);const X=new I.IntVec;X.push_back(c.owidth),X.push_back(c.oheight);const T=new I.IntVec;T.push_back(m),T.push_back(y);const P=new I.IntVec;P.push_back(K),P.push_back(b),console.debug(Q,N,c.orientations,[c.owidth,c.oheight],[m,y],[K,b],c.format,c.animFramesLimit,s);let q=0;return t==="image"?q=I.convert_image_ext(Q,N,c.orientations,X,T,P,c.format,s,new I.U8Vec):q=I.convert_video_ext(Q,N,c.orientations,X,T,P,c.format,c.animFramesLimit,s,new I.U8Vec),I.FS.unlink(Q),q===0?I.FS.readFile(N):null};return jsxs(Fragment,{children:[jsx(MediaRow,{children:jsxs(MediaContainer$1,{$width:m,$height:y,children:[jsx(Media,{type:p==null?void 0:p.type,src:p==null?void 0:p.src,width:m,height:y}),jsx(Draggable,{position:{x:K,y:b},onStop:U,bounds:w,children:jsx(Dragger$1,{children:p&&jsx("canvas",{ref:V,width:c.owidth,height:c.oheight})})})]})}),jsxs(ControlRow,{children:[jsxs(Label$1,{children:[e("File"),"：",p==null?void 0:p.name]}),jsxs(Detail,{children:[jsx(AccentButton,{onClick:F,children:e("Import "+(t==="video"?"Video":"Image"))}),jsx(HiddenInput$1,{accept:L,onChange:j,type:"file",ref:f})]})]}),jsx(ControlRow,{children:jsxs(Label$1,{children:[e("Original Size"),": ",(p==null?void 0:p.width)||0," x ",(p==null?void 0:p.height)||0]})}),jsx(FileSaveControl,{area:c,setArea:u,generate:R,disabled:!p,wasmLoaded:k})]})},shallowEqual),Slider=styled.div.attrs(e=>({style:{width:e.$width,height:e.$height}}))`
  position: relative;
  overflow: hidden;
`,upAnima=keyframes`
  0% {
    transform: translateY(0);
  }
  100% {
    transform: translateY(-100%);
  }
`,downAnim=keyframes`
  0% {
    transform: translateY(0);
  }
  100% {
    transform: translateY(100%);
  }
`,leftAnim=keyframes`
  0% {
    transform: translateX(0);
  }
  100% {
    transform: translateX(-100%);
  }
`,rightAnim=keyframes`
  0% {
    transform: translateX(0);
  }
  100% {
    transform: translateX(100%);
  }
`,SliderImage=styled.img.attrs(e=>{let t="0",r="0";if(e.$isNext)switch(e.$anim){case 3:r="100%";break;case 2:r="-100%";break;case 5:t="100%";break;case 4:t="-100%";break}return{style:{width:e.$width,height:e.$height,left:t,top:r,zIndex:e.$anim!==1||e.$isNext?0:1}}})`
  background: #000;
  object-fit: cover;
  position: absolute;
  animation-name: ${e=>{if(!e.$isNext)return"";switch(e.$anim){case 3:return upAnima;case 2:return downAnim;case 5:return leftAnim;case 4:return rightAnim;default:return""}}};
  animation-delay: ${e=>(e.$interval||1)-.3}s;
  animation-duration: 0.3s;
  animation-fill-mode: forwards;
  animation-timing-function: linear;
  pointer-events: none;
`,SliderTool=()=>{var z,te;const{t:e,i18n:t}=useTranslation(),r=useAppSelector(getDefaultArea),s=useAppSelector(getKbresFlags);if(!r)return null;const i=reactExports.useMemo(()=>[5,10,15,30].map(R=>({label:R+" "+e("S"),value:R})),[t.language]),l=reactExports.useMemo(()=>[{label:e("None"),value:1},{label:e("Top to bottom"),value:2},{label:e("Bottom to top"),value:3},{label:e("Left to right"),value:4},{label:e("Right to left"),value:5}],[t.language]),[c,u]=reactExports.useState(r),p=reactExports.useRef(null),[f,m]=reactExports.useState([]),[y,K]=reactExports.useState(0),x=f.length<=1||y===f.length-1?0:y+1,[b,M]=reactExports.useState(i[0].value),[w,L]=reactExports.useState(l[0].value),F=reactExports.useRef(null),{kbres:I,loaded:k}=useKbres(),j=()=>{var R;(R=p.current)==null||R.click()},U=async R=>{if(R.target.files){const H=Array.from(R.target.files).filter(Q=>["image/jpeg","image/png","image/bmp"].includes(Q.type)),N=lodashExports.sortBy(await getScreenFiles(H),[Q=>Q.name]);m(N),K(0)}};reactExports.useEffect(()=>{p.current!==null&&(p.current.setAttribute("directory",""),p.current.setAttribute("webkitdirectory",""))},[p]),reactExports.useEffect(()=>{if(f.length!==0)return F.current=setInterval(()=>{K(R=>R===f.length-1?0:R+1)},b*1e3),()=>{F.current&&(clearInterval(F.current),K(0))}},[c,w,b,f]);const V=()=>{if(!I)return null;const R="/tabkb";try{I.FS.stat(R)}catch{I.FS.mkdir(R)}const H=c.format,N=c.format,Q=new I.StrVec;for(const P of f)I.FS.writeFile(R+"/"+P.name,P.byteArray),Q.push_back(R+"/"+P.name);const X=new I.IntVec;X.push_back(c.owidth),X.push_back(c.oheight),console.debug(R,H,c.orientations,b,w,[c.owidth,c.oheight],N,s);const T=I.convert_image_folder_ext(Q,H,c.orientations,b,w,X,N,s);for(let P=0;P<Q.size();P++){const q=Q.get(P);I.FS.unlink(q)}return T===0?I.FS.readFile(H):null};return jsxs(Fragment,{children:[jsx(MediaRow,{children:jsxs(Slider,{$width:c.owidth,$height:c.oheight,children:[f.length>0&&jsx(SliderImage,{$interval:b,$anim:w,src:(z=f[y])==null?void 0:z.src,$width:c.owidth,$height:c.oheight}),f.length>1&&jsx(SliderImage,{$interval:b,$anim:w,$isNext:!0,src:(te=f[x])==null?void 0:te.src,$width:c.owidth,$height:c.oheight})]},y)}),jsxs(ControlRow,{children:[jsxs(Label$1,{children:[e("image"),": ",f.length===0?0:y+1," / ",f.length," ",f.length===0?"":`( ${f[y].name} )`]}),jsxs(Detail,{children:[jsx(AccentButton,{onClick:j,children:e("Import From Album")}),jsx(HiddenInput$1,{onChange:U,type:"file",ref:p})]})]}),jsxs(ControlRow,{children:[jsxs(Label$1,{children:[e("Interval"),": "]}),jsx(Detail,{children:jsx(AccentSelect,{onChange:R=>M(R.value),value:i.find(R=>R.value===b),options:i})})]}),jsxs(ControlRow,{children:[jsxs(Label$1,{children:[e("Transition Animation"),": "]}),jsx(Detail,{children:jsx(AccentSelect,{onChange:R=>L(R.value),value:l.find(R=>R.value===w),options:l})})]}),jsx(FileSaveControl,{area:c,setArea:u,generate:V,disabled:f.length===0,wasmLoaded:k})]})},Container$d=styled.div`
  position: absolute;
  z-index: 3;
`,MediaResizer=({file:e,x:t,y:r,width:s,height:i,onChange:l})=>{const c=reactExports.useRef(null),u=reactExports.useRef(0),p=()=>{if(!c.current){u.current=0;return}const I=c.current,k=I.getContext("2d");k.clearRect(0,0,I.width,I.height);const j=5;k.setLineDash([j,j]),k.lineDashOffset=u.current,k.strokeStyle="white",k.beginPath(),k.rect(0,0,I.width,I.height),k.stroke(),k.lineDashOffset=u.current+j,k.strokeStyle="black",k.beginPath(),k.rect(0,0,I.width,I.height),k.stroke(),u.current+=3,setTimeout(p,200)},f=e.dw/e.dh,[m,y]=reactExports.useState(null),[K,x]=reactExports.useState(null),b=[{name:"bottom-right",style:{right:-5,bottom:-5,cursor:"nwse-resize"}}],M=I=>{y({x:I.clientX,y:I.clientY}),x(null)},w=()=>{y(null),x(null)},L=(I,k)=>{k.stopPropagation(),x({x:k.clientX,y:k.clientY,point:I})},F=I=>{if(m){const k=e.dx+(I.clientX-m.x),j=e.dy+(I.clientY-m.y),U=Math.max(Math.min(k,s-e.dw),0),V=Math.max(Math.min(j,i-e.dh),0);l({dw:e.dw,dh:e.dh,dx:U,dy:V})}if(K){const k=I.clientX-K.x,j=K.point==="top-left"||K.point==="bottom-left"?-k:k,U=e.dw+j;let V=Math.max(Math.min(U,s-e.dx),10),z=Math.max(Math.min(V/f,i-e.dy),10);V=z*f,l({dx:e.dx,dy:e.dy,dw:V,dh:z})}};return reactExports.useEffect(()=>(window.addEventListener("mousemove",F),window.addEventListener("mouseup",w),()=>{window.removeEventListener("mousemove",F),window.removeEventListener("mouseup",w)}),[m,K]),reactExports.useEffect(()=>{u.current===0&&p()},[]),jsxs(Container$d,{style:{top:r+e.dy,left:t+e.dx,cursor:m?"grabbing":"grab",width:e.dw,height:e.dh},onMouseDown:M,children:[jsx(Media,{type:e.type,src:e.src,width:e.dw,height:e.dh}),jsx("canvas",{style:{position:"absolute",left:0,top:0},ref:c,width:e.dw,height:e.dh}),b.map(I=>jsx("div",{onMouseDown:k=>L(I.name,k),style:{position:"absolute",width:"10px",height:"10px",border:"1px solid #fff",...I.style}},I.name))]})},MediaContainer=styled.div.attrs(({$width:e,$height:t})=>({style:{width:e,height:t,display:e>0&&t>0?"block":"none"}}))`
  position: relative;
`,Dragger=styled.div`
  top: 0;
  left: 0;
  position: absolute;
  cursor: move;
  cursor: grab;
  transition: all 0.3s;
  z-index: 1;
  &.react-draggable-dragging {
    transition: none;
    cursor: grabbing;
  }
`,FgFileList=styled.div`
  margin-top: 10px;
  display: flex;
  column-gap: 5px;
  flex-wrap: wrap;
`,FgMedia=styled.div`
  border: ${e=>e.$active?"1px solid var(--color_accent)":"1px solid rgba(0,0,0,0)"};

  cursor: pointer;
  width: fit-content;
  height: fit-content;
  position: relative;
  svg {
    color: var(--bg_icon-highlighted);
    position: absolute;
    right: -6px;
    top: -6px;
    opacity: 0;
    cursor: pointer;
    transition: transform 0.2s ease-in-out;
    background: var(--bg_icon);
    border-radius: 50%;
    transform: scale(0.8);
  }
  &:hover svg {
    opacity: 1;
    transform: scale(1);
  }
`;function calculateDestDimensions(e,t,r,s){const i=r/e,l=s/t,c=Math.min(i,l),u=e*c/2,p=t*c/2,f=(r-u)/2,m=(s-p)/2;return{dx:f,dy:m,dw:u,dh:p}}const isVideo=e=>e.type==="video/mp4"||e.type==="image/gif",hasAlpha=e=>e.type==="image/png"||e.type==="image/gif",getDimension=(e,t)=>{if(e&&t){const[r,s]=[t.width,t.height],[i,l]=[e.owidth,e.oheight],c=r/s,u=i/l;return c>u?[~~(c*l),l]:[i,~~(i/c)]}return[0,0]},ThemeTool=reactExports.memo(()=>{const{t:e}=useTranslation(),t=useAppSelector(getKbresFlags),r=useAppSelector(getMaxOutputSize),s=useAppSelector(getMaxFgFileCount),i=useAppSelector(getExportOptions),l=i==null?void 0:i.find(oe=>oe.format===ATBG),c=i==null?void 0:i.find(oe=>oe.format===ATFG);if(!l)return null;const u=l,[p,f]=reactExports.useState(),m=reactExports.useRef(null),[y,K]=reactExports.useState([]),x=reactExports.useRef(null),[b,M]=reactExports.useState(0),w=y[b],[L,F]=getDimension(u,p),[I,k]=reactExports.useState(Math.floor((L-u.owidth)/2)),[j,U]=reactExports.useState(Math.floor((F-u.oheight)/2)),V={left:0,top:0,right:L-u.owidth,bottom:F-u.oheight},z="image/gif,video/mp4",te="image/gif,video/mp4,image/jpeg,image/png,image/bmp",R=()=>{var oe;(oe=m.current)==null||oe.click()},H=()=>{var oe;(oe=x.current)==null||oe.click()},{kbres:N,loaded:Q}=useKbres(),[X,T]=reactExports.useState(0),P=reactExports.useMemo(()=>y.reduce((oe,ne)=>oe+ne.outputSize,0)+X,[X,y]),q=(oe,ne,we,Se)=>{if(!N)return{size:0,alpha:0,frames:0};const pe="/tabkb";try{N.FS.stat(pe)}catch{N.FS.mkdir(pe)}const fe=`info_${u.format}`,De=pe+"/info_"+oe.name;N.FS.writeFile(De,oe.byteArray);const re=new N.IntVec;re.push_back(ne[0]),re.push_back(ne[1]),Se|=KBRE_FLAGS_REFPS;const ue=N.media_info(De,fe,isVideo(oe)?1:0,re,we,Se),ie=new TextDecoder().decode(N.FS.readFile(fe)).trim().split(" ");return N.FS.unlink(De),{size:ue,alpha:parseInt(ie[0]),frames:parseInt(ie[1])}},ae=async oe=>{if(oe.target.files){const ne=await getScreenFiles(Array.from(oe.target.files)),{size:we}=q(ne[0],[u.owidth,u.oheight],u.animFramesLimit,t);T(we),f(ne[0])}},he=async oe=>{if(oe.target.files){const we=(await getScreenFiles(Array.from(oe.target.files))).map(Se=>{const pe=calculateDestDimensions(Se.width,Se.height,u.owidth,u.oheight);let fe=t;hasAlpha(Se)&&(fe|=KBRE_FLAGS_ALPHA);const{size:De,frames:re,alpha:ue}=q(Se,[pe.dw,pe.dh],(c==null?void 0:c.animFramesLimit)||-1,fe);return{...Se,...pe,animation:ThemeAnim.ANIM_NONE,outputSize:De,frames:re,alpha:ue}});if(we.length>0){const Se=[...y,...we].slice(0,s);K(Se),M(y.length)}}},Te=(oe,ne)=>{k(ne.x),U(ne.y)},Ae=reactExports.useRef(null),$e=reactExports.useRef(0),Ye=()=>{if(!Ae.current){$e.current=0;return}const oe=Ae.current,ne=oe.getContext("2d");ne.clearRect(0,0,oe.width,oe.height);const we=5;ne.setLineDash([we,we]),ne.lineDashOffset=$e.current,ne.strokeStyle="white",ne.beginPath(),ne.rect(0,0,oe.width,oe.height),ne.stroke(),ne.lineDashOffset=$e.current+we,ne.strokeStyle="black",ne.beginPath(),ne.rect(0,0,oe.width,oe.height),ne.stroke(),$e.current+=3,setTimeout(Ye,200)};reactExports.useEffect(()=>{setTimeout(()=>{k(Math.floor((L-u.owidth)/2)),U(Math.floor((F-u.oheight)/2)),$e.current===0&&Ye()},0)},[u,L,F]);const ot=()=>{if(!N||!p)return null;let oe=t|KBRE_FLAGS_REFPS;const ne="/tabkb";try{N.FS.stat(ne)}catch{N.FS.mkdir(ne)}let we=[];const Se=`${u.format}`,pe=ne+"/"+p.name;N.FS.writeFile(pe,p.byteArray);const fe=new N.IntVec;fe.push_back(u.owidth),fe.push_back(u.oheight);const De=new N.IntVec;De.push_back(L),De.push_back(F);const re=new N.IntVec;re.push_back(I),re.push_back(j);const ue=new N.U8Vec;ue.push_back(y.length);for(let ie=0;ie<y.length;ie++){const ge=y[ie];ue.push_back(ge.dw&255),ue.push_back(ge.dw>>8),ue.push_back(ge.dh&255),ue.push_back(ge.dh>>8),ue.push_back(ge.alpha),ue.push_back(0),ue.push_back(ge.frames&255),ue.push_back(ge.frames>>8)}console.debug(pe,Se,u.orientations,[fe.get(0),fe.get(1)],[De.get(0),De.get(1)],[re.get(0),re.get(1)],u.format,u.animFramesLimit,oe);let Ke=0;if(Ke=N.convert_video_extf(pe,Se,u.orientations,fe,De,re,u.format,u.animFramesLimit,oe,ue),N.FS.unlink(pe),Ke!==0)return null;if(we=[N.FS.readFile(Se)],c&&y.length>0)for(let ie=0;ie<y.length;ie++){const ge=y[ie],je=`${c.format}`,Pe=ne+"/"+ge.name;let _e=oe;hasAlpha(ge)&&(_e|=KBRE_FLAGS_ALPHA),N.FS.writeFile(Pe,ge.byteArray);const Oe=new N.IntVec;Oe.push_back(~~ge.dw),Oe.push_back(~~ge.dh);const Fe=new N.IntVec;Fe.push_back(~~ge.dw),Fe.push_back(~~ge.dh);const nt=new N.IntVec;nt.push_back(0),nt.push_back(0);const ke=new N.U8Vec;ke.push_back(ge.dx&255),ke.push_back(ge.dx>>8),ke.push_back(ge.dy&255),ke.push_back(ge.dy>>8),ke.push_back(ge.animation&255),ke.push_back(ge.animation>>8),console.debug(Pe,je,c.orientations,[Oe.get(0),Oe.get(1)],[Fe.get(0),Fe.get(1)],[nt.get(0),nt.get(1)],c.format,c.animFramesLimit,_e,[ke.get(0),ke.get(1),ke.get(2),ke.get(3),ke.get(4),ke.get(5)]);let St=0;if(isVideo(ge)?St=N.convert_video_extf(Pe,je,c.orientations,Oe,Fe,nt,c.format,c.animFramesLimit,_e,ke):St=N.convert_image_ext(Pe,je,c.orientations,Oe,Fe,nt,c.format,_e,ke),N.FS.unlink(Pe),St!==0)return null;const qt=N.FS.readFile(je);we.push(qt)}return we},Qe=oe=>{K(y.map((ne,we)=>{if(we!==b)return ne;let Se=ne.outputSize;if(ne.dh!==oe.dh||ne.dw!=oe.dw){let pe=t;hasAlpha(ne)&&(pe|=KBRE_FLAGS_ALPHA);const{size:fe}=q(ne,[oe.dw,oe.dh],(c==null?void 0:c.animFramesLimit)||-1,pe);Se=fe}return{...ne,...oe,outputSize:Se}}))},Xe=[{label:e("None"),value:ThemeAnim.ANIM_NONE},{label:e("Anim A"),value:ThemeAnim.ANIM_A},{label:e("Anim B"),value:ThemeAnim.ANIM_B}],it=Xe.find(oe=>{var ne;return oe.value===((ne=y[b])==null?void 0:ne.animation)})||Xe[0],ct=oe=>{K(y.map((ne,we)=>we!==b?ne:{...ne,animation:oe}))};return jsxs(Fragment,{children:[jsxs(MediaRow,{children:[jsxs(MediaContainer,{$width:L,$height:F,children:[p&&jsx(Media,{type:p==null?void 0:p.type,src:p==null?void 0:p.src,width:L,height:F}),jsx(Draggable,{position:{x:I,y:j},onStop:Te,bounds:V,children:jsx(Dragger,{children:p&&jsx("canvas",{ref:Ae,width:u.owidth,height:u.oheight})})}),p&&w&&jsx(MediaResizer,{file:w,x:I,y:j,width:u.owidth,height:u.oheight,onChange:Qe})]}),jsx(FgFileList,{children:y.map((oe,ne)=>jsxs(FgMedia,{$active:b===ne,onClick:()=>M(ne),children:[jsx(Media,{type:oe.type,src:oe.src,width:"auto",height:60}),jsx(FontAwesomeIcon,{icon:faXmarkCircle,size:"lg",onClick:we=>{we.stopPropagation(),K(pe=>pe.filter((fe,De)=>ne!==De));const Se=b>=ne?b===0?0:b-1:b;M(Se)}})]},ne))})]}),jsxs(ControlRow,{children:[jsx(Label$1,{children:e("Background")}),jsxs(Detail,{children:[jsx(AccentButton,{onClick:R,disabled:!Q,children:e("Import Background")}),jsx(HiddenInput$1,{accept:z,onChange:ae,type:"file",ref:m})]})]}),c&&jsxs(Fragment,{children:[jsxs(ControlRow,{children:[jsx(Label$1,{children:e("Foreground")}),jsxs(Detail,{children:[jsx(AccentButton,{onClick:H,disabled:!Q||y.length>=s,children:e("Import Foreground")}),jsx(HiddenInput$1,{multiple:!0,accept:te,onChange:he,type:"file",ref:x})]})]}),y.length>0&&jsxs(ControlRow,{children:[jsx(Label$1,{children:e("Foreground Animation")}),jsx(Detail,{children:jsx(AccentSelect,{onChange:oe=>{ct(oe.value)},value:it,options:Xe})})]})]}),jsxs(ControlRow,{children:[jsx(FlexLabel,{children:jsx("span",{style:{marginLeft:10,fontSize:16,color:P>r?"#d15e5e":"inherit"},children:printBytesUsed(P,r)})}),jsx(Detail,{})]}),jsx(FileSaveControl,{generate:ot,disabled:!p||P>r,wasmLoaded:Q})]})},shallowEqual),title$1="Screen",ScreenPane=styled(CenterPane)`
  height: 100%;
`,MenuContainer$1=styled.div`
  padding: 15px 10px 20px 10px;
  pointer-events: ${e=>e.$disabled?"none":"auto"};
`,Container$c=styled.div`
  display: flex;
  align-items: center;
  flex-direction: column;
  padding: 12px;
`,Media=reactExports.memo(({type:e,src:t,width:r,height:s})=>jsxs("div",{style:{pointerEvents:"none",lineHeight:0},children:[(e==null?void 0:e.startsWith("image"))&&jsx("img",{src:t,style:{width:r,height:s}}),(e==null?void 0:e.startsWith("video"))&&jsx("video",{style:{width:r,height:s},muted:!0,autoPlay:!0,loop:!0,src:t})]}),shallowEqual),Pane$1=()=>{const{t:e}=useTranslation(),t=useDispatch(),r=useAppSelector(getSelectedTool),s=useAppSelector(getSavingState$2),i=useAppSelector(getScreenMenus),l=useAppSelector(getDeviceConfig),c=i.map(p=>jsx(SubmenuRow,{$selected:r===p,onClick:()=>t(updateTool(p)),style:{borderWidth:0,textAlign:"center"},children:e(p)},p));return jsxs(Fragment,{children:[jsx(SubmenuOverflowCell,{children:jsx(MenuContainer$1,{$disabled:s==="saving",children:c})}),jsx(OverflowCell,{children:jsx(ScreenPane,{children:jsx(Container$c,{children:(()=>{if(!l)return jsx(Fragment,{});switch(r){case"video":return jsx(CropTool,{},"video");case"image":return jsx(CropTool,{},"image");case"slider":return jsx(SliderTool,{},"slider");case"theme":return jsx(ThemeTool,{},"theme")}})()})})})]})},Icon$1=()=>jsx("svg",{viewBox:"1 1 22 22",fill:"currentColor",children:jsx("path",{d:"M6.25,4 L17.75,4 C19.4830315,4 20.8992459,5.35645477 20.9948552,7.06557609 L21,7.25 L21,16.75 C21,18.4830315 19.6435452,19.8992459 17.9344239,19.9948552 L17.75,20 L6.25,20 C4.51696854,20 3.10075407,18.6435452 3.00514479,16.9344239 L3,16.75 L3,7.25 C3,5.51696854 4.35645477,4.10075407 6.06557609,4.00514479 L6.25,4 L17.75,4 L6.25,4 Z M17.75,5.5 L6.25,5.5 C5.3318266,5.5 4.57880766,6.20711027 4.5058012,7.10647279 L4.5,7.25 L4.5,16.75 C4.5,17.6681734 5.20711027,18.4211923 6.10647279,18.4941988 L6.25,18.5 L17.75,18.5 C18.6681734,18.5 19.4211923,17.7928897 19.4941988,16.8935272 L19.5,16.75 L19.5,7.25 C19.5,6.3318266 18.7928897,5.57880766 17.8935272,5.5058012 L17.75,5.5 Z M10.0527864,9.5854102 C10.1625594,9.3658642 10.4120593,9.26236922 10.639617,9.328815 L10.7236068,9.3618034 L15.1055728,11.5527864 C15.2023365,11.6011683 15.2807978,11.6796295 15.3291796,11.7763932 C15.4389526,11.9959392 15.3720486,12.2576361 15.1823574,12.3998148 L15.1055728,12.4472136 L10.7236068,14.6381966 C10.6541791,14.6729105 10.5776225,14.690983 10.5,14.690983 C10.2545401,14.690983 10.0503916,14.5141078 10.0080557,14.2808586 L10,14.190983 L10,9.80901699 C10,9.73139445 10.0180725,9.65483791 10.0527864,9.5854102 Z"})}),Title$2=title$1,Screen=Object.freeze(Object.defineProperty({__proto__:null,Icon:Icon$1,Media,Pane:Pane$1,Title:Title$2},Symbol.toStringTag,{value:"Module"})),FirmwarePane=styled(CenterPane)`
  grid-column: span 2;
`,Container$b=styled.div`
  display: flex;
  align-items: center;
  flex-direction: column;
  padding: 0 12px;
`,HiddenInput=styled.input`
  display: none;
`,PointBadge=styled.div`
  position: absolute;
  background: rgb(220 53 69);
  padding: 5px;
  border-radius: 50%;
  right: 0;
  top: 0;
`,TextBadge=styled.span`
  position: absolute;
  top: 4px;
  display: inline-block;
  background: rgb(220 53 69);
  line-height: 1em;
  color: #fff;
  font-size: 12px;
  margin-left: 6px;
  padding: 2px;
  vertical-align: middle;
  border-radius: 5px;
`,Pane=()=>{const{t:e}=useTranslation(),t=useAppDispatch(),r=useAppSelector(getSavingState$1),s=useAppSelector(getBufferSize$1),i=useAppSelector(getBytesSended$1),l=useAppSelector(getSendSpeed$1),c=useAppSelector(getFirmwareNeedUpdate),u=useAppSelector(getSelectedDeviceFirmwareVersion),p=useAppSelector(getCfgFirmwareVersion),f=useAppSelector(getCfgFirmwareFile),m=useAppSelector(getSelectedConnectedDevice),y=useAppSelector(getSelectedKeyboardAPI),[K,x]=reactExports.useState([]),b=useAppSelector(getCDCMacIssue),[M,w]=reactExports.useState(null),[L,F]=reactExports.useState(),I=reactExports.useRef(null),k=()=>{var X;(X=I.current)==null||X.click()},j=async X=>{var T;if((T=X.target.files)!=null&&T[0]){const P=X.target.files[0],q=P.name,ae=await P.arrayBuffer(),he=new Uint8Array(ae);F({name:q,byteArray:he}),t(updateState$1("waiting"))}else F(null)},U=async()=>{if(!f||M)return;const X="/tabkb/firmwares/"+f,T=await fetch(X,{cache:"reload"});if(T.status!==200){console.log(X+": "+T.statusText);return}const P=await T.arrayBuffer(),q=new Uint8Array(P);w(q)},V=()=>{if(!M){t(updateState$1("failed"));return}t(saveTabFirmware$1(M))},z=()=>{L&&t(saveTabFirmware$1(L.byteArray))},te=async()=>{if(!y)return;const X=q=>`${q>>8&255}.${q>>4&15}.${q&15}`,T=(await y.getCustomMenuValue([66,100])).slice(1),P=T[0];if(P){const q=[];for(let ae=0;ae<P;ae++){const he=bytesIntoNum(T.slice(1+ae*4,5+ae*4));q.push(X(he))}x(q)}};reactExports.useEffect(()=>{U(),te()},[]);const R=reactExports.useMemo(()=>{switch(K.length){case 3:return` (Host: v${K[0]} Left: v${K[1]} Right: v${K[2]})`;case 1:return` (PLC: v${K[0]})`;default:return""}},[K]),H=m&&m.vendorId===20311&&m.productId===16656&&m.firmware>=parseVersionStr("1.0.5"),Q=navigator.userAgent.includes("Mac")&&b&&!H;return jsx(FirmwarePane,{children:jsxs(Container$b,{children:[u&&jsxs(ControlRow,{children:[jsxs(Label$1,{children:[e("Current Version"),": v",u," ",jsx("span",{style:{fontSize:14},children:R}),c&&jsxs(Fragment,{children:[", ",e("Update Available")," : v",p," ",jsx(TextBadge,{children:"new"})]})]}),c&&jsx(Detail,{children:jsx(AccentButton,{onClick:V,disabled:r==="saving",children:e("Update")})})]}),Q?jsx(ControlRow,{children:jsx(Label$1,{style:{fontSize:16},children:e("FIRMWARE_MAC_NOTSUPPORT")})}):jsxs(Fragment,{children:[jsxs(ControlRow,{children:[jsxs(Label$1,{children:[e("Firmware"),"：",L==null?void 0:L.name]}),jsxs(Detail,{children:[jsx(AccentButton,{disabled:r==="saving",onClick:k,children:e("Open")}),jsx(HiddenInput,{accept:".uf2",onChange:j,type:"file",ref:I})]})]}),jsxs(ControlRow,{children:[jsxs(FlexLabel,{children:[r==="failed"&&jsxs(Fragment,{children:[jsx(FontAwesomeIcon,{icon:faWarning,size:"xs",style:{color:"gold",marginRight:5}}),e("Failed to flash.")]}),r==="completed"&&e("Flash successful.")," ",r==="saving"&&jsx(SavingProgress,{bufferSize:s,sendSpeed:l,bytesSended:i})]}),jsx(Detail,{children:jsx(AccentButton,{onClick:z,disabled:!L||r==="saving",children:e("Flash")})})]}),jsx(ControlRow,{children:jsx(Label$1,{style:{fontSize:16},children:e("Please DO NOT disconnect or switch modes during the upgrade until the keyboard auto-reboot finishes.")})}),jsx(ControlRow,{children:jsx(Label$1,{style:{fontSize:16},children:e("TRANS_TIP")})})]})]})})},Icon=()=>{const e=useAppSelector(getFirmwareNeedUpdate);return jsxs("div",{style:{position:"relative"},children:[e?jsx(PointBadge,{}):null,jsx(FontAwesomeIcon,{icon:faMicrochip})]})},Title$1="Firmware",Firmware=Object.freeze(Object.defineProperty({__proto__:null,Icon,Pane,Title:Title$1},Symbol.toStringTag,{value:"Module"})),Container$a=styled.div`
  position: absolute;
  left: 15px;
  font-weight: 400;
  top: 10px;
`,Label=styled.label`
  font-size: 20px;
  text-transform: uppercase;
  color: var(--color_label-highlighted);
  margin-right: 6px;
`,LayerButton=styled.button`
  outline: none;
  font-variant-numeric: tabular-nums;
  border: none;
  background: ${e=>e.$selected?"var(--color_accent)":"transparent"};
  color: ${e=>e.$selected?"var(--color_inside-accent)":"var(--color_label-highlighted)"};
  cursor: pointer;
  font-size: 20px;
  font-weight: 400;
  &:hover {
    border: none;
    background: ${e=>e.$selected?"auto":"var(--bg_menu)"};
    color: ${e=>e.$selected?"auto":"var(--color_label-highlighted)"};
  }
`,LayerControl=()=>{const{t:e}=useTranslation(),t=useDispatch(),r=useAppSelector(getNumberOfLayers),s=useAppSelector(getSelectedLayerIndex),i=reactExports.useMemo(()=>new Array(r).fill(0).map((l,c)=>c).map(l=>jsx(LayerButton,{$selected:l===s,onClick:()=>t(setLayer(l)),children:l},l)),[r,s]);return jsxs(Container$a,{children:[jsx(Label,{children:e("Layer")}),i]})},createRetry=(e,t)=>{const r={retriesLeft:e,timeoutWait:t};return{retry:c=>{r.retriesLeft=r.retriesLeft-1,r.retriesLeft<=0?console.error("Exhausted all retries"):(console.log(`Retrying after waiting ${r.timeoutWait}`),setTimeout(c,r.timeoutWait),r.timeoutWait=r.timeoutWait*2)},clear:()=>{console.log("Clearing retries back to:",e),r.retriesLeft=e,r.timeoutWait=t},retriesLeft:()=>r.retriesLeft>=1}},selectConnectedDeviceRetry=createRetry(8,100),selectConnectedDeviceByPath=e=>async(t,r)=>{await t(reloadConnectedDevices());const s=getConnectedDevices(r())[e];s&&t(selectConnectedDevice(s))},selectConnectedDevice=e=>async t=>{const r=extractDeviceInfo(e);try{t(selectDevice(e)),await t(loadMacros(e)),await t(loadLayoutOptions()),await t(loadMatrixLighintConfig());const{protocol:s}=e;try{s<11?await t(updateLightingData(e)):s>=11&&await t(updateV3MenuData(e))}catch{t(logAppError({message:"Loading lighting/menu data failed",deviceInfo:r}))}await t(loadKeymapFromDevice(e)),selectConnectedDeviceRetry.clear()}catch(s){selectConnectedDeviceRetry.retriesLeft()?(t(logAppError({message:"Loading device failed - retrying",deviceInfo:r})),selectConnectedDeviceRetry.retry(()=>{t(selectConnectedDevice(e))})):(t(logAppError({message:"All retries failed for attempting connection with device",deviceInfo:r})),console.log("Hard resetting device store:",s),t(clearAllDevices()))}},reloadConnectedDevices=()=>async(e,t)=>{const r=t(),s=getSelectedDevicePath(r),i=getForceAuthorize(r),l=getSupportedIds(r),c=await getRecognisedDevices(l,i),u=await Promise.all(c.map(b=>new KeyboardAPI(b.path).getProtocolVersion())),p=await Promise.all(c.map(b=>new KeyboardAPI(b.path).getFirmwareVersion())),f=c.filter((b,M)=>u[M]===-1);f.length&&f.forEach(b=>{const M=extractDeviceInfo(b);e(logAppError({message:"Received invalid protocol version from device",deviceInfo:M}))});const m=c.filter((b,M)=>u[M]!==-1).map((b,M)=>{const{path:w,productId:L,vendorId:F,productName:I}=b,k=u[M],j=p[M];return{path:w,productId:L,vendorId:F,protocol:k,firmware:j,productName:I,hasResolvedDefinition:!1,requiredDefinitionVersion:k>=11?"v3":"v2",vendorProductId:getVendorProductId(b.vendorId,b.productId)}});await e(reloadDefinitions(m));const y=getDefinitions(t()),K=m.filter((b,M)=>isAuthorizedDeviceConnected(b,y)).reduce((b,M,w)=>(b[M.path]={...M,hasResolvedDefinition:!0},b),{});m.filter(b=>!isAuthorizedDeviceConnected(b,y)).forEach(tryForgetDevice);const x=Object.entries(K);if(x.forEach(([b,M])=>{console.info("Setting connected device:",M.protocol,b,M)}),e(updateConnectedDevices(K)),(!s||!K[s])&&x.length>0){const b=x[0][1];e(selectConnectedDevice(b))}else x.length===0&&e(selectDevice(null))},loadSupportedIds=()=>async e=>{await syncStore(),e(updateSupportedIds(getSupportedIdsFromStore())),await e(loadTabkbIds()),await e(updateDefinitions(getDefinitionsFromStore())),e(loadStoredCustomDefinitions()),e(reloadConnectedDevices())},isElectron=/Electron/.test(navigator.userAgent),Container$9=styled.div`
  position: absolute;
  right: 15px;
  top: 0px;
  font-size: 18px;
  pointer-events: none;
  font-weight: 400;
`,KeyboardTitle=styled.label`
  pointer-events: all;
  display: inline-block;
  background: var(--color_accent);
  border-bottom-left-radius: 6px;
  border-bottom-right-radius: 6px;
  font-size: 18px;
  text-transform: uppercase;
  color: var(--color_inside-accent);
  padding: 1px 10px;
  margin-right: 10px;
  border: solid 1px var(--bg_control);
  border-top: none;
  cursor: pointer;
  transition: all 0.1s ease-out;
  &:hover {
    filter: brightness(0.7);
  }
`,KeyboardList=styled.ul`
  padding: 0;
  border: 1px solid var(--bg_control);
  width: 160px;
  border-radius: 6px;
  background-color: var(--bg_menu);
  margin: 0;
  margin-top: 5px;
  right: 10px;
  position: absolute;
  pointer-events: ${e=>e.$show?"all":"none"};
  transition: all 0.2s ease-out;
  z-index: 11;
  opacity: ${e=>e.$show?1:0};
  overflow: hidden;
  transform: ${e=>e.$show?0:"translateY(-5px)"};
`,KeyboardButton=styled.button`
  display: block;
  text-align: center;
  outline: none;
  font-variant-numeric: tabular-nums;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  width: 100%;
  border: none;
  background: ${e=>e.$selected?"var(--bg_icon-highlighted)":"transparent"};
  color: ${e=>e.$selected?"var(--color_icon_highlighted)":"var(--color_label-highlighted)"};
  cursor: pointer;
  text-align: left;
  font-size: 14px;
  text-transform: uppercase;
  padding: 5px 10px;
  &:hover {
    border: none;
    background: ${e=>e.$selected?"var(--bg_icon-highlighted)":"var(--bg_control)"};
    color: ${e=>e.$selected?"var(--color_control-highlighted)":"var(--color_label-highlighted)"};
  }
`,ClickCover$1=styled.div`
  position: fixed;
  z-index: 10;
  pointer-events: all;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  opacity: 0.4;
  background: rgba(0, 0, 0, 0.75);
`,KeyboardSelectors=e=>{const{t}=useTranslation(),r=async()=>{const s=await HID.requestDevice();s&&e.selectKeyboard(s.__path)};return jsxs(Fragment,{children:[e.show&&jsx(ClickCover$1,{onClick:e.onClickOut}),jsxs(KeyboardList,{$show:e.show,children:[e.keyboards.map(([s,i])=>jsx(KeyboardButton,{$selected:s===e.selectedPath,onClick:()=>e.selectKeyboard(s),children:i.name},s)),!isElectron&&jsxs(KeyboardButton,{onClick:r,children:[t("Authorize New"),jsx(FontAwesomeIcon,{icon:faPlus,style:{marginLeft:"10px"}})]})]})]})},Badge=()=>{const e=useAppDispatch(),t=useAppSelector(getDefinitions),r=useAppSelector(getSelectedDefinition),s=useAppSelector(getConnectedDevices),i=useAppSelector(getSelectedDevicePath),[l,c]=reactExports.useState(!1),u=reactExports.useMemo(()=>Object.entries(s).map(([p,f])=>[p,t[f.vendorProductId]&&t[f.vendorProductId][f.requiredDefinitionVersion]]).filter(p=>p[1]),[s,t]);return!r||!i?null:jsx(Fragment,{children:jsxs(Container$9,{children:[jsxs(KeyboardTitle,{onClick:()=>c(!l),children:[r.name,jsx(FontAwesomeIcon,{icon:faAngleDown,style:{transform:l?"rotate(180deg)":"",transition:"transform 0.2s ease-out",marginLeft:"5px"}})]}),jsx(KeyboardSelectors,{show:l,selectedPath:i,keyboards:u,onClickOut:()=>c(!1),selectKeyboard:p=>{e(selectConnectedDeviceByPath(p)),c(!1)}})]})})},MenuContainer=styled.div`
  padding: 15px 10px 20px 10px;
`;[...makeCustomMenus([])];function getCustomPanes(e){return e.find(t=>t===dist.CustomFeaturesV2.RotaryEncoder)?[RotaryEncoder]:[]}const getRowsForKeyboard=()=>{const e=useAppSelector(getIsMacroFeatureSupported),t=useAppSelector(getV3MenuComponents),r=useAppSelector(getSelectedDefinition),s=useAppSelector(getNumberOfLayers),i=useAppSelector(getSelectedTabkbConfig);return r?dist.isVIADefinitionV2(r)?getRowsForKeyboardV2(r,e,s):dist.isVIADefinitionV3(r)?[...filterInferredRows(r,e,s,[Keycode$1,Layouts$1,Macros,SaveLoad]),...t,...filterTabRows(i,[MatrixLighting,Screen,Firmware])]:[]:[]},filterTabRows=(e,t)=>{if(!e)return[];let r=[];return e.screen||(r=[...r,Screen]),e.matrixLighting||(r=[...r,MatrixLighting]),e.firmware||(r=[...r,Firmware]),t.filter(s=>!r.includes(s))},filterInferredRows=(e,t,r,s)=>{const{layouts:i}=e;let l=[];return i.optionKeys&&Object.entries(i.optionKeys).length!==0||(l=[...l,Layouts$1]),r===0&&(l=[...l,Keycode$1,SaveLoad]),t||(l=[...l,Macros]),s.filter(u=>!l.includes(u))},getRowsForKeyboardV2=(e,t,r)=>{let s=[Keycode$1,Layouts$1,Macros,SaveLoad];if(dist.isVIADefinitionV2(e)){const{lighting:i,customFeatures:l}=e,{supportedLightingValues:c}=dist.getLightingDefinition(i);c.length!==0&&(s=[...s,Lighting$1]),l&&(s=[...s,...getCustomPanes(l)])}return filterInferredRows(e,t,r,s)},Loader=e=>{const{t}=useTranslation(),{loadProgress:r,selectedDefinition:s}=e,i=useAppDispatch(),l=useAppSelector(getSelectedTheme),c=useAppSelector(getConnectedDevices),u=useAppSelector(getSupportedIds),p=!Object.values(u).length,f=!Object.values(c).length,[m,y]=reactExports.useState(!1);return reactExports.useEffect(()=>{const K=setTimeout(()=>{s||y(!0)},3e3);return()=>clearTimeout(K)},[s]),jsxs(LoaderPane,{children:[jsx(ChippyLoader,{theme:l,progress:r||null}),(m||f)&&!p&&!isElectron?jsxs(AccentButtonLarge,{onClick:()=>i(reloadConnectedDevices()),children:[t("Authorize device"),jsx(FontAwesomeIcon,{style:{marginLeft:"10px"},icon:faPlus})]}):jsx(LoadingText$1,{isSearching:!s})]})},LoaderPane=styled(CenterPane)`
  display: flex;
  align-items: center;
  justify-content: center;
  row-gap: 50px;
  position: absolute;
  bottom: 50px;
  top: 50px;
  left: 0;
  right: 0;
  z-index: 4;
`,ConfigurePane=()=>{const e=useAppSelector(getSelectedDefinition),t=useAppSelector(getLoadProgress),r=useAppSelector(getRenderMode);return!e||t!==1?r==="2D"?jsx(Loader,{selectedDefinition:e||null,loadProgress:t}):null:jsx(ConfigureBasePane,{children:jsx(ConfigureGrid,{})})},ConfigureGrid=()=>{var p,f;const{t:e}=useTranslation(),t=useDispatch(),[r,s]=reactExports.useState(0),i=getRowsForKeyboard(),l=(p=i[r])==null?void 0:p.Pane,c=(f=i[r])==null?void 0:f.Title,u=useAppSelector(getShowLayerControl);return reactExports.useEffect(()=>(c==="Keymap"&&t(setConfigureKeyboardIsSelectable(!0)),t(updateSelectedRowTitle(c)),()=>{t(setConfigureKeyboardIsSelectable(!1))}),[c]),jsxs(Fragment,{children:[jsx(ConfigureFlexCell,{onClick:m=>{m.target.nodeName!=="CANVAS"&&t(clearSelectedKey())},style:{pointerEvents:"none",position:"absolute",top:50,left:0,right:0},children:jsxs("div",{style:{pointerEvents:"all"},children:[u&&jsx(LayerControl,{}),jsx(Badge,{})]})}),jsxs(Grid,{style:{pointerEvents:"none"},children:[jsx(MenuCell,{style:{pointerEvents:"all"},children:jsx(MenuContainer,{children:(i||[]).map(({Icon:m,Title:y},K)=>jsx(Row,{onClick:x=>s(K),$selected:r===K,children:jsxs(IconContainer,{children:[jsx(m,{}),jsx(MenuTooltip,{children:e(y)})]})},K))})}),l&&jsx(l,{})]})]})};function Layouts({definition:e,onLayoutChange:t,RowComponent:r=IndentedControlRow}){const s=useAppSelector(getDesignSelectedOptionKeys),i=useDispatch();if(React.useEffect(()=>{i(updateSelectedOptionKeys([]))},[e]),React.useEffect(()=>{t(s)},[s]),!e.layouts.labels)return null;const l=e.layouts.labels.map((c,u)=>{const p=e.layouts.optionKeys[u];if(Array.isArray(c)){const f=c[0],m=c.slice(1),y=m.map((K,x)=>({label:K,value:p[x]}));return jsxs(r,{children:[jsx(Label$1,{children:f}),jsx(Detail,{children:jsx(AccentSelect,{onChange:K=>{if(K&&K.label){const x=m.indexOf(K.label),b=Array.from(s).map(M=>M||0);b[u]=x,i(updateSelectedOptionKeys(b))}},value:s[u]?y[s[u]]:y[0],options:y})})]},`${u}-${f}`)}return typeof c=="string"?jsxs(r,{children:[jsx(Label$1,{children:c}),jsx(Detail,{children:jsx(AccentSlider,{isChecked:!!s[u],onChange:f=>{const m=Array.from(s).map(y=>y||0);m[u]=Number(f),i(updateSelectedOptionKeys(m))}})})]},`${u}-${c}`):null});return jsx(Fragment,{children:l})}const Container$8=styled.div`
  display: flex;
  align-items: center;
  flex-direction: column;
  padding: 0 12px;
`,ControlGroup=styled.div`
  margin-bottom: 0.75rem;
  padding-bottom: 0.75rem;
  width: 100%;

  &:last-child {
    padding-bottom: 0;
  }
`,ControlGroupHeader=styled.div`
  font-size: 1.5rem;
  font-weight: 600;
  margin: 0;
  margin-bottom: 0.5rem;
`,TestControls=()=>{const[e,t]=reactExports.useState(!0),[r,s]=reactExports.useState(0),[i,l]=reactExports.useState([0,0]),[c,u]=reactExports.useState(0),[p,f]=reactExports.useState(0),{basicKeyToByte:m,byteToKey:y}=useAppSelector(getBasicKeyToByte),K=useAppSelector(getSelected256PaletteColor),x=useDispatch(),b=[{label:"Option 1",value:"0"},{label:"Option 2",value:"1"}];return jsxs(ControlGroup,{children:[jsx(ControlGroupHeader,{children:"Controls"}),jsxs(ControlRow,{children:[jsx(Label$1,{children:"Button"}),jsx(Detail,{children:jsx(AccentButton,{children:"Click"})})]}),jsxs(ControlRow,{children:[jsx(Label$1,{children:"Disabled Button"}),jsx(Detail,{children:jsx(AccentButton,{disabled:!0,children:"Disabled"})})]}),jsxs(ControlRow,{children:[jsx(Label$1,{children:"Text Input"}),jsx(Detail,{children:jsx(TextInput,{})})]}),jsxs(ControlRow,{children:[jsxs(Label$1,{children:[p," / ",anyKeycodeToString(p,m,y)]}),jsx(Detail,{children:jsx(PelpiKeycodeInput,{value:p,setValue:f,meta:{}})})]}),jsxs(ControlRow,{children:[jsxs(Label$1,{children:[i[0],", ",i[1]]}),jsx(Detail,{children:jsx(ArrayColorPicker,{color:i,setColor:(M,w)=>l([M,w])})})]}),jsxs(ControlRow,{children:[jsxs(Label$1,{children:[K[0],", ",K[1]]}),jsx(Detail,{children:jsx(ColorPalettePicker,{color:K,setColor:(M,w)=>x(setSelectedPaletteColor([M,w]))})})]}),jsxs(ControlRow,{children:[jsx(Label$1,{children:r}),jsx(Detail,{children:jsx(AccentRange,{max:100,min:0,defaultValue:r,onChange:s})})]}),jsxs(ControlRow,{children:[jsx(Label$1,{children:+e}),jsx(Detail,{children:jsx(AccentSlider,{isChecked:e,onChange:t})})]}),jsxs(ControlRow,{children:[jsx(Label$1,{children:+c}),jsx(Detail,{children:jsx(AccentSelect,{defaultValue:b[c],options:b,onChange:M=>{M&&u(+M.value)}})})]}),jsx(MacroRecorder,{selectedMacro:[[RawKeycodeSequenceAction.Delay,4]],setUnsavedMacro:M=>M,undoMacro:()=>null,saveMacro:()=>null,isDelaySupported:!0}),jsx(MacroRecorder,{setUnsavedMacro:M=>M,undoMacro:()=>null,saveMacro:()=>null,isDelaySupported:!0})]})},Debug=()=>{const e=useAppSelector(getSelectedKeyboardAPI),t=useAppSelector(getConnectedDevices),r=Object.entries(useAppSelector(getDefinitions)).flatMap(([M,w])=>[[M,w.v2],[M,w.v3]]).filter(([M,w])=>w!==void 0),s=Object.entries(useAppSelector(getBaseDefinitions)).flatMap(([M,w])=>[[M,w.v2],[M,w.v3]]).filter(([M,w])=>w!==void 0),i=Object.entries(useAppSelector(getCustomDefinitions)).flatMap(([M,w])=>[[M,w.v2],[M,w.v3]]).filter(([M,w])=>w!==void 0),[l,c]=reactExports.useState(0),[u,p]=reactExports.useState([]),[f,m]=reactExports.useState(0),[y,K]=reactExports.useState(!1),x=r.map(([,M],w)=>({label:M.name,value:`${w}`})),b=r[l];return jsx(Pane$c,{children:jsx(OverflowCell,{children:jsxs(Container$8,{children:[jsxs(ControlGroup,{children:[jsx(ControlGroupHeader,{children:"Key Testing"}),jsxs(ControlRow,{children:[jsx(Label$1,{children:"Show Matrix"}),jsx(Detail,{children:jsx(AccentSlider,{isChecked:y,onChange:M=>K(M)})})]}),jsxs(ControlRow,{children:[jsx(Label$1,{children:"Set next key"}),jsx(Detail,{children:jsx(AccentButton,{onClick:()=>{const{keys:M,optionKeys:w}=b[1].layouts,L=w?Object.entries(w).flatMap(([I,k])=>k[0]):[],F=[...M,...L];f!==void 0&&m(getNextKey(f,F)||0)},children:"Next"})})]})]}),x&&jsxs(ControlGroup,{children:[jsx(ControlGroupHeader,{children:"Layout Testing"}),jsxs(ControlRow,{children:[jsx(Label$1,{children:"Dummy Keyboard"}),jsx(Detail,{children:jsx(AccentSelect,{onChange:M=>M&&c(+M.value),defaultValue:x[0],options:x})})]})]}),b&&jsx(Layouts,{definition:b[1],onLayoutChange:M=>{p(M)}}),e&&jsxs(ControlGroup,{children:[jsx(ControlGroupHeader,{children:"Connected Device Debugging"}),jsxs(ControlRow,{children:[jsx(Label$1,{children:"EEPROM Reset"}),jsx(Detail,{children:jsx(AccentButton,{onClick:()=>e.resetEEPROM(),children:"Reset"})})]}),jsxs(ControlRow,{children:[jsx(Label$1,{children:"Bootloader Jump"}),jsx(Detail,{children:jsx(AccentButton,{onClick:()=>e.jumpToBootloader(),children:"Jump"})})]}),jsxs(ControlRow,{children:[jsx(Label$1,{children:"Clear all macros"}),jsx(Detail,{children:jsx(AccentButton,{onClick:()=>e.resetMacros(),children:"Clear"})})]}),jsxs(ControlRow,{children:[jsx(Label$1,{children:"Benchmark Switch State Query Speed"}),jsx(Detail,{children:jsx(AccentButton,{onClick:async()=>{const M=performance.now();await Array(1e3).fill(0).map(w=>e.getKeyboardValue(KeyboardValue.SWITCH_MATRIX_STATE,[],20)),console.info("1000 commands in ",performance.now()-M,"ms")},children:"Benchmark"})})]})]}),jsxs(ControlGroup,{children:[jsx(ControlGroupHeader,{children:"Device IDs"}),jsxs(ControlRow,{children:[jsx(Label$1,{children:"Connected Devices"}),jsxs(Detail,{children:[Object.values(t).length," Devices"]})]}),Object.values(t).map(M=>{const w=r.find(([L])=>L===M.vendorProductId.toString());return w?jsxs(IndentedControlRow,{children:[jsx(SubLabel,{children:w[1].name}),jsxs(Detail,{children:["0x",M.vendorProductId.toString(16).toUpperCase()]})]},M.path):null}),jsxs(ControlRow,{children:[jsx(Label$1,{children:"Local definitions"}),jsxs(Detail,{children:[Object.values(i).length," Definitions"]})]}),Object.values(i).map(([M,w],L)=>jsxs(IndentedControlRow,{children:[jsx(SubLabel,{children:w.name}),jsxs(Detail,{children:["0x",parseInt(M).toString(16).toUpperCase()]})]},L)),jsx(ControlRow,{children:jsxs("details",{children:[jsxs("summary",{children:[jsx(Label$1,{children:"Remote definitions"}),jsxs(Detail,{children:[Object.values(s).length," Definitions"]})]}),Object.values(s).map(([M,w],L)=>jsxs(IndentedControlRow,{children:[jsx(SubLabel,{children:w.name}),jsxs(Detail,{children:["0x",parseInt(M).toString(16).toUpperCase()]})]},L))]})})]}),jsx(TestControls,{})]})})})},MessageDialogContainer=styled.dialog`
  padding: 0;
  border-width: 0;

  background: transparent;
  &::backdrop {
    background: rgba(0, 0, 0, 0.75);
  }

  & > div {
    transition: transform 0.2s ease-out;
    transform: translateY(-20px);
  }

  &[open] > div {
    transform: translateY(0px);
  }
`,Controls=styled.div`
  display: flex;
  justify-content: center;
  align-items: center;
`,MessageDialog=e=>{const t=reactExports.useRef(null),r=reactExports.useCallback(()=>{t.current&&t.current.close(),e.onClose&&e.onClose()},[t.current,e.onClose]);return reactExports.useEffect(()=>(t.current&&(e.isOpen?t.current.showModal():t.current.close()),()=>{r()}),[e.isOpen]),jsx(MessageDialogContainer,{ref:t,children:jsxs(ModalContainer,{children:[jsx(PromptText,{children:e.children}),jsx(Controls,{children:jsx(AccentButton,{onClick:r,children:"Confirm"})})]})})};let designWarningSeen=Number(localStorage.getItem("designWarningSeen")||0),hideDesignWarning=sessionStorage.getItem("hideDesignWarning")||designWarningSeen>4;const DesignErrorMessage=styled(ErrorMessage)`
  margin: 0;
  font-style: italic;
`,Container$7=styled.div`
  display: flex;
  align-items: center;
  flex-direction: column;
  padding: 0 12px;
`,DesignPane=styled(Pane$c)`
  display: grid;
  max-width: 100vw;
  grid-template-columns: 100vw;
  grid-template-rows: min-content;
`,UploadIcon=styled.div`
  height: 200px;
  width: 50%;
  cursor: pointer;
  max-width: 560px;
  border-radius: 6px;
  margin: 50px 10px;
  animation-duration: 1.5s;
  animation-name: border-glow;
  animation-iteration-count: infinite;
  animation-direction: alternate;
  animation-timing-function: ease-in-out;
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
  svg {
    color: transparent;
    stroke-width: 8px;
    animation-duration: 1.5s;
    animation-name: text-glow;
    animation-iteration-count: infinite;
    animation-direction: alternate;
    animation-timing-function: ease-in-out;
    font-size: 100px;
  }
`,makeReaderPromise=e=>new Promise((t,r)=>{const s=new FileReader;s.onload=()=>{if(!s.result)return r();t([e.name,s.result.toString()])},s.onerror=r,s.onabort=r,s.readAsBinaryString(e)}),isVIADefinition=e=>dist.isVIADefinitionV2(e)||dist.isVIADefinitionV3(e);function importDefinitions(e,t,r,s){Promise.all(e.map(makeReaderPromise)).then(i=>{let l=[];s([]);const c=i.map(([u,p])=>{if(l.length>0)return null;try{const f=JSON.parse(p.toString());if(t==="v2"?dist.isKeyboardDefinitionV2(f)||dist.isVIADefinitionV2(f):dist.isKeyboardDefinitionV3(f)||dist.isVIADefinitionV3(f))return t==="v2"?dist.isVIADefinitionV2(f)?f:dist.keyboardDefinitionV2ToVIADefinitionV2(f):dist.isVIADefinitionV3(f)?f:dist.keyboardDefinitionV3ToVIADefinitionV3(f);l=(t==="v2"?dist.isKeyboardDefinitionV2.errors||dist.isVIADefinitionV2.errors||[]:dist.isKeyboardDefinitionV3.errors||dist.isVIADefinitionV3.errors||[]).map(y=>`${u} ${y.dataPath?y.dataPath+": ":"Object: "}${y.message}`)}catch(f){f.name?l.push(`${f.name}: ${f.message}`):l.push(`${f}`)}}).filter(isVIADefinition);l.length?s(l):(r(loadCustomDefinitions({definitions:c,version:t})),r(storeCustomDefinitions({definitions:c,version:t})),r(ensureSupportedIds({productIds:c.map(u=>u.vendorProductId),version:t})),r(selectDevice(null)),r(reloadConnectedDevices()))})}function onDrop(e,t,r,s){e.preventDefault();const{dataTransfer:i}=e;if(i!=null&&i.items){const l=Array.from(i.items).filter(c=>c.kind==="file"&&c.type==="application/json").map(c=>c.getAsFile()).filter(c=>c!==null);l.length&&importDefinitions(l,t,r,s)}}const DesignTab=()=>{const{t:e}=useTranslation(),t=useDispatch(),r=Object.values(useAppSelector(getCustomDefinitions)),s=useAppSelector(getDesignDefinitionVersion),i=useAppSelector(getSelectedDefinitionIndex),l=useAppSelector(getShowMatrix),[c,u]=reactExports.useState([]),p=reactExports.useMemo(()=>r.filter(x=>x[s]),[r,s]),f=p.map((x,b)=>({label:x[s].name,value:b.toString()})),m=reactExports.useRef(null),y=p[i]&&p[i][s],K=reactExports.useRef();return jsxs(DesignPane,{onDragOver:x=>{x.dataTransfer.effectAllowed="copyMove",x.dataTransfer.dropEffect="none",x.preventDefault(),x.stopPropagation()},children:[jsx(MessageDialog,{isOpen:!hideDesignWarning,onClose:()=>{sessionStorage.setItem("hideDesignWarning","1"),hideDesignWarning="1",designWarningSeen=designWarningSeen+1,localStorage.setItem("designWarningSeen",`${designWarningSeen}`)},children:"This feature is intended for development purposes. If your keyboard is not recognized automatically by VIA, please contact your keyboard's manufacturer or vendor."}),jsx(SinglePaneFlexCell,{ref:m,children:!y&&jsx(UploadIcon,{onClick:()=>{K.current&&K.current.click()},onDrop:x=>onDrop(x,s,t,u),onDragOver:x=>{x.dataTransfer.effectAllowed="copyMove",x.dataTransfer.dropEffect="copy",x.preventDefault(),x.stopPropagation()},children:jsx(FontAwesomeIcon,{icon:faUpload})})}),jsxs(Grid,{style:{overflow:"hidden"},children:[jsx(MenuCell,{style:{pointerEvents:"all"},children:jsx(MenuContainer$6,{children:jsx(Row,{$selected:!0,children:jsxs(IconContainer,{children:[jsx(FontAwesomeIcon,{icon:faBook}),jsx(MenuTooltip,{children:e("Add Definition")})]})})})}),jsx(SpanOverflowCell,{children:jsxs(Container$7,{children:[jsxs(ControlRow,{children:[jsx(Label$1,{children:e("Load Draft Definition")}),jsx(Detail,{children:jsx(AccentUploadButton,{multiple:!0,inputRef:K,onLoad:x=>{importDefinitions(Array.from(x),s,t,u)},children:e("Load")})})]}),jsxs(ControlRow,{children:[jsx(Label$1,{children:e("Use V2 definitions (deprecated)")}),jsx(Detail,{children:jsx(AccentSlider,{isChecked:s==="v2",onChange:x=>t(updateDesignDefinitionVersion(x?"v2":"v3"))})})]}),y&&jsx(Fragment,{children:jsxs(ControlRow,{children:[jsx(Label$1,{children:e("Shown Keyboard Definition")}),jsx(Detail,{children:jsx(AccentSelect,{onChange:x=>{t(updateSelectedOptionKeys([])),x&&t(updateSelectedDefinitionIndex(+x.value))},value:f[i],options:f})})]})}),y&&jsx(Layouts,{definition:y,onLayoutChange:x=>{t(updateSelectedOptionKeys(x))}}),y&&jsxs(ControlRow,{children:[jsx(Label$1,{children:e("Show Matrix")}),jsx(Detail,{children:jsx(AccentSlider,{isChecked:l,onChange:x=>{t(updateShowMatrix(x))}})})]}),c.map(x=>jsx(IndentedControlRow,{children:jsx(DesignErrorMessage,{children:x})})),jsxs(ControlRow,{children:[jsx(Label$1,{children:e("Draft Definitions")}),jsxs(Detail,{children:[Object.values(p).length," ",e("Definitions")]})]}),p.map(x=>jsxs(IndentedControlRow,{children:[jsx(SubLabel,{children:x[s].name}),jsxs(Detail,{children:[formatNumberAsHex(x[s].vendorProductId,8),jsx(IconButtonUnfilledContainer,{onClick:()=>{t(unloadCustomDefinition({id:x[s].vendorProductId,version:s}))},style:{marginLeft:10,borderRadius:4},children:jsx(FontAwesomeIcon,{icon:faXmark,size:"lg"})})]})]},`${s}-${x[s].vendorProductId}`))]})})]})]})},Container$6=styled.div`
  display: flex;
  align-items: center;
  flex-direction: column;
  padding: 0 12px;
`,DiagnosticContainer=styled(Container$6)`
  margin-top: 20px;
  padding-top: 20px;
`,SettingsErrorMessage=styled(ErrorMessage)`
  margin: 0;
  font-style: italic;
`,Settings=()=>{const{t:e}=useTranslation(),t=useDispatch(),r=useAppSelector(getShowDesignTab),s=useAppSelector(getDisableFastRemap),i=useAppSelector(getThemeMode),l=useAppSelector(getThemeName),c=useAppSelector(getRenderMode),u=useAppSelector(getSelectedConnectedDevice),p=useAppSelector(getSelectedDeviceFirmwareVersion),[f,m]=reactExports.useState(!1),y=Object.keys(THEMES).map(M=>({label:M.replaceAll("_"," "),value:M})),K=y.find(M=>M.value===l),x=webGLIsAvailable?[{label:"2D",value:"2D"},{label:"3D",value:"3D"}]:[{label:"2D",value:"2D"}],b=x.find(M=>M.value===c);return jsx(Pane$c,{children:jsxs(Grid,{style:{overflow:"hidden"},children:[jsx(MenuCell,{style:{pointerEvents:"all",borderTop:"none"},children:jsx(MenuContainer$6,{children:jsx(Row,{$selected:!0,children:jsxs(IconContainer,{children:[jsx(FontAwesomeIcon,{icon:faToolbox}),jsx(MenuTooltip,{children:e("General")})]})})})}),jsxs(SpanOverflowCell,{style:{flex:1,borderWidth:0},children:[jsxs(Container$6,{children:[jsxs(ControlRow,{children:[jsx(Label$1,{children:e("Show Design tab")}),jsx(Detail,{children:jsx(AccentSlider,{onChange:()=>t(toggleCreatorMode()),isChecked:r})})]}),jsxs(ControlRow,{children:[jsx(Label$1,{children:e("Fast Key Mapping")}),jsx(Detail,{children:jsx(AccentSlider,{onChange:()=>t(toggleFastRemap()),isChecked:!s})})]}),jsxs(ControlRow,{children:[jsx(Label$1,{children:e("Light Mode")}),jsx(Detail,{children:jsx(AccentSlider,{onChange:()=>t(toggleThemeMode()),isChecked:i==="light"})})]}),jsxs(ControlRow,{children:[jsx(Label$1,{children:e("Keycap Theme")}),jsx(Detail,{children:jsx(AccentSelect,{defaultValue:K,options:y,onChange:M=>{M&&t(updateThemeName(M.value))}})})]}),jsxs(ControlRow,{children:[jsx(Label$1,{children:e("Render Mode")}),jsx(Detail,{children:jsx(AccentSelect,{defaultValue:b,options:x,onChange:M=>{M&&t(updateRenderMode(M.value))}})})]}),jsxs(ControlRow,{children:[jsx(Label$1,{children:e("Show Diagnostic Information")}),jsx(Detail,{children:u?jsx(AccentSlider,{onChange:()=>m(!f),isChecked:f}):jsx(SettingsErrorMessage,{children:e("Requires connected device")})})]})]}),f&&u?jsxs(DiagnosticContainer,{children:[jsxs(ControlRow,{children:[jsx(Label$1,{children:e("VIA Firmware Protocol")}),jsx(Detail,{children:u.protocol})]}),!!p&&jsxs(ControlRow,{children:[jsx(Label$1,{children:e("VIA Firmware Version")}),jsx(Detail,{children:p})]})]}):null]})]})})},name="Tester",lighting="none",layouts={width:22.5,height:6.25,optionKeys:{},keys:[{row:0,col:0,x:0,y:0,r:0,rx:0,ry:0,h:1,w:1,color:"accent"},{row:0,col:1,x:2,y:0,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:2,x:3,y:0,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:3,x:4,y:0,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:4,x:5,y:0,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:5,x:6.5,y:0,r:0,rx:0,ry:0,h:1,w:1,color:"mod"},{row:0,col:6,x:7.5,y:0,r:0,rx:0,ry:0,h:1,w:1,color:"mod"},{row:0,col:7,x:8.5,y:0,r:0,rx:0,ry:0,h:1,w:1,color:"mod"},{row:0,col:8,x:9.5,y:0,r:0,rx:0,ry:0,h:1,w:1,color:"mod"},{row:0,col:9,x:11,y:0,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:10,x:12,y:0,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:11,x:13,y:0,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:12,x:14,y:0,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:13,x:15.25,y:0,r:0,rx:0,ry:0,h:1,w:1,color:"mod"},{row:0,col:14,x:16.25,y:0,r:0,rx:0,ry:0,h:1,w:1,color:"mod"},{row:0,col:15,x:17.25,y:0,r:0,rx:0,ry:0,h:1,w:1,color:"mod"},{row:0,col:16,x:18.5,y:0,r:0,rx:0,ry:0,h:1,w:1,color:"mod"},{row:0,col:17,x:19.5,y:0,r:0,rx:0,ry:0,h:1,w:1,color:"mod"},{row:0,col:18,x:20.5,y:0,r:0,rx:0,ry:0,h:1,w:1,color:"mod"},{row:0,col:19,x:21.5,y:0,r:0,rx:0,ry:0,h:1,w:1,color:"mod"},{row:0,col:20,x:0,y:1.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:21,x:1,y:1.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:22,x:2,y:1.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:23,x:3,y:1.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:24,x:4,y:1.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:25,x:5,y:1.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:26,x:6,y:1.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:27,x:7,y:1.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:28,x:8,y:1.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:29,x:9,y:1.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:30,x:10,y:1.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:31,x:11,y:1.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:32,x:12,y:1.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:33,x:13,y:1.25,r:0,rx:0,ry:0,h:1,w:2,color:"mod"},{row:0,col:34,x:15.25,y:1.25,r:0,rx:0,ry:0,h:1,w:1,color:"mod"},{row:0,col:35,x:16.25,y:1.25,r:0,rx:0,ry:0,h:1,w:1,color:"mod"},{row:0,col:36,x:17.25,y:1.25,r:0,rx:0,ry:0,h:1,w:1,color:"mod"},{row:0,col:37,x:18.5,y:1.25,r:0,rx:0,ry:0,h:1,w:1,color:"mod"},{row:0,col:38,x:19.5,y:1.25,r:0,rx:0,ry:0,h:1,w:1,color:"mod"},{row:0,col:39,x:20.5,y:1.25,r:0,rx:0,ry:0,h:1,w:1,color:"mod"},{row:0,col:40,x:21.5,y:1.25,r:0,rx:0,ry:0,h:1,w:1,color:"mod"},{row:0,col:41,x:0,y:2.25,r:0,rx:0,ry:0,h:1,w:1.5,color:"mod"},{row:0,col:42,x:1.5,y:2.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:43,x:2.5,y:2.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:44,x:3.5,y:2.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:45,x:4.5,y:2.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:46,x:5.5,y:2.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:47,x:6.5,y:2.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:48,x:7.5,y:2.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:49,x:8.5,y:2.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:50,x:9.5,y:2.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:51,x:10.5,y:2.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:52,x:11.5,y:2.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:53,x:12.5,y:2.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:54,x:13.5,y:2.25,r:0,rx:0,ry:0,h:1,w:1.5,color:"alpha"},{row:0,col:55,x:15.25,y:2.25,r:0,rx:0,ry:0,h:1,w:1,color:"mod"},{row:0,col:56,x:16.25,y:2.25,r:0,rx:0,ry:0,h:1,w:1,color:"mod"},{row:0,col:57,x:17.25,y:2.25,r:0,rx:0,ry:0,h:1,w:1,color:"mod"},{row:0,col:58,x:18.5,y:2.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:59,x:19.5,y:2.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:60,x:20.5,y:2.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:61,x:21.5,y:2.25,r:0,rx:0,ry:0,h:2,w:1,color:"mod"},{row:0,col:62,x:0,y:3.25,r:0,rx:0,ry:0,h:1,w:1.75,color:"mod"},{row:0,col:63,x:1.75,y:3.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:64,x:2.75,y:3.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:65,x:3.75,y:3.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:66,x:4.75,y:3.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:67,x:5.75,y:3.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:68,x:6.75,y:3.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:69,x:7.75,y:3.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:70,x:8.75,y:3.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:71,x:9.75,y:3.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:72,x:10.75,y:3.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:73,x:11.75,y:3.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:74,x:12.75,y:3.25,r:0,rx:0,ry:0,h:1,w:2.25,color:"accent"},{row:0,col:75,x:18.5,y:3.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:76,x:19.5,y:3.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:77,x:20.5,y:3.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:78,x:0,y:4.25,r:0,rx:0,ry:0,h:1,w:2.25,color:"mod"},{row:0,col:79,x:2.25,y:4.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:80,x:3.25,y:4.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:81,x:4.25,y:4.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:82,x:5.25,y:4.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:83,x:6.25,y:4.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:84,x:7.25,y:4.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:85,x:8.25,y:4.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:86,x:9.25,y:4.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:87,x:10.25,y:4.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:88,x:11.25,y:4.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:89,x:12.25,y:4.25,r:0,rx:0,ry:0,h:1,w:2.75,color:"mod"},{row:0,col:90,x:16.25,y:4.25,r:0,rx:0,ry:0,h:1,w:1,color:"mod"},{row:0,col:91,x:18.5,y:4.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:92,x:19.5,y:4.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:93,x:20.5,y:4.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:94,x:21.5,y:4.25,r:0,rx:0,ry:0,h:2,w:1,color:"accent"},{row:0,col:95,x:0,y:5.25,r:0,rx:0,ry:0,h:1,w:1.25,color:"mod"},{row:0,col:96,x:1.25,y:5.25,r:0,rx:0,ry:0,h:1,w:1.25,color:"mod"},{row:0,col:97,x:2.5,y:5.25,r:0,rx:0,ry:0,h:1,w:1.25,color:"mod"},{row:0,col:98,x:3.75,y:5.25,r:0,rx:0,ry:0,h:1,w:6.25,color:"alpha"},{row:0,col:99,x:10,y:5.25,r:0,rx:0,ry:0,h:1,w:1.25,color:"mod"},{row:0,col:100,x:11.25,y:5.25,r:0,rx:0,ry:0,h:1,w:1.25,color:"mod"},{row:0,col:101,x:12.5,y:5.25,r:0,rx:0,ry:0,h:1,w:1.25,color:"mod"},{row:0,col:102,x:13.75,y:5.25,r:0,rx:0,ry:0,h:1,w:1.25,color:"mod"},{row:0,col:103,x:15.25,y:5.25,r:0,rx:0,ry:0,h:1,w:1,color:"mod"},{row:0,col:104,x:16.25,y:5.25,r:0,rx:0,ry:0,h:1,w:1,color:"mod"},{row:0,col:105,x:17.25,y:5.25,r:0,rx:0,ry:0,h:1,w:1,color:"mod"},{row:0,col:106,x:18.5,y:5.25,r:0,rx:0,ry:0,h:1,w:2,color:"alpha"},{row:0,col:107,x:20.5,y:5.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"}]},matrix={rows:1,cols:108},vendorProductId=0,fullKeyboardDefinition={name,lighting,layouts,matrix,vendorProductId},Container$5=styled.div`
  display: flex;
  align-items: center;
  flex-direction: column;
  padding: 0 12px;
`,TestPane=styled(Pane$c)`
  display: flex;
  height: 100%;
  max-width: 100vw;
  flex-direction: column;
`,TestContext=React.createContext([{clearTestKeys:()=>{}},(...e)=>{}]),Test$1=()=>{const{t:e}=useTranslation(),t=useDispatch(),r=useAppSelector(getSelectedConnectedDevice),s=useAppSelector(getSelectedDefinition),i=useAppSelector(getSelectedKeyDefinitions),l=useAppSelector(getIsTestMatrixEnabled),c=useAppSelector(getTestKeyboardSoundsSettings),[u]=reactExports.useContext(TestContext),{progress:p}=useProgress(),m=r&&s&&i&&PROTOCOL_GAMMA<=r.protocol,y=l?s:fullKeyboardDefinition;if(!y||typeof y=="string")return null;const K=[{label:"Sine",value:"sine"},{label:"Triangle",value:"triangle"},{label:"Sawtooth",value:"sawtooth"},{label:"Square",value:"square"}],x=K.find(w=>w.value===c.waveform),b=[{label:"Wicki-Hayden",value:TestKeyboardSoundsMode.WickiHayden},{label:"Chromatic",value:TestKeyboardSoundsMode.Chromatic},{label:"Random",value:TestKeyboardSoundsMode.Random}],M=b.find(w=>w.value===c.mode);return p!==100?null:jsx(TestPane,{children:jsxs(Grid,{children:[jsx(MenuCell,{style:{pointerEvents:"all"},children:jsx(MenuContainer$6,{children:jsx(Row,{$selected:!0,children:jsxs(IconContainer,{children:[jsx(FontAwesomeIcon,{icon:faCircleQuestion}),jsx(MenuTooltip,{children:e("Check Key")})]})})})}),jsx(SpanOverflowCell,{children:jsxs(Container$5,{children:[jsxs(ControlRow,{children:[jsx(Label$1,{children:e("Reset Keyboard")}),jsx(Detail,{children:jsx(AccentButton,{onClick:u.clearTestKeys,children:e("Reset")})})]}),m&&s?jsxs(ControlRow,{children:[jsx(Label$1,{children:e("Test Matrix")}),jsx(Detail,{children:jsx(AccentSlider,{isChecked:l,onChange:w=>{t(setTestMatrixEnabled(w)),u.clearTestKeys()}})})]}):null,jsxs(ControlRow,{children:[jsx(Label$1,{children:e("Key Sounds")}),jsx(Detail,{children:jsx(AccentSlider,{isChecked:c.isEnabled,onChange:w=>{t(setTestKeyboardSoundsSettings({isEnabled:w}))}})})]}),jsxs(ControlRow,{children:[jsx(Label$1,{children:e("Volume")}),jsx(Detail,{children:jsx(AccentRange,{max:100,min:0,defaultValue:c.volume,onChange:w=>{t(setTestKeyboardSoundsSettings({volume:w}))}})})]}),jsxs(ControlRow,{children:[jsx(Label$1,{children:e("Transpose")}),jsx(Detail,{children:jsx(AccentRange,{max:24,min:-24,defaultValue:c.transpose,onChange:w=>{t(setTestKeyboardSoundsSettings({transpose:w}))}})})]}),jsxs(ControlRow,{children:[jsx(Label$1,{children:e("Waveform")}),jsx(Detail,{children:jsx(AccentSelect,{isSearchable:!1,defaultValue:x,options:K,onChange:w=>{w&&t(setTestKeyboardSoundsSettings({waveform:w.value}))}})})]}),jsxs(ControlRow,{children:[jsx(Label$1,{children:e("Mode")}),jsx(Detail,{children:jsx(AccentSelect,{isSearchable:!1,defaultValue:M,options:b,onChange:w=>{w&&t(setTestKeyboardSoundsSettings({mode:w.value}))}})})]})]})})]})})},Container$4=styled.div`
  display: flex;
  flex-direction: column;
  padding: 16px;
  user-select: text;
  border-top: 1px solid var(--color_accent);
  &:last-of-type {
    border-bottom: 1px solid var(--color_accent);
  }
`,printId=e=>formatNumberAsHex(e,4),ErrorListContainer=e=>{const{t}=useTranslation(),{clear:r,save:s,hasErrors:i}=e;return jsxs(Fragment,{children:[jsxs(IconButtonGroupContainer,{style:{margin:"10px 15px"},children:[jsxs(IconButtonContainer,{onClick:r,disabled:!i,children:[jsx(FontAwesomeIcon,{size:"sm",color:"var(--color_label)",icon:faCancel}),jsx(IconButtonTooltip,{children:t("Clear")})]}),jsxs(IconButtonContainer,{onClick:s,disabled:!i,children:[jsx(FontAwesomeIcon,{size:"sm",color:"var(--color_label)",icon:faDownload}),jsx(IconButtonTooltip,{children:t("Download")})]})]}),e.children]})},AppErrors=({})=>{const e=useAppSelector(getAppErrors),t=useDispatch();return jsx(ErrorListContainer,{clear:()=>t(clearAppErrors()),save:()=>saveAppErrors(e),hasErrors:!!e.length,children:e.map(({timestamp:r,deviceInfo:{productId:s,productName:i,vendorId:l},message:c})=>jsxs(Container$4,{children:[r,jsx("ul",{children:c==null?void 0:c.split(`
`).map(u=>jsx("li",{children:u}))}),jsxs("ul",{children:[jsxs("li",{children:["Device: ",i]}),jsxs("li",{children:["Vid: ",printId(l)]}),jsxs("li",{children:["Pid: ",printId(s)]})]})]},r))})};async function saveErrors(e,t,r,s){try{const i=await window.showSaveFilePicker({suggestedName:`${r}.csv`}),l=[t.join(", ")],c=e.map(s),u=l.concat(...c).join(`
`),p=new Blob([u],{type:"text/csv"}),f=await i.createWritable();await f.write(p),await f.close()}catch{console.log("User cancelled save errors request")}}const saveAppErrors=async e=>saveErrors(e,["timestamp","productName","vendorId","productId","message"],"VIA-app-errors",({timestamp:t,deviceInfo:{productName:r,vendorId:s,productId:i},message:l})=>`${t}, ${r}, ${printId(s)}, ${printId(i)}, "${l}"`),IconButtonGroupContainer=styled.div`
  border-radius: 2px;
  border: 1px solid var(--border_color_icon);
  display: inline-flex;
  > button:last-child {
    border: none;
  }
`,ErrorPanes=[[1,AppErrors,faComputer,"App"]],Errors=()=>{const[e,t]=reactExports.useState(0),r=(ErrorPanes.find(([s])=>e===s)||ErrorPanes[0])[1];return jsx(Pane$c,{children:jsxs(Grid,{style:{overflow:"hidden"},children:[jsx(MenuCell,{style:{pointerEvents:"all",borderTop:"none"},children:jsx(MenuContainer$6,{children:ErrorPanes.map(([s,i,l,c])=>jsx(Row,{$selected:e===s,onClick:()=>{t(s)},children:jsxs(IconContainer,{children:[jsx(FontAwesomeIcon,{icon:l}),jsx(MenuTooltip,{children:c})]})},s))})}),jsx(SpanOverflowCell,{style:{flex:1,borderWidth:0},children:jsx(r,{})})]})})},ErrorLink=()=>{const e=useAppSelector(getAppErrors),[t]=useLocation(),r=t==="/errors";return e.length?jsx(Link$1,{to:"/errors",children:jsxs(CategoryIconContainer,{$selected:r,children:[jsx(FontAwesomeIcon,{size:"xl",icon:ErrorsPaneConfig.icon,color:r?"inherit":"gold"}),jsxs(CategoryMenuTooltip,{children:[e.length," error",e.length>1?"s":""]})]})}):null},ErrorsPaneConfig={component:Errors,path:"/errors",icon:faWarning,key:"errors",title:"Errors"},Container$3=styled.div`
  padding-top: 20px;
  width: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
`,Boot=()=>{const{t:e}=useTranslation(),t=useAppDispatch(),r=useAppSelector(getSavingState),s=useAppSelector(getBufferSize),i=useAppSelector(getBytesSended),l=useAppSelector(getSendSpeed),c=reactExports.useRef(null),[u,p]=reactExports.useState(),f=()=>{var K;(K=c.current)==null||K.click()},m=async K=>{var x;if((x=K.target.files)!=null&&x[0]){const b=K.target.files[0],M=b.name,w=await b.arrayBuffer(),L=new Uint8Array(w);p({name:M,byteArray:L}),t(updateState("waiting"))}else p(null)},y=()=>{u&&t(saveTabFirmware(u.byteArray))};return jsx(Pane$c,{children:jsxs(Container$3,{children:[jsxs(ControlRow,{children:[jsxs(Label$1,{children:[e("Firmware"),"：",u==null?void 0:u.name]}),jsxs(Detail,{children:[jsx(AccentButton,{disabled:r==="saving",onClick:f,children:e("Open")}),jsx(HiddenInput$3,{accept:".uf2",onChange:m,type:"file",ref:c})]})]}),jsxs(ControlRow,{children:[jsxs(FlexLabel,{children:[r==="failed"&&jsxs(Fragment,{children:[jsx(FontAwesomeIcon,{icon:faWarning,size:"xs",style:{color:"gold",marginRight:5}}),e("Failed to flash.")]}),r==="completed"&&e("Flash successful.")," ",r==="saving"&&jsx(SavingProgress,{bufferSize:s,sendSpeed:l,bytesSended:i})]}),jsx(Detail,{children:jsx(AccentButton,{onClick:y,disabled:!u||r==="saving",children:e("Flash")})})]})]})})},Container$2=styled.div`
  padding-top: 20px;
  width: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
`,Boot2=()=>{const{t:e}=useTranslation(),t=useAppDispatch(),r=useAppSelector(getSavingState),s=useAppSelector(getBufferSize),i=useAppSelector(getBytesSended),l=useAppSelector(getSendSpeed),c=reactExports.useRef(null),[u,p]=reactExports.useState(),f=()=>{var K;(K=c.current)==null||K.click()},m=async K=>{var x;if((x=K.target.files)!=null&&x[0]){const b=K.target.files[0],M=b.name,w=await b.arrayBuffer(),L=new Uint8Array(w);p({name:M,byteArray:L}),t(updateState("waiting"))}else p(null)},y=()=>{u&&t(saveTabFirmware(u.byteArray,!0))};return jsx(Pane$c,{children:jsxs(Container$2,{children:[jsxs(ControlRow,{children:[jsxs(Label$1,{children:[e("Firmware"),"：",u==null?void 0:u.name]}),jsxs(Detail,{children:[jsx(AccentButton,{disabled:r==="saving",onClick:f,children:e("Open")}),jsx(HiddenInput$3,{accept:".uf2",onChange:m,type:"file",ref:c})]})]}),jsxs(ControlRow,{children:[jsxs(FlexLabel,{children:[r==="failed"&&jsxs(Fragment,{children:[jsx(FontAwesomeIcon,{icon:faWarning,size:"xs",style:{color:"gold",marginRight:5}}),e("Failed to flash.")]}),r==="completed"&&e("Flash successful.")," ",r==="saving"&&jsx(SavingProgress,{bufferSize:s,sendSpeed:l,bytesSended:i})]}),jsx(Detail,{children:jsx(AccentButton,{onClick:y,disabled:!u||r==="saving",children:e("Flash")})})]})]})})},PANES=[{key:"default",component:ConfigurePane,icon:faKeyboard,title:"Configure",path:"/"},{key:"test",component:Test$1,icon:faStethoscope,path:"/test",title:"Key Tester"},{key:"design",component:DesignTab,icon:faBrush,path:"/design",title:"Design"},{key:"settings",component:Settings,icon:faGear,path:"/settings",title:"Settings"},{key:"debug",icon:faBug,component:Debug,path:"/debug",title:"Debug"},{key:"boot",icon:faSatelliteDish,component:Boot,path:"/boot",title:"2.4G boot"},{key:"boot2",icon:faSatelliteDish,component:Boot2,path:"/boot2",title:"boot2"},ErrorsPaneConfig],VIALogo=e=>jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 525.74 268.41",...e,children:[jsx("defs",{children:jsx("style",{children:".cls-1{fill:currentColor}"})}),jsx("g",{id:"Layer_2","data-name":"Layer 2",children:jsx("g",{id:"Layer_2-2","data-name":"Layer 2",children:jsx("path",{className:"cls-1",d:"M524.6 237.33 459.25 37.88C451.73 14.93 432.81.12 411 .12h-.13c-21.87.06-40.79 15-48.21 38.11l-64 199.23a22.93 22.93 0 0 0 43.66 14l18.74-58.35h100.81l19.13 58.5a22.93 22.93 0 0 0 43.58-14.28Zm-145-90a2.78 2.78 0 0 1-2.65-3.63l29.37-91.41C407.82 47.68 410 46 411 46c1 0 3.17 1.68 4.65 6.19l30 91.49a2.78 2.78 0 0 1-2.64 3.64ZM212.25 1.21A22.93 22.93 0 0 0 183.41 16l-64 199.23c-1.47 4.57-3.66 6.28-4.69 6.29-1 0-3.17-1.68-4.64-6.19L44.72 15.91A22.92 22.92 0 1 0 1.15 30.18l65.34 199.45c7.52 23 26.44 37.77 48.22 37.77h.14c21.86-.06 40.78-15 48.2-38.11l64-199.23a22.93 22.93 0 0 0-14.8-28.85ZM306.09 1.1a22.93 22.93 0 0 0-28.84 14.82l-71.5 222.54a22.93 22.93 0 1 0 43.66 14l71.5-222.55A22.93 22.93 0 0 0 306.09 1.1Zm-78.17 255.45a12.5 12.5 0 1 1 12.5-12.5 12.5 12.5 0 0 1-12.5 12.5Zm70.7-220.91a12.5 12.5 0 1 1 12.5-12.5 12.5 12.5 0 0 1-12.5 12.5Z"})})})]}),ExternalLinkContainer=styled.span`
  position: absolute;
  right: 1em;
  display: flex;
  gap: 1em;
`,ExternalLinks=()=>jsxs(ExternalLinkContainer,{children:[jsx("a",{href:"https://caniusevia.com/",target:"_blank",children:jsxs(CategoryIconContainer,{children:[jsx(VIALogo,{height:"25px",fill:"currentColor"}),jsx(CategoryMenuTooltip,{children:"Firmware + Docs"})]})}),jsx("a",{href:"https://discord.gg/NStTR5YaPB",target:"_blank",children:jsxs(CategoryIconContainer,{children:[jsx(FontAwesomeIcon,{size:"xl",icon:faDiscord}),jsx(CategoryMenuTooltip,{children:"Discord"})]})}),jsx("a",{href:"https://github.com/tabkb/via-app",target:"_blank",children:jsxs(CategoryIconContainer,{children:[jsx(FontAwesomeIcon,{size:"xl",icon:faGithub}),jsx(CategoryMenuTooltip,{children:"Github"})]})})]}),Container$1=styled.div`
  position: absolute;
  right: 200px;
  font-size: 18px;
`,LanguageList=styled.ul`
  padding: 0;
  border: 1px solid var(--bg_control);
  width: 160px;
  border-radius: 6px;
  background-color: var(--bg_menu);
  margin: 0;
  margin-top: 5px;
  top: 30px;
  right: 0px;
  position: absolute;
  pointer-events: ${e=>e.$show?"all":"none"};
  transition: all 0.2s ease-out;
  z-index: 11;
  opacity: ${e=>e.$show?1:0};
  overflow: hidden;
  transform: ${e=>e.$show?0:"translateY(-5px)"};
`,LanugaeButton=styled.button`
  display: block;
  text-align: center;
  outline: none;
  font-variant-numeric: tabular-nums;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  width: 100%;
  border: none;
  background: ${e=>e.$selected?"var(--bg_icon-highlighted)":"transparent"};
  color: ${e=>e.$selected?"var(--color_icon_highlighted)":"var(--color_label-highlighted)"};
  cursor: pointer;
  text-align: left;
  font-size: 14px;
  text-transform: uppercase;
  padding: 5px 10px;
  &:hover {
    border: none;
    background: ${e=>e.$selected?"var(--bg_icon-highlighted)":"var(--bg_control)"};
    color: ${e=>e.$selected?"var(--color_control-highlighted)":"var(--color_label-highlighted)"};
  }
`,ClickCover=styled.div`
  position: fixed;
  z-index: 10;
  pointer-events: all;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  opacity: 0.4;
  background: rgba(0, 0, 0, 0.75);
`,LanguageSelectors=e=>{const t=[{code:"en",lang:"English"},{code:"zh",lang:"中文"},{code:"ko",lang:"한국어"},{code:"ja",lang:"日本語"}],{i18n:r}=useTranslation(),s=l=>{r.changeLanguage(l),e.onClickOut()},i=reactExports.useMemo(()=>r.resolvedLanguage?r.resolvedLanguage:r.languages[r.languages.length-1],[r.resolvedLanguage,r.languages]);return jsxs(Fragment,{children:[e.show&&jsx(ClickCover,{onClick:e.onClickOut}),jsx(LanguageList,{$show:e.show,children:t.map(({lang:l,code:c})=>jsx(LanugaeButton,{$selected:c===i,onClick:()=>s(c),children:l},c))})]})},LanguageSelect=()=>{const[e,t]=reactExports.useState(!1);return jsxs(Container$1,{children:[jsx(CategoryIconContainer,{children:jsx(FontAwesomeIcon,{size:"xl",icon:faLanguage,onClick:()=>t(!0)})}),jsx(LanguageSelectors,{show:e,onClickOut:()=>t(!1)})]})},Container=styled.div`
  width: 100vw;
  height: 25px;
  padding: 12px 0;
  border-bottom: 1px solid var(--border_color_cell);
  display: flex;
  align-items: center;
  justify-content: center;
`,{DEBUG_PROD,MODE,DEV}={BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},showDebugPane=MODE==="development"||DEBUG_PROD==="true"||DEV,GlobalContainer=styled(Container)`
  background: var(--bg_outside-accent);
  column-gap: 20px;
`,UnconnectedGlobalMenu=()=>{var c;const{t:e,i18n:t}=useTranslation(),r=useAppSelector(getShowDesignTab),s=(c=useAppSelector(getSelectedTabkbConfig))==null?void 0:c.g24boot,[i]=useLocation(),l=reactExports.useMemo(()=>PANES.filter(u=>u.key!==ErrorsPaneConfig.key).map(u=>u.key==="boot"&&!s||u.key==="boot2"&&!s||u.key==="design"&&!r||u.key==="debug"&&!showDebugPane?null:jsx(Link$1,{to:u.path,children:jsxs(CategoryIconContainer,{$selected:u.path===i,children:[jsx(FontAwesomeIcon,{size:"xl",icon:u.icon}),jsx(CategoryMenuTooltip,{children:e(u.title)})]})},u.key)),[i,r,t.language,s]);return jsx(React.Fragment,{children:jsxs(GlobalContainer,{children:[jsx(ErrorLink,{}),l,jsx(LanguageSelect,{}),jsx(ExternalLinks,{})]})})},overrideParam=new URL(window.location.href).searchParams.get("override_hid_check");overrideParam!==null&&localStorage.setItem("override_hid_check",overrideParam);const overrideHidCheck=localStorage.getItem("override_hid_check")||"false",OVERRIDE_HID_CHECK=!!JSON.parse(overrideHidCheck),ErrorHome=styled.div`
  background: var(--bg_gradient);
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  height: 100%;
  overflow: hidden;
  height: auto;
  left: 0;
  right: 0;
  bottom: 0;
  padding-top: 24px;
  position: absolute;
  border-top: 1px solid var(--border_color_cell);
`,UsbError=styled.div`
  align-items: center;
  display: flex;
  color: var(--color_label);
  flex-direction: column;
  height: 100%;
  justify-content: center;
  margin: 0 auto;
  max-width: 650px;
  text-align: center;
`,UsbErrorIcon=styled.div`
  font-size: 2rem;
`,UsbErrorHeading=styled.h1`
  margin: 1rem 0 0;
`,UsbErrorWebHIDLink=styled.a`
  text-decoration: underline;
  color: var(--color_label-highlighted);
`,timeoutRepeater=(e,t,r=0)=>()=>setTimeout(()=>{e(),r>0&&timeoutRepeater(e,t,r-1)()},t),Home=e=>{const{t}=useTranslation(),{hasHIDSupport:r}=e,s=useAppDispatch();useAppSelector(getSelectedKey),useAppSelector(getSelectedDefinition),useAppSelector(getConnectedDevices),useAppSelector(getSelectedLayerIndex),useAppSelector(getSelectedKeyDefinitions),useAppSelector(getDisableFastRemap),useAppSelector(getBasicKeyToByte);const i=useAppSelector(getSelectedKeyboardAPI),l=timeoutRepeater(()=>{s(reloadConnectedDevices())},500,1),c=reactExports.createRef();return reactExports.useEffect(()=>{if(r)return c.current&&c.current.focus(),startMonitoring(),usbDetect.on("change",l),s(loadSupportedIds()),s(loadTabkbConfigs()),()=>{usbDetect.off("change",l)}},[]),reactExports.useEffect(()=>{s(updateSelectedKey(null))},[i]),!r&&!OVERRIDE_HID_CHECK?jsx(ErrorHome,{ref:c,tabIndex:0,children:jsxs(UsbError,{children:[jsx(UsbErrorIcon,{children:"❌"}),jsx(UsbErrorHeading,{children:t("USB Detection Error")}),jsxs("p",{children:["Looks like there was a problem getting USB detection working. Right now, we only support"," ",jsx(UsbErrorWebHIDLink,{href:"https://caniuse.com/?search=webhid",target:"_blank",children:"browsers that have WebHID enabled"}),", so make sure yours is compatible before trying again."]})]})}):jsx(Fragment,{children:e.children})},useSize=e=>{const[t,r]=reactExports.useState();return reactExports.useLayoutEffect(()=>{e.current&&r(e.current.getBoundingClientRect())},[e]),useResizeObserver(e,s=>r(s.contentRect)),t},ZOOM=5.5*.8,Camera=()=>{const{progress:e}=useProgress(),t=useThree(l=>l.camera),[r,s]=[7,7],i=J({config:{duration:800},from:{x:r}});return React.useEffect(()=>{e===100&&(console.debug("lets animate"),i.x.start(s))},[e]),React.useEffect(()=>(console.debug("mounting"),()=>{console.debug("unmounting")}),[]),useFrame(()=>{i.x.isAnimating&&(t.position.setZ(i.x.get()),t.position.setY(.4*Math.pow(i.x.get()-s,1)),t.updateProjectionMatrix()),t.zoom!==ZOOM&&(t.zoom=ZOOM,t.updateProjectionMatrix())}),jsx(PerspectiveCamera,{"position-z":r,makeDefault:!0,fov:25})},CaseGroup=styled.div``,OuterCase=styled.div`
  background: ${e=>e.background};
  width: ${e=>e.width}px;
  height: ${e=>e.height}px;
`,InnerCase=styled.div`
  background: ${e=>e.background};
  top: 0;
  left: 0;
  position: absolute;
  width: ${e=>e.width}px;
  height: ${e=>e.height}px;
`,CaseInsideBorder=10,Case$1=React.memo(e=>{const t=useAppSelector(getSelectedTheme),r=reactExports.useMemo(()=>t[dist.KeyColorType.Accent].c,[t]),s=e.width*CSSVarObject.keyXPos-CSSVarObject.keyXSpacing,i=CSSVarObject.keyYPos*e.height-CSSVarObject.keyYSpacing,l=CSSVarObject.insideBorder,c=s+l*1,u=s+l*3,[p,f]=[i+l,i+l*3],[m,y,K]=[.15,.25,.2].map(x=>getDarkenedColor(r,x));return jsxs(CaseGroup,{children:[jsx(OuterCase,{background:r,width:u,height:f,style:{borderRadius:8,boxShadow:"var(--box-shadow-keyboard)"}}),jsx(InnerCase,{background:`linear-gradient(200deg,${m} 40%,${y},${K} 80%)`,width:c,height:p,style:{transform:`translate( ${c-s}px,
           ${p-i}px)`,boxShadow:"var(--box-shadow-keyboard)",borderRadius:8}})]})},shallowEqual);var DisplayMode=(e=>(e[e.Test=1]="Test",e[e.Configure=2]="Configure",e[e.Design=3]="Design",e[e.ConfigureColors=4]="ConfigureColors",e[e.ConfigureDKS=5]="ConfigureDKS",e[e.ConfigureAP=6]="ConfigureAP",e[e.ConfigureRT=7]="ConfigureRT",e))(DisplayMode||{}),KeycapState=(e=>(e[e.Pressed=1]="Pressed",e[e.Unpressed=2]="Unpressed",e))(KeycapState||{});const KeycapContainer=styled.div`
  position: absolute;
  left: 0;
  top: 0;
  width: 52px;
  height: 54px;
  &:hover {
    z-index: 1;
    & .tooltip {
      transform: scale(1) translateY(0px);
      opacity: 1;
    }
  }
  .tooltip {
    transform: translateY(5px) scale(0.6);
    opacity: 0;
  }
`,TooltipContainer=styled.div`
  position: absolute;
  transform: rotate(${e=>e.$rotate}rad);
  width: 100%;
  height: 100%;
  bottom: 0;
`,TestOverlay=styled.div`
  transition: all 0.2s ease-out;
  position: absolute;
  left: 0;
  top: 0;
  right: 0;
  bottom: 0;
`,CanvasContainerBG=styled.div``,CanvasContainer=styled.div`
  box-shadow: inset -1px -1px 0 rgb(0 0 0 / 20%),
    inset 1px 1px 0 rgb(255 255 255 / 10%);
`,ComboKeycap=e=>{const{normalizedRects:t,clipPath:r,overflowsTexture:s,macroData:i,label:l,canvasRef:c,onClick:u,onPointerDown:p,onPointerOver:f,onPointerOut:m,disabled:y,...K}=e,[x,b]=t;return jsx(Fragment,{children:jsxs(KeycapContainer,{...K,children:[jsxs(ComboKeyBoundingContainer,{$selected:e.selected,onClick:u,onPointerDown:p,onPointerOver:f,onPointerOut:m,style:{cursor:y?"initial":"pointer",position:"relative",animation:e.disabled?"initial":e.selected?".75s infinite alternate select-glow":"",transform:`translateX(${-Math.abs(x[0]-b[0])*CSSVarObject.keyXPos/2}px) perspective(100px) translateZ(${e.keycapZ}px)`,width:Math.max(x[2],b[2])*CSSVarObject.keyXPos-CSSVarObject.keyXSpacing,height:Math.max(x[3],b[3])*CSSVarObject.keyYPos-CSSVarObject.keyYSpacing,clipPath:r},children:[jsx(ComboKeyRectContainer,{style:{position:"absolute",borderRadius:3,background:getDarkenedColor(e.color.c,.8),transform:`translate(${CSSVarObject.keyXPos*x[0]}px,${CSSVarObject.keyYPos*x[1]}px)`,width:x[2]*CSSVarObject.keyXPos-CSSVarObject.keyXSpacing,height:x[3]*CSSVarObject.keyYPos-CSSVarObject.keyYSpacing}}),jsx(ComboKeyRectContainer,{style:{position:"absolute",borderRadius:3,transform:`translate(${CSSVarObject.keyXPos*b[0]}px,${CSSVarObject.keyYPos*b[1]}px)`,background:getDarkenedColor(e.color.c,.8),width:b[2]*CSSVarObject.keyXPos-CSSVarObject.keyXSpacing,height:b[3]*CSSVarObject.keyYPos-CSSVarObject.keyYSpacing}}),jsx(ComboKeyBGContainer,{style:{position:"absolute",borderRadius:3,background:getDarkenedColor(e.color.c,.8),transform:`translate(${CSSVarObject.keyXPos*x[0]+1}px,${1+CSSVarObject.keyYPos*x[1]}px)`,width:x[2]*CSSVarObject.keyXPos-CSSVarObject.keyXSpacing-2,height:x[3]*CSSVarObject.keyYPos-CSSVarObject.keyYSpacing-2}}),jsx(CanvasContainer,{style:{borderRadius:4,background:e.color.c,position:"absolute",transform:`translate(${CSSVarObject.keyXPos*x[0]+CSSVarObject.faceXPadding[0]}px,${CSSVarObject.faceYPadding[0]+CSSVarObject.keyYPos*x[1]}px)`,width:x[2]*CSSVarObject.keyXPos-CSSVarObject.keyXSpacing-CSSVarObject.faceXPadding[0]-CSSVarObject.faceXPadding[1],height:x[3]*CSSVarObject.keyYPos-CSSVarObject.keyYSpacing-CSSVarObject.faceYPadding[0]-CSSVarObject.faceYPadding[1]}}),jsx(CanvasContainer,{style:{borderRadius:4,background:e.color.c,position:"absolute",transform:`translate(${CSSVarObject.keyXPos*b[0]+CSSVarObject.faceXPadding[0]}px,${CSSVarObject.faceYPadding[0]+CSSVarObject.keyYPos*b[1]}px)`,width:b[2]*CSSVarObject.keyXPos-CSSVarObject.keyXSpacing-CSSVarObject.faceXPadding[0]-CSSVarObject.faceXPadding[1],height:b[3]*CSSVarObject.keyYPos-CSSVarObject.keyYSpacing-CSSVarObject.faceYPadding[0]-CSSVarObject.faceYPadding[1]}}),jsx(CanvasContainerBG,{style:{borderRadius:4,background:e.color.c,position:"absolute",transform:`translate(${1+CSSVarObject.keyXPos*x[0]+CSSVarObject.faceXPadding[0]}px,${1+CSSVarObject.faceYPadding[0]+CSSVarObject.keyYPos*x[1]}px)`,width:x[2]*CSSVarObject.keyXPos-CSSVarObject.keyXSpacing-CSSVarObject.faceXPadding[0]-CSSVarObject.faceXPadding[1]-2,height:x[3]*CSSVarObject.keyYPos-CSSVarObject.keyYSpacing-CSSVarObject.faceYPadding[0]-CSSVarObject.faceYPadding[1]-2},children:jsx("canvas",{ref:c,style:{}})}),DisplayMode.Test===e.mode?jsx(TestOverlay,{style:{background:e.keycapColor,opacity:e.keycapOpacity}}):null]}),(e.macroData||e.overflowsTexture)&&jsx(TooltipContainer,{$rotate:e.rotation[2],children:jsx(Keycap2DTooltip,{children:e.macroData||e.label&&e.label.tooltipLabel})})]})})},ComboKeyBoundingContainer=styled.div`
  box-sizing: border-box;
  transition: transform 0.2s ease-out;
  animation: ${e=>e.$selected?".75s infinite alternate select-glow":"initial"};
  &:hover {
    transform: perspective(100px) translateZ(-5px);
    animation: 0.5s 1 forwards select-glow;
  }
`,ComboKeyRectContainer=styled.div`
  box-sizing: border-box;
  padding: 2px 6px 10px 6px;
  box-shadow: inset -1px -1px 0 rgb(0 0 0 / 20%),
    inset 1px 1px 0 rgb(255 255 255 / 20%);
`,ComboKeyBGContainer=styled.div`
  box-sizing: border-box;
  padding: 3px 7px 10px 6px;
`,EncoderKeyContainer=styled.div`
  position: absolute;
  left: 0;
  top: 0;
  width: 52px;
  opacity: 1;
  height: 52px;
  &:hover {
    z-index: 1;
    animation: 0.75s infinite alternate select-glow;
  }
`,EncoderKeyContent2=styled.div`
  --inner-padding: ${e=>e.$innerPadding}px;
  --size: ${e=>e.$size}px;
  --inner-size: ${e=>e.$size-e.$innerPadding*2}px;
  --half-size: ${e=>(e.$size-e.$innerPadding*2)/2}px;
  --half-size-p1: ${e=>1+(e.$size-e.$innerPadding*2)/2}px;
  --half-size-p05p: ${e=>e.$innerPadding/2+(e.$size-e.$innerPadding*2)/2}px;
  background-color: currentColor;
  padding: var(--inner-padding);
  min-width: var(--size);
  min-height: var(--size);
  clip-path: polygon(
    50% 0%,
    46.93% 3.1%,
    43.47% 0.43%,
    40.83% 3.9%,
    37.06% 1.7%,
    34.89% 5.49%,
    30.87% 3.81%,
    29.21% 7.85%,
    25% 6.7%,
    23.89% 10.92%,
    19.56% 10.33%,
    19.01% 14.66%,
    14.64% 14.64%,
    14.66% 19.01%,
    10.33% 19.56%,
    10.92% 23.89%,
    6.7% 25%,
    7.85% 29.21%,
    3.81% 30.87%,
    5.49% 34.89%,
    1.7% 37.06%,
    3.9% 40.83%,
    0.43% 43.47%,
    3.1% 46.93%,
    0% 50%,
    3.1% 53.07%,
    0.43% 56.53%,
    3.9% 59.17%,
    1.7% 62.94%,
    5.49% 65.11%,
    3.81% 69.13%,
    7.85% 70.79%,
    6.7% 75%,
    10.92% 76.11%,
    10.33% 80.44%,
    14.66% 80.99%,
    14.64% 85.36%,
    19.01% 85.34%,
    19.56% 89.67%,
    23.89% 89.08%,
    25% 93.3%,
    29.21% 92.15%,
    30.87% 96.19%,
    34.89% 94.51%,
    37.06% 98.3%,
    40.83% 96.1%,
    43.47% 99.57%,
    46.93% 96.9%,
    50% 100%,
    53.07% 96.9%,
    56.53% 99.57%,
    59.17% 96.1%,
    62.94% 98.3%,
    65.11% 94.51%,
    69.13% 96.19%,
    70.79% 92.15%,
    75% 93.3%,
    76.11% 89.08%,
    80.44% 89.67%,
    80.99% 85.34%,
    85.36% 85.36%,
    85.34% 80.99%,
    89.67% 80.44%,
    89.08% 76.11%,
    93.3% 75%,
    92.15% 70.79%,
    96.19% 69.13%,
    94.51% 65.11%,
    98.3% 62.94%,
    96.1% 59.17%,
    99.57% 56.53%,
    96.9% 53.07%,
    100% 50%,
    96.9% 46.93%,
    99.57% 43.47%,
    96.1% 40.83%,
    98.3% 37.06%,
    94.51% 34.89%,
    96.19% 30.87%,
    92.15% 29.21%,
    93.3% 25%,
    89.08% 23.89%,
    89.67% 19.56%,
    85.34% 19.01%,
    85.36% 14.64%,
    80.99% 14.66%,
    80.44% 10.33%,
    76.11% 10.92%,
    75% 6.7%,
    70.79% 7.85%,
    69.13% 3.81%,
    65.11% 5.49%,
    62.94% 1.7%,
    59.17% 3.9%,
    56.53% 0.43%,
    53.07% 3.1%
  );

  background-image: radial-gradient(
      currentColor var(--half-size),
      transparent var(--half-size-p1)
    ),
    radial-gradient(
      rgba(255, 255, 255, 0.6) var(--half-size),
      transparent var(--half-size-p1)
    ),
    radial-gradient(
      rgba(0, 0, 0, 0.2) var(--half-size),
      transparent var(--half-size-p05p)
    ),
    radial-gradient(
      rgba(0, 0, 0, 0.2) var(--half-size),
      transparent var(--half-size-p05p)
    );
  background-size: var(--size) var(--size);
  background-position: 0px 0px, -0.5px -0.5px, 0px 0px,
    calc(var(--inner-padding) / 2) calc(var(--inner-padding) / 2);
  background-repeat: repeat;

  transition: transform 0.5s ease-out;
  transform: rotate(0);
  box-sizing: border-box;
  &:hover {
    transform: rotate(450deg);
  }
`,EncoderKey=e=>jsx(EncoderKeyContainer,{onClick:e.onClick,style:e.style,children:jsx(EncoderKeyContent2,{$size:e.size&&+e.size,$innerPadding:5*e.size/52})}),getMacroData$1=({macroExpression:e,label:t})=>t&&t.length>15?t:e&&e.length?e:null,paintKeycapLabel$1=(e,t,r,s,i,l)=>{const c=e.getContext("2d");if(c==null)return;const u=devicePixelRatio,[p,f]=[e.width,e.height];e.width=p*u,e.height=f*u,e.style.width=`${p}px`,e.style.height=`${f}px`,c.scale(u,u);const m="Fira Sans, Arial Rounded MT, Arial Rounded MT Bold, Arial",y={x:4,y:4},K={x:4,y:4},x={x:3,y:0},b={x:4,y:4};if(c.beginPath(),c.moveTo(0,0),c.lineTo(e.width,0),c.lineTo(e.width,e.height),c.lineTo(0,e.height),c.lineTo(0,0),c.clip(),c.fillStyle=t,DisplayMode.ConfigureAP===s||DisplayMode.ConfigureRT===s||DisplayMode.ConfigureDKS===s){let w=10,L=.75*w,F=f/2;const I=Math.min(p-1,120),k=L+2,j=f-3;c.font=`${w}px ${m}`,c.textAlign="right";const U=(i==null?void 0:i.apData)!==void 0,V=(i==null?void 0:i.rtData)!==void 0&&i.rtData.enabled;if(DisplayMode.ConfigureAP===s&&(l?c.fillText("DKS",I,j):U&&c.fillText(i.apData.ap.toFixed(2),I,j)),DisplayMode.ConfigureRT===s&&(l?c.fillText("DKS",I,j):(c.textAlign="right",V&&c.fillText(i.rtData.rt1.toFixed(2),I,k),c.textAlign="right",V&&c.fillText(i.rtData.rt2.toFixed(2),I,j))),DisplayMode.ConfigureDKS===s)if(l)c.fillText("DKS",I,j);else{const te=[];V&&te.push("RT"),V&&c.fillText(te.join(","),I,k)}c.textAlign="start",w=13*r.size,L=.75*w,c.font=`bold ${w}px ${m}`;const z=r.label||r.key;return c.fillText(z,x.x,F+.5*L),c.measureText(z).width>p-x.x}if(r!==void 0){if(r.topLabel&&r.bottomLabel){let w=16,L=.75*w,F=r.offset[0]*L,I=r.offset[1]*L;c.font=`bold ${w}px ${m}`,c.fillText(r.topLabel,y.x,y.y+F+L),c.fillText(r.bottomLabel,K.x,f-K.y-I)}else if(r.centerLabel){let w=13*r.size,L=.75*w,F=f/2;return c.font=`bold ${w}px ${m}`,c.fillText(r.label,x.x,F+.5*L),c.measureText(r.centerLabel).width>p-x.x}else if(typeof r.label=="string"){let w=22,L=.75*w;c.font=`bold ${w}px ${m}`,c.fillText(r.label,b.x,b.y+L)}}},paintKeycap$1=(e,t,r,s,i,l,c,u)=>{const[p,f]=[CSSVarObject.keyWidth,CSSVarObject.keyHeight];if(e.width=p*t-CSSVarObject.faceXPadding.reduce((y,K)=>y+K,0),e.height=f*r-CSSVarObject.faceYPadding.reduce((y,K)=>y+K,0),e.getContext("2d")!=null)return paintKeycapLabel$1(e,s,i,l,c,u)},Keycap$1=React.memo(e=>{const{label:t,scale:r,color:s,selected:i,multiSelected:l,disabled:c,mode:u,rotation:p,keyState:f,shouldRotate:m,textureWidth:y,textureHeight:K,skipFontCheck:x,idx:b,actuation:M,dksData:w,multiSelect:L}=e,F=t&&getMacroData$1(t),[I,k]=reactExports.useState(!1),[j,U]=reactExports.useState(!1),V=reactExports.useRef(null),z=React.useCallback(()=>{if(V.current&&s&&t&&(document.fonts.check('bold 16px "Fira Sans"',t.label)||x)){const Te=paintKeycap$1(V.current,y,K,s.t,t,u,M,w);k(!!Te)}},[V.current,y,t&&t.key,r[0],r[1],s&&s.t,s&&s.c,m,u,M,w]);reactExports.useEffect(z,[t&&t.key,x,s&&s.c,s&&s.t,u,M,w]),reactExports.useEffect(()=>(document.fonts.addEventListener("loadingdone",z),()=>{document.fonts.removeEventListener("loadingdone",z)}),[]);const[te,R]=[-8,0],H=DisplayMode.Test===u?TestKeyState.KeyDown===f?KeycapState.Pressed:KeycapState.Unpressed:j||i?KeycapState.Pressed:KeycapState.Unpressed,[N]=H===KeycapState.Pressed?[te,p[2]]:[R,p[2]+Math.PI*Number(m)],Q=f===TestKeyState.KeyUp,X=DisplayMode.Test===u?H===KeycapState.Unpressed?Q?"mediumvioletred":"lightgrey":"mediumvioletred":(H===KeycapState.Unpressed,"lightgrey"),T=H===KeycapState.Unpressed?Q?.4:0:.6,[P,q,ae,he]=reactExports.useMemo(()=>{const Te=()=>{};return c?[Te,Te,Te,Te]:e.mode===DisplayMode.ConfigureColors?[Te,Ae=>{e.onPointerOver&&e.onPointerOver(Ae,b)},Te,Ae=>{e.onPointerDown&&e.onPointerDown(Ae,b)}]:[Ae=>e.onClick(Ae,b),Ae=>{e.onPointerOver&&e.onPointerOver(Ae,b),U(!0)},()=>U(!1),Ae=>{e.onPointerDown&&e.onPointerDown(Ae,b)}]},[c,e.onClick,e.onPointerDown,e.onPointerOver,U,b,u,L]);return m?jsx(EncoderKey,{onClick:P,size:y*CSSVarObject.keyWidth,style:{transform:`translate(${e.position[0]-(CSSVarObject.keyWidth*y-CSSVarObject.keyWidth)/2}px,${y*(CSSVarObject.keyHeight-CSSVarObject.keyWidth)/2+e.position[1]-(CSSVarObject.keyHeight*K-CSSVarObject.keyHeight)/2}px) rotate(${-e.rotation[2]}rad)`,borderRadius:3,color:e.color.c}}):e.clipPath?jsx(ComboKeycap,{...e,onClick:P,onPointerDown:he,onPointerOver:q,onPointerOut:ae,keycapZ:N,keycapOpacity:T,keycapColor:X,canvasRef:V,macroData:F,overflowsTexture:I,style:{transform:`translate(${CSSVarObject.keyWidth/2+e.position[0]-(CSSVarObject.keyXPos*y-CSSVarObject.keyXSpacing)/2}px,${CSSVarObject.keyHeight/2+e.position[1]-(CSSVarObject.keyYPos*K-CSSVarObject.keyYSpacing)/2}px) rotate(${-e.rotation[2]}rad)`,width:y*CSSVarObject.keyXPos-CSSVarObject.keyXSpacing,height:K*CSSVarObject.keyYPos-CSSVarObject.keyYSpacing}}):jsx(Fragment,{children:jsxs(KeycapContainer,{onClick:P,onPointerDown:he,onPointerOver:q,onPointerOut:ae,style:{transform:`translate(${CSSVarObject.keyWidth/2+e.position[0]-(CSSVarObject.keyXPos*y-CSSVarObject.keyXSpacing)/2}px,${CSSVarObject.keyHeight/2+e.position[1]-(CSSVarObject.keyYPos*K-CSSVarObject.keyYSpacing)/2}px) rotate(${-e.rotation[2]}rad)`,width:y*CSSVarObject.keyXPos-CSSVarObject.keyXSpacing,height:K*CSSVarObject.keyYPos-CSSVarObject.keyYSpacing,cursor:c?"initial":"pointer"},children:[jsxs(GlowContainer,{$selected:i,$multiSelected:L&&l,style:{animation:c?"initial":i?".75s infinite alternate select-glow":"",background:getDarkenedColor(e.color.c,.8),transform:`perspective(100px) translateZ(${N}px)`,borderRadius:3,width:y*CSSVarObject.keyXPos-CSSVarObject.keyXSpacing,height:K*CSSVarObject.keyYPos-CSSVarObject.keyYSpacing},children:[DisplayMode.Test===u?jsx(TestOverlay,{style:{background:X,opacity:T}}):null,jsx(CanvasContainer,{style:{borderRadius:4,background:e.color.c,height:"100%"},children:jsx("canvas",{ref:V,style:{}})})]}),(F||I)&&jsx(TooltipContainer,{$rotate:p[2],children:jsx(Keycap2DTooltip,{children:F||t&&t.tooltipLabel})})]})})},shallowEqual),GlowContainer=styled.div`
  box-sizing: border-box;
  padding: 2px 6px 10px 6px;
  transition: transform 0.2s ease-out;
  box-shadow: ${e=>e.$multiSelected?"inset -2px -2px 0 rgb(199 21 133 / 80%), inset 2px 2px 0 rgb(199 21 133 / 90%)":"inset -1px -1px 0 rgb(0 0 0 / 20%), inset 1px 1px 0 rgb(255 255 255 / 20%)"};
  animation: ${e=>e.$selected?".75s infinite alternate select-glow":"initial"};
  &:hover {
    transform: perspective(100px) translateZ(-5px);
    animation: 0.5s 1 forwards select-glow;
  }
`;function getKeycapSharedProps(e,t,r,s,i,l,c,u,p,f){const{position:m,rotation:y,scale:K,color:x,idx:b,onClick:M,onPointerDown:w,onPointerOver:L}=s.coords[t],F=e.ei!==void 0;return{mode:r.mode,position:m,rotation:y,scale:getScale(e,K),textureWidth:e.w,textureHeight:e.h,textureOffsetX:e.w2?Math.abs(e.w2-e.w):0,color:x,shouldRotate:F,onPointerDown:w,onPointerOver:L,keyState:r.pressedKeys?r.pressedKeys[t]:-1,disabled:!r.selectable&&!r.multiSelect,selected:t===i,multiSelected:l!==null&&l.includes(t),idx:b,label:c[t],onClick:M,key:s.indices[t],skipFontCheck:u,dksData:p[t],actuation:f[t],multiSelect:!!r.multiSelect}}const getKeysKeysIndices=e=>(t,r)=>{const s=t.ei!==void 0;return`${e}-${r}-${t.w}-${t.h}-${s}`};function getLabels(e,t,r,s,i){return e.matrixKeycodes.length?e.keys.map((l,c)=>getLabel(e.matrixKeycodes[c],l.w,t,e.definition,r,s,i)):[]}function getKeysKeys(e,t,r,s){const{keys:i}=e,{rowMap:l}=getKeyboardRowPartitions(i),c=i.map(dist.getBoundingBox),[u,p]=[Math.min(...c.map(m=>m.xStart)),Math.min(...c.map(m=>m.yStart))],f=i.map(m=>{const y={...m};return u<0&&(y.x=y.x-u),p<0&&(y.y=y.y-p),y}).map(calculatePointPosition);return{indices:i.map(getKeysKeysIndices(e.definition.vendorProductId)),coords:i.map((m,y)=>{const[K,x]=f[y],b=m.r*(2*Math.PI)/360,M=KeycapMetric.keyXSpacing/KeycapMetric.keyWidth,w=KeycapMetric.keyYSpacing/KeycapMetric.keyHeight,L=(1+M)*(m.w2||m.w)-M,F=m.h*(1+w)-w,I=getMeshName(m,l[getKeyId(m)],!1),k=e.keyColors?y:m.color,j=t[k];return{position:s(K+u,x+p),rotation:[0,0,-b],scale:[L,F,1],color:j,meshKey:I,idx:y,onClick:(U,V)=>{U.stopPropagation(),!e.multiSelect&&r(updateSelectedKey(V))},onPointerDown:e.onKeycapPointerDown,onPointerOver:e.onKeycapPointerOver}})}}function useSkipFontCheck(){const[e,t]=reactExports.useState(!1),r=reactExports.useCallback(()=>{t(!1)},[]),s=reactExports.useCallback(()=>{t(!0)},[]);return reactExports.useEffect(()=>{document.fonts.load("Fira Sans").then(r,s)},[]),e}const KeyGroupContainer=styled.div`
  position: absolute;
  top: ${e=>CaseInsideBorder*1.5}px;
  left: ${e=>CaseInsideBorder*1.5}px;
`,getPosition$1=(e,t)=>[e-CSSVarObject.keyWidth/2,t-CSSVarObject.keyHeight/2,0],getRGBArray=e=>e.map(([t,r])=>{const s=getRGB({hue:Math.round(255*t/360),sat:Math.round(255*r)}),i=`#${new Color(s).getHexString()}`;return{c:i,t:i}}),KeyGroup$1=e=>{const t=useAppDispatch(),r=useAppSelector(getSelectedKey),s=useAppSelector(getSelectedKeys),i=useAppSelector(getSelectedTheme),l=useAppSelector(getExpressions),c=useSkipFontCheck(),u=e.keyColors?getRGBArray(e.keyColors):i,{basicKeyToByte:p,byteToKey:f}=useAppSelector(getBasicKeyToByte),m=useAppSelector(U=>U.macros),{keys:y,selectedKey:K}=e,x=K===void 0?r:K,b=reactExports.useMemo(()=>getKeysKeys(e,u,t,getPosition$1),[y,u,e.onKeycapPointerDown,e.onKeycapPointerOver]),M=useAppSelector(getSelectedDksmap)||[],w=useAppSelector(getSelectedActuationMap)||[],L=useAppSelector(getTapDanceKeycodes),F=reactExports.useMemo(()=>getLabels(e,l,p,f,L),[y,e.matrixKeycodes,m,e.definition,L]),{width:I,height:k}=calculateKeyboardFrameDimensions(y),j=reactExports.useMemo(()=>e.keys.map((U,V)=>U.d?null:jsx(Keycap$1,{...getComboKeyProps(U),...getKeycapSharedProps(U,V,e,b,x,s,F,c,M,w)})),[y,x,s,F,e.pressedKeys,e.selectable,u,e.definition.vendorProductId,c,e.mode,M,w,e.multiSelect]);return jsx(KeyGroupContainer,{height:k,width:I,style:{pointerEvents:e.selectable||e.multiSelect?"all":"none"},children:j})},generateRowColArray=(e,t,r)=>{const s=e.filter(c=>c.ei===void 0&&!c.d),i=s.reduce((c,u)=>(c[u.row][u.col]=calculatePointPosition(u),c),Array(t).fill(0).map(()=>Array(r).fill(0))).map(c=>c.sort((u,p)=>u[0]-p[0])),l=s.reduce((c,u)=>(c[u.col][u.row]=calculatePointPosition(u),c),Array(r).fill(0).map(()=>Array(t).fill(0))).map(c=>c.sort((u,p)=>u[1]-p[1]));return{rowKeys:i,colKeys:l}},Matrix=({rowKeys:e,colKeys:t})=>jsxs(SVG,{style:{position:"absolute",top:CSSVarObject.insideBorder,left:CSSVarObject.insideBorder},children:[e.map((r,s)=>jsx(RowLine,{points:r.map(i=>(i||[]).join(",")).join(" ")},s)),t.map((r,s)=>jsx(ColLine,{points:r.map(i=>(i||[]).join(",")).join(" ")},s))]}),SVG=styled.svg`
  transform: rotateZ(0);
  width: 100%;
  height: 100%;
`,RowLine=styled.polyline`
  stroke: var(--color_accent);
  stroke-width: 3;
  fill-opacity: 0;
  stroke-opacity: 0.4;
  stroke-linecap: round;
`,ColLine=styled.polyline`
  stroke: var(--color_light-grey);
  stroke-width: 3;
  fill-opacity: 0;
  stroke-opacity: 0.4;
  stroke-linecap: round;
`,MatrixLines$1=({keys:e,rows:t,cols:r,width:s,height:i})=>{const{rowKeys:l,colKeys:c}=generateRowColArray(e,t,r);return jsx(Matrix,{rowKeys:l,colKeys:c})},KeyboardCanvas$1=e=>{const{containerDimensions:t,shouldHide:r,...s}=e,{width:i,height:l}=reactExports.useMemo(()=>calculateKeyboardFrameDimensions(s.keys),[s.keys]),c=t.height,u=35,p=Math.min(Math.min(1,t&&t.width/((CSSVarObject.keyWidth+CSSVarObject.keyXSpacing)*i-CSSVarObject.keyXSpacing+u*2)),c/((CSSVarObject.keyHeight+CSSVarObject.keyYSpacing)*l-CSSVarObject.keyYSpacing+u*2))||1;return jsx("div",{style:{transform:`scale(${p}, ${p})`,opacity:r?0:1,position:"absolute",pointerEvents:r?"none":"all"},children:jsx(KeyboardCanvasContent$1,{...s,width:i,height:l})})},KeyboardGroup$2=styled.div`
  position: relative;
`,KeyboardCanvasContent$1=React.memo(e=>{const{matrixKeycodes:t,keys:r,definition:s,pressedKeys:i,mode:l,showMatrix:c,selectable:u,width:p,height:f}=e;return jsxs(KeyboardGroup$2,{children:[jsx(Case$1,{width:p,height:f}),jsx(KeyGroup$1,{...e,keys:r,mode:l,matrixKeycodes:t,selectable:u,definition:s,pressedKeys:i}),c&&jsx(MatrixLines$1,{keys:r,rows:s.matrix.rows,cols:s.matrix.cols,width:p,height:f})]})},shallowEqual),Heart=React.memo(e=>{const t=Math.atan(2/e.caseWidth),r=(80+-30)/2,s=2,i=1,c=-(-e.caseWidth-i*2-s*2)/Math.cos(t),u=.1*c/22,p=95,f=95*u,m=(c-f)/2,y=reactExports.useMemo(()=>{const x=new Shape;return x.moveTo(u*(25-r),u*(25-p)),x.bezierCurveTo(u*(25-r),u*(25-p),u*(20-r),u*(0-p),u*(0-r),u*(0-p)),x.bezierCurveTo(u*(-30-r),u*(0-p),u*(-30-r),u*(35-p),u*(-30-r),u*(35-p)),x.bezierCurveTo(u*(-30-r),u*(55-p),u*(-10-r),u*(77-p),u*(25-r),u*(95-p)),x.bezierCurveTo(u*(60-r),u*(77-p),u*(80-r),u*(55-p),u*(80-r),u*(35-p)),x.bezierCurveTo(u*(80-r),u*(35-p),u*(80-r),u*(0-p),u*(50-r),u*(0-p)),x.bezierCurveTo(u*(35-r),u*(0-p),u*(25-r),u*(25-p),u*(25-r),u*(25-p)),x},[e.caseWidth,e.caseHeight,e.color]),K={depth:4,bevelEnabled:!0,bevelSegments:10,bevelSize:1,bevelThickness:1};return jsxs("mesh",{position:[-c+m,s*2+i*2+e.caseHeight/2,0],scale:1,rotation:[Math.PI/2,t,Math.PI/2],children:[jsx("extrudeGeometry",{attach:"geometry",args:[y,K]}),jsx("meshPhongMaterial",{color:e.color,transparent:!0,opacity:1})]})},shallowEqual),makeShape2=e=>{const t=Math.tan(Math.PI*7.5/180),r=10,s=r+t*e,i=e/2,l=new Shape;let c=2,u=Math.PI/2;return l.moveTo(-s,i),l.absarc(-s-c,i-c,c,u*1+u,u*1,!0),l.absarc(-c,i,c,u*1,u*1-u,!0),l.absarc(-c,-i,c,u*3+u,u*3,!0),l.absarc(-r-c,-i-c,c,u*2+u,u*2,!0),l},Case=React.memo(e=>{const t=useAppSelector(getSelectedTheme),r=reactExports.useMemo(()=>t[dist.KeyColorType.Accent].c,[t]),s="#212020",i=reactExports.useMemo(()=>t[dist.KeyColorType.Accent].t,[t]),l=e.width*KeycapMetric.keyXPos-KeycapMetric.keyXSpacing,c=KeycapMetric.keyYPos*e.height-KeycapMetric.keyYSpacing,u=4,p=l+u*1,f=l+u*2.5,[m,y]=reactExports.useMemo(()=>[c+u,c+u*2].map(makeShape2),[c]),K=1,x=10,w=10+Math.tan(Math.PI*7.5/180)*(c+u*2);return jsxs("group",{scale:1,"position-z":-K*2,"rotation-y":-Math.PI/2,children:[jsx(Heart,{caseWidth:w,caseHeight:c,color:i}),jsxs("mesh",{position:[-K,0,-f/2],castShadow:!0,children:[jsx("extrudeGeometry",{attach:"geometry",args:[y,{depth:f,bevelEnabled:!0,bevelSize:K,bevelThickness:K,bevelSegments:x}]}),jsx("meshPhongMaterial",{color:r,shininess:100,reflectivity:1,specular:getDarkenedColor(r,.2)})]}),jsxs("mesh",{position:[0,0,-p/2],castShadow:!0,children:[jsx("extrudeGeometry",{attach:"geometry",args:[m,{depth:p,bevelEnabled:!0,bevelSize:K/2,bevelThickness:K,bevelSegments:x}]}),jsx("meshPhongMaterial",{color:s,shininess:100,reflectivity:1,specular:getDarkenedColor(r,.2)})]})]})}),getMacroData=({macroExpression:e,label:t})=>t&&t.length>15?t:e&&e.length?e:null,paintEncoder=(e,[t,r],s,i)=>{const[u,p]=[512*t,512*r];e.width=u,e.height=p;const f=e.getContext("2d"),m=2.6;if(f){f.fillStyle=s,f.clearRect(0,0,e.width,e.height),f.fillRect(0,0,e.width,e.height),f.fill(),f.fillStyle=i;const y=.4*u/m;f.ellipse(.5*u/m,2.1*p/m,y,y,Math.PI/4,0,2*Math.PI),f.fill()}},paintKeycapLabel=(e,t,r,s,i,l,c)=>{const u=e.getContext("2d");if(u==null)return;const p="Fira Sans, Arial Rounded MT, Arial Rounded MT Bold, Arial",f={x:.015,y:.02},m={x:.01,y:-.01},y={x:.01,y:.02};if(u.beginPath(),u.moveTo(t.bl.x*e.width,(1-t.bl.y)*e.height),u.lineTo(t.bl.x*e.width,(1-t.tr.y)*e.height),u.lineTo(t.tr.x*e.width,(1-t.tr.y)*e.height),u.lineTo(t.tr.x*e.width,(1-t.bl.y)*e.height),u.lineTo(t.bl.x*e.width,(1-t.bl.y)*e.height),u.clip(),u.fillStyle=r,DisplayMode.ConfigureAP===i||DisplayMode.ConfigureRT===i||DisplayMode.ConfigureDKS===i){let x=30,b=.75*x/e.height,M=(t.tr.y+t.bl.y)/2;t.bl.x*e.width;const w=t.tr.x*e.width,L=(1-(t.tr.y-b-.01))*e.height,F=(1-(t.bl.y+.015))*e.height;u.font=`${x}px ${p}`,u.textAlign="right";const I=(l==null?void 0:l.apData)!==void 0,k=(l==null?void 0:l.rtData)!==void 0&&l.rtData.enabled;if(DisplayMode.ConfigureAP===i&&(c?u.fillText("DKS",w,F):I&&u.fillText(l.apData.ap.toFixed(2),w,F)),DisplayMode.ConfigureRT===i&&(c?u.fillText("DKS",w,F):(u.textAlign="right",k&&u.fillText(l.rtData.rt1.toFixed(2),w,L),u.textAlign="right",k&&u.fillText(l.rtData.rt2.toFixed(2),w,F))),DisplayMode.ConfigureDKS===i)if(c)u.fillText("DKS",w,F);else{const U=[];k&&U.push("RT"),k&&u.fillText(U.join(","),w,L)}x=37.5*s.size,b=.75*x/e.height,u.textAlign="start",u.font=`bold ${x}px ${p}`;const j=s.label||s.key;return u.fillText(j,(t.bl.x+m.x)*e.width,(1-(M-.5*b-m.y))*e.height),u.measureText(j).width>(t.tr.x-(t.bl.x+m.x))*e.width}if(u.textAlign="left",s!==void 0){if(s.topLabel&&s.bottomLabel){let x=52,b=.75*x/e.height,M=s.offset[0]*b,w=s.offset[1]*b;u.font=`bold ${x}px ${p}`,u.fillText(s.topLabel,(t.bl.x+f.x)*e.width,(1-(t.tr.y-b-f.y-M))*e.height),u.fillText(s.bottomLabel,(t.bl.x+f.x)*e.width,(1-(t.bl.y+f.y+w))*e.height)}else if(s.centerLabel){let x=37.5*s.size,b=.75*x/e.height,M=(t.tr.y+t.bl.y)/2;return u.font=`bold ${x}px ${p}`,u.fillText(s.label,(t.bl.x+m.x)*e.width,(1-(M-.5*b-m.y))*e.height),u.measureText(s.centerLabel).width>(t.tr.x-(t.bl.x+m.x))*e.width}else if(typeof s.label=="string"){let x=75,b=.75*x/e.height;u.font=`bold ${x}px ${p}`,u.fillText(s.label,(t.bl.x+y.x)*e.width,(1-(t.tr.y-b-y.y))*e.height)}}},calculateTextureRects=(e,t,r,s,i)=>{const l=.3846153846153846,p=.445/19.05*l;let f=Math.min(2.75,r),m=Math.min(2.75,s);(e>1||t>1)&&(f=1,m=1);let y={bl:{x:p,y:p},tr:{x:f*l-p,y:m*l-p}},K={bl:{x:y.bl.x+.07,y:y.bl.y+.08},tr:{x:y.tr.x-.07,y:y.tr.y-.0146}};return i>0&&(K.bl.x+=i*l,K.tr.x+=i*l,y.bl.x+=i*l,y.tr.x+=i*l),{keycapRect:y,faceRect:K}},paintKeycap=(e,[t,r],s,i,l,c,u,p,f,m,y)=>{const K=calculateTextureRects(t,r,s,i,p),x=512;e.width=x*t,e.height=x*r;const b=e.getContext("2d");if(b!=null)return b.fillStyle=l,b.fillRect(0,0,e.width,e.height),paintKeycapLabel(e,K.faceRect,c,u,f,m,y)},Keycap=React.memo(e=>{const{label:t,scale:r,color:s,onClick:i,selected:l,multiSelected:c,disabled:u,mode:p,rotation:f,keyState:m,shouldRotate:y,keycapGeometry:K,textureOffsetX:x,textureWidth:b,textureHeight:M,onPointerOver:w,onPointerDown:L,idx:F,actuation:I,multiSelect:k,dksData:j}=e,U=reactExports.useRef(),V=t&&getMacroData(t),[z,te]=reactExports.useState(!1),[R,H]=reactExports.useState(!1),N=reactExports.useRef(),Q=reactExports.useRef(document.createElement("canvas")),X=React.useCallback(()=>{if(Q.current&&s){if(y)paintEncoder(Q.current,[r[0],r[1]],s.c,s.t);else{const pe=paintKeycap(Q.current,[r[0],r[1]],b,M,s.c,s.t,t,x,p,I,j);te(!!pe)}N.current.needsUpdate=!0}},[Q.current,b,t&&t.key,r[0],r[1],s&&s.t,s&&s.c,y,p,I,j]);reactExports.useEffect(X,[t&&t.key,s&&s.c,s&&s.t,p,I,j]);const T=J({config:{duration:800},from:{x:0,y:"#f4a0a0"},loop:l?{reverse:!0}:!1,to:{x:100,y:"#b49999"}});let P=K.boundingBox.max.z;const[q,ae]=[P,P+8],he=DisplayMode.Test===p?TestKeyState.KeyDown===m?KeycapState.Pressed:KeycapState.Unpressed:R||l?KeycapState.Unpressed:KeycapState.Pressed,[Te,Ae]=he===KeycapState.Pressed?[q,f[2]]:[ae,f[2]+Math.PI*Number(y)],$e=m===TestKeyState.KeyUp,Ye=DisplayMode.Test===p?he===KeycapState.Unpressed?$e?"palevioletred":"lightgrey":"pink":(he===KeycapState.Unpressed,"lightgrey"),{z:ot,b:Qe,rotateZ:Xe,tooltipScale:it}=J({config:{duration:100},z:Te,b:Ye,rotateZ:Ae,tooltipScale:R?1:0}),[ct,oe,ne,we]=reactExports.useMemo(()=>{const pe=()=>{};return u?[pe,pe,pe,pe]:e.mode===DisplayMode.ConfigureColors?[pe,fe=>{w&&w(fe,F)},pe,fe=>{L&&L(fe,F)}]:[fe=>i(fe,F),fe=>{w&&w(fe,F),H(!0)},()=>H(!1),fe=>{L&&L(fe,F)}]},[u,i,L,w,H,F,p,k]),Se=E.meshPhongMaterial;return jsxs(Fragment,{children:[jsx(E.mesh,{...e,ref:U,"position-z":ot,"rotation-z":Xe,onClick:ct,onPointerDown:we,onPointerOver:oe,onPointerOut:ne,geometry:K,children:jsx(Se,{attach:"material",color:l?T.y:k&&c?"palevioletred":Qe,children:jsx("canvasTexture",{ref:N,attach:"map",image:Q.current})})}),(V||z)&&jsx(React.Suspense,{fallback:null,children:jsx(E.group,{position:e.position,"position-z":20,scale:it,children:jsx(Html,{transform:!0,style:{pointerEvents:"none"},children:jsx(KeycapTooltip,{children:V||t&&t.tooltipLabel})})})})]})},shallowEqual),glbSrc="/assets/keyboard_components-1a09821a.glb",getSRGBArray=e=>e.map(([t,r])=>{const s=getRGB({hue:Math.round(255*t/360),sat:Math.round(255*r)}),i=`#${new Color(s).convertSRGBToLinear().getHexString()}`;return{c:i,t:i}}),getPosition=(e,t)=>[KeycapMetric.keyXPos*e/CSSVarObject.keyXPos,-t*KeycapMetric.keyYPos/CSSVarObject.keyYPos,0],KeyGroup=e=>{const t=useAppDispatch(),r=useGLTF(glbSrc,!0).scene,s=useAppSelector(getSelectedKey),i=useAppSelector(getSelectedKeys),l=useAppSelector(getSelectedSRGBTheme),c=useAppSelector(getExpressions),u=useSkipFontCheck(),p=e.keyColors?getSRGBArray(e.keyColors):l,{basicKeyToByte:f,byteToKey:m}=useAppSelector(getBasicKeyToByte),y=useAppSelector(V=>V.macros),{keys:K,selectedKey:x}=e,b=x===void 0?s:x,M=reactExports.useMemo(()=>getKeysKeys(e,p,t,getPosition),[K,p,e.onKeycapPointerDown,e.onKeycapPointerOver]),w=useAppSelector(getSelectedDksmap)||[],L=useAppSelector(getSelectedActuationMap)||[],F=useAppSelector(getTapDanceKeycodes),I=reactExports.useMemo(()=>getLabels(e,c,f,m,F),[K,e.matrixKeycodes,y,e.definition]),{width:k,height:j}=calculateKeyboardFrameDimensions(K),U=reactExports.useMemo(()=>e.keys.map((V,z)=>{const{meshKey:te}=M.coords[z];return V.d?null:jsx(Keycap,{keycapGeometry:(r.getObjectByName(te)||r.getObjectByName("K-R1-100")).geometry,...getKeycapSharedProps(V,z,e,M,b,i,I,u,w,L)})}),[K,b,i,I,e.pressedKeys,e.selectable,p,e.definition.vendorProductId,u,e.mode,w,L,e.multiSelect]);return jsx("group",{scale:1,position:[(-k*KeycapMetric.keyXPos+KeycapMetric.keyXSpacing)/2,(KeycapMetric.keyYPos*j-KeycapMetric.keyYSpacing)/2,0],children:U})},MatrixLines=({keys:e,rows:t,cols:r,width:s,height:i})=>{const[l,c]=["lightpink","lightgrey"],{rowKeys:u,colKeys:p}=generateRowColArray(e,t,r);return jsx("group",{scale:.35,rotation:[Math.PI,0,0],position:[-s*KeycapMetric.keyXPos/2,(i+.4)*KeycapMetric.keyYPos/2,11],children:jsxs(Segments,{lineWidth:1,children:[u.flatMap(f=>{const m=f.filter(y=>y);return m.length>=2?m.reduce((y,K,x)=>y.prev===null?{res:[],prev:K}:{res:[...y.res,jsx(Segment,{start:[y.prev[0],y.prev[1],0],end:[K[0],K[1],0],color:l},`row-${x}`)],prev:K},{res:[],prev:null}).res:[]}),p.flatMap(f=>{const m=f.filter(y=>y);return m.length>=2?m.reduce((y,K,x)=>y.prev===null?{res:[],prev:K}:{res:[...y.res,jsx(Segment,{start:[y.prev[0],y.prev[1],0],end:[K[0],K[1],0],color:c},`col-${x}`)],prev:K},{res:[],prev:null}).res:[]})]})},`${t}-${r}-${s}-${i}`)},KeyboardCanvas=e=>{const{containerDimensions:t,shouldHide:r,...s}=e,{width:i,height:l}=reactExports.useMemo(()=>calculateKeyboardFrameDimensions(s.keys),[s.keys]),[c,u]=reactExports.useState(!1),{verticalPostion:p,tilt:f}=J({config:{tension:35,friction:5,mass:.3},verticalPostion:c?1:-3,tilt:c?-.15:0});reactExports.useEffect(()=>{const y=document.querySelector("canvas");y&&(y.addEventListener("mouseenter",()=>{u(!0)}),y.addEventListener("mouseleave",()=>{u(!1)}))},[]);const m=Math.min(Math.min(1,t&&t.width/((CSSVarObject.keyWidth+CSSVarObject.keyXSpacing)*i-CSSVarObject.keyXSpacing+70)),500/((CSSVarObject.keyHeight+CSSVarObject.keyYSpacing)*l-CSSVarObject.keyYSpacing+70))||1;return jsx("group",{position:[0,-0,-19],scale:.015*m,visible:!r,children:jsx(KeyboardCanvasContent,{...s,width:i,height:l,verticalPostion:p,tilt:f})})},KeyboardCanvasContent=React.memo(e=>{const{matrixKeycodes:t,keys:r,definition:s,pressedKeys:i,mode:l,showMatrix:c,selectable:u,width:p,height:f,verticalPostion:m,tilt:y}=e;return jsx(E.group,{"position-y":m,"rotation-x":y,children:jsxs(PresentationControls,{enabled:e.mode!==DisplayMode.ConfigureColors,global:!0,snap:!0,speed:1,zoom:1,polar:[-Math.PI/10,Math.PI/10],azimuth:[-Math.PI/16,Math.PI/16],config:{mass:1,tension:170,friction:26},children:[jsx(Case,{width:p,height:f}),jsx(KeyGroup,{...e,keys:r,mode:l,matrixKeycodes:t,selectable:u,definition:s,pressedKeys:i}),c&&jsx(MatrixLines,{keys:r,rows:s.matrix.rows,cols:s.matrix.cols,width:p,height:f})]})})},shallowEqual),useGlobalKeys=e=>{const t=!e,r=reactExports.useState({}),[s,i]=r;function l(u){u.preventDefault(),!t&&!u.repeat&&s[getIndexByEvent(u)??-1]!==TestKeyState.KeyDown&&i(p=>({...p,[getIndexByEvent(u)]:TestKeyState.KeyDown}))}const c=u=>{u.preventDefault(),!t&&s[getIndexByEvent(u)]!==TestKeyState.KeyUp&&i(p=>({...p,[getIndexByEvent(u)]:TestKeyState.KeyUp}))};return reactExports.useEffect(()=>(e&&(window.addEventListener("keydown",l),window.addEventListener("keyup",c)),()=>{window.removeEventListener("keydown",l),window.removeEventListener("keyup",c)}),[e]),r},invertTestKeyState=e=>e===TestKeyState.KeyDown?TestKeyState.KeyUp:TestKeyState.KeyDown,useMatrixTest=(e,t,r,s)=>{const i=reactExports.useState([]),[,l]=i,c=useDispatch(),u=reactExports.useRef(e);reactExports.useEffect(()=>{let m=[];const y=()=>{u.current=!1},K=async(x,b,M,w)=>{if(e&&x&&M){const{cols:L,rows:F}=M.matrix,I=Math.ceil(L/8),k=Math.floor(28/I);try{let j=[];for(let V=0;V<F;V+=k){const z=Math.min(F*I-j.length,I*k);j.push(...await x.getKeyboardValue(KeyboardValue.SWITCH_MATRIX_STATE,b>=12?[V]:[],z))}if(!j.some((V,z)=>V^(w[z]||0))){await x.timeout(20),u.current&&K(x,b,M,w);return}l(V=>j.reduce((z,te,R)=>{const H=te^(w[R]||0);if(H===0)return z;const N=~~(R/I),Q=8*(I-1-R%I);return Array(Math.max(0,Math.min(8,L-Q))).fill(0).reduce((X,T,P)=>{const q=L*N+P+Q;return X[q]=(H>>P&1)===1?invertTestKeyState(X[q]):X[q],X},z)},Array.isArray(V)&&V.length===F*L?[...V]:Array(F*L).fill(TestKeyState.Initial))),await x.timeout(20),u.current&&K(x,b,M,j)}catch{u.current=!1,c(setTestMatrixEnabled(!1))}}};return e&&t&&r&&s&&(u.current=!0,K(t,r.protocol,s,m)),()=>{y()}},[e,s,t]);const p=m=>{m.preventDefault()},f=m=>{m.preventDefault()};return reactExports.useEffect(()=>(e&&(window.addEventListener("keydown",p),window.addEventListener("keyup",f)),()=>{window.removeEventListener("keydown",p),window.removeEventListener("keyup",f)}),[e]),i},useColorPainter=(e,t)=>{const r=useAppSelector(getSelectedConnectedDevice),s=useAppSelector(getSelectedKeyboardAPI),i=useAppSelector(getSelectedCustomMenuData)||{__perKeyRGB:[]},[l,c]=reactExports.useState([]);reactExports.useEffect(()=>{const p=i.__perKeyRGB??[],m=(e.find(y=>"li"in y)?e.map(y=>y.li??-1):[]).map(y=>{const K=p[y??-1];if(K)return getHSVFrom256(K)});c(m)},[i.__perKeyRGB&&i.__perKeyRGB.length,e]);const u=reactExports.useCallback((p,f)=>{if(p.buttons===1&&s){const m=Math.round(t[0]*255/360),y=Math.round(t[1]*255),K=e[f].li;K!==void 0&&(s.setPerKeyRGBMatrix(K,m,y),s.commitCustomMenu(0),c(x=>(x[f]=t,[...x])))}},[c,t,e,r]);return{keyColors:l,onKeycapPointerDown:u,onKeycapPointerOver:u}};styled.div`
  display: flex;
  margin-left: 50px;
  margin-bottom: 10px;
  font-size: 12px;
`;styled.div`
  width: 30px;
  height: 30px;
  border: 2px solid var(--color_accent);
  border-radius: 5px;
  color: var(--color_accent);
`;styled.div`
  width: 100px;
  display: flex;
  flex-direction: column;
  align-items: center;
`;styled.div`
  padding: 5px 0;
  text-decoration: ${e=>e.$enable?"underline":"none"};
  cursor: ${e=>e.$enable?"pointer":"default"};
  color: var(--color_label-highlighted);
  pointer-events: ${e=>e.$enable?"auto":"none"};
`;styled.dialog`
  padding: 0;
  border-width: 0;

  background: transparent;
  &::backdrop {
    background: rgba(0, 0, 0, 0.75);
  }

  & > div {
    transition: transform 0.2s ease-out;
    transform: translateY(-20px);
  }

  &[open] > div {
    transform: translateY(0px);
  }
`;styled.div`
  display: flex;
  justify-content: center;
  align-items: center;
`;styled(AccentRange)`
  transform: rotate(90deg);
  transform-origin: center;
  height: 150px;
  width: 150px;
`;styled.div`
  position: relative;
`;styled.div.attrs(e=>e.$max===e.$min?{}:{style:{top:134/(e.$max-e.$min)*(e.$value-e.$min)+4}})`
  position: absolute;
  left: 100px;
  font-size: 12px;
  color: var(--color_accent);
`;styled.div`
  position: absolute;
  top: -2px;
  font-size: 12px;
  left: 10px;
  color: var(--color_accent);
`;styled.div`
  position: absolute;
  bottom: 2px;
  font-size: 12px;
  left: 10px;
  color: var(--color_accent);
`;const size=100,minSize=24;styled.div.attrs(e=>({style:{width:e.$width+"px"}}))`
  position: absolute;
  z-index: 1;
  top: 0;
  left: 0;
  background: var(--color_accent);
  border-radius: ${minSize}px;
  height: ${minSize}px;
  cursor: pointer;
`;styled.div`
  width: ${minSize}px;
  height: ${minSize}px;
  display: flex;
  justify-content: center;
  align-items: center;
  color: var(--color_label-highlighted);
  border-radius: ${minSize}px;
  background: var(--bg_control);
`;styled.div.attrs(e=>({style:{left:size*e.$index+"px"}}))`
  position: absolute;
  height: ${minSize}px;
`;styled.div.attrs(e=>({style:{left:e.$width>0?e.$width-minSize/2+minSize/4+"px":"0px",cursor:e.$width>0?"ew-resize":"pointer",width:e.$width>0?minSize/2+"px":minSize+"px"}}))`
  position: absolute;
  z-index: 2;
  height: ${minSize}px;
  top: 0;
`;styled.div`
  border: 4px solid
    ${e=>e.$active?"var(--color_accent)":"var(--border_color_icon)"};
  width: 50px;
  height: 50px;
  border-radius: 10px;
  background: var(--bg_control);
  margin-right: 30px;
  cursor: pointer;
  text-align: center;
  line-height: 18px;
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: 14px;
  // position: relative;
  // padding: 0;
  // &:hover {
  //   background: var(--bg_control);
  //   border: 4px solid
  //     ${e=>e.$active?"var(--color_accent)":"var(--border_color_icon)"};
  // }
`;styled.div`
  white-space: pre-wrap;
  text-overflow: ellipsis;
  overflow: hidden;
  user-select: none;
  color: var(--color_label-highlighted);
`;styled.div`
  padding: 5px 0;
  display: flex;
  align-items: center;
`;styled.div`
  width: 330px;
  display: flex;
  align-items: center;
  overflow: hidden;
  position: relative;
  height: 24px;
`;styled.div``;styled.div`
  display: grid;
  grid-template-columns: repeat(auto-fill, 64px);
  grid-auto-rows: 64px;
  justify-content: center;
  grid-gap: 10px;
`;styled.div`
  padding: 10px 10px 0;
  display: flex;
`;styled(Button)`
  width: 50px;
  height: 50px;
  line-height: 18px;
  border-radius: 64px;
  font-size: 14px;
  border: 4px solid var(--border_color_icon);
  background: var(--bg_control);
  color: var(--color_label-highlighted);
  margin: 0;
  box-shadow: none;
  position: relative;
  border-radius: 10px;
  &:hover {
    border-color: var(--color_accent);
    transform: translate3d(0, -2px, 0);
  }
  ${e=>e.disabled&&"cursor:not-allowed;filter:opacity(50%);"}
`;styled.div`
  text-overflow: ellipsis;
  overflow: hidden;
`;styled(Button)`
  width: 50px;
  height: 50px;
  line-height: 18px;
  border-radius: 10px;
  font-size: 14px;
  border: 4px solid var(--border_color_icon);
  background: var(--color_accent);
  border-color: var(--color_inside_accent);
  color: var(--color_inside_accent);
  margin: 0;
`;styled.div`
  padding: 12px;
  padding-bottom: 30px;
`;styled.div`
  position: fixed;
  bottom: 0;
  background: #d9d9d97a;
  box-sizing: border-box;
  transition: opacity 0.4s ease-out;
  height: 25px;
  width: 100%;
  line-height: 14px;
  padding: 5px;
  font-size: 14px;
  opacity: 1;
  pointer-events: none;
  &:empty {
    opacity: 0;
  }
`;styled.div`
  display: flex;
  width: 100%;
`;styled.div`
  width: 450px;
  margin-right: 10px;
  flex-shrink: 0;
  padding-top: 10px;
`;styled.div`
  width: 100%;
  display: block;
  border: 1px solid var(--border_color_cell);
  border-style: dashed;
  padding: 20px 20px;
  border-radius: 15px;
  box-sizing: border-box;
  text-align: center;
  color: var(--color_label-highlighted);
`;styled.div`
  height: calc(100vh - 580px);
  padding-left: 10px;
  overflow-y: auto;
  width: 100%;
  border-left: 1px solid var(--border_color_cell);
`;styled.div`
  height: calc(100vh - 600px);
  overflow-y: auto;
  padding-left: 10px;
  color: var(--color_label);
`;styled.div`
  flex-wrap: wrap;
  display: flex;
  margin-top: 20px;
`;styled.div`
  padding: 0 20px;
  cursor: pointer;
`;const DksBindingKey=styled.div`
  width: 50px;
  height: 50px;
  border-radius: 10px;
  background: var(--bg_control);
  margin-right: 30px;
  cursor: pointer;
  text-align: center;
  line-height: 18px;
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: 14px;
  border: 2px solid var(--border_color_icon);
  margin-right: 10px;
  & > span {
    white-space: pre-wrap;
    text-overflow: ellipsis;
    overflow: hidden;
    user-select: none;
    color: var(--color_label-highlighted);
  }
`;styled.div`
  display: flex;
  align-items: center;
  margin-bottom: 10px;
  & > button {
    margin-left: 10px;
  }
  &:hover ${DksBindingKey} {
    border-color: var(--color_accent);
  }
`;styled.div`
  display: flex;
  cursor: pointer;
`;styled.div`
  position: relative;
  height: 24px;
  padding-bottom: 15px;
  border-bottom: 1px solid var(--border_color_cell);
  text-align: center;
  color: var(--color_label);
  > span {
    color: var(--color_accent);
  }
  margin-bottom: 10px;
  ${SimpleIconButton} {
    position: absolute;
    padding: 0 10px;
    font-size: 16px;
    left: 0px;
    top: 2px;
  }
`;styled.div`
  display: flex;
  align-items: center;
  justify-content: space-between;
`;styled.div`
  position: relative;
  width: 120px;
  padding-top: 15px;
`;styled.div`
  background: var(--bg_control);
  position: relative;
  border-radius: 5px;
  width: 28px;
  height: 165px;
  overflow: hidden;
  > span {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    background: var(--color_accent);
    height: 100%;
    width: 28px;
    transform-origin: top;
    transition: transform 0.1s ease-in-out;
  }
`;styled.div`
  width: 28px;
  height: 165px;
  margin: 0 auto;
  position: relative;
`;styled.div`
  position: absolute;
  top: 0;
  left: 0;
  height: 165px;
  width: 28px;
  z-index: 1;
`;styled.div`
  font-size: 10px;
  /* font-weight: bold; */
  height: 1px;
  width: 100%;
  display: flex;
  align-items: center;
  color: var(--color_accent);
  position: absolute;
  & > span {
    line-height: normal;
    margin-left: -36px;
  }
  &::before,
  &::after {
    background: var(--color_accent);
    content: '';
    display: block;
    position: absolute;
    width: 10px;
    height: 1px;
    border-radius: 1px;
  }
  &::before {
    left: -14px;
  }
  &::after {
    right: -14px;
  }
`;styled.div`
  height: 1px;
  width: 100%;
  display: flex;
  align-items: center;
  color: var(--color_accent);
  position: absolute;
  &::before,
  &::after {
    background: var(--color_accent);
    content: '';
    display: block;
    position: absolute;
    width: 5px;
    height: 1px;
    border-radius: 1px;
  }
  &::before {
    left: -9px;
  }
  &::after {
    right: -9px;
  }
`;styled.div`
  line-height: 3em;
  font-size: 16px;
  text-align: right;
  margin-right: 20px;
`;styled.div`
  padding: 20px 0;
  width: 100%;
  /* border: 1px solid #ccc; */
  margin-left: -100px;
  margin-right: 0px;
  overflow: hidden;
  display: flex;
  justify-content: flex-end;
  column-gap: 10px;
`;const title="Actuation";styled.div`
  padding: 15px 10px 20px 10px;
`;styled(CenterPane)`
  height: 100%;
`;styled.div`
  display: flex;
  align-items: center;
  flex-direction: column;
  padding: 12px;
`;const Title=title,useMultiSelect=()=>{const e=useDispatch(),t=reactExports.useRef(!1),r=()=>{window.removeEventListener("pointerup",r),t.current=!1};return{onMultiPointerDown:(l,c)=>{window.addEventListener("pointerup",r),e(toggleSelectedKey(c)),t.current=!0},onMultiPointerOver:(l,c)=>{t.current&&e(addSelectedKey(c))}}},getKeyboardCanvas=e=>e==="2D"?KeyboardCanvas$1:KeyboardCanvas,ConfigureKeyboard=e=>{const{selectable:t,dimensions:r}=e,s=useAppSelector(k=>getSelectedKeymap(k)||[]),i=useAppSelector(getSelectedKeyDefinitions),l=useAppSelector(getSelectedDefinition),c=useAppSelector(getShowKeyPainter),u=useAppSelector(getSelectedPaletteColor),{keyColors:p,onKeycapPointerDown:f,onKeycapPointerOver:m}=useColorPainter(i,u),[y,K]=reactExports.useMemo(()=>p&&i?[i.filter((k,j)=>p[j]&&p[j].length),p.filter(k=>k&&k.length)]:[null,null],[i,p]),x=useAppSelector(getSelectedRowTitle),{onMultiPointerDown:b,onMultiPointerOver:M}=useMultiSelect(),w=useAppSelector(getMultiSelectAble),L=useAppSelector(getActiveMenu);let F=DisplayMode.Configure;if(L==="DKS"?F=DisplayMode.ConfigureDKS:L==="RT"?F=DisplayMode.ConfigureRT:L==="AP"&&(F=DisplayMode.ConfigureAP),!l||!r)return null;const I=getKeyboardCanvas(e.nDimension);return jsxs(Fragment,{children:[x===Title?jsx(I,{matrixKeycodes:s,keys:i,selectable:!w&&!!t,multiSelect:w,definition:l,containerDimensions:r,mode:F,onKeycapPointerDown:w?b:void 0,onKeycapPointerOver:w?M:void 0}):jsx(I,{matrixKeycodes:s,keys:i,selectable:!!t,definition:l,containerDimensions:r,mode:DisplayMode.Configure,shouldHide:c}),y&&y.length&&K&&K.length?jsx(I,{matrixKeycodes:s,keys:y,selectable:c,definition:l,containerDimensions:r,mode:DisplayMode.ConfigureColors,keyColors:K,onKeycapPointerDown:f,onKeycapPointerOver:m,shouldHide:!c}):null]})},TestKeyboard=e=>{const{selectable:t,containerDimensions:r,matrixKeycodes:s,keys:i,pressedKeys:l,definition:c,nDimension:u}=e;if(!r)return null;const p=getKeyboardCanvas(u);return jsx(p,{matrixKeycodes:s,keys:i,selectable:!!t,definition:c,pressedKeys:l,containerDimensions:r,mode:DisplayMode.Test})},DesignKeyboard=e=>{const{containerDimensions:t,showMatrix:r,definition:s,selectedOptionKeys:i}=e,{keys:l,optionKeys:c}=s.layouts;if(!t)return null;const u=reactExports.useMemo(()=>c?Object.entries(c).flatMap(([m,y])=>{const K=parseInt(m);return i[K]?y[i[K]]:y[0]}):[],[c,i]),p=reactExports.useMemo(()=>[...l,...u],[l,u]),f=getKeyboardCanvas(e.nDimension);return jsx(f,{matrixKeycodes:EMPTY_ARR,keys:p,selectable:!1,definition:s,containerDimensions:t,mode:DisplayMode.Design,showMatrix:r})},Design=e=>{const t=Object.values(useAppSelector(getCustomDefinitions)),r=useAppSelector(getDesignDefinitionVersion),s=useAppSelector(getSelectedDefinitionIndex),i=useAppSelector(getDesignSelectedOptionKeys),l=useAppSelector(getShowMatrix),c=reactExports.useMemo(()=>t.filter(p=>p[r]),[t,r]),u=c[s]&&c[s][r];return u&&jsx(DesignKeyboard,{containerDimensions:e.dimensions,definition:u,selectedOptionKeys:i,showMatrix:l,nDimension:e.nDimension})},EMPTY_ARR=[],Test=e=>{const t=useAppDispatch(),[r]=useLocation(),s=r==="/test",i=useAppSelector(getSelectedKeyboardAPI),l=useAppSelector(getSelectedConnectedDevice),c=useAppSelector(getSelectedDefinition),u=useAppSelector(getSelectedKeyDefinitions),p=useAppSelector(getIsTestMatrixEnabled),f=useAppSelector(getTestKeyboardSoundsSettings),m=useAppSelector(z=>getSelectedKeymap(z)||[]),[y,K]=useGlobalKeys(!p&&s),[x,b]=useMatrixTest(p&&s,i,l,c),M=reactExports.useCallback(()=>{K(EMPTY_ARR),b(EMPTY_ARR)},[K,b]),w=reactExports.useContext(TestContext);reactExports.useEffect(()=>{w[0].clearTestKeys!==M&&w[1]({clearTestKeys:M})},[w,M]),reactExports.useEffect(()=>{r!=="/test"&&(t(setTestMatrixEnabled(!1)),w[0].clearTestKeys()),r!=="/"&&t(setLayer(0))},[r]);const L=p&&u?u.map(({row:z,col:te})=>c&&x[z*c.matrix.cols+te]):[],F=p?c:fullKeyboardDefinition,I=p?u:fullKeyboardDefinition.layouts.keys;if(!F||typeof F=="string")return null;const k=p?L:y,{partitionedKeys:j}=reactExports.useMemo(()=>getKeyboardRowPartitions(I),[I]),U=p?x:y,V=j.map(z=>z.map(({row:te,col:R})=>U[te*F.matrix.cols+R]));return jsxs(Fragment,{children:[jsx(TestKeyboard,{definition:F,keys:I,pressedKeys:k,matrixKeycodes:p?m:matrixKeycodes,containerDimensions:e.dimensions,nDimension:e.nDimension}),V&&f.isEnabled&&jsx(TestKeyboardSounds,{pressedKeys:V})]})},UpdateUVMaps=()=>{const e=useGLTF(glbSrc,!0).scene;return reactExports.useEffect(()=>{Object.values(e.children).forEach(t=>{if(t.isGroup)return;const r=t,s=1/2.6,i=r.geometry,{min:l}=i.boundingBox,c=19.05,u=.445,p=r.geometry.attributes.position;r.geometry.attributes.uv||r.geometry.setAttribute("uv",new BufferAttribute(new Float32Array(p.count*2),2,!1));const f=r.geometry.attributes.uv,m=new Float32Array(f.count*2);for(let y=0;y<r.geometry.attributes.uv.count;y++)m[2*y]=s*(p.array[y*3]-l.x+u)/c,m[2*y+1]=s*(p.array[y*3+1]-l.y+u)/c;f.copyArray(m),i.center(),f.needsUpdate=!0})},[e]),null},cubeySrc="/assets/cubey-495d68a6.glb",LoaderCubey=React.memo(({visible:e,theme:t})=>{const r=useGLTF(cubeySrc);console.debug(r,"cubey");const s=reactExports.useRef(),i=e?-.3:10,l=getDarkenedColor(t.accent.c,.8),c={"upper-body":new Color(t.mod.c),"lower-body":new Color(t.mod.t),accent:new Color(l),bowtie:new Color(l)};return r.scene.children.forEach(u=>{const p=u.name.split("_")[0],f=c[p];f&&(u.material.color=f)}),useFrame(({clock:u})=>{e&&(s.current.rotation.z=Math.sin(u.elapsedTime)*(Math.PI/40),s.current.rotation.y=Math.PI+Math.sin(.6*u.elapsedTime)*(Math.PI/16),s.current.position.y=i+.2*Math.sin(u.elapsedTime))}),jsx(Fragment,{children:jsx("group",{scale:.6,position:[0,i,-19],children:jsx(PresentationControls,{enabled:!0,global:!0,snap:!0,speed:1,zoom:1,rotation:[0,0,0],polar:[-Math.PI/3,Math.PI/3],config:{mass:2,tension:200,friction:14},children:jsx("group",{ref:s,children:jsx("primitive",{object:r.scene})})})})})},shallowEqual);useGLTF.preload(cubeySrc);useGLTF.preload(glbSrc);const KeyboardBG$1=React.memo(e=>{const{onClick:t,visible:r,color:s}=e;return jsxs("mesh",{receiveShadow:!0,position:[0,-5.75,0],rotation:[-Math.PI/2+Math.PI/14,0,0],onClick:t,visible:r,children:[jsx("planeGeometry",{args:[100,100]}),jsx("meshStandardMaterial",{color:s})]})},shallowEqual),CanvasRouter$1=()=>{const[e]=useLocation(),t=reactExports.useRef(document.body),r=reactExports.useRef(null),s=useAppSelector(getLoadProgress),{progress:i}=useProgress(),l=useAppDispatch(),c=useSize(t),u=Object.values(useAppSelector(getCustomDefinitions)),p=useAppSelector(getSelectedDefinition),f=useAppSelector(getDesignDefinitionVersion),m=useAppSelector(getSelectedTheme),y=reactExports.useMemo(()=>m[dist.KeyColorType.Accent].c,[m]),[K,x]=reactExports.useState(!1),b=e==="/"&&(!p||s!==1),M=reactExports.useMemo(()=>u.filter(V=>V[f]),[u,f]),w=e==="/design"&&!M.length,L=e==="/"&&(!p||(s+i/100)/2!==1),F=reactExports.useCallback(()=>{l(updateSelectedKey(null))},[l]),I="hid"in navigator||OVERRIDE_HID_CHECK,k=!I||["/settings","/errors","/boot","/boot2"].includes(e)||w||L,j=useAppSelector(getConfigureKeyboardIsSelectable),U=b;return reactExports.useEffect(()=>{document.fonts.load("bold 16px Fira Sans").finally(()=>{x(!0)})},[]),jsxs(Fragment,{children:[jsx(UpdateUVMaps,{}),jsx("div",{style:{height:500,width:"100%",top:0,transform:k?U?c?`translateY(${-300+c.height/2}px)`:"":"translateY(-500px)":"",position:k&&!U?"absolute":"relative",overflow:"visible",zIndex:0,visibility:k&&!U?"hidden":"visible"},ref:r,children:jsxs(Canvas,{flat:!0,shadows:!0,style:{overflow:"visible"},children:[jsx(Lights,{}),jsx(KeyboardBG$1,{onClick:F,color:y,visible:!U}),jsx(OrbitControls,{enabled:!1}),jsx(Camera,{}),jsx(LoaderCubey,{theme:m,visible:U&&!p}),jsx(Html,{center:!0,position:[0,U?p?0:-1:10,-19],children:I?p?jsx(Fragment,{children:jsx("div",{style:{textAlign:"center",color:"var(--color_accent)",fontSize:60},children:jsx(FontAwesomeIcon,{spinPulse:!0,icon:faSpinner})})}):jsxs(AccentButtonLarge,{onClick:()=>l(reloadConnectedDevices()),style:{width:"max-content"},children:["Authorize device",jsx(FontAwesomeIcon,{style:{marginLeft:"10px"},icon:faUnlock})]}):null}),K?jsx(KeyboardGroup$1,{containerRef:r,configureKeyboardIsSelectable:j,loadProgress:s}):null]})})]})},Lights=React.memo(()=>{const l=reactExports.useRef(null);reactExports.useEffect(()=>{l.current&&(l.current.shadow.mapSize.width=2048,l.current.shadow.mapSize.height=2048)},[l.current]);const c=React.useMemo(()=>{const p=new Object3D;return p.position.set(0,0,-19),p.updateMatrixWorld(),p},[]);return!0?jsxs(Fragment,{children:[jsx("ambientLight",{intensity:0}),jsx(SpotLight,{ref:l,distance:12+3,position:[0,12,-19+2],angle:Math.PI/5,attenuation:5,target:c,intensity:10,castShadow:!0,anglePower:5}),jsx("pointLight",{position:[3,.5,-15],intensity:.8}),jsx("pointLight",{position:[-3,.5,-15],intensity:.8})]}):jsxs(Fragment,{children:[jsx("ambientLight",{intensity:.4}),jsx("pointLight",{position:[-.5,.5,-15],intensity:1.5})]})},shallowEqual),getRouteX$1=e=>{switch(e){case"/debug":return-60;case"/design":return-40;case"/test":return-20;case"/":return 0;default:return-60}},KeyboardGroup$1=React.memo(e=>{const{loadProgress:t,configureKeyboardIsSelectable:r}=e,[s]=useLocation(),i=getRouteX$1(s),l=J({config:mt.stiff,x:i}),c=useSize(e.containerRef);return jsx(E.group,{"position-x":l.x,children:jsx(Keyboards$1,{configureKeyboardIsSelectable:r,loadProgress:t,dimensions:c})})},shallowEqual),Keyboards$1=React.memo(e=>{const{loadProgress:t,dimensions:r,configureKeyboardIsSelectable:s}=e,i=-getRouteX$1("/test"),l=-getRouteX$1("/design"),c=-getRouteX$1("/debug");return jsxs(Fragment,{children:[jsx("group",{visible:t===1,children:jsx(ConfigureKeyboard,{dimensions:r,selectable:s,nDimension:"3D"})}),jsx("group",{"position-x":i,children:jsx(Test,{dimensions:r,nDimension:"3D"})}),jsx("group",{"position-x":l,children:jsx(Design,{dimensions:r,nDimension:"3D"})}),jsx("group",{"position-x":c})]})},shallowEqual),KeyboardBG=styled.div`
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  background: ${e=>`linear-gradient(30deg, rgba(150,150,150,1) 10%,${getDarkenedColor(e.$color)} 50%, rgba(150,150,150,1) 90%)`};
  opacity: ${e=>e.$visible?1:0};
`,KeyboardRouteGroup=styled.div`
  position: absolute;
  left: 0;
  transform: translateX(${e=>e.$position*100}vw);
  height: 100%;
  width: 100vw;
  display: inline-flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
`,CanvasRouter=()=>{const[e]=useLocation(),t=reactExports.useRef(document.body),r=reactExports.useRef(null),s=useAppSelector(getLoadProgress),{progress:i}=useProgress(),l=useAppDispatch(),c=useSize(r),u=useSize(t),p=Object.values(useAppSelector(getCustomDefinitions)),f=useAppSelector(getSelectedDefinition),m=useAppSelector(getDesignDefinitionVersion),y=useAppSelector(getSelectedTheme),K=reactExports.useMemo(()=>y[dist.KeyColorType.Accent].c,[y]),x=e==="/"&&(!f||s!==1),b=reactExports.useMemo(()=>p.filter(U=>U[m]),[p,m]),M=e==="/design"&&!b.length,w=e==="/"&&(!f||(s+i/100)/2!==1),L=reactExports.useCallback(()=>{l(updateSelectedKey(null))},[l]),I=!("hid"in navigator||OVERRIDE_HID_CHECK)||["/settings","/errors","/boot","/boot2"].includes(e)||M||w,k=useAppSelector(getConfigureKeyboardIsSelectable),j=x;return jsx(Fragment,{children:jsx("div",{style:{height:500,width:"100%",top:0,transform:I?j?u?`translateY(${-300+u.height/2}px)`:"":"translateY(-500px)":"",position:I&&!j?"absolute":"relative",overflow:"visible",zIndex:2,visibility:I&&!j?"hidden":"visible"},onClick:U=>{U.target.nodeName!=="CANVAS"&&l(clearSelectedKey())},ref:r,children:I?null:jsxs(Fragment,{children:[jsx(KeyboardBG,{onClick:L,$color:K,$visible:!j}),jsx(KeyboardGroup,{containerDimensions:c,configureKeyboardIsSelectable:k,loadProgress:s})]})})})},getRouteX=e=>{switch(e){case"/debug":return-300;case"/design":return-200;case"/test":return-100;case"/":return 0;default:return-300}},KeyboardGroupContainer=styled.div`
  z-index: 2;
  display: block;
  white-space: nowrap;
  height: 100%;
  background: linear-gradient(90deg, red, blue);
  width: max-content;
  position: absolute;
  top: 0;
  left: 0;
`,KeyboardGroup=React.memo(e=>{const t=useDispatch(),{loadProgress:r,configureKeyboardIsSelectable:s,containerDimensions:i}=e,[l]=useLocation(),c=reactExports.useRef(null),u=getRouteX(l),p={transition:"transform 0.25s ease-in-out",transform:`translate(${u}vw, 0px)`},f=reactExports.useCallback(()=>{c.current&&(c.current.style.transition=p.transition)},[c.current]),m=reactExports.useCallback(()=>{c.current&&(c.current.style.transition="")},[c.current]);return reactExports.useEffect(()=>(c.current&&(c.current.addEventListener("transitionend",m),c.current.style.transform=p.transform),()=>{var y;c.current&&((y=c.current)==null||y.removeEventListener("transitionend",m))}),[]),reactExports.useEffect(()=>{c.current&&c.current.style.transform!==p.transform&&(f(),c.current.style.transform=p.transform)},[u]),jsx(KeyboardGroupContainer,{onClick:y=>{var K;((K=y.target)==null?void 0:K.parentNode)===c.current&&t(updateSelectedKeys([]))},ref:c,children:jsx(Keyboards,{configureKeyboardIsSelectable:s,loadProgress:r,dimensions:i})})},shallowEqual),Keyboards=React.memo(e=>{const{dimensions:t,configureKeyboardIsSelectable:r}=e;return jsxs(Fragment,{children:[jsx(KeyboardRouteGroup,{$position:0,children:jsx(ConfigureKeyboard,{dimensions:t,selectable:r,nDimension:"2D"})}),jsx(KeyboardRouteGroup,{$position:1,children:jsx(Test,{dimensions:t,nDimension:"2D"})}),jsx(KeyboardRouteGroup,{$position:2,children:jsx(Design,{dimensions:t,nDimension:"2D"})}),jsx(KeyboardRouteGroup,{$position:3})]})},shallowEqual),GlobalStyle=createGlobalStyle`
  *:focus {
    outline: none;
  }
`,hashLocation=()=>window.location.hash.replace(/^#/,"")||"/",hashNavigate=e=>navigate("#"+e),useHashLocation=(...e)=>[useLocationProperty(hashLocation),hashNavigate],Routes=()=>{const e="hid"in navigator||OVERRIDE_HID_CHECK,t=useAppSelector(getRenderMode),r=reactExports.useMemo(()=>PANES.map(l=>jsx(Route,{component:l.component,path:l.path},l.key)),[]),s=t==="2D"?CanvasRouter:CanvasRouter$1,i=reactExports.useState({clearTestKeys:()=>{}});return jsx(Fragment,{children:jsx(ErrorBoundary,{showDialog:!0,children:jsx(Router,{hook:useHashLocation,children:jsxs(TestContext.Provider,{value:i,children:[jsx(GlobalStyle,{}),e&&jsx(UnconnectedGlobalMenu,{}),jsx(s,{}),jsx(Home,{hasHIDSupport:e,children:r})]})})})})},Root=()=>jsx(Provider,{store,children:jsx(Routes,{})}),app_global="";instance.use(Browser$1).use(initReactI18next).use(resourcesToBackend(e=>__variableDynamicImportRuntimeHelper(Object.assign({"./locales/en.json":()=>__vitePreload(()=>import("./en-d8a2cbb6.js"),[]),"./locales/ja.json":()=>__vitePreload(()=>import("./ja-986a8e05.js"),[]),"./locales/ko.json":()=>__vitePreload(()=>import("./ko-53fa904f.js"),[]),"./locales/zh.json":()=>__vitePreload(()=>import("./zh-c2912911.js"),[])}),`./locales/${e}.json`))).init({fallbackLng:"en",debug:!1,interpolation:{escapeValue:!1}});const elem=document.getElementById("root");elem&&(createRoot(elem).render(jsx(Root,{})),document.documentElement.dataset.themeMode=getThemeModeFromStore(),updateCSSVariables(getThemeNameFromStore()));
